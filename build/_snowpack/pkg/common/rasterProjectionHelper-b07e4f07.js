import { _ as j$1, s, M as M$1, ai as g$1, aq as S } from './Identifiable-c8406192.js';
import { G } from './unitUtils-1b0a3531.js';
import { V, X, D, H, O } from './projection-1aa78979.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
const u=5e-4,m=function(e,n){const t=(e.isWGS84||e.isWebMercator)&&(n.isWGS84||n.isWebMercator);return !(e.equals(n)||t)},p=function(e,n){const t=(e[0]+e[4]+e[4*n.cols]+e[4*n.cols+4])/4,o=(e[1]+e[5]+e[4*n.rows+1]+e[4*n.rows+5])/4;return [Math.abs(t-e[2*n.rows+2]),Math.abs(o-e[2*n.rows+3])]},f=32;async function h(){if(V()||!X())return null;await D();}function y(n,t,o){if(!m(n.spatialReference,t))return null;if(!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");return o?O(t,n.spatialReference,n):O(n.spatialReference,t,n)}function M(n,o,r,s$1=null){if(n.spatialReference.equals(o))return n;const l=m(n.spatialReference,o);if(l&&!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");const c=r.center,u=new M$1({xmin:c.x-n.x/2,xmax:c.x+n.x/2,ymin:c.y-n.y/2,ymax:c.y+n.y/2,spatialReference:n.spatialReference}),p=l?H(u,o,s$1):g$1(u,o);if(null==p)return null;return {x:p.xmax-p.xmin,y:p.ymax-p.ymin}}function w(e,n=.01){return G(e)?n/G(e):0}function d(o,i,r=null,s$1=!0){const l=o.spatialReference;if(l.equals(i))return o;const c=m(l,i);if(c&&!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");const p=c?H(o,i,r):g$1(o,i);if(p&&s$1&&i.isGeographic){var f,h;const[e,t]=l.isWebMercator?S(l).origin:null!=(f=null==(h=S(l))?void 0:h.valid)?f:[],i=w(l);i&&null!=e&&null!=t&&(Math.abs(o.x-e)<i&&Math.abs(180-p.x)<u?p.x-=360:Math.abs(o.x-t)<i&&Math.abs(180+p.x)<u&&(p.x+=360));}return p}function g(i,r,s$1=null,l=!0){var c,p,f,h;const y=i.spatialReference;if(y.equals(r))return i;const M=m(y,r);if(M&&!V())throw new s("rasterprojectionhelper-projectExtent","projection engine is not loaded");const g=M?H(i,r,s$1):g$1(i,r);let[R,j]=null!=(c=null==(p=S(y))?void 0:p.origin)?c:[];if(g&&l&&y.isWebMercator&&r.isGeographic&&null!=R&&null!=j){const e=.001,n=1e3;if(Math.abs(i.xmin-R)<e&&Math.abs(j-i.xmax)>n&&Math.abs(180-g.xmax)<u){g.xmin=-180;const e=[];e.push(new j$1(i.xmax,i.ymin,y)),e.push(new j$1(i.xmax,(i.ymin+i.ymax)/2,y)),e.push(new j$1(i.xmax,i.ymax,y));const n=e.map((e=>d(e,r,s$1))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmax=Math.max.apply(null,n);}if(Math.abs(i.xmax-j)<e&&Math.abs(R-i.xmin)>n&&Math.abs(180+g.xmin)<u){g.xmax=180;const e=[];e.push(new j$1(i.xmin,i.ymin,y)),e.push(new j$1(i.xmin,(i.ymin+i.ymax)/2,y)),e.push(new j$1(i.xmin,i.ymax,y));const n=e.map((e=>d(e,r,s$1))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmin=Math.min.apply(null,n);}}[R,j]=r.isWebMercator?S(r).origin:null!=(f=null==(h=S(r))?void 0:h.valid)?f:[];const b=w(r);return b&&null!=R&&null!=j&&(Math.abs(g.xmin-R)<b&&(g.xmin=R),Math.abs(g.xmax-j)<b&&(g.xmax=j)),g}function R(t,i,r,s$1=null,l=null,c=!1,x=[f,f]){var u,h;if(m(t.spatialReference,i.spatialReference)&&!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(t&&i&&r))return null;const{xmin:y,ymin:M,xmax:w,ymax:g}=t,R=t.spatialReference,j=i.spatialReference,[b,v]=null!=(u=null==(h=S(R))?void 0:h.valid)?u:[],N={x:x[0]*r.x,y:x[1]*r.y},S$1={cols:Math.ceil((w-y)/N.x-.1)+1,rows:Math.ceil((g-M)/N.y-.1)+1},z=N.x,W=N.y,G=[];let P,L=!1;for(let e=0;e<S$1.cols;e++){const n=[];for(let t=0;t<S$1.rows;t++){let r=d(new j$1({x:y+z*e,y:g-W*t,spatialReference:R}),j,s$1);l&&(r=l.inverseTransform(r)),n.push(r),e>0&&c&&r&&P[t]&&null!=b&&r.x<P[t].x&&(r.x+=v-b),r?(G.push((r.x-i.xmin)/(i.xmax-i.xmin)),G.push((i.ymax-r.y)/(i.ymax-i.ymin))):(G.push(NaN),G.push(NaN),L=!0);}P=n;}const q=p(G,S$1),A=new Float32Array((S$1.cols-1)*(S$1.rows-1)*2*6),E=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),F=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<S$1.cols-1;e++){for(let n=0;n<S$1.rows-1;n++){let t=e*S$1.rows*2+2*n;const o=G[t],i=G[t+1],r=G[t+2],a=G[t+3];t+=2*S$1.rows;const s=G[t],l=G[t+1],c=G[t+2],x=G[t+3];let u=0,m=12*(n*(S$1.cols-1)+e);for(let e=0;e<3;e++)A[m++]=E[u++]*o+E[u++]*r+E[u++]*c;u=0;for(let e=0;e<3;e++)A[m++]=E[u++]*i+E[u++]*a+E[u++]*x;u=0;for(let e=0;e<3;e++)A[m++]=F[u++]*o+F[u++]*s+F[u++]*c;u=0;for(let e=0;e<3;e++)A[m++]=F[u++]*i+F[u++]*l+F[u++]*x;}if(L)for(let e=0;e<A.length;e++)isNaN(A[e])&&(A[e]=-1);}return {offsets:G,error:q,coefficients:A,spacing:x,size:[S$1.cols-1,S$1.rows-1]}}function j(e,n,t){const i=Math.log(e.x/n.pixelSize.x)/Math.LN2,r=Math.log(e.y/n.pixelSize.y)/Math.LN2,a=n.storageInfo.maximumPyramidLevel||0;let s="down"===t?Math.floor(Math.min(i,r)):"up"===t?Math.ceil(Math.max(i,r)):Math.round((i+r)/2),l=!1;s<0?s=0:s>a&&(l=s>a+3,s=a);const c=2**s;return {pyramidLevel:s,pyramidResolution:new j$1({x:c*n.nativePixelSize.x,y:c*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:l}}function b(e,n,t=512,i=!0){const{extent:a,spatialReference:s,pixelSize:l}=e,c=M(new j$1({x:l.x,y:l.y,spatialReference:s}),n,a);if(null==c)return {projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const x=(c.x+c.y)/2,u=G(n),m=x*u*96*39.37,p=n.isGeographic?512/t*295828763.7958547:512/t*591657527.591555;let f=!1;const h=g(a,n);i&&(n.isGeographic||n.isWebMercator)&&(f=h.xmin*h.xmax<0);let y,w=m;const d=1.001;if(f){w=p;const e=.29858214164761665,n=e*(96*u*39.37);y=M(new j$1({x:e,y:e,spatialReference:{wkid:3857}}),s,h),y.x*=w/n,y.y*=w/n;}else {y={x:l.x,y:l.y};const n=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let t=0;for(;w<p*(d/2)&&t<n;)t++,w*=2,y.x*=2,y.y*=2;Math.max(w,p)/Math.min(w,p)<=d&&(w=p);}const R=[w],j=[{x:y.x,y:y.y}],b=70.5310735,v=Math.min(b,m)/d;for(;w>=v;)w/=2,y.x/=2,y.y/=2,R.push(w),j.push({x:y.x,y:y.y});return {projectedPixelSize:c,scales:R,srcResolutions:j,isCustomTilingScheme:!f}}

export { M, R, b, d, g, h, j, y };
