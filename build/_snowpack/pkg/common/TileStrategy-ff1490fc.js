import { a as a$6 } from './vec3-ae5ae182.js';
import { e as e$3, y as y$1, i as i$3, u as u$4 } from './Identifiable-c8406192.js';
import './config-b3bf08ce.js';
import { d as d$1, q as q$1 } from './vec2-f6c2e17c.js';
import { _ as _$1, l as l$5 } from './TileInfoView-40300351.js';
import { e as e$4 } from './TileKey-482fe256.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
function a$5(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t}function n$4(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function s$2(t,a,n,s,r,u,o){return t[0]=a,t[1]=n,t[2]=s,t[3]=r,t[4]=u,t[5]=o,t}function r$2(t,a){const n=a[0],s=a[1],r=a[2],u=a[3],o=a[4],c=a[5];let e=n*u-s*r;return e?(e=1/e,t[0]=u*e,t[1]=-s*e,t[2]=-r*e,t[3]=n*e,t[4]=(r*c-u*o)*e,t[5]=(s*o-n*c)*e,t):null}function u$3(t){return t[0]*t[3]-t[1]*t[2]}function o$2(t,a,n){const s=a[0],r=a[1],u=a[2],o=a[3],c=a[4],e=a[5],i=n[0],h=n[1],M=n[2],f=n[3],b=n[4],l=n[5];return t[0]=s*i+u*h,t[1]=r*i+o*h,t[2]=s*M+u*f,t[3]=r*M+o*f,t[4]=s*b+u*l+c,t[5]=r*b+o*l+e,t}function c$4(t,a,n){const s=a[0],r=a[1],u=a[2],o=a[3],c=a[4],e=a[5],i=Math.sin(n),h=Math.cos(n);return t[0]=s*h+u*i,t[1]=r*h+o*i,t[2]=s*-i+u*h,t[3]=r*-i+o*h,t[4]=c,t[5]=e,t}function e$2(t,a,n){const s=a[0],r=a[1],u=a[2],o=a[3],c=a[4],e=a[5],i=n[0],h=n[1];return t[0]=s*i,t[1]=r*i,t[2]=u*h,t[3]=o*h,t[4]=c,t[5]=e,t}function i$2(t,a,n){const s=a[0],r=a[1],u=a[2],o=a[3],c=a[4],e=a[5],i=n[0],h=n[1];return t[0]=s,t[1]=r,t[2]=u,t[3]=o,t[4]=s*i+u*h+c,t[5]=r*i+o*h+e,t}function h$3(t,a){const n=Math.sin(a),s=Math.cos(a);return t[0]=s,t[1]=n,t[2]=-n,t[3]=s,t[4]=0,t[5]=0,t}function M(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=a[1],t[4]=0,t[5]=0,t}function f$1(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=a[0],t[5]=a[1],t}function b(t){return "mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function l$4(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function m(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t[4]=a[4]+n[4],t[5]=a[5]+n[5],t}function d(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t[4]=a[4]-n[4],t[5]=a[5]-n[5],t}function p$1(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*n,t[5]=a[5]*n,t}function x(t,a,n,s){return t[0]=a[0]+n[0]*s,t[1]=a[1]+n[1]*s,t[2]=a[2]+n[2]*s,t[3]=a[3]+n[3]*s,t[4]=a[4]+n[4]*s,t[5]=a[5]+n[5]*s,t}function y(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]}function q(a,n){const s=a[0],r=a[1],u=a[2],o=a[3],c=a[4],e=a[5],i=n[0],h=n[1],M=n[2],f=n[3],b=n[4],l=n[5];return Math.abs(s-i)<=a$6*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(r-h)<=a$6*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(u-M)<=a$6*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(o-f)<=a$6*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(c-b)<=a$6*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(e-l)<=a$6*Math.max(1,Math.abs(e),Math.abs(l))}const _=o$2,j=d;Object.freeze({__proto__:null,copy:a$5,identity:n$4,set:s$2,invert:r$2,determinant:u$3,multiply:o$2,rotate:c$4,scale:e$2,translate:i$2,fromRotation:h$3,fromScaling:M,fromTranslation:f$1,str:b,frob:l$4,add:m,subtract:d,multiplyScalar:p$1,multiplyScalarAndAdd:x,exactEquals:y,equals:q,mul:_,sub:j});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
function n$3(){const n=new Float32Array(6);return n[0]=1,n[3]=1,n}function t$2(n){const t=new Float32Array(6);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t}function r$1(n,t,r,a,o,e){const c=new Float32Array(6);return c[0]=n,c[1]=t,c[2]=r,c[3]=a,c[4]=o,c[5]=e,c}function a$4(n,t){return new Float32Array(n,t,6)}function o$1(n,t,r,a){const o=t[a],e=t[a+1];n[a]=r[0]*o+r[2]*e+r[4],n[a+1]=r[1]*o+r[3]*e+r[5];}function e$1(n,t,r,a=0,e=0,c=2){const s=e||t.length/c;for(let f=a;f<s;f++){o$1(n,t,r,f*c);}}Object.freeze({__proto__:null,create:n$3,clone:t$2,fromValues:r$1,createView:a$4,transform:o$1,transformMany:e$1});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
function n$2(){return new Float32Array(2)}function r(n){const r=new Float32Array(2);return r[0]=n[0],r[1]=n[1],r}function t$1(n,r){const t=new Float32Array(2);return t[0]=n,t[1]=r,t}function e(n,r){return new Float32Array(n,r,2)}function a$3(){return n$2()}function o(){return t$1(1,1)}function u$2(){return t$1(1,0)}function s$1(){return t$1(0,1)}const c$3=a$3(),f=o(),i$1=u$2(),l$3=s$1();Object.freeze({__proto__:null,create:n$2,clone:r,fromValues:t$1,createView:e,zeros:a$3,ones:o,unitX:u$2,unitY:s$1,ZEROS:c$3,ONES:f,UNIT_X:i$1,UNIT_Y:l$3});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
function n$1(e,t){return e.length=0,t.forEach((t=>e.push(t))),e}const u$1=new Set,c$2=[],a$2=new Map,h$2=[0,0];let l$2=class extends u$4{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null;}initialize(){const{concurrency:e,process:t}=this;this._queue=new _$1({concurrency:e,process:(e,s)=>{const r=this._keyToItem.get(e);return t(r,{signal:s})},peeker:e=>e.values().next().value});}destroy(){this.clear(),this._queue.destroy(),this._queue=null;}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t);}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating");}has(e){return "string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause();}push(e,t){const s=e.key.id+"-"+t;if(this.has(s))return this.get(s);const r=this._queue.push(s),o=()=>{this._keyToItem.delete(s),this.notifyChange("updating");};return this._keyToItem.set(s,e),r.then(o,o),this.notifyChange("updating"),r}reset(){this._queue.reset(),this.notifyChange("updating");}resume(){this._queue.resume();}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),o=this.tileInfoView.getTileScale(t.key);a$2.has(o)||(a$2.set(o,[]),s=Math.max(o,s),r=Math.min(o,r)),a$2.get(o).push(t.key),u$1.add(o);}));let o=this.state.scale;a$2.has(o)||(n$1(c$2,u$1),c$2.sort(),o=c$2.reduce(((e,t)=>Math.abs(t-o)<Math.abs(e-o)?t:e),c$2[0])),o=Math.min(o,s),o=Math.max(o,r);const i=a$2.get(o),h=t.getClosestInfoForScale(o),l=h.getColumnForX(this.state.center[0]),p=h.getRowForY(this.state.center[1]);return i.sort(((e,t)=>{const s=h.denormalizeCol(e.col,e.world),r=h.denormalizeCol(t.col,t.world);return Math.sqrt((l-s)*(l-s)+(p-e.row)*(p-e.row))-Math.sqrt((l-r)*(l-r)+(p-t.row)*(p-t.row))})),u$1.clear(),a$2.clear(),i[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,s=this.state.center;let r=Number.POSITIVE_INFINITY,i=null;return e.forEach((e=>{const n=this._keyToItem.get(e);t.getTileCoords(h$2,n.key);const u=d$1(h$2,s);u<r&&(r=u,i=n.key);})),i.id}};e$3([y$1({constructOnly:!0})],l$2.prototype,"concurrency",void 0),e$3([y$1({constructOnly:!0})],l$2.prototype,"process",void 0),e$3([y$1()],l$2.prototype,"state",void 0),e$3([y$1({constructOnly:!0})],l$2.prototype,"strategy",void 0),e$3([y$1({constructOnly:!0})],l$2.prototype,"tileInfoView",void 0),e$3([y$1({readOnly:!0})],l$2.prototype,"updating",null),l$2=e$3([i$3("esri.views.2d.tiling.PagedTileQueue")],l$2);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
function n(e,t){return e.length=0,t.forEach((t=>e.push(t))),e}const u=new Set,c$1=[],a$1=new Map,h$1=[0,0];let l$1=class extends u$4{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null;}initialize(){const{concurrency:e,process:t,strategy:s}=this;this._queue=new _$1({concurrency:e,process:(e,s)=>{const r=this._keyToItem.get(e);return t(r,{signal:s})},peeker:"scale-first"===s?e=>this._peekByScaleFirst(e):e=>this._peekByCenterFirst(e)});}destroy(){this.clear(),this._queue.destroy(),this._queue=null;}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t);}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating");}has(e){return "string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause();}push(e){const t=e.key.id;if(this.has(t))return this.get(t);const s=this._queue.push(t),r=()=>{this._keyToItem.delete(t),this.notifyChange("updating");};return this._keyToItem.set(t,e),s.then(r,r),this.notifyChange("updating"),s}reset(){this._queue.reset(),this.notifyChange("updating");}resume(){this._queue.resume();}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),o=this.tileInfoView.getTileScale(t.key);a$1.has(o)||(a$1.set(o,[]),s=Math.max(o,s),r=Math.min(o,r)),a$1.get(o).push(t.key),u.add(o);}));let o=this.state.scale;a$1.has(o)||(n(c$1,u),c$1.sort(),o=c$1.reduce(((e,t)=>Math.abs(t-o)<Math.abs(e-o)?t:e),c$1[0])),o=Math.min(o,s),o=Math.max(o,r);const i=a$1.get(o),h=t.getClosestInfoForScale(o),l=h.getColumnForX(this.state.center[0]),p=h.getRowForY(this.state.center[1]);return i.sort(((e,t)=>{const s=h.denormalizeCol(e.col,e.world),r=h.denormalizeCol(t.col,t.world);return Math.sqrt((l-s)*(l-s)+(p-e.row)*(p-e.row))-Math.sqrt((l-r)*(l-r)+(p-t.row)*(p-t.row))})),u.clear(),a$1.clear(),i[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,s=this.state.center;let r=Number.POSITIVE_INFINITY,i=null;return e.forEach((e=>{const n=this._keyToItem.get(e);t.getTileCoords(h$1,n.key);const u=d$1(h$1,s);u<r&&(r=u,i=n.key);})),i.id}};e$3([y$1({constructOnly:!0})],l$1.prototype,"concurrency",void 0),e$3([y$1({constructOnly:!0})],l$1.prototype,"process",void 0),e$3([y$1()],l$1.prototype,"state",void 0),e$3([y$1({constructOnly:!0})],l$1.prototype,"strategy",void 0),e$3([y$1({constructOnly:!0})],l$1.prototype,"tileInfoView",void 0),e$3([y$1({readOnly:!0})],l$1.prototype,"updating",null),l$1=e$3([i$3("esri.views.2d.tiling.TileQueue")],l$1);var p=l$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
class t{constructor(e,t,i){this.maxSize=e,this.tileInfoView=t,this.removedFunc=i,this._tilePerId=new Map,this._tileKeysPerLevel=[];}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const t=this._tilePerId.get(e);if(!t)return null;const r=t.key.level,s=this._tileKeysPerLevel[r];i(this._tilePerId,e);for(let i=0;i<s.length;i++)if(s[i].id===e){s.splice(i,1);break}return t.visible=!0,t}add(e){e.visible=!1;const t=e.key,i=t.id;if(this._tilePerId.has(i))return;this._tilePerId.set(i,e);const r=t.level;this._tileKeysPerLevel[r]||(this._tileKeysPerLevel[r]=[]),this._tileKeysPerLevel[r].push(t);}prune(e,t,i){let r=this._tilePerId.size;if(r<=this.maxSize)return;let s=this._tileKeysPerLevel.length-1;for(;r>this.maxSize&&s>=0;)s!==e&&(r=this._pruneAroundCenterTile(r,t,i,s)),s--;r>this.maxSize&&(r=this._pruneAroundCenterTile(r,t,i,e));}_pruneAroundCenterTile(t,i,r,s){const l=this._tileKeysPerLevel[s];if(!l||0===l.length)return t;const{size:n,origin:h}=this.tileInfoView.tileInfo,o=r*n[0],u=r*n[1],d=[0,0],_=[0,0];for(l.sort(((t,r)=>(d[0]=h.x+o*(t.col+.5),d[1]=h.y-u*(t.row+.5),_[0]=h.x+o*(r.col+.5),_[1]=h.y-u*(r.row+.5),q$1(d,i)-q$1(_,i))));l.length>0;){const e=l.pop();if(this._removeTile(e.id),--t===this.maxSize)break}return t}_removeTile(e){const t=this._tilePerId.get(e);this.removedFunc&&this.removedFunc(t),i(this._tilePerId,e);}}function i(e,t){e.delete(t);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
const s=new e$4(0,0,0,0),l=new Map,a=[],h=[];class c{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=null==e.resampling||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new t(e.cacheSize,this.tileInfoView,(e=>{this.releaseTile(e);})));}destroy(){this.tileIndex.clear();}update(e){const{resampling:t,tileIndex:c}=this,o=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(h.length=0,a.length=0,l.clear(),!o)return;const{minScale:r,maxScale:n}=this.tileInfoView.tileInfo,{spans:f,lodInfo:d}=o,{level:u}=d,{scale:p,center:g,resolution:y}=e.state,I=!e.stationary&&p>this._previousScale;if(this._previousScale=p,this.tiles.length=0,!t&&(p>r||p<n))return this.tiles.length=0,l.clear(),c.forEach((e=>{this.releaseTile(e);})),c.clear(),h.length=0,a.length=0,l.clear(),l$5.pool.release(o),!0;c.forEach((e=>e.visible=!0));let T=0,_=0;if(f.length>0)for(const{row:i,colFrom:a,colTo:h}of f)for(let e=a;e<=h;e++){T++;const t=s.set(u,i,d.normalizeCol(e),d.getWorldForColumn(e)).id;if(c.has(t)){const e=c.get(t);e.isReady?(l.set(t,e),_++):I||this._addParentTile(t,l);}else {let e;if(this._tileCache&&this._tileCache.has(t)){if(e=this._tileCache.pop(t),this.tileIndex.set(t,e),e.isReady){l.set(t,e),_++;continue}}else e=this.acquireTile(s),this.tileIndex.set(t,e);I||this._addParentTile(t,l);}}const C=_===T;c.forEach(((e,i)=>{if(s.set(i),l.has(i))return;const t=this.tileInfoView.intersects(o,s),c="purge"===this.cachePolicy?s.level!==u:s.level>u;!t||!I&&C?!c&&t||a.push(i):e.isReady?h.push(i):c&&a.push(i);}));for(const i of h){const e=c.get(i);e&&e.isReady&&l.set(i,e);}for(const i of a){const e=c.get(i);this._tileCache?this._tileCache.add(e):this.releaseTile(e),c.delete(i);}return l.forEach((e=>this.tiles.push(e))),c.forEach((e=>{l.has(e.key.id)||(e.visible=!1);})),this._tileCache&&this._tileCache.prune(u,g,y),l$5.pool.release(o),l.clear(),C}clear(e=!0){const{tileIndex:i}=this;e&&i.forEach((e=>{this.releaseTile(e);})),i.clear();}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e);}_addParentTile(e,i){let t=e,s=null;for(;t=this.tileInfoView.getTileParentId(t),t;)if(this.tileIndex.has(t)){if(s=this.tileIndex.get(t),s&&s.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if(this._tileCache&&this._tileCache.has(t)&&(s=this._tileCache.pop(t),this.tileIndex.set(t,s),s&&s.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}}

export { M, n$3 as a, n$2 as b, c$4 as c, e$1 as d, e$2 as e, c as f, h$3 as h, i$2 as i, n$4 as n, o$2 as o, p, r$2 as r, t$1 as t };
