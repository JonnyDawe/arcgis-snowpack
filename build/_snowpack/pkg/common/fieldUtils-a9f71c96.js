import { y as y$2, t as t$5, o as o$2 } from './config-b3bf08ce.js';
import { aM as t$4, e, y as y$1, r, i as i$5, a as a$3, A as k$1, P as r$1, J as t$6, s as s$2 } from './Identifiable-c8406192.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
const c$2=new t$4({inherited:"inherited",codedValue:"coded-value",range:"range"});let i$4=class extends a$3{constructor(r){super(r),this.name=null,this.type=null;}};e([y$1({type:String,json:{write:!0}})],i$4.prototype,"name",void 0),e([r(c$2)],i$4.prototype,"type",void 0),i$4=e([i$5("esri.layers.support.Domain")],i$4);var a$2=i$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
var t$3;let p$2=t$3=class extends a$3{constructor(r){super(r),this.name=null,this.code=null;}clone(){return new t$3({name:this.name,code:this.code})}};e([y$1({type:String,json:{write:!0}})],p$2.prototype,"name",void 0),e([y$1({type:[String,Number],json:{write:!0}})],p$2.prototype,"code",void 0),p$2=t$3=e([i$5("esri.layers.support.CodedValue")],p$2);var c$1=p$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
var a$1;let i$3=a$1=class extends a$2{constructor(o){super(o),this.codedValues=null,this.type="coded-value";}getName(o){let e=null;if(this.codedValues){const r=String(o);this.codedValues.some((o=>(String(o.code)===r&&(e=o.name),!!e)));}return e}clone(){return new a$1({codedValues:y$2(this.codedValues),name:this.name})}};e([y$1({type:[c$1],json:{write:!0}})],i$3.prototype,"codedValues",void 0),e([r({codedValue:"coded-value"})],i$3.prototype,"type",void 0),i$3=a$1=e([i$5("esri.layers.support.CodedValueDomain")],i$3);var u$2=i$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
var t$2;let p$1=t$2=class extends a$2{constructor(r){super(r),this.type="inherited";}clone(){return new t$2}};e([r({inherited:"inherited"})],p$1.prototype,"type",void 0),p$1=t$2=e([i$5("esri.layers.support.InheritedDomain")],p$1);var i$2=p$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
var s$1;let i$1=s$1=class extends a$2{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range";}clone(){return new s$1({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};e([y$1({type:Number,json:{type:[Number],read:{source:"range",reader:(e,r)=>r.range&&r.range[1]},write:{enabled:!1,overridePolicy(){return {enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,r,o){r[o]=[this.minValue||0,e];}}}})],i$1.prototype,"maxValue",void 0),e([y$1({type:Number,json:{type:[Number],read:{source:"range",reader:(e,r)=>r.range&&r.range[0]},write:{target:"range",writer(e,r,o){r[o]=[e,this.maxValue||0];}}}})],i$1.prototype,"minValue",void 0),e([r({range:"range"})],i$1.prototype,"type",void 0),i$1=s$1=e([i$5("esri.layers.support.RangeDomain")],i$1);var n$1=i$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
var o$1;function t$1(e,n){switch(e.type){case"range":{const a="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+n<a||+n>r)return o$1.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every((e=>null==e||e.code!==n)))return o$1.INVALID_CODED_VALUE}return null}!function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value";}(o$1||(o$1={}));const u$1={key:"type",base:a$2,typeMap:{range:n$1,"coded-value":u$2,inherited:i$2}};function d$1(e){if(!e||!e.type)return null;switch(e.type){case"range":return n$1.fromJSON(e);case"codedValue":return u$2.fromJSON(e);case"inherited":return i$2.fromJSON(e)}return null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
let t;async function a(){return t||(t=(async()=>{const e=await import('./arcadeUtils-0513dddf.js').then(function (n) { return n.aq; });return await e.arcade.load(),{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),t}const s=(e,r,t)=>o.create(e,r,t,null,["$feature"]),i=(e,r,t)=>o.create(e,r,t,null,["$feature","$view"]),n=(e,r,t,a)=>o.create(e,r,t,a,["$feature","$view"]);class o{constructor(e,r,t,a,s,i,c,n){this.script=e,this.evaluate=s,this.fields=c,this._syntaxTree=a,this._arcade=r,this._arcadeDictionary=t,this._arcadeFeature=i,this._spatialReference=n,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale");}static async create(t,s,i,c,n,l){const{arcade:u,Feature:p,Dictionary:d}=await a(),f=k$1.fromJSON(s),h=u.parseScript(t,l),m=n.reduce(((e,r)=>({...e,[r]:null})),{});let y=null;r$1(c)&&(y=new d(c),y.immutable=!0,m.$config=null);const _=u.scriptUsesGeometryEngine(h)&&u.enableGeometrySupport(),F=u.scriptUsesFeatureSet(h)&&u.enableFeatureSetSupport(),w=u.scriptIsAsync(h)&&u.enableAsyncSupport(),S={vars:m,spatialReference:f,useAsync:!!w},b=new d;b.immutable=!1,b.setField("scale",0);const $=u.compileScript(h,S),x=e=>("$view"in e&&e.$view&&(b.setField("scale",e.$view.scale),e.$view=b),y&&(e.$config=y),$({vars:e,spatialReference:f}));return await Promise.all([_,F,w]),new o(t,u,d,h,x,new p,i,f)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}repurposeAdapter(e){return this._arcadeFeature.repurposeFromAdapter(e,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(e){return this._arcade.extractFieldLiterals(this._syntaxTree,e)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
const u=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],f=["field","normalizationField"];function c(e,n){if(null!=e&&null!=n)for(const i of Array.isArray(e)?e:[e])if(d(u,i,n),"visualVariables"in i&&i.visualVariables)for(const e of i.visualVariables)d(f,e,n);}function d(i,t,r){if(i)for(const o of i){const i=t$5(o,t),l=i&&"function"!=typeof i&&T(r,i);l&&o$2(o,l.name,t);}}function m(e,n){if(null!=e&&null!=n)if("startField"in e){const i=T(n,e.startField),t=T(n,e.endField);e.startField=i&&i.name||null,e.endField=t&&t.name||null;}else {const i=T(n,e.startTimeField),t=T(n,e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=t&&t.name||null;}}const p=new Set;function y(e,n){return e&&n?(p.clear(),g(p,e,n),Array.from(p).sort()):[]}function g(e,n,i){if(i)if(n&&n.length)if(i.includes("*"))for(const{name:t}of n)e.add(t);else for(const t of i)F(e,n,t);else {if(i.includes("*"))return e.clear(),void e.add("*");for(const n of i)e.add(n);}}function F(e,n,i){if(n&&n.length){const t=T(n,i);t&&e.add(t.name);}else "string"==typeof i&&e.add(i);}function I(e,n){return t$6(n)||t$6(e)?[]:n.includes("*")?e.map((e=>e.name)):n}function T(e,n){if("string"!=typeof n)return null;if(null!=e){n=n.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===n)return i}return null}function h(e,n){if(!e||!n||"string"!=typeof n)return !1;n=n.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===n)return !0;return !1}async function w(e,n,i){if(!i)return;const{arcadeUtils:t}=await a(),r=t.extractFieldNames(i);for(const o of r)F(e,n,o);}function S({displayField:e,fields:n}){return e||(n&&n.length?A(n,"name-or-title")||A(n,"unique-identifier")||A(n,"type-or-category")||x(n):null)}function x(e){for(const n of e){if(!n||!n.name)continue;const e=n.name.toLowerCase();if(e.indexOf("name")>-1||e.indexOf("title")>-1)return n.name}return null}function A(e,n){for(const i of e)if(i&&i.valueType&&i.valueType===n)return i.name;return null}async function v(n,i){if(!i)return;const{fields:t}=i,r=t$5("elevationInfo.featureExpressionInfo",i);return r?r.collectRequiredFields(n,t):void 0}async function E(e,n,i){i.outStatistic.onStatisticValueExpression?w(e,n,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField);}async function V(e,n,i){n&&i&&"cluster"===i.type&&i.fields&&await Promise.all(i.fields.map((i=>E(e,n.fields,i))));}async function L(e,n,i){if(n&&(n.timeInfo&&r$1(i)&&i.timeExtent&&g(e,n.fields,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&g(e,n.fields,[n.floorInfo.floorField]),r$1(i)&&r$1(i.where)&&i.where&&"1=1"!==i.where)){const t=(await import('./WhereClause-c9442cc5.js')).WhereClause.create(i.where,n.fieldsIndex);if(!t.isStandardized)throw new s$2("fieldUtils:collectFilterFields","Where clause is not standardized");g(e,n.fields,t.fieldNames);}}function D(e){if(!e)return [];const n="editFieldsInfo"in e&&e.editFieldsInfo;return n?y(e.fields,[n&&n.creatorField,n&&n.creationDateField,n&&n.editorField,n&&n.editDateField]):[]}async function U(e,n){const{labelingInfo:i,fields:t}=n;i&&i.length&&await Promise.all(i.map((n=>C(e,t,n))));}async function C(e,n,i){if(!i)return;const t=i.getLabelExpression(),r=i.where;if("arcade"===t.type)await w(e,n,t.expression);else {const i=t.expression.match(/{[^}]*}/g);i&&i.forEach((i=>{F(e,n,i.slice(1,-1));}));}const o=/['"]+/g;if(r){const i=r.split(" ");3===i.length&&F(e,n,i[0].replace(o,"")),7===i.length&&(F(e,n,i[0].replace(o,"")),F(e,n,i[4].replace(o,"")));}}function j(e){const n=e.defaultValue;return void 0!==n&&W(e,n)?n:e.nullable?null:void 0}function z(e){return "number"==typeof e&&!isNaN(e)&&isFinite(e)}function k(e){return null===e||z(e)}const P="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function R(e){return null===e||P(e)}function G(e){return null!=e&&"string"==typeof e}function q(e){return null===e||G(e)}function M(){return !0}function W(e,n){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?R:P;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?k:z;break;case"string":case"esriFieldTypeString":i=e.nullable?q:G;break;default:i=M;}return 1===arguments.length?i:i(n)}const Y=["integer","small-integer","single","double"],J=new Set([...Y,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function X(e){return null!=e&&J.has(e.type)}function B(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}var Q,Z;function ee(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function ne(e,n){return e.nullable&&null===n?null:X(e)&&!ie(e.type,Number(n))?Q.OUT_OF_RANGE:W(e,n)?e.domain?t$1(e.domain,n):null:Z.INVALID_TYPE}function ie(e,n){const i="string"==typeof e?re(e):e;return !!i&&(i.isInteger?P(n)&&n>=i.min&&n<=i.max:n>=i.min&&n<=i.max)}function re(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return le;case"esriFieldTypeInteger":case"integer":return ae;case"esriFieldTypeSingle":case"single":return se;case"esriFieldTypeDouble":case"double":return ue}}!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range";}(Q||(Q={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type";}(Z||(Z={}));const le={min:-32768,max:32767,isInteger:!0},ae={min:-2147483648,max:2147483647,isInteger:!0},se={min:-34e37,max:12e37,isInteger:!1},ue={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function fe(e,n,i){switch(e){case o$1.INVALID_CODED_VALUE:return `Value ${i} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case o$1.VALUE_OUT_OF_RANGE:return `Value ${i} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case Z.INVALID_TYPE:return `Value ${i} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case Q.OUT_OF_RANGE:{const{min:e,max:t}=re(n.type);return `Value ${i} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${e} to ${t}`}}}function ce(e,n){return !de(e,n,null)}function de(e,n,i){if(!n||!n.attributes||!e){if(r$1(i))for(const n of e)i.add(n);return !0}const r=n.attributes;let o=!1;for(const l of e)if(!(l in r)){if(o=!0,!r$1(i))break;i.add(l);}return o}

export { B, D, F, I, L, S, T, U, V, X, a, c as b, ce as c, d$1 as d, u$2 as e, n$1 as f, g, h, i$2 as i, i as j, j as k, ee as l, m, n, o, ne as p, fe as q, s, u$1 as u, v, w, y };
