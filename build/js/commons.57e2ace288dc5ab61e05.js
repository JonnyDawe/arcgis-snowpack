(window.webpackJsonp=window.webpackJsonp||[]).push([[0,12],Array(91).concat([function(e,t,r){"use strict";r.r(t),r.d(t,"addOrUpdateResource",(function(){return s})),r.d(t,"contentToBlob",(function(){return u})),r.d(t,"fetchResources",(function(){return n})),r.d(t,"getSiblingOfSameType",(function(){return h})),r.d(t,"getSiblingOfSameTypeI",(function(){return d})),r.d(t,"removeAllResources",(function(){return o})),r.d(t,"removeResource",(function(){return a})),r.d(t,"splitPrefixFileNameAndExtension",(function(){return c}));var i=r(0);r(1);async function n(e,t={},r){await e.load(r);const n=Object(i.aX)(e.itemUrl,"resources"),{start:s=1,num:a=10,sortOrder:o="asc",sortField:l="created"}=t,c={query:{start:s,num:a,sortOrder:o,sortField:l},signal:Object(i.ap)(r,"signal")},u=await e.portal._request(n,c);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map((({created:t,size:r,resource:i})=>({created:new Date(t),size:r,resource:e.resourceFromPath(i)})))}}async function s(e,t,r,n){if(!e.hasPath())throw new i.s(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");await e.portalItem.load(n);const s=Object(i.aX)(e.portalItem.userItemUrl,"add"===t?"addResources":"updateResources"),[a,o]=l(e.path),c=await u(r),h=new FormData;return a&&"."!==a&&h.append("resourcesPrefix",a),h.append("fileName",o),h.append("file",c,o),h.append("f","json"),Object(i.P)(n)&&n.access&&h.append("access",n.access),await e.portalItem.portal._request(s,{method:"post",body:h,signal:Object(i.ap)(n,"signal")}),e}async function a(e,t,r){if(!t.hasPath())throw new i.s("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const n=Object(i.aX)(e.userItemUrl,"removeResources");await e.portal._request(n,{method:"post",query:{resource:t.path},signal:Object(i.ap)(r,"signal")}),t.portalItem=null}async function o(e,t){await e.load(t);const r=Object(i.aX)(e.userItemUrl,"removeResources");return e.portal._request(r,{method:"post",query:{deleteAll:!0},signal:Object(i.ap)(t,"signal")})}function l(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function c(e){const[t,r]=function(e){const t=Object(i.bY)(e);return Object(i.J)(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[n,s]=l(t);return[n,s,r]}async function u(e){return e instanceof Blob?e:(await Object(i.C)(e.url,{responseType:"blob"})).data}function h(e,t){if(!e.hasPath())return null;const[r,,n]=c(e.path);return e.portalItem.resourceFromPath(Object(i.aX)(r,t+n))}function d(e,t){if(!e.hasPath())return null;const[r,,n]=c(e.path);return e.portalItem.resourceFromPath(Object(i.aX)(r,t+n))}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";r.r(t),r.d(t,"WhereClause",(function(){return v})),r.d(t,"defaultAttributeAdapter",(function(){return N}));r(25);var i=r(1),n=r(0),s=r(310);const a={min:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.min.apply(Math,e[0])},max:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.max.apply(Math,e[0])},avg:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:o(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sqrt(l(e[0]))},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:l(e[0])}};function o(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}function l(e){const t=o(e),r=e.length;let i=0;for(const r of e)i+=(r-t)**2;return r>1?i/(r-1):0}class c{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}static fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static createFromMilliseconds(e){const t=new c;return t.second=e/1e3,t}static createFromValueAndQualifer(e,t,r){let i=null;const n=new c;if(n.op="-"===r?"-":"+","interval-period"===t.type){c.fixDefaults(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new Error("Year-Month Intervals not supported");if(!r.test(e))throw new Error("Illegal Interval");n[t.period]=parseFloat(e)}else{if(c.fixDefaults(t.start),c.fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period)throw new Error("Year-Month Intervals not supported");if("year"===t.end.period||"month"===t.end.period)throw new Error("Year-Month Intervals not supported");switch(t.start.period){case"day":switch(t.end.period){case"hour":if(i=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!i.test(e))throw new Error("Illegal Interval");n[t.start.period]=parseFloat(e.split(" ")[0]),n[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!i.test(e))throw new Error("Illegal Interval");{n[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");n.hour=parseFloat(r[0]),n.minute=parseFloat(r[1])}break;case"second":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new Error("Illegal Interval");{n[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");n.hour=parseFloat(r[0]),n.minute=parseFloat(r[1]),n.second=parseFloat(r[2])}break;default:throw"Invalid Interval."}break;case"hour":switch(t.end.period){case"minute":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!i.test(e))throw new Error("Illegal Interval");n.hour=parseFloat(e.split(":")[0]),n.minute=parseFloat(e.split(":")[1]);break;case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new Error("Illegal Interval");{const t=e.split(":");n.hour=parseFloat(t[0]),n.minute=parseFloat(t[1]),n.second=parseFloat(t[2])}break;default:throw"Invalid Interval."}break;case"minute":switch(t.end.period){case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new Error("Illegal Interval");{const t=e.split(":");n.minute=parseFloat(t[0]),n.second=parseFloat(t[1])}break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return n}valueInMilliseconds(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function u(e,t){const r=h[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error(`Invalid Parameter count for call to ${e.toUpperCase()}`);return r.evaluate(t)}const h={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(t instanceof Date)switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,i]=e;return null==t||null==r||null==i?null:i<=0?"":t.toString().substring(r-1,r+i-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",i=t?e[2]:e[1];if(null==r||null==i)return null;const s=`(${Object(n.bP)(r)})`;switch(e[0]){case"BOTH":return i.replace(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return i.replace(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return i.replace(new RegExp(`${s}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?10**e[1]:1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>"string"==typeof e[0]||e[0]instanceof String?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()}};var d=Object(s.b)((function(e){var t;t=function(){function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return r[e.type](e)}return"Expected "+function(e){var t,r,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=a(e[t]);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var i,n={},s={start:We},a=We,o=function(e,t){var r={type:"expr_list"},i=function(e,t,r){return function(e,t){for(var r=[e],i=0;i<t.length;i++)r.push(t[i][3]);return r}(e,t)}(e,t);return r.value=i,r},l=function(e,t){return yr(e,t)},c=ze("!",!1),u=ze("=",!1),h=ze(">=",!1),d=ze(">",!1),f=ze("<=",!1),p=ze("<>",!1),y=ze("<",!1),g=ze("!=",!1),m=function(e){return e[0]+" "+e[2]},b=ze("+",!1),_=ze("-",!1),x=ze("*",!1),v=ze("/",!1),w=function(e,t){return e+t.join("")},O=/^[A-Za-z_\x80-\uFFFF]/,I=Ve([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),S=/^[A-Za-z0-9_]/,T=Ve([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),j=/^[A-Za-z0-9_.\x80-\uFFFF]/,E=Ve([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),A=ze("@",!1),M=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},R=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},F=function(e){return parseFloat(e)},C=ze("'",!1),D=ze("N'",!1),L="''",N=ze("''",!1),P=/^[^']/,B=Ve(["'"],!0,!1),k=function(e,t){return{type:"when_clause",operand:e,value:t}},U=ze(".",!1),z=/^[0-9]/,V=Ve([["0","9"]],!1,!1),G=/^[eE]/,q=Ve(["e","E"],!1,!1),H=/^[+\-]/,W=Ve(["+","-"],!1,!1),Z=ze("NULL",!0),X=ze("TRUE",!0),J=ze("FALSE",!0),Y=ze("IN",!0),Q=ze("IS",!0),K=ze("LIKE",!0),$=ze("ESCAPE",!0),ee=ze("NOT",!0),te=ze("AND",!0),re=ze("OR",!0),ie=ze("BETWEEN",!0),ne=ze("FROM",!0),se=ze("FOR",!0),ae=ze("SUBSTRING",!0),oe=ze("EXTRACT",!0),le=ze("TRIM",!0),ce=ze("POSITION",!0),ue=ze("TIMESTAMP",!0),he=ze("DATE",!0),de=ze("LEADING",!0),fe=ze("TRAILING",!0),pe=ze("BOTH",!0),ye=ze("TO",!0),ge=ze("INTERVAL",!0),me=ze("YEAR",!0),be=ze("MONTH",!0),_e=ze("DAY",!0),xe=ze("HOUR",!0),ve=ze("MINUTE",!0),we=ze("SECOND",!0),Oe=ze("CASE",!0),Ie=ze("END",!0),Se=ze("WHEN",!0),Te=ze("THEN",!0),je=ze("ELSE",!0),Ee=ze(",",!1),Ae=ze("(",!1),Me=ze(")",!1),Re=/^[ \t\n\r]/,Fe=Ve([" ","\t","\n","\r"],!1,!1),Ce=ze("`",!1),De=/^[^`]/,Le=Ve(["`"],!0,!1),Ne=0,Pe=[{line:1,column:1}],Be=0,ke=[],Ue=0;if("startRule"in r){if(!(r.startRule in s))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=s[r.startRule]}function ze(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ve(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ge(e){var r,i=Pe[e];if(i)return i;for(r=e-1;!Pe[r];)r--;for(i={line:(i=Pe[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Pe[e]=i,i}function qe(e,t){var r=Ge(e),i=Ge(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function He(e){Ne<Be||(Ne>Be&&(Be=Ne,ke=[]),ke.push(e))}function We(){var e,t;return e=Ne,hr()!==n&&(t=Xe())!==n&&hr()!==n?e=t:(Ne=e,e=n),e}function Ze(){var e,t,r,i,s,a,l,c;if(e=Ne,(t=Xe())!==n){for(r=[],i=Ne,(s=hr())!==n&&(a=lr())!==n&&(l=hr())!==n&&(c=Xe())!==n?i=s=[s,a,l,c]:(Ne=i,i=n);i!==n;)r.push(i),i=Ne,(s=hr())!==n&&(a=lr())!==n&&(l=hr())!==n&&(c=Xe())!==n?i=s=[s,a,l,c]:(Ne=i,i=n);r!==n?e=t=o(t,r):(Ne=e,e=n)}else Ne=e,e=n;return e}function Xe(){var e,t,r,i,s,a,o,c;if(e=Ne,(t=Je())!==n){for(r=[],i=Ne,(s=hr())!==n&&(a=Nt())!==n&&(o=hr())!==n&&(c=Je())!==n?i=s=[s,a,o,c]:(Ne=i,i=n);i!==n;)r.push(i),i=Ne,(s=hr())!==n&&(a=Nt())!==n&&(o=hr())!==n&&(c=Je())!==n?i=s=[s,a,o,c]:(Ne=i,i=n);r!==n?e=t=l(t,r):(Ne=e,e=n)}else Ne=e,e=n;return e}function Je(){var e,t,r,i,s,a,o,c;if(e=Ne,(t=Ye())!==n){for(r=[],i=Ne,(s=hr())!==n&&(a=Lt())!==n&&(o=hr())!==n&&(c=Ye())!==n?i=s=[s,a,o,c]:(Ne=i,i=n);i!==n;)r.push(i),i=Ne,(s=hr())!==n&&(a=Lt())!==n&&(o=hr())!==n&&(c=Ye())!==n?i=s=[s,a,o,c]:(Ne=i,i=n);r!==n?e=t=l(t,r):(Ne=e,e=n)}else Ne=e,e=n;return e}function Ye(){var e,r,i,s,a;return e=Ne,(r=Dt())===n&&(r=Ne,33===t.charCodeAt(Ne)?(i="!",Ne++):(i=n,0===Ue&&He(c)),i!==n?(s=Ne,Ue++,61===t.charCodeAt(Ne)?(a="=",Ne++):(a=n,0===Ue&&He(u)),Ue--,a===n?s=void 0:(Ne=s,s=n),s!==n?r=i=[i,s]:(Ne=r,r=n)):(Ne=r,r=n)),r!==n&&(i=hr())!==n&&(s=Ye())!==n?e=r=function(e){return function(e,t){return{type:"unary_expr",operator:"NOT",expr:t}}(0,e)}(s):(Ne=e,e=n),e===n&&(e=function(){var e,t,r;return e=Ne,(t=et())!==n&&hr()!==n?((r=function(){var e;return(e=function(){var e,t,r,i,s,a;if(e=[],t=Ne,(r=hr())!==n&&(i=Qe())!==n&&(s=hr())!==n&&(a=et())!==n?t=r=[r,i,s,a]:(Ne=t,t=n),t!==n)for(;t!==n;)e.push(t),t=Ne,(r=hr())!==n&&(i=Qe())!==n&&(s=hr())!==n&&(a=et())!==n?t=r=[r,i,s,a]:(Ne=t,t=n);else e=n;return e!==n&&(e=function(e){return{type:"arithmetic",tail:e}}(e)),e}())===n&&(e=function(){var e,t,r,i;return e=Ne,(t=$e())!==n&&hr()!==n&&(r=cr())!==n&&hr()!==n&&(i=Ze())!==n&&hr()!==n&&ur()!==n?e=t=function(e,t){return{op:e,right:t}}(t,i):(Ne=e,e=n),e===n&&(e=Ne,(t=$e())!==n&&hr()!==n&&(r=cr())!==n&&hr()!==n&&(i=ur())!==n?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Ne=e,e=n),e===n&&(e=Ne,(t=$e())!==n&&hr()!==n&&(r=ct())!==n?e=t=function(e,t){return{op:e,right:t}}(t,r):(Ne=e,e=n))),e}())===n&&(e=function(){var e,t,r,i,s,a;return e=Ne,(t=Dt())!==n&&hr()!==n&&(r=Pt())!==n&&hr()!==n&&(i=et())!==n&&hr()!==n&&(s=Lt())!==n&&hr()!==n&&(a=et())!==n?e=t=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}}(r,i,a):(Ne=e,e=n),e===n&&(e=Ne,(t=Pt())!==n&&hr()!==n&&(r=et())!==n&&hr()!==n&&(i=Lt())!==n&&hr()!==n&&(s=et())!==n?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,s):(Ne=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=Ne,(t=Rt())!==n&&hr()!==n&&(r=Dt())!==n&&hr()!==n&&(i=et())!==n?e=t=function(e,t){return{op:e+"NOT",right:t}}(t,i):(Ne=e,e=n),e===n&&(e=Ne,(t=Rt())!==n&&hr()!==n&&(r=et())!==n?e=t=function(e,t){return{op:e,right:t}}(t,r):(Ne=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=Ne,(t=Ke())!==n&&hr()!==n&&(r=gt())!==n&&hr()!==n&&Ct()!==n&&hr()!==n&&(i=mt())!==n?e=t=function(e,t,r){return{op:e,right:t,escape:r.value}}(t,r,i):(Ne=e,e=n),e===n&&(e=Ne,(t=Ke())!==n&&hr()!==n&&(r=gt())!==n?e=t=function(e,t){return{op:e,right:t,escape:""}}(t,r):(Ne=e,e=n)),e}()),e}())===n&&(r=null),r!==n?e=t=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?yr(e,t.tail):pr(t.op,e,t.right,t.escape)}(t,r):(Ne=e,e=n)):(Ne=e,e=n),e}()),e}function Qe(){var e;return">="===t.substr(Ne,2)?(e=">=",Ne+=2):(e=n,0===Ue&&He(h)),e===n&&(62===t.charCodeAt(Ne)?(e=">",Ne++):(e=n,0===Ue&&He(d)),e===n&&("<="===t.substr(Ne,2)?(e="<=",Ne+=2):(e=n,0===Ue&&He(f)),e===n&&("<>"===t.substr(Ne,2)?(e="<>",Ne+=2):(e=n,0===Ue&&He(p)),e===n&&(60===t.charCodeAt(Ne)?(e="<",Ne++):(e=n,0===Ue&&He(y)),e===n&&(61===t.charCodeAt(Ne)?(e="=",Ne++):(e=n,0===Ue&&He(u)),e===n&&("!="===t.substr(Ne,2)?(e="!=",Ne+=2):(e=n,0===Ue&&He(g)))))))),e}function Ke(){var e,t,r,i,s;return e=Ne,t=Ne,(r=Dt())!==n&&(i=hr())!==n&&(s=Ft())!==n?t=r=[r,i,s]:(Ne=t,t=n),t!==n&&(t=m(t)),(e=t)===n&&(e=Ft()),e}function $e(){var e,t,r,i,s;return e=Ne,t=Ne,(r=Dt())!==n&&(i=hr())!==n&&(s=Mt())!==n?t=r=[r,i,s]:(Ne=t,t=n),t!==n&&(t=m(t)),(e=t)===n&&(e=Mt()),e}function et(){var e,t,r,i,s,a,o,c;if(e=Ne,(t=rt())!==n){for(r=[],i=Ne,(s=hr())!==n&&(a=tt())!==n&&(o=hr())!==n&&(c=rt())!==n?i=s=[s,a,o,c]:(Ne=i,i=n);i!==n;)r.push(i),i=Ne,(s=hr())!==n&&(a=tt())!==n&&(o=hr())!==n&&(c=rt())!==n?i=s=[s,a,o,c]:(Ne=i,i=n);r!==n?e=t=l(t,r):(Ne=e,e=n)}else Ne=e,e=n;return e}function tt(){var e;return 43===t.charCodeAt(Ne)?(e="+",Ne++):(e=n,0===Ue&&He(b)),e===n&&(45===t.charCodeAt(Ne)?(e="-",Ne++):(e=n,0===Ue&&He(_))),e}function rt(){var e,t,r,i,s,a,o,l;if(e=Ne,(t=nt())!==n){for(r=[],i=Ne,(s=hr())!==n&&(a=it())!==n&&(o=hr())!==n&&(l=nt())!==n?i=s=[s,a,o,l]:(Ne=i,i=n);i!==n;)r.push(i),i=Ne,(s=hr())!==n&&(a=it())!==n&&(o=hr())!==n&&(l=nt())!==n?i=s=[s,a,o,l]:(Ne=i,i=n);r!==n?e=t=function(e,t){return yr(e,t)}(t,r):(Ne=e,e=n)}else Ne=e,e=n;return e}function it(){var e;return 42===t.charCodeAt(Ne)?(e="*",Ne++):(e=n,0===Ue&&He(x)),e===n&&(47===t.charCodeAt(Ne)?(e="/",Ne++):(e=n,0===Ue&&He(v))),e}function nt(){var e,t;return(e=function(){var e;return(e=mt())===n&&(e=function(){var e,t,r,i;return e=Ne,(t=function(){var e,t,r,i;return e=Ne,(t=vt())!==n&&(r=wt())!==n&&(i=Ot())!==n?e=t=function(e,t,r){return parseFloat(e+t+r)}(t,r,i):(Ne=e,e=n),e===n&&(e=Ne,(t=vt())!==n&&(r=wt())!==n?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Ne=e,e=n),e===n&&(e=Ne,(t=vt())!==n&&(r=Ot())!==n?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Ne=e,e=n),e===n&&(e=Ne,(t=vt())!==n&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==n?(r=Ne,Ue++,i=at(),Ue--,i===n?r=void 0:(Ne=r,r=n),r!==n?e=t=function(e){return{type:"number",value:e}}(t):(Ne=e,e=n)):(Ne=e,e=n),e}())===n&&(e=function(){var e,t;return e=Ne,(t=Et())!==n&&(t={type:"bool",value:!0}),(e=t)===n&&(e=Ne,(t=At())!==n&&(t={type:"bool",value:!1}),e=t),e}())===n&&(e=function(){var e;return(e=jt())!==n&&(e={type:"null",value:null}),e}())===n&&(e=function(){var e,t;return e=Ne,Ht()!==n&&hr()!==n&&(t=gt())!==n?e=function(e){return{type:"date",value:e.value}}(t):(Ne=e,e=n),e}())===n&&(e=function(){var e,t;return e=Ne,qt()!==n&&hr()!==n&&(t=gt())!==n?e=function(e){return{type:"timestamp",value:e.value}}(t):(Ne=e,e=n),e}())===n&&(e=ht()),e}())===n&&(e=function(){var e,t,r;return e=Ne,zt()!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(t=function(){var e;return(e=Qt())===n&&(e=Kt())===n&&(e=$t())===n&&(e=er())===n&&(e=tr())===n&&(e=rr()),e}())!==n&&hr()!==n&&Bt()!==n&&hr()!==n&&(r=Xe())!==n&&hr()!==n&&ur()!==n?e=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}}(t,r):(Ne=e,e=n),e}())===n&&(e=function(){var e,t,r,i,s,a,o,l;return e=Ne,Ut()!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(t=Xe())!==n&&hr()!==n&&Bt()!==n&&hr()!==n&&(r=Xe())!==n&&hr()!==n?(i=Ne,(s=kt())!==n&&(a=hr())!==n&&(o=Xe())!==n&&(l=hr())!==n?i=s=[s,a,o,l]:(Ne=i,i=n),i===n&&(i=null),i!==n&&(s=ur())!==n?e=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}}(t,r,i):(Ne=e,e=n)):(Ne=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=Ne,Vt()!==n&&hr()!==n&&cr()!==n&&hr()!==n?((t=ut())===n&&(t=null),t!==n&&hr()!==n&&(r=Xe())!==n&&hr()!==n&&Bt()!==n&&hr()!==n&&(i=Xe())!==n&&hr()!==n&&ur()!==n?e=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}}(t,r,i):(Ne=e,e=n)):(Ne=e,e=n),e===n&&(e=Ne,Vt()!==n&&hr()!==n&&cr()!==n&&hr()!==n?((t=ut())===n&&(t=null),t!==n&&hr()!==n&&(r=Xe())!==n&&hr()!==n&&ur()!==n?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(Ne=e,e=n)):(Ne=e,e=n)),e}())===n&&(e=function(){var e,t,r;return e=Ne,Gt()!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(t=Xe())!==n&&hr()!==n&&Mt()!==n&&hr()!==n&&(r=Xe())!==n&&hr()!==n&&ur()!==n?e=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}}(t,r):(Ne=e,e=n),e}())===n&&(e=function(){var e,t,r;return e=Ne,(t=fr())!==n&&hr()!==n&&cr()!==n&&hr()!==n?((r=Ze())===n&&(r=null),r!==n&&hr()!==n&&ur()!==n?e=t=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}}(t,r):(Ne=e,e=n)):(Ne=e,e=n),e}())===n&&(e=function(){var e;return(e=function(){var e,t,r,i,s;if(e=Ne,ir()!==n)if(hr()!==n)if((t=Xe())!==n)if(hr()!==n){for(r=[],i=_t();i!==n;)r.push(i),i=_t();r!==n&&(i=hr())!==n&&(s=nr())!==n?e=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}}(t,r):(Ne=e,e=n)}else Ne=e,e=n;else Ne=e,e=n;else Ne=e,e=n;else Ne=e,e=n;if(e===n)if(e=Ne,ir()!==n)if(hr()!==n)if((t=Xe())!==n)if(hr()!==n){for(r=[],i=_t();i!==n;)r.push(i),i=_t();r!==n&&(i=hr())!==n&&(s=xt())!==n&&hr()!==n&&nr()!==n?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,s):(Ne=e,e=n)}else Ne=e,e=n;else Ne=e,e=n;else Ne=e,e=n;else Ne=e,e=n;return e}())===n&&(e=function(){var e,t,r,i;if(e=Ne,ir()!==n)if(hr()!==n){for(t=[],r=bt();r!==n;)t.push(r),r=bt();t!==n&&(r=hr())!==n&&(i=nr())!==n?e=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}}(t):(Ne=e,e=n)}else Ne=e,e=n;else Ne=e,e=n;if(e===n)if(e=Ne,ir()!==n)if(hr()!==n){for(t=[],r=bt();r!==n;)t.push(r),r=bt();t!==n&&(r=hr())!==n&&(i=xt())!==n&&hr()!==n&&nr()!==n?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,i):(Ne=e,e=n)}else Ne=e,e=n;else Ne=e,e=n;return e}()),e}())===n&&(e=function(){var e;return(e=function(){var e;return(e=function(){var e,t,r,i;if(e=Ne,(t=at())!==n){for(r=[],i=lt();i!==n;)r.push(i),i=lt();r!==n?e=t=w(t,r):(Ne=e,e=n)}else Ne=e,e=n;return e}())!==n&&(e=e),e}())!==n&&(e=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:e}}(e)),e}())===n&&(e=ct())===n&&(e=Ne,cr()!==n&&hr()!==n&&(t=Xe())!==n&&hr()!==n&&ur()!==n?e=function(e){return e.paren=!0,e}(t):(Ne=e,e=n)),e}function st(){var e,t,r,i;if(e=Ne,(t=at())!==n){for(r=[],i=ot();i!==n;)r.push(i),i=ot();r!==n?e=t=w(t,r):(Ne=e,e=n)}else Ne=e,e=n;return e}function at(){var e;return O.test(t.charAt(Ne))?(e=t.charAt(Ne),Ne++):(e=n,0===Ue&&He(I)),e}function ot(){var e;return S.test(t.charAt(Ne))?(e=t.charAt(Ne),Ne++):(e=n,0===Ue&&He(T)),e}function lt(){var e;return j.test(t.charAt(Ne))?(e=t.charAt(Ne),Ne++):(e=n,0===Ue&&He(E)),e}function ct(){var e,r,i;return e=Ne,64===t.charCodeAt(Ne)?(r="@",Ne++):(r=n,0===Ue&&He(A)),r!==n&&(i=st())!==n?e=r=[r,i]:(Ne=e,e=n),e!==n&&(e=function(e){return{type:"param",value:e[1]}}(e)),e}function ut(){var e;return(e=Wt())===n&&(e=Zt())===n&&(e=Xt()),e}function ht(){var e,r,i,s;return e=Ne,Yt()!==n&&hr()!==n?(45===t.charCodeAt(Ne)?(r="-",Ne++):(r=n,0===Ue&&He(_)),r===n&&(43===t.charCodeAt(Ne)?(r="+",Ne++):(r=n,0===Ue&&He(b))),r!==n&&hr()!==n&&(i=gt())!==n&&hr()!==n&&(s=dt())!==n?e=function(e,t,r){return{type:"interval",value:t,qualifier:r,op:e}}(r,i,s):(Ne=e,e=n)):(Ne=e,e=n),e===n&&(e=Ne,Yt()!==n&&hr()!==n&&(r=gt())!==n&&hr()!==n&&(i=dt())!==n?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,i):(Ne=e,e=n)),e}function dt(){var e,t,r;return e=Ne,(t=function(){var e,t,r;return e=Ne,(t=ft())!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(r=yt())!==n&&hr()!==n&&ur()!==n?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Ne=e,e=n),e===n&&(e=Ne,(t=ft())!==n&&(t=M(t)),e=t),e}())!==n&&hr()!==n&&Jt()!==n&&hr()!==n&&(r=function(){var e,t,r,i;return e=Ne,(t=ft())!==n&&(t=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}}(t)),(e=t)===n&&(e=Ne,(t=rr())!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(r=yt())!==n&&hr()!==n&&lr()!==n&&hr()!==n&&(i=pt())!==n&&hr()!==n&&ur()!==n?e=t=R(r,i):(Ne=e,e=n),e===n&&(e=Ne,(t=rr())!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(r=yt())!==n&&hr()!==n&&ur()!==n?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Ne=e,e=n),e===n&&(e=Ne,(t=rr())!==n&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==n?e=t=function(e,t){return{type:"interval-qualifier",start:e,end:t}}(t,r):(Ne=e,e=n),e===n&&(e=function(){var e,t,r,i;return e=Ne,(t=ft())!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(r=pt())!==n&&hr()!==n&&ur()!==n?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Ne=e,e=n),e===n&&(e=Ne,(t=ft())!==n&&(t=M(t)),(e=t)===n&&(e=Ne,(t=rr())!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(r=yt())!==n&&hr()!==n&&lr()!==n&&hr()!==n&&(i=pt())!==n&&hr()!==n&&ur()!==n?e=t=R(r,i):(Ne=e,e=n),e===n&&(e=Ne,(t=rr())!==n&&hr()!==n&&cr()!==n&&hr()!==n&&(r=pt())!==n&&hr()!==n&&ur()!==n?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Ne=e,e=n),e===n&&(e=Ne,(t=rr())!==n&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function ft(){var e,t;return e=Ne,(t=$t())!==n&&(t={type:"string",value:"day"}),(e=t)===n&&(e=Ne,(t=er())!==n&&(t={type:"string",value:"hour"}),(e=t)===n&&(e=Ne,(t=tr())!==n&&(t={type:"string",value:"minute"}),(e=t)===n&&(e=Ne,(t=Kt())!==n&&(t={type:"string",value:"month"}),(e=t)===n&&(e=Ne,(t=Qt())!==n&&(t={type:"string",value:"year"}),e=t)))),e}function pt(){var e;return(e=It())!==n&&(e=F(e)),e}function yt(){var e;return(e=It())!==n&&(e=F(e)),e}function gt(){var e;return(e=mt())===n&&(e=ct()),e}function mt(){var e,r,i,s,a;if(e=Ne,39===t.charCodeAt(Ne)?(r="'",Ne++):(r=n,0===Ue&&He(C)),r===n&&("N'"===t.substr(Ne,2)?(r="N'",Ne+=2):(r=n,0===Ue&&He(D))),r!==n){for(i=[],s=Ne,t.substr(Ne,2)===L?(a=L,Ne+=2):(a=n,0===Ue&&He(N)),a!==n&&(a="'"),(s=a)===n&&(P.test(t.charAt(Ne))?(s=t.charAt(Ne),Ne++):(s=n,0===Ue&&He(B)));s!==n;)i.push(s),s=Ne,t.substr(Ne,2)===L?(a=L,Ne+=2):(a=n,0===Ue&&He(N)),a!==n&&(a="'"),(s=a)===n&&(P.test(t.charAt(Ne))?(s=t.charAt(Ne),Ne++):(s=n,0===Ue&&He(B)));i!==n?(39===t.charCodeAt(Ne)?(s="'",Ne++):(s=n,0===Ue&&He(C)),s!==n?e=r=function(e){return{type:"string",value:e.join("")}}(i):(Ne=e,e=n)):(Ne=e,e=n)}else Ne=e,e=n;return e}function bt(){var e,t,r;return e=Ne,sr()!==n&&hr()!==n&&(t=Xe())!==n&&hr()!==n&&ar()!==n&&hr()!==n&&(r=Xe())!==n?e=k(t,r):(Ne=e,e=n),e}function _t(){var e,t,r;return e=Ne,sr()!==n&&hr()!==n&&(t=Xe())!==n&&hr()!==n&&ar()!==n&&hr()!==n&&(r=Xe())!==n?e=k(t,r):(Ne=e,e=n),e}function xt(){var e,t;return e=Ne,or()!==n&&hr()!==n&&(t=Xe())!==n?e=function(e){return{type:"else_clause",value:e}}(t):(Ne=e,e=n),e}function vt(){var e,r,i;return(e=It())===n&&(e=Ne,45===t.charCodeAt(Ne)?(r="-",Ne++):(r=n,0===Ue&&He(_)),r===n&&(43===t.charCodeAt(Ne)?(r="+",Ne++):(r=n,0===Ue&&He(b))),r!==n&&(i=It())!==n?e=r=function(e,t){return e[0]+t}(r,i):(Ne=e,e=n)),e}function wt(){var e,r,i;return e=Ne,46===t.charCodeAt(Ne)?(r=".",Ne++):(r=n,0===Ue&&He(U)),r!==n?((i=It())===n&&(i=null),i!==n?e=r=function(e){return"."+(null!=e?e:"")}(i):(Ne=e,e=n)):(Ne=e,e=n),e}function Ot(){var e,t,r;return e=Ne,(t=Tt())!==n&&(r=It())!==n?e=t=function(e,t){return e+t}(t,r):(Ne=e,e=n),e}function It(){var e,t;if(e=[],(t=St())!==n)for(;t!==n;)e.push(t),t=St();else e=n;return e!==n&&(e=function(e){return e.join("")}(e)),e}function St(){var e;return z.test(t.charAt(Ne))?(e=t.charAt(Ne),Ne++):(e=n,0===Ue&&He(V)),e}function Tt(){var e,r,i;return e=Ne,G.test(t.charAt(Ne))?(r=t.charAt(Ne),Ne++):(r=n,0===Ue&&He(q)),r!==n?(H.test(t.charAt(Ne))?(i=t.charAt(Ne),Ne++):(i=n,0===Ue&&He(W)),i===n&&(i=null),i!==n?e=r=function(e,t){return"e"+(null===t?"":t)}(0,i):(Ne=e,e=n)):(Ne=e,e=n),e}function jt(){var e,r,i,s;return e=Ne,"null"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(Z)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r=[r,i]:(Ne=e,e=n)):(Ne=e,e=n),e}function Et(){var e,r,i,s;return e=Ne,"true"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(X)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r=[r,i]:(Ne=e,e=n)):(Ne=e,e=n),e}function At(){var e,r,i,s;return e=Ne,"false"===t.substr(Ne,5).toLowerCase()?(r=t.substr(Ne,5),Ne+=5):(r=n,0===Ue&&He(J)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r=[r,i]:(Ne=e,e=n)):(Ne=e,e=n),e}function Mt(){var e,r,i,s;return e=Ne,"in"===t.substr(Ne,2).toLowerCase()?(r=t.substr(Ne,2),Ne+=2):(r=n,0===Ue&&He(Y)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="IN":(Ne=e,e=n)):(Ne=e,e=n),e}function Rt(){var e,r,i,s;return e=Ne,"is"===t.substr(Ne,2).toLowerCase()?(r=t.substr(Ne,2),Ne+=2):(r=n,0===Ue&&He(Q)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="IS":(Ne=e,e=n)):(Ne=e,e=n),e}function Ft(){var e,r,i,s;return e=Ne,"like"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(K)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="LIKE":(Ne=e,e=n)):(Ne=e,e=n),e}function Ct(){var e,r,i,s;return e=Ne,"escape"===t.substr(Ne,6).toLowerCase()?(r=t.substr(Ne,6),Ne+=6):(r=n,0===Ue&&He($)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="ESCAPE":(Ne=e,e=n)):(Ne=e,e=n),e}function Dt(){var e,r,i,s;return e=Ne,"not"===t.substr(Ne,3).toLowerCase()?(r=t.substr(Ne,3),Ne+=3):(r=n,0===Ue&&He(ee)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="NOT":(Ne=e,e=n)):(Ne=e,e=n),e}function Lt(){var e,r,i,s;return e=Ne,"and"===t.substr(Ne,3).toLowerCase()?(r=t.substr(Ne,3),Ne+=3):(r=n,0===Ue&&He(te)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="AND":(Ne=e,e=n)):(Ne=e,e=n),e}function Nt(){var e,r,i,s;return e=Ne,"or"===t.substr(Ne,2).toLowerCase()?(r=t.substr(Ne,2),Ne+=2):(r=n,0===Ue&&He(re)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="OR":(Ne=e,e=n)):(Ne=e,e=n),e}function Pt(){var e,r,i,s;return e=Ne,"between"===t.substr(Ne,7).toLowerCase()?(r=t.substr(Ne,7),Ne+=7):(r=n,0===Ue&&He(ie)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="BETWEEN":(Ne=e,e=n)):(Ne=e,e=n),e}function Bt(){var e,r,i,s;return e=Ne,"from"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(ne)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="FROM":(Ne=e,e=n)):(Ne=e,e=n),e}function kt(){var e,r,i,s;return e=Ne,"for"===t.substr(Ne,3).toLowerCase()?(r=t.substr(Ne,3),Ne+=3):(r=n,0===Ue&&He(se)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="FOR":(Ne=e,e=n)):(Ne=e,e=n),e}function Ut(){var e,r,i,s;return e=Ne,"substring"===t.substr(Ne,9).toLowerCase()?(r=t.substr(Ne,9),Ne+=9):(r=n,0===Ue&&He(ae)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="SUBSTRING":(Ne=e,e=n)):(Ne=e,e=n),e}function zt(){var e,r,i,s;return e=Ne,"extract"===t.substr(Ne,7).toLowerCase()?(r=t.substr(Ne,7),Ne+=7):(r=n,0===Ue&&He(oe)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="EXTRACT":(Ne=e,e=n)):(Ne=e,e=n),e}function Vt(){var e,r,i,s;return e=Ne,"trim"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(le)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="TRIM":(Ne=e,e=n)):(Ne=e,e=n),e}function Gt(){var e,r,i,s;return e=Ne,"position"===t.substr(Ne,8).toLowerCase()?(r=t.substr(Ne,8),Ne+=8):(r=n,0===Ue&&He(ce)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="POSITION":(Ne=e,e=n)):(Ne=e,e=n),e}function qt(){var e,r,i,s;return e=Ne,"timestamp"===t.substr(Ne,9).toLowerCase()?(r=t.substr(Ne,9),Ne+=9):(r=n,0===Ue&&He(ue)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="TIMESTAMP":(Ne=e,e=n)):(Ne=e,e=n),e}function Ht(){var e,r,i,s;return e=Ne,"date"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(he)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="DATE":(Ne=e,e=n)):(Ne=e,e=n),e}function Wt(){var e,r,i,s;return e=Ne,"leading"===t.substr(Ne,7).toLowerCase()?(r=t.substr(Ne,7),Ne+=7):(r=n,0===Ue&&He(de)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="LEADING":(Ne=e,e=n)):(Ne=e,e=n),e}function Zt(){var e,r,i,s;return e=Ne,"trailing"===t.substr(Ne,8).toLowerCase()?(r=t.substr(Ne,8),Ne+=8):(r=n,0===Ue&&He(fe)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="TRAILING":(Ne=e,e=n)):(Ne=e,e=n),e}function Xt(){var e,r,i,s;return e=Ne,"both"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(pe)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="BOTH":(Ne=e,e=n)):(Ne=e,e=n),e}function Jt(){var e,r,i,s;return e=Ne,"to"===t.substr(Ne,2).toLowerCase()?(r=t.substr(Ne,2),Ne+=2):(r=n,0===Ue&&He(ye)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="TO":(Ne=e,e=n)):(Ne=e,e=n),e}function Yt(){var e,r,i,s;return e=Ne,"interval"===t.substr(Ne,8).toLowerCase()?(r=t.substr(Ne,8),Ne+=8):(r=n,0===Ue&&He(ge)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="INTERVAL":(Ne=e,e=n)):(Ne=e,e=n),e}function Qt(){var e,r,i,s;return e=Ne,"year"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(me)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="YEAR":(Ne=e,e=n)):(Ne=e,e=n),e}function Kt(){var e,r,i,s;return e=Ne,"month"===t.substr(Ne,5).toLowerCase()?(r=t.substr(Ne,5),Ne+=5):(r=n,0===Ue&&He(be)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="MONTH":(Ne=e,e=n)):(Ne=e,e=n),e}function $t(){var e,r,i,s;return e=Ne,"day"===t.substr(Ne,3).toLowerCase()?(r=t.substr(Ne,3),Ne+=3):(r=n,0===Ue&&He(_e)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="DAY":(Ne=e,e=n)):(Ne=e,e=n),e}function er(){var e,r,i,s;return e=Ne,"hour"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(xe)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="HOUR":(Ne=e,e=n)):(Ne=e,e=n),e}function tr(){var e,r,i,s;return e=Ne,"minute"===t.substr(Ne,6).toLowerCase()?(r=t.substr(Ne,6),Ne+=6):(r=n,0===Ue&&He(ve)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="MINUTE":(Ne=e,e=n)):(Ne=e,e=n),e}function rr(){var e,r,i,s;return e=Ne,"second"===t.substr(Ne,6).toLowerCase()?(r=t.substr(Ne,6),Ne+=6):(r=n,0===Ue&&He(we)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="SECOND":(Ne=e,e=n)):(Ne=e,e=n),e}function ir(){var e,r,i,s;return e=Ne,"case"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(Oe)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="CASE":(Ne=e,e=n)):(Ne=e,e=n),e}function nr(){var e,r,i,s;return e=Ne,"end"===t.substr(Ne,3).toLowerCase()?(r=t.substr(Ne,3),Ne+=3):(r=n,0===Ue&&He(Ie)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="END":(Ne=e,e=n)):(Ne=e,e=n),e}function sr(){var e,r,i,s;return e=Ne,"when"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(Se)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="WHEN":(Ne=e,e=n)):(Ne=e,e=n),e}function ar(){var e,r,i,s;return e=Ne,"then"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(Te)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="THEN":(Ne=e,e=n)):(Ne=e,e=n),e}function or(){var e,r,i,s;return e=Ne,"else"===t.substr(Ne,4).toLowerCase()?(r=t.substr(Ne,4),Ne+=4):(r=n,0===Ue&&He(je)),r!==n?(i=Ne,Ue++,s=ot(),Ue--,s===n?i=void 0:(Ne=i,i=n),i!==n?e=r="ELSE":(Ne=e,e=n)):(Ne=e,e=n),e}function lr(){var e;return 44===t.charCodeAt(Ne)?(e=",",Ne++):(e=n,0===Ue&&He(Ee)),e}function cr(){var e;return 40===t.charCodeAt(Ne)?(e="(",Ne++):(e=n,0===Ue&&He(Ae)),e}function ur(){var e;return 41===t.charCodeAt(Ne)?(e=")",Ne++):(e=n,0===Ue&&He(Me)),e}function hr(){var e,t;for(e=[],t=dr();t!==n;)e.push(t),t=dr();return e}function dr(){var e;return Re.test(t.charAt(Ne))?(e=t.charAt(Ne),Ne++):(e=n,0===Ue&&He(Fe)),e}function fr(){var e,r,i,s;if(e=Ne,(r=st())!==n&&(r=r),(e=r)===n)if(e=Ne,96===t.charCodeAt(Ne)?(r="`",Ne++):(r=n,0===Ue&&He(Ce)),r!==n){if(i=[],De.test(t.charAt(Ne))?(s=t.charAt(Ne),Ne++):(s=n,0===Ue&&He(Le)),s!==n)for(;s!==n;)i.push(s),De.test(t.charAt(Ne))?(s=t.charAt(Ne),Ne++):(s=n,0===Ue&&He(Le));else i=n;i!==n?(96===t.charCodeAt(Ne)?(s="`",Ne++):(s=n,0===Ue&&He(Ce)),s!==n?e=r=function(e){return e.join("")}(i):(Ne=e,e=n)):(Ne=e,e=n)}else Ne=e,e=n;return e}function pr(e,t,r,i){var n={type:"binary_expr",operator:e,left:t,right:r};return void 0!==i&&(n.escape=i),n}function yr(e,t){for(var r=e,i=0;i<t.length;i++)r=pr(t[i][1],r,t[i][3]);return r}if((i=a())!==n&&Ne===t.length)return i;throw i!==n&&Ne<t.length&&He({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(ke,Be<t.length?t.charAt(Be):null,Be<t.length?qe(Be,Be+1):qe(Be,Be))}}},e.exports&&(e.exports=t())}));const f=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,p=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,g=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,m=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function b(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function _(e,t,r="0",i="0",n="0",s="0",a="",o="0",l="0"){if("+"===a||"-"===a){const c=`${b(parseInt(e,10),4)}-${b(parseInt(t,10),2)}-${b(parseInt(r,10),2)}`;let u="";parseFloat(s)<10&&(u="0");const h=`${b(parseInt(i,10),2)}:${b(parseInt(n,10),2)}:${u+parseFloat(s).toString()}`,d=`${a}${b(parseInt(o,10),2)}:${b(parseInt(l,10),2)}`;return new Date(c+"T"+h+d)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(i,10),parseInt(n,10),parseFloat(s))}class x{static makeBool(e){return I(e)}static featureValue(e,t,r,i){return L(e,t,r,i)}static equalsNull(e){return null===e}static applyLike(e,t,r){return M(e,t,r)}static ensureArray(e){return S(e)}static applyIn(e,t){return A(e,t)}static currentDate(){const e=new Date;return e.setHours(0,0,0,0),e}static makeSqlInterval(e,t,r){return c.createFromValueAndQualifer(e,t,r)}static convertInterval(e){return e instanceof c?e.valueInMilliseconds():e}static currentTimestamp(){return new Date}static compare(e,t,r){return F(e,t,r)}static calculate(e,t,r){return D(e,t,r)}static makeComparable(e){return R(e)}static evaluateFunction(e,t){return u(e,t)}static lookup(e,t){const r=t[e];return void 0===r?null:r}static between(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}static notbetween(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}static ternaryNot(e){return T(e)}static ternaryAnd(e,t){return j(e,t)}static ternaryOr(e,t){return E(e,t)}}class v{constructor(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this.parseTree=class{static parse(e){return d.parse(e)}}.parse(e);const{isStandardized:r,isAggregate:i,referencedFieldNames:n}=this.extractExpressionInfo(t);this.referencedFieldNames=n,this.isStandardized=r,this.isAggregate=i}static create(e,t){return new v(e,t)}get fieldNames(){return this.referencedFieldNames}testSet(e,t=N){const r={};for(const i of this.fieldNames)r[i]=e.map((e=>t.getAttribute(e,i)));return!!this.evaluateNode(this.parseTree,{attributes:r},N)}calculateValue(e,t=N){const r=this.evaluateNode(this.parseTree,e,t);return r instanceof c?r.valueInMilliseconds()/864e5:r}calculateValueCompiled(e,t=N){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(i.a)("csp-restrictions")?this.calculateValue(e,t):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}testFeature(e,t=N){return!!this.evaluateNode(this.parseTree,e,t)}testFeatureCompiled(e,t=N){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(i.a)("csp-restrictions")?this.testFeature(e,t):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}getFunctions(){const e=[];return this.visitAll(this.parseTree,(t=>{"function"===t.type&&e.push(t.name.toLowerCase())})),C(e)}getExpressions(){const e=new Map;return this.visitAll(this.parseTree,(t=>{if("function"===t.type){const r=t.name.toLowerCase(),i=t.args.value[0];if("column_ref"===i.type){const t=i.column,n=`${r}-${t}`;e.has(n)||e.set(n,{aggregateType:r,field:t})}}})),[...e.values()]}getVariables(){const e=[];return this.visitAll(this.parseTree,(t=>{"param"===t.type&&e.push(t.value.toLowerCase())})),C(e)}compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(x)}extractExpressionInfo(e){const t=[];let r=!0,i=!0;return this.visitAll(this.parseTree,(n=>{switch(n.type){case"column_ref":{const r=e.get(n.column),i=r&&r.name;!r||"date"!==r.type&&"esriFieldTypeDate"!==r.type||(this.datefields[r.name]=1),void 0!==i?(t.push(i),n.column=i):t.push(n.column);break}case"function":{const{name:e,args:t}=n,s=t.value.length;r&&(r=function(e,t){const r=h[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,s)),i&&(i=function(e,t){const r=a[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,s));break}}})),{referencedFieldNames:C(t),isStandardized:r,isAggregate:i}}visitAll(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(const r of e.clauses)this.visitAll(r,t);"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(const r of e.value)this.visitAll(r,t);break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":{let t="";if("simple"===e.format){const r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(let i=0;i<e.clauses.length;i++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[i].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[i].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let r=0;r<e.clauses.length;r++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":{let t="[";for(const r of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(r);return t+="]",t}case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+O(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+w(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}evaluateNode(e,t,r){switch(e.type){case"interval":{const i=this.evaluateNode(e.value,t,r);return c.createFromValueAndQualifer(i,e.qualifier,e.op)}case"case_expression":if("simple"===e.format){const i=R(this.evaluateNode(e.operand,t,r));for(let n=0;n<e.clauses.length;n++)if(i===R(this.evaluateNode(e.clauses[n].operand,t,r)))return this.evaluateNode(e.clauses[n].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(let i=0;i<e.clauses.length;i++)if(I(this.evaluateNode(e.clauses[i].operand,t,r)))return this.evaluateNode(e.clauses[i].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":{const i=[];for(const n of e.value)i.push(this.evaluateNode(n,t,r));return i}case"unary_expr":return T(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return j(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return E(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":{const i=S(this.evaluateNode(e.right,t,r));return A(this.evaluateNode(e.left,t,r),i)}case"NOT IN":{const i=S(this.evaluateNode(e.right,t,r));return T(A(this.evaluateNode(e.left,t,r),i))}case"BETWEEN":{const i=this.evaluateNode(e.left,t,r),n=this.evaluateNode(e.right,t,r);return null==i||null==n[0]||null==n[1]?null:i>=R(n[0])&&i<=R(n[1])}case"NOTBETWEEN":{const i=this.evaluateNode(e.left,t,r),n=this.evaluateNode(e.right,t,r);return null==i||null==n[0]||null==n[1]?null:i<R(n[0])||i>R(n[1])}case"LIKE":return M(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return T(M(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return F(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return D(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}case"null":case"bool":case"string":case"number":return e.value;case"date":return O(e.value);case"timestamp":return w(e.value);case"current_time":{const t=new Date;return"date"===e.mode&&t.setHours(0,0,0,0),t}case"column_ref":return L(t,e.column,this.datefields,r);case"function":{const i=this.evaluateNode(e.args,t,r);return this.isAggregate?function(e,t){const r=a[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error(`Invalid Parameter count for call to ${e.toUpperCase()}`);return r.evaluate(t)}(e.name,i):u(e.name,i)}}throw new Error("Unsupported sql syntax "+e.type)}}function w(e){let t=p.exec(e);if(null!==t){const[,e,r,i,n,s,a]=t;return _(e,r,i,n,s,a)}if(t=y.exec(e),null!==t){const[,e,r,i,n,s,a,o,l,c]=t;return _(e,r,i,n,s,a,o,l,c)}if(t=g.exec(e),null!==t){const[,e,r,i,n,s,a,o,l]=t;return _(e,r,i,n,s,"0",a,o,l)}if(t=m.exec(e),null!==t){const[,e,r,i,n,s]=t;return _(e,r,i,n,s)}if(t=f.exec(e),null!==t){const[,e,r,i]=t;return _(e,r,i)}throw new Error("SQL Invalid Timestamp")}function O(e){const t=f.exec(e);if(null===t)throw new Error("SQL Invalid Date");const[,r,i,n]=t;return new Date(parseInt(r,10),parseInt(i,10)-1,parseInt(n,10))}function I(e){return!0===e}function S(e){return Array.isArray(e)?e:[e]}function T(e){return null!==e?!0!==e:null}function j(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function E(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function A(e,t){if(null==e)return null;let r=!1;for(const i of t)if(null==i)r=null;else if(e===i){r=!0;break}return r}function M(e,t,r){if(null==e)return null;const i=t,n=r;let s="";const a="-[]/{}()*+?.\\^$|";let o=0;for(let e=0;e<i.length;e++){const t=i.charAt(e);switch(o){case 0:t===n?o=1:a.indexOf(t)>=0?s+="\\"+t:s+="%"===t?".*":"_"===t?".":t;break;case 1:a.indexOf(t)>=0?s+="\\"+t:s+=t,o=0}}return new RegExp("^"+s+"$").test(e)}function R(e){return e instanceof Date?e.valueOf():e}function F(e,t,r){if(null==t||null==r)return null;const i=R(t),n=R(r);switch(e){case"<>":return i!==n;case"=":return i===n;case">":return i>n;case"<":return i<n;case">=":return i>=n;case"<=":return i<=n}}function C(e){const t=[],r={};for(const i of e){const e=i.toLowerCase();void 0===r[e]&&(t.push(i),r[e]=1)}return t}function D(e,t,r){if(t instanceof c)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof c)switch(e){case"+":return c.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return c.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof c)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function L(e,t,r,i){const n=i.getAttribute(e,t);return null!=n&&1===r[t]?new Date(n):n}const N={getAttribute:(e,t)=>(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}},,,function(e,t,r){"use strict";r.r(t);r(18),r(25);var i,n=r(0),s=r(1),a=r(20),o=r(5),l=r(32),c=r(53),u=r(14),h=r(314),d=r(122),f=r(138),p=r(335),y=r(364),g=r(356),m=r(337),b=r(317),_=r(9),x=r(16),v=r(6),w=r(23),O=r(357),I=r(72),S=r(54),T=r(35);r(3),r(4),r(13),r(52),r(51),r(82),r(43),r(2),r(40),r(15),r(75),r(10),r(27),r(89),r(12),r(44),r(106),r(63),r(55),r(119),r(17),r(120),r(48),r(83),r(115),r(47),r(103),r(57),r(21),r(62),r(26),r(24),r(85),r(70),r(109),r(49),r(111),r(71),r(104),r(112),r(108),r(58),r(105),r(110),r(107),r(56),r(116),r(36),r(64),r(42),r(113),r(41),r(121),r(117),r(114),r(66),r(31),r(118),r(123),r(8),r(73),r(84),r(65),r(74),r(90),r(11),r(7),r(19),r(67),r(86),r(137),r(333),r(313),r(312),r(310),r(320),r(330),r(334),r(338),r(318);let j=i=class extends a.a{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer&&this.sourceLayer.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.objectId}clone(){return new i({objectId:this.objectId,...this.cloneProperties()})}};Object(n.e)([Object(n.y)({type:Boolean})],j.prototype,"isAggregate",void 0),Object(n.e)([Object(n.y)({type:Number,json:{read:!0}})],j.prototype,"objectId",void 0),j=i=Object(n.e)([Object(n.i)("esri.AggregateGraphic")],j);var E,A=j;const M=new n.aM({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),R=new n.aM({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let F=E=class extends n.a{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||"1=1"}enable(){this._set("enabled",!0)}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:a,units:o,distance:l}=this;return new u.b({geometry:Object(s.o)(r),objectIds:Object(s.o)(a),spatialRelationship:i,timeExtent:Object(s.o)(n),where:t,units:o,distance:l,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,hiddenIds:i,timeExtent:n,objectIds:a,units:o,distance:l}=this,c=new Set;return i.forEach((e=>c.add(e))),new E({geometry:Object(s.o)(t),hiddenIds:c,objectIds:Object(s.o)(a),spatialRelationship:r,timeExtent:Object(s.o)(n),where:e,units:o,distance:l})}};Object(n.e)([Object(n.y)({type:String})],F.prototype,"where",void 0),Object(n.e)([Object(n.o)("where")],F.prototype,"writeWhere",null),Object(n.e)([Object(n.y)({types:n.a3,json:{read:_.e,write:!0}})],F.prototype,"geometry",void 0),Object(n.e)([Object(n.y)({type:String,json:{read:{source:"spatialRel",reader:M.read},write:{target:"spatialRel",writer:M.write}}})],F.prototype,"spatialRelationship",void 0),Object(n.e)([Object(n.y)({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],F.prototype,"hiddenIds",void 0),Object(n.e)([Object(n.y)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],F.prototype,"distance",void 0),Object(n.e)([Object(n.y)({type:[Number],json:{write:!0}})],F.prototype,"objectIds",void 0),Object(n.e)([Object(n.y)({type:String,json:{read:R.read,write:{writer:R.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],F.prototype,"units",void 0),Object(n.e)([Object(n.y)({type:x.a,json:{write:!0}})],F.prototype,"timeExtent",void 0),Object(n.e)([Object(n.y)({readOnly:!0})],F.prototype,"enabled",void 0),F=E=Object(n.e)([Object(n.i)("esri.views.layers.support.FeatureFilter")],F);var C,D=F;let L=C=class extends n.a{constructor(){super(...arguments),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}clone(){return new C({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};Object(n.e)([Object(n.y)({type:D,json:{write:!0}})],L.prototype,"filter",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],L.prototype,"includedEffect",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],L.prototype,"excludedEffect",void 0),Object(n.e)([Object(n.y)({type:Boolean,json:{write:!0}})],L.prototype,"excludedLabelsVisible",void 0),L=C=Object(n.e)([Object(n.i)("esri.views.layers.support.FeatureEffect")],L);var N=L;const P=n.n.getLogger("esri.views.layers.FeatureLayerView"),B=e=>{let t=class extends e{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.effect=null,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){Object(o.g)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","layer.floorInfo","timeExtent"],(()=>this._handleRequiredFieldsChange()),!0),Object(o.d)(this,"view.floors","change",(()=>this._handleRequiredFieldsChange()))}get availableFields(){const{layer:e,layer:{fields:t},requiredFields:r}=this;return"outFields"in e&&e.outFields?Object(v.F)(t,[...Object(v.d)(t,e.outFields),...r]):Object(v.F)(t,r)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){P.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(n.P)(this.filter)?this.filter.createQuery(e):new u.b(e);return Object(n.P)(this.timeExtent)&&(t.timeExtent=Object(n.P)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}_loadArcadeModules(e){if(e.get("expressionInfos.length"))return Object(v.k)()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)}))}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fields:r,objectIdField:i,renderer:s,displayField:a}}=this,o=t.featureReduction,l=new Set,c=await Object(n.E)([s?s.collectRequiredFields(l,r):null,Object(v.h)(l,t),e?Object(v.D)(l,t):null,Object(n.P)(this.filter)?Object(v.e)(l,t,this.filter):null,this.effect?Object(v.e)(l,t,this.effect.filter):null,o?Object(v.i)(l,t,o):null]);t.timeInfo&&this.timeExtent&&Object(v.q)(l,t.fields,[t.timeInfo.startField,t.timeInfo.endField]),"feature"===t.type&&t.floorInfo&&Object(v.q)(l,t.fields,[t.floorInfo.floorField]);for(const e of c)e.error&&P.error(e.error);Object(v.c)(l,r,i),e&&a&&Object(v.c)(l,r,a);const u=Array.from(l).sort();this._set("requiredFields",u)}validateFetchPopupFeatures(e){const{layer:t,layer:{popupEnabled:r}}=this;return r?Object(O.a)(this.layer,e)?void 0:new n.s("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new n.s("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})}async fetchClientPopupFeatures(e){const t=Object(n.P)(e)?e.clientGraphics:null;if(!t||0===t.length)return Promise.resolve([]);const r=[],i=[],{layer:s}=this,a=Object(O.a)(s,e);if(!Object(n.P)(a))return Promise.resolve([]);const o=await this._loadArcadeModules(a),l=o&&o.arcadeUtils.hasGeometryOperations(a),c=await this.createPopupQuery(e),u=Object(v.d)(s.fields,c.outFields);for(const e of t)l||!Object(v.m)(u,e)?i.push(e):r.push(e);return"stream"===s.type||0===i.length?Promise.resolve(r):(c.objectIds=i.map((e=>e.attributes[s.objectIdField])),s.queryFeatures(c).then((e=>r.concat(e.features))).catch((()=>i)))}async createPopupQuery(e){const t=this.layer,r=t.createQuery(),i=Object(O.a)(t,e),s=Object(n.P)(i)&&await this._loadArcadeModules(i),a=Object(n.P)(i)&&s&&s.arcadeUtils.hasGeometryOperations(i),o=!("point"!==t.geometryType&&!a);return r.returnGeometry=o,r.returnZ=o,r.returnM=o,r.outFields=await Object(O.b)(this.layer,i),r.outSpatialReference=this.view.spatialReference,r}canResume(){return!(!super.canResume()||Object(n.P)(this.timeExtent)&&this.timeExtent.isEmpty)}};return Object(n.e)([Object(n.y)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),Object(n.e)([Object(n.y)({readOnly:!0})],t.prototype,"availableFields",null),Object(n.e)([Object(n.y)({type:N})],t.prototype,"effect",void 0),Object(n.e)([Object(n.y)({type:D})],t.prototype,"filter",void 0),Object(n.e)([Object(n.y)(w.n)],t.prototype,"timeExtent",void 0),Object(n.e)([Object(n.y)()],t.prototype,"layer",void 0),Object(n.e)([Object(n.y)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),Object(n.e)([Object(n.y)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),Object(n.e)([Object(n.y)({readOnly:!0})],t.prototype,"requiredFields",void 0),Object(n.e)([Object(n.y)()],t.prototype,"suspended",void 0),Object(n.e)([Object(n.y)()],t.prototype,"view",void 0),t=Object(n.e)([Object(n.i)("esri.views.layers.FeatureLayerView")],t),t};let k=class extends n.al{constructor(e){super(e),this._startupResolver=Object(n.b$)(),this.isReady=!1}initialize(){this._controller=Object(n.V)(),this.addResolvingPromise(this._startWorker(this._controller.signal))}destroy(){this._controller.abort(),this._connection&&this._connection.close()}set tileRenderer(e){this.client.tileRenderer=e}get closed(){return this._connection.closed}async startup(e,t,r,i){await this.when();const n=this._controller.signal,s=function(e){return Array.isArray(e)}(r.source)?{transferList:r.source,signal:n}:void 0,a={service:r,config:t,tileInfo:e.tileInfo.toJSON(),tiles:i};await this._connection.invoke("startup",a,s),this._startupResolver.resolve(),this._set("isReady",!0)}async updateTiles(e){return await this._startupResolver.promise,Object(n.ay)(this._connection.invoke("updateTiles",e))}async update(e){const t={config:e};return await this._startupResolver.promise,this._connection.invoke("update",t)}async applyUpdate(e){return await this._startupResolver.promise,this._connection.invoke("applyUpdate",e)}async setHighlight(e){return await this._startupResolver.promise,Object(n.ay)(this._connection.invoke("controller.setHighlight",e))}async refresh(){return await this._startupResolver.promise,Object(n.ay)(this._connection.invoke("controller.refresh"))}async queryFeatures(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatures",e.toJSON(),t)}async queryObjectIds(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryObjectIds",e.toJSON(),t)}async queryFeatureCount(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatureCount",e.toJSON(),t)}async queryExtent(e,t){return this._connection.invoke("controller.queryExtent",e.toJSON(),t)}async queryLatestObservations(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryLatestObservations",e.toJSON(),t)}async queryStatistics(e){return await this._startupResolver.promise,this._connection.invoke("controller.queryStatistics",e)}async getObjectId(e){return await this._startupResolver.promise,this._connection.invoke("controller.getObjectId",e)}async getDisplayId(e){return await this._startupResolver.promise,this._connection.invoke("controller.getDisplayId",e)}async getFeature(e){return await this._startupResolver.promise,this._connection.invoke("controller.getFeature",e)}async getAggregate(e){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregate",e)}async getAggregateValueRanges(){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregateValueRanges")}async mapValidDisplayIds(e){return await this._startupResolver.promise,this._connection.invoke("controller.mapValidDisplayIds",e)}async onEdits(e){await this._startupResolver.promise;const{addedFeatures:t,deletedFeatures:r,updatedFeatures:i}=e;return Object(n.ay)(this._connection.invoke("controller.onEdits",{addedFeatures:t,deletedFeatures:r,updatedFeatures:i}))}async enableEvent(e,t){return await this._startupResolver.promise,Object(n.ay)(this._connection.invoke("controller.enableEvent",{name:e,value:t}))}async _startWorker(e){try{this._connection=await Object(I.d)("Pipeline",{client:this.client,strategy:"dedicated",signal:e})}catch(e){Object(n.b2)(e)}}};Object(n.e)([Object(n.y)()],k.prototype,"isReady",void 0),Object(n.e)([Object(n.y)()],k.prototype,"client",void 0),Object(n.e)([Object(n.y)()],k.prototype,"tileRenderer",null),k=Object(n.e)([Object(n.i)("esri.views.2d.layers.support.FeatureLayerProxy")],k);var U=k;class z{constructor(e){this._tiles=new Map,this.buffer=0,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.buffer=e.buffer}destroy(){}clear(){this._tiles.forEach((e=>this._releaseTile(e)))}tileKeys(){const e=[];return this._tiles.forEach(((t,r)=>e.push(r))),e}update(e){const t=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),{spans:r,lodInfo:i}=t,{level:n}=i,s=[],a=[],o=new Set,l=new Set;for(const{row:e,colFrom:t,colTo:a}of r)for(let r=t;r<=a;r++){const t=S.a.getId(n,e,i.normalizeCol(r),i.getWorldForColumn(r)),a=this._getOrAcquireTile(s,t);o.add(t),a.isReady?a.visible=!0:l.add(a.key)}return l.forEach((e=>this._addPlaceholders(o,e))),this._tiles.forEach((e=>{o.has(e.key.id)||(a.push(e.key.id),this._releaseTile(e))})),T.c.pool.release(t),{hasMissingTiles:l.size>0,added:s,removed:a}}_getOrAcquireTile(e,t){if(!this._tiles.has(t)){const r=this.acquireTile(new S.a(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}_getTile(e){return this._tiles.get(e)}_releaseTile(e){this._tiles.delete(e.key.id),this.releaseTile(e)}_addPlaceholders(e,t){const r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}_addPlaceholderChildren(e,t){let r=0;return this._tiles.forEach((i=>{r+=this._addPlaceholderChild(e,i,t)})),r}_addPlaceholderChild(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}_addPlaceholderParent(e,t){let r=t.getParentKey(),i=0,s=null;for(;Object(n.P)(r);){if(e.has(r.id))return!0;const t=this._getTile(r.id);if(null!=t&&t.isReady)return t.visible=!0,e.add(t.key.id),!0;null!=t&&t.hasData&&t.patchCount>i&&(i=t.patchCount,s=t),r=r.getParentKey()}return!!s&&(s.visible=!0,e.add(s.key.id),!0)}}function V(e){return e&&"openPorts"in e}const G=n.n.getLogger("esri.views.2d.layers.FeatureLayerView2D");let q=class extends(B(Object(f.m)(Object(p.b)(p.a)))){constructor(){super(...arguments),this._pipelineIsUpdating=!0,this._updatingPipelineConfig=!1,this._onGoingEdits=0,this._isRefreshing=!1,this._visibilityOverrides=new Set,this._effect=null,this._highlightIds=new Map,this._lastPixelBuffer=0,this.filter=null,this.effectLists={included:new b.c,excluded:new b.c},this.doRefresh=Object(n.aa)((async()=>{this.isUpdating()&&await Object(o.a)(this,"updating"),this._set("_isRefreshing",!0),this._lockGPUUploads();try{await this._proxy.refresh()}catch(e){Object(n.B)(e)}this._unlockGPUUploads(),this._set("_isRefreshing",!1)})),this._doUpdate=Object(n.aa)((async()=>{try{if(this.destroyed||!this._hasRequiredSupport(this.layer))return;this._set("_updatingPipelineConfig",!0),await Object(o.a)(this,"_isRefreshing");const{effect:e,filter:t}=this;await this._updateRequiredFields();const{renderer:r}=this._getEffectiveRenderer();this._set("_effectiveRenderer",r);const i="feature"===this.layer.type?this.layer.historicMoment:null,s="feature"===this.layer.type?this.layer.gdbVersion:null,a={renderer:this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:i,labelsVisible:this.layer.labelsVisible,labelingInfo:this.layer.labelingInfo,availableFields:this.availableFields,effect:this.effect,filter:this.filter,gdbVersion:s,pixelBuffer:0},l=Object(m.D)(this.layer.geometryType),c=await Object(m.H)(r,l,this.layer.featureReduction),u=this._createConfiguration(a,t,e);this._lastPixelBuffer=0===c?0:Math.max(c,this._lastPixelBuffer),u.schema.source.pixelBuffer=this._lastPixelBuffer;const h=this._createTileRendererHash(r);if(h!==this._tileRendererHash){await this._initTileRenderer(r);const e=this._serviceOptions;this.effects.forEach((e=>Object(n.P)(e)&&Object(n.P)(e.filter)&&e.filter.enable())),this.tileRenderer.onConfigUpdate(r);const t={added:this._tileStrategy.tileKeys(),removed:[]},i=this.layer;"stream"!==i.type&&V(i.source)&&(e.source=await i.source.openPorts()),await this._proxy.startup(this.view.featuresTilingScheme,u,e,t),this.hasHighlight()&&await this._proxy.setHighlight(Array.from(this._highlightIds.keys())),await this._onceTilesUpdated(),this.tileRenderer.onConfigUpdate(r)}else{const e=await this._proxy.update(u);(e.mesh||e.targets.aggregate)&&this._lockGPUUploads();try{await this._proxy.applyUpdate(e)}catch(e){Object(n.B)(e)||G.error(e)}(e.mesh||e.targets.aggregate)&&this._unlockGPUUploads(),this.effects.forEach((e=>Object(n.P)(e)&&Object(n.P)(e.filter)&&e.filter.enable())),this.tileRenderer.onConfigUpdate(r),this._forceAttributeTextureUpload()}this._tileRendererHash=h,this.tileRenderer.invalidateLabels(),this.requestUpdate()}catch(e){}})),this._updateHighlight=Object(n.aa)((async()=>this._proxy.setHighlight(Array.from(this._highlightIds.keys()))))}destroy(){var e,t;null==(e=this._proxy)||e.destroy(),Object(n.c6)(this._updateClusterSizeTask,(e=>e.remove())),null==(t=this.tileRenderer)||t.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(e=>{this._set("_aggregateValueRanges",e.valueRanges)})),Object(o.g)(this,"effect",(e=>{this.effectLists.included.effect=null==e?void 0:e.includedEffect})),Object(o.g)(this,"effect",(e=>{this.effectLists.excluded.effect=null==e?void 0:e.excludedEffect}))])}async _initProxy(){if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type&&this.layer.isTable)throw new n.s("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const e=this._createClientOptions();return this._set("_proxy",new U({client:e})),this._proxy.when()}async _initServiceOptions(){this._set("_serviceOptions",await this._createServiceOptions())}get labelsVisible(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible}get effect(){return Object(n.bJ)(this._effect,null)}set effect(e){const t=this._effect;Object(n.P)(t)&&Object(n.P)(t.filter)&&t.filter.enabled&&Object(n.P)(e)&&Object(n.P)(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}get effects(){return this.effect&&[this.effect]||[]}get queryMode(){return this._serviceOptions.type}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,t=this.layer,r=this.view.floors,{definitionExpression:i,renderer:s,labelingInfo:a}=t,o="feature"===t.type?t.gdbVersion:void 0,l="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,{timeExtent:c}=this,u="stream"===t.type?`${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}`:null,h=JSON.stringify(this.clips),d=t.featureReduction&&t.featureReduction.toJSON();return JSON.stringify({filterHash:Object(n.P)(this.filter)&&this.filter.toJSON(),effectHash:Object(n.P)(this.effect)&&this.effect.toJSON(),streamFilter:u,gdbVersion:o,definitionExpression:i,historicMoment:l,availableFields:e,renderer:s,labelingInfo:t.labelsVisible&&a,timeExtent:c,floors:r,clipsHash:h,featureReduction:d})}get hasEffects(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}highlight(e){let t;return e instanceof a.a?t=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?t=[e]:n.L.isCollection(e)?t=e.map((e=>e&&e.getAttribute(this.layer.objectIdField))).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((e=>e&&e.getAttribute(this.layer.objectIdField)))),t&&t.length?(t=t.filter((e=>null!=e)),this._addHighlight(t),{remove:()=>this._removeHighlight(t)}):{remove:()=>{}}}hasHighlight(){return!!this._highlightIds.size}hitTest(e,t){return this._hitTest(e,t)}queryStatistics(){return this._proxy.queryStatistics()}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then((e=>{const t=c.default.fromJSON(e);return t.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),t}))}queryFeaturesJSON(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}queryObjectIds(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}queryFeatureCount(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}queryExtent(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((e=>({count:e.count,extent:n.M.fromJSON(e.extent)})))}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:t,added:r,removed:i}=this._tileStrategy.update(e);(r.length||i.length)&&this._proxy.updateTiles({added:r,removed:i}),t&&this.requestUpdate(),this.notifyChange("updating")}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new z({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(o.g)(this,"renderingConfigHash",(()=>this._update())),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(async e=>{this._set("_onGoingEdits",this._onGoingEdits+1);try{const t="globalIdField"in this.layer&&this.layer.globalIdField,r=e.deletedFeatures.some((e=>-1===e.objectId||!e.objectId)),i=t&&this.availableFields.includes(t);if(r&&!i)return void G.error(new n.s("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected on the map`));await this._proxy.onEdits(e)}catch(e){Object(n.B)(e)}this._set("_onGoingEdits",Math.max(0,this._onGoingEdits-1))})),"attach")}detach(){this.container.removeAllChildren(),this.handles.remove("attach"),this._updatingPipelineConfig=!1,this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}async fetchPopupFeatures(e,t){if(Object(n.P)(t)&&t.clientGraphics.length){const e=t.clientGraphics[0];if(e instanceof A)return[e]}const r=this.validateFetchPopupFeatures(t);if(r)throw r;if(Object(n.P)(t)&&0===t.clientGraphics.length)return[];const i=this.fetchClientPopupFeatures(t);if(!e)return i;const s=this._fetchServicePopupFeatures(e,t);return Object(n.a4)([i,s]).then(n.a5)}async _fetchServicePopupFeatures(e,t){if("stream"===this.layer.type||"ogc-feature"===this.layer.type)return[];const r=await this.createPopupQuery(t),{layer:i}=this,{renderer:s}=i,a=Object(n.P)(t)?t.event:null,o=Object(y.a)({renderer:s,event:a});r.geometry=this.createFetchPopupFeaturesQueryGeometry(e,o);const l=new Set,{objectIdField:c}=i,u=Object(n.P)(t)?t.clientGraphics:null;if(u)for(const e of u)l.add(e.attributes[c]);return i.queryFeatures(r).then((e=>e.features.filter((e=>!l.has(e.attributes[c])))))}createFetchPopupFeaturesQueryGeometry(e,t){return Object(g.a)(e,t,this.view)}isUpdating(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating||this._onGoingEdits>0)}_createClientOptions(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}async _detectQueryMode(e){if("path"in e&&Object(l.i)(e.path)&&"feature"===this.layer.type&&"point"===this.layer.geometryType&&!this.layer.capabilities.operations.supportsEditing&&Object(s.a)("featurelayer-snapshot-enabled"))try{const e=await this.layer.queryFeatureCount();if(e<=Object(s.a)("featurelayer-snapshot-point-min-threshold"))return{mode:"snapshot",featureCount:e};const t=Object(s.a)("featurelayer-snapshot-point-max-threshold"),r=Object(s.a)("featurelayer-snapshot-point-coverage"),i=this.view.extent,n=this.layer.fullExtent,a=null==n?void 0:n.clone().intersection(i),o=(null==a?void 0:a.width)*(null==a?void 0:a.height),l=(null==n?void 0:n.width)*(null==n?void 0:n.height),c=0===l?0:o/l;if(e<=t&&c>=r)return{mode:"snapshot",featureCount:e}}catch(e){G.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e})}return{mode:"on-demand"}}async _createServiceOptions(){const e=this.layer;if("stream"===e.type)return null;const{capabilities:t,objectIdField:r}=e,i=e.fields.map((e=>e.toJSON())),n=e.fullExtent&&e.fullExtent.toJSON(),a=Object(m.D)(e.geometryType),o=e.timeInfo&&e.timeInfo.toJSON()||null,l=e.spatialReference?e.spatialReference.toJSON():null,c="feature"===e.type?e.customParameters:null,u="feature"===e.type?e.globalIdField:null;let h;"ogc-feature"===e.type?h=e.source.getFeatureDefinition():V(e.source)?h=await e.source.openPorts():e.parsedUrl&&(h=Object(s.o)(e.parsedUrl),"dynamicDataSource"in e&&e.dynamicDataSource&&(h.query={layer:JSON.stringify({source:e.dynamicDataSource})}));const{mode:d,featureCount:f}=await this._detectQueryMode(h);return{type:d,featureCount:f,globalIdField:u,maxRecordCount:t.query.maxRecordCount,tileMaxRecordCount:t.query.tileMaxRecordCount,capabilities:t,fields:i,fullExtent:n,geometryType:a,objectIdField:r,source:h,timeInfo:o,spatialReference:l,customParameters:c}}async _createMemoryServiceOptions(e){const t=await e.openPorts();return{...this._createServiceOptions(),type:"memory",source:t}}_cleanUpQuery(e){const t=u.b.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}_createUpdateClusterSizeTask(e,t){return this.watch("_aggregateValueRanges",(async r=>{this._updateClusterEffectiveRendererSizeVariable(e,t,r),this._updatingPipelineConfig||this.tileRenderer.onConfigUpdate(this._effectiveRenderer)}))}async _updateClusterEffectiveRendererSizeVariable(e,t,r){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const i=Object(m.I)(e.visualVariables);if(Object(n.P)(i)&&"cluster_count"===i.field){const n=e.visualVariables.indexOf(i);e.visualVariables[n]=Object(m.J)(t,r);const s=e.clone();s.dynamicClusterSize=!0,this._set("_effectiveRenderer",s)}}}_getEffectiveRenderer(){const e=this.layer.renderer,t=this.layer.featureReduction;if(Object(n.P)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&Object(m.K)(e)){const r=t,i=[],s=Object(m.L)(i,e,r,this._aggregateValueRanges);return Object(n.c6)(this._updateClusterSizeTask,(e=>e.remove())),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,r),{renderer:s,aggregateFields:i,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const t=this.tileRenderer.acquireTile(e);return t.once("attach",(()=>{this.requestUpdate()})),t}_releaseTile(e){this.tileRenderer.releaseTile(e)}async _initTileRenderer(e){const t=await async function(e,t){if(!e)return null;switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return new((await Promise.all([r.e(2),r.e(0),r.e(83)]).then(r.bind(null,513))).default)(t);case"heatmap":return new((await Promise.all([r.e(2),r.e(0),r.e(51)]).then(r.bind(null,514))).default)(t)}}(e,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});return this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=t,this._set("tileRenderer",t),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(e),this.requestUpdate(),this.tileRenderer)}_createTileRendererHash(e){return`${"heatmap"===e.type?"heatmap":"symbol"}.${"dot-density"===e.type}`}_createFeatureDataHash(e,t,r){const i=e.getAttributeHash(),s=JSON.stringify(t),a=Object(n.P)(r)&&JSON.stringify(r.filter),o=JSON.stringify(this.timeExtent);let l="";return this._visibilityOverrides.forEach((e=>l+=e)),`${i}.${s}.${a}.${o}.${l}`}get hasFilter(){const e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}_injectOverrides(e){const t=Object(n.P)(e)?e.timeExtent:null,r=Object(n.P)(this.timeExtent)&&Object(n.P)(t)?this.timeExtent.intersection(t):this.timeExtent||t;let i=null;const s="floorInfo"in this.layer&&this.layer.floorInfo;if(s){const t=Object(n.P)(e)&&e.where;i=this._addFloorFilterClause(t)}if(!this._visibilityOverrides.size&&!r&&!s)return e;const a=Object(n.P)(e)&&e.clone()||new D;return a.hiddenIds=this._visibilityOverrides,a.timeExtent=r,i&&(a.where=i),a}_addFloorFilterClause(e){const t=this.layer;let r=e||"";if("floorInfo"in t&&t.floorInfo){var i;let e=this.view.floors;if(!e||!e.length)return r;null!=(i=t.floorInfo.viewAllLevelIds)&&i.length&&(e=t.floorInfo.viewAllLevelIds);const s=e.filter((e=>""!==e)).map((e=>"'"+e+"'"));s.push("''");const a=t.floorInfo.floorField;let o="("+a+" IN ({ids}) OR "+a+" IS NULL)";if(o=o.replace("{ids}",s.join(", ")),Object(n.P)(r)&&r.includes(a)){let e=new RegExp("AND \\("+a+".*NULL\\)","g");r=r.replace(e,""),e=new RegExp("\\("+a+".*NULL\\)","g"),r=r.replace(e,""),r=r.replace(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+o:o}return""!==r?r:null}_createConfiguration(e,t,r){const i="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,s="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(h.l),o=this._injectOverrides(t);a[0]=Object(n.P)(o)?o.toJSON():null,a[1]=Object(n.P)(r)&&r.filter?r.filter.toJSON():null;const l=Object(m.b)(e);if(Object(n.J)(l))return null;const c=Object(d.b)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:s,historicMoment:i,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:l,supportsTextureFloat:c.supportsTextureFloat,maxTextureSize:c.maxTextureSize}}_hasRequiredSupport(e){var t;return!("dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!Object(d.b)().supportsTextureFloat&&(G.error(new n.s("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}_onceTilesUpdated(){return this.requestUpdate(),Object(o.a)(this,"_pipelineIsUpdating",!1)}_lockGPUUploads(){this.tileRenderer&&this.tileRenderer.lockGPUUploads()}_unlockGPUUploads(){this.tileRenderer&&this.tileRenderer.unlockGPUUploads()}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_update(){this.view.timeline.begin(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`);const e=this._doUpdate();this._updatingPromise=e;const t=()=>{e===this._updatingPromise&&this._set("_updatingPipelineConfig",!1),this.view&&this.view.timeline.end(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`)};e.then(t).catch((e=>{Object(n.B)(e)||G.error(e),t()}))}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight().catch((e=>{Object(n.B)(e)||G.error(e)}))}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight().catch((e=>{Object(n.B)(e)||G.error(e)}))}_createHittestResult(e){return e.layer=this.layer,e.sourceLayer=this.layer,Object(n.P)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}async _hitTest(e,t){if(this.suspended||!this.tileRenderer)return null;const r=await this.tileRenderer.hitTest(e,t);if(0===r.length)return await Object(n.X)(1),null;const i=r[0];if(!(e=>(2147483648&e)>>>31==1)(i)){const e=await this._proxy.getFeature(i);return Object(n.c6)(e,(e=>this._createHittestResult(a.a.fromJSON(e))))}const s=await this._proxy.getAggregate(i);if(Object(n.J)(s))return null;if(Object(n.P)(s.referenceId)){const e=await this._proxy.getFeature(s.referenceId);return Object(n.c6)(e,(e=>this._createHittestResult(a.a.fromJSON(e))))}return this._createHittestResult(A.fromJSON(s))}};Object(n.e)([Object(n.y)()],q.prototype,"_serviceOptions",void 0),Object(n.e)([Object(n.y)()],q.prototype,"_proxy",void 0),Object(n.e)([Object(n.y)()],q.prototype,"_pipelineIsUpdating",void 0),Object(n.e)([Object(n.y)()],q.prototype,"_updatingPipelineConfig",void 0),Object(n.e)([Object(n.y)()],q.prototype,"_effectiveRenderer",void 0),Object(n.e)([Object(n.y)()],q.prototype,"_aggregateValueRanges",void 0),Object(n.e)([Object(n.y)()],q.prototype,"_onGoingEdits",void 0),Object(n.e)([Object(n.y)()],q.prototype,"_isRefreshing",void 0),Object(n.e)([Object(n.y)()],q.prototype,"labelsVisible",null),Object(n.e)([Object(n.y)({type:D})],q.prototype,"filter",void 0),Object(n.e)([Object(n.y)({type:N})],q.prototype,"effect",null),Object(n.e)([Object(n.y)({readOnly:!0})],q.prototype,"effects",null),Object(n.e)([Object(n.y)({readOnly:!0})],q.prototype,"queryMode",null),Object(n.e)([Object(n.y)()],q.prototype,"renderingConfigHash",null),Object(n.e)([Object(n.y)()],q.prototype,"tileRenderer",void 0),Object(n.e)([Object(n.y)()],q.prototype,"updating",void 0),q=Object(n.e)([Object(n.i)("esri.views.2d.layers.FeatureLayerView2D")],q);var H=q;t.default=H},function(e,t,r){"use strict";r.r(t),r.d(t,"p",(function(){return f})),r.d(t,"t",(function(){return s})),r.d(t,"u",(function(){return a}));var i=r(0),n=r(371);function s(e,t){return!!e.typeKeywords&&e.typeKeywords.indexOf(t)>-1}function a(e){switch(e.type){case"Map Service":return function(e){return function(e){return d(e.url).then((e=>e.tileInfo))}(e).then((e=>e?{className:"TileLayer"}:{className:"MapImageLayer"}))}(e);case"Feature Service":return function(e){return l(e).then((e=>{if("object"==typeof e){const t={};return null!=e.id&&(t.layerId=e.id),{className:"FeatureLayer",properties:t}}return{className:"GroupLayer"}}))}(e);case"Feature Collection":return async function(e){return await e.load(),s(e,"Map Notes")?{className:"MapNotesLayer"}:s(e,"Route Layer")?{className:"RouteLayer"}:1===h(await e.fetchData())?{className:"FeatureLayer"}:{className:"GroupLayer"}}(e);case"Scene Service":return function(e){return l(e).then((t=>{if("object"==typeof t){const r={};let i;if(null!=t.id?(r.layerId=t.id,i=`${e.url}/layers/${t.id}`):i=e.url,Array.isArray(e.typeKeywords)&&e.typeKeywords.length>0){const t={IntegratedMesh:"IntegratedMeshLayer","3DObject":"SceneLayer",Point:"SceneLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};for(const r of Object.keys(t))if(-1!==e.typeKeywords.indexOf(r))return{className:t[r]}}return d(i).then((e=>{let t="SceneLayer";const i={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};return e&&e.layerType&&i[e.layerType]&&(t=i[e.layerType]),{className:t,properties:r}}))}return{className:"GroupLayer"}}))}(e);case"Image Service":return async function(e){var t,r,i;await e.load();const n=null!=(t=null==(r=e.typeKeywords)?void 0:r.map((e=>e.toLowerCase())))?t:[];if(n.indexOf("elevation 3d layer")>-1)return{className:"ElevationLayer"};if(n.indexOf("tiled imagery")>-1)return{className:"ImageryTileLayer"};const s=await e.fetchData(),a=null==s?void 0:s.layerType;return"ArcGISTiledImageServiceLayer"===a?{className:"ImageryTileLayer"}:"ArcGISImageServiceLayer"===a?{className:"ImageryLayer"}:"map"===(null==(i=(await d(e.url)).cacheType)?void 0:i.toLowerCase())?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}}(e);case"Stream Service":return{className:"StreamLayer"};case"Vector Tile Service":return{className:"VectorTileLayer"};case"KML":return{className:"KMLLayer"};case"WMTS":return{className:"WMTSLayer"};case"WMS":return{className:"WMSLayer"};default:return Promise.reject(new i.s("portal:unknown-item-type","Unknown item type '${type}'",{type:e.type}))}}function o(e){return(0,n.a[e.className])().then((t=>({constructor:t,properties:e.properties})))}function l(e){return!e.url||e.url.match(/\/\d+$/)?Promise.resolve({}):e.load().then((()=>e.fetchData())).then((t=>h(t)>0?c(t):d(e.url).then(c)))}function c(e){return 1===h(e)&&{id:Object(i.Y)(u(e))}}function u(e){const t=e.layers;if(t&&t.length)return t[0].id;const r=e.tables;return r&&r.length?r[0].id:null}function h(e){var t,r,i,n;return(null!=(t=null==e||null==(r=e.layers)?void 0:r.length)?t:0)+(null!=(i=null==e||null==(n=e.tables)?void 0:n.length)?i:0)}function d(e){return Object(i.C)(e,{responseType:"json",query:{f:"json"}}).then((e=>e.data))}var f=Object.freeze({__proto__:null,fromItem:function(e){return!e.portalItem||e.portalItem instanceof i.bK||(e={...e,portalItem:new i.bK(e.portalItem)}),function(e){return e.load().then(a).then(o)}(e.portalItem).then((t=>{const r={portalItem:e.portalItem,...t.properties},i=t.constructor;return Promise.resolve(new i(r))}))},selectLayerClassPath:a})},,,function(e,t,r){"use strict";r.r(t),r.d(t,"hydratedAdapter",(function(){return n}));var i=r(0);r(1);const n={convertToGEGeometry:function(e,t){if(null==t)return null;let r="cache"in t?t.cache._geVersion:void 0;return null==r&&(r=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=r)),r},exportPoint:function(e,t,r){const n=e.hasZ(t),s=e.hasM(t),a=new i._({x:e.getPointX(t),y:e.getPointY(t),spatialReference:r});return n&&(a.z=e.getPointZ(t)),s&&(a.m=e.getPointM(t)),a.cache._geVersion=t,a},exportPolygon:function(e,t,r){const n=new i.au({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:r});return n.cache._geVersion=t,n},exportPolyline:function(e,t,r){const n=new i.aJ({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:r});return n.cache._geVersion=t,n},exportMultipoint:function(e,t,r){const n=new i.aK({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:r});return n.cache._geVersion=t,n},exportExtent:function(e,t,r){const n=e.hasZ(t),s=e.hasM(t),a=new i.M({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:r});if(n){const r=e.getZExtent(t);a.zmin=r.vmin,a.zmax=r.vmax}if(s){const r=e.getMExtent(t);a.mmin=r.vmin,a.mmax=r.vmax}return a.cache._geVersion=t,a}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return s(null==t&&r.path)}},r.exports),r.exports}function s(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s}))},,function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return h}));var i=r(310),n=(r(1),r(0)),s=Object(i.b)((function(e){var t;void 0!==(t=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(e.exports=t)})),a=Object(i.b)((function(e){var t;void 0!==(t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"])&&(e.exports=t)})),o=Object(i.b)((function(e){var t;void 0!==(t=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"])&&(e.exports=t)}));function l(e){}function c(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}n.n.getLogger("esri/views/webgl");class u{constructor(e,t,r=null){this._context=null,this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(0,this),this._context=e,this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...t},this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){if(this._context&&this._context.gl){if(this._glName){const e=this._context.gl;this._context.unbindTextureAllUnits(this),e.deleteTexture(this._glName),this._glName=null}this._context.instanceCounter.decrement(0,this),this._context=null}}release(){this.dispose()}resize(e,t){const r=this._descriptor;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))}setData(e){if(!this._context||!this._context.gl)return;const t=this._context.gl;this._glName||(this._glName=t.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const i=this._descriptor;u._validateTexture(this._context,i),t.pixelStorei(t.UNPACK_ALIGNMENT,i.unpackAlignment),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i.flipped?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.preMultiplyAlpha?1:0);const s=i.pixelFormat;let a=i.internalFormat?i.internalFormat:s;if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let r=e.width,n=e.height;e instanceof HTMLVideoElement&&(r=e.videoWidth,n=e.videoHeight),i.width&&i.height&&console.assert(r===i.width&&n===i.height),t.texImage2D(t.TEXTURE_2D,0,a,s,i.dataType,e),i.hasMipmap&&this.generateMipmap(),void 0===i.width&&(i.width=r),void 0===i.height&&(i.height=n)}else{null!=i.width&&null!=i.height||console.error("Width and height must be specified!"),t.DEPTH24_STENCIL8&&a===t.DEPTH_STENCIL&&(a=t.DEPTH24_STENCIL8);let r=i.width,o=i.height;if(function(e){return Object(n.P)(e)&&"type"in e&&"compressed"===e.type}(e)){const n=Math.round(Math.log(Math.max(r,o))/Math.LN2)+1;i.hasMipmap=i.hasMipmap&&n===e.levels.length;for(let n=0;;++n){const s=e.levels[Math.min(n,e.levels.length-1)];if(t.compressedTexImage2D(t.TEXTURE_2D,n,a,r,o,0,s),1===r&&1===o||!i.hasMipmap)break;r=Math.max(1,r>>1),o=Math.max(1,o>>1)}}else if(Object(n.P)(e))t.texImage2D(t.TEXTURE_2D,0,a,r,o,0,s,i.dataType,e),i.hasMipmap&&this.generateMipmap();else for(let e=0;t.texImage2D(t.TEXTURE_2D,e,a,r,o,0,s,i.dataType,null),(1!==r||1!==o)&&i.hasMipmap;++e)r=Math.max(1,r>>1),o=Math.max(1,o>>1)}u._applySamplingMode(t,this._descriptor),u._applyWrapMode(t,this._descriptor),u._applyAnisotropicFilteringParameters(this._context,this._descriptor),r&&this._context.bindTexture(r,0)}updateData(e,t,r,i,n,s){s||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,o=this._descriptor,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0),(t<0||r<0||i>o.width||n>o.height||t+i>o.width||r+n>o.height)&&console.error("An attempt to update out of bounds of the texture!"),a.pixelStorei(a.UNPACK_ALIGNMENT,o.unpackAlignment),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,o.flipped?1:0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.preMultiplyAlpha?1:0),s instanceof ImageData||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement?a.texSubImage2D(a.TEXTURE_2D,e,t,r,o.pixelFormat,o.dataType,s):a.texSubImage2D(a.TEXTURE_2D,e,t,r,i,n,o.pixelFormat,o.dataType,s),this._context.bindTexture(l,0)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,u._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const r=this._context.gl;r.generateMipmap(r.TEXTURE_2D),this._context.bindTexture(t,0)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,u._validateTexture(this._context,this._descriptor),this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(u._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(u._applyWrapMode(e,t),this._wrapModeDirty=!1)}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const r=Object(n.c4)(t.width)&&Object(n.c4)(t.height);c(e.gl)||r||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let r=t.samplingMode,i=t.samplingMode;9985===r||9987===r?(r=9729,t.hasMipmap||(i=9729)):9984!==r&&9986!==r||(r=9728,t.hasMipmap||(i=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){if(null==t.maxAnisotropy)return;const r=e.capabilities.textureFilterAnisotropic;if(!r)return;const i=e.gl;i.texParameterf(i.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}class h{constructor(e,t){this._context=e,this._desc=t,this._context.instanceCounter.increment(5,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,t.internalFormat,t.width,t.height)}get descriptor(){return this._desc}resize(e,t){const r=this._desc;if(r.width===e&&r.height===t)return;r.width=e,r.height=t;const i=this._context.gl;this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(5,this),this._context=null)}}const d=n.n.getLogger("esri.views.webgl.FrameBufferObject");class f{constructor(e,t,r,i){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...t},e.instanceCounter.increment(4,this),r){let t;var n;if(Array.isArray(r))for(const i of r){const{attachmentPoint:r,texture:n}=i,s=n instanceof u?n:new u(e,n);t=s.descriptor,this._colorAttachments.set(r,s),this._validateColorAttachmentPoint(r),this._validateTextureDimensions(t,this._desc)}else r instanceof u?(t=r.descriptor,this._colorAttachments.set(36064,r)):(t=r,this._colorAttachments.set(36064,new u(e,r))),0!==(null==(n=this._desc)?void 0:n.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateTextureDimensions(t,this._desc)}if(i instanceof h){var s;const e=null!=(s=this._desc.depthStencilTarget)?s:3;2===e?this._stencilAttachment=i:1===e||3===e?this._depthAttachment=i:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),f._validateBufferDimensions(i.descriptor,this._desc)}else if(i){let e;this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),i instanceof u?(this._depthStencilTexture=i,e=this._depthStencilTexture.descriptor):(e=i,this._depthStencilTexture=new u(this._context,e)),this._validateTextureDimensions(e,this._desc)}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(4,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(36064);return e&&e instanceof u?e:null}get colorAttachment(){return this._colorAttachments.get(36064)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&t instanceof u?t:null}attachColorTexture(e,t=36064){if(!e)return;this._validateColorAttachmentPoint(t);const r=e.descriptor;if(this._validateTextureDimensions(r,this._desc),this._disposeColorAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl;r.framebufferTexture2D(r.FRAMEBUFFER,t,r.TEXTURE_2D,e.glName,0)}this._colorAttachments.set(t,e)}detachColorTexture(e=36064){const t=this._colorAttachments.get(e);if(t instanceof u){const r=t;if(this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,null,0)}return this._colorAttachments.delete(e),r}}attachDepthStencilTexture(e){if(!e)return;const t=e.descriptor;if(34041!==t.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==t.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDimensions(t,this._desc),this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,e.glName,0)}this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(!e)return;const t=e.descriptor;if(34041!==t.internalFormat&&33189!==t.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),f._validateBufferDimensions(t,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===t.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl,r=1===this._desc.depthStencilTarget?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,r,t.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}return this._depthAttachment=null,t}copyToTexture(e,t,r,i,n,s,a){(e<0||t<0||n<0||s<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");const o=this._desc,l=a.descriptor;3553!==a.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+r>o.width||t+i>o.height||n+r>l.width||s+i>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context;c.bindTexture(a,0),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(3553,0,n,s,e,t,r,i)}readPixels(e,t,r,i,n,s,a){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,n,s,a)}resize(e,t){const r=this._desc;if(r.width!==e||r.height!==t){if(!this._initialized)return r.width=e,r.height=t,this._colorAttachments.forEach((r=>{r&&r.resize(e,t)})),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,t));r.width=e,r.height=t,this._colorAttachments.forEach((r=>{r&&r.resize(e,t)})),null!=this._depthStencilTexture?this._depthStencilTexture.resize(e,t):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,t),this._stencilAttachment&&this._stencilAttachment.resize(e,t)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(){var e,t,r,i;const n=this._context.gl;if(this._initialized)return void n.bindFramebuffer(n.FRAMEBUFFER,this.glName);this._glName&&n.deleteFramebuffer(this._glName);const s=this._context,a=n.createFramebuffer(),o=this._desc,l=null!=(e=o.colorTarget)?e:1,c=null!=(t=o.width)?t:1,d=null!=(r=o.height)?r:1;if(n.bindFramebuffer(n.FRAMEBUFFER,a),0===this._colorAttachments.size)if(0===l)this._colorAttachments.set(36064,p(s,o));else{const e=new h(s,{internalFormat:32854,width:c,height:d});this._colorAttachments.set(36064,e)}this._colorAttachments.forEach(((e,t)=>{e&&(e instanceof u?n.framebufferTexture2D(n.FRAMEBUFFER,t,n.TEXTURE_2D,e.glName,0):n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,e.glName))}));const f=null!=(i=o.depthStencilTarget)?i:0;switch(f){case 1:case 3:{this._depthAttachment||(this._depthAttachment=new h(s,{internalFormat:1===o.depthStencilTarget?33189:34041,width:c,height:d}));const e=1===f?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT;n.framebufferRenderbuffer(n.FRAMEBUFFER,e,n.RENDERBUFFER,this._depthAttachment.glName);break}case 2:this._stencilAttachment||(this._stencilAttachment=new h(s,{internalFormat:36168,width:c,height:d})),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){s.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const e={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c,height:d};this._depthStencilTexture=new u(s,e)}n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,this._depthStencilTexture.glName,0)}this._glName=a,this._initialized=!0}_disposeColorAttachments(){this._colorAttachments.forEach(((e,t)=>{if(e instanceof u){if(this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,null,0)}e.dispose()}else if(e instanceof WebGLRenderbuffer){const r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(e)}})),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}static _validateBufferDimensions(e,t){console.assert(e.width>=0&&e.height>=0),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}_validateTextureDimensions(e,t){console.assert(e.width>=0&&e.height>=0),3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}_validateColorAttachmentPoint(e){if(-1===f._MAX_COLOR_ATTACHMENTS){const e=this._context.capabilities.drawBuffers;if(e){const t=this._context.gl;f._MAX_COLOR_ATTACHMENTS=t.getParameter(e.MAX_COLOR_ATTACHMENTS)}else f._MAX_COLOR_ATTACHMENTS=1}const t=e-36064;t+1>f._MAX_COLOR_ATTACHMENTS&&d.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${f._MAX_COLOR_ATTACHMENTS} color attachments`)}}f._MAX_COLOR_ATTACHMENTS=-1;const p=(e,t)=>new u(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height})},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return N})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return z})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return k})),r.d(t,"h",(function(){return c})),r.d(t,"i",(function(){return V})),r.d(t,"j",(function(){return P})),r.d(t,"k",(function(){return G})),r.d(t,"l",(function(){return A})),r.d(t,"m",(function(){return X})),r.d(t,"n",(function(){return J})),r.d(t,"o",(function(){return q})),r.d(t,"p",(function(){return H})),r.d(t,"q",(function(){return B})),r.d(t,"r",(function(){return l})),r.d(t,"s",(function(){return U})),r.d(t,"t",(function(){return d})),r.d(t,"u",(function(){return W})),r.d(t,"v",(function(){return $})),r.d(t,"w",(function(){return ee})),r.d(t,"x",(function(){return f}));r(163),r(87),r(140),r(88),r(1);var i,n,s,a,o,l,c,u=r(0);r(312);function h(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function d(e,t){return 65535&e|t<<16}function f(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24}!function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(i||(i={})),function(e){e[e.SUCCEEDED=0]="SUCCEEDED",e[e.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(s||(s={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(o||(o={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(l||(l={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(c||(c={}));class p{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(e,t,r,i,n,s,a,o,l){this.color=e,this.haloColor=t,this.haloSize=r,this.size=i,this.angle=n,this.offsetX=s,this.offsetY=a,this.hAnchor=o,this.vAnchor=l}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}p.pool=new u.b6(p);const y=u.n.getLogger("esri.views.2d.engine.webgl.Utils"),g="geometry",m=[{name:g,strideInBytes:32,divisor:0}],b=[{name:g,strideInBytes:12,divisor:0}],_=[{name:g,strideInBytes:36,divisor:0}],x=[{name:g,strideInBytes:32,divisor:0}],v=[{name:g,strideInBytes:36,divisor:0}];function w(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const O=w([{name:g,strideInBytes:32,divisor:0}]),I=w(m),S=w(b),T=w(_),j=w(x),E=w(v);function A(e,t){switch(e){case i.MARKER:return O;case i.FILL:return t?S:I;case i.LINE:return T;case i.TEXT:return j;case i.LABEL:return E}}const M=[g],R=[g],F=[g],C=[g],D=[g];function L(e){switch(e){case i.MARKER:return M;case i.FILL:return R;case i.LINE:return F;case i.TEXT:return C;case i.LABEL:return D}}function N(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function P(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function B(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function k(e){return null!=e}function U(e){return"number"==typeof e}function z(e,t){switch(e){case"butt":return 0;case"round":return t?2:1;case"square":return 2;default:return y.error(new u.s("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}}function V(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return y.error(new u.s("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}}function G(e){switch(e){case"opacity":return a.OPACITY;case"color":return a.COLOR;case"rotation":return a.ROTATION;case"size":return a.SIZE;default:return y.error(`Cannot interpret unknown vv: ${e}`),null}}function q(e,t,r,i,n,s,a){for(const t in s){const i=s[t].stride,a=N(i),o=s[t].data,l=r[t].data,c=i*n.vertexCount/a,u=i*e/a,h=i*n.vertexFrom/a;for(let e=0;e<c;++e)l[e+u]=o[e+h]}const o=n.indexCount;for(let r=0;r<o;++r)i[r+t]=a[r+n.indexFrom]-n.vertexFrom+e}const H={[g]:35044};function W(e,t){const r=[];for(let i=0;i<5;++i){const n=L(i),s={};for(const e of n)s[e]={data:t(i,e)};r.push({data:e(i),buffers:s})}return r}function Z(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function X(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void y.error(new u.s("webgl-utils",`Unable to handle type ${e}`))}}function J(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void y.error(new u.s("webgl-utils",`Unable to handle type ${e}`))}}const Y=e=>{const t={};for(const r in e)for(const i of e[r])t[i.name]=i.location;return t},Q=e=>{const t={};for(const r in e){const i=e[r];t[r]=i.length?i[0].stride:0}return t},K=new Map,$=(e,t)=>{if(!K.has(e)){const r=function(e){const t={};for(const r in e){const i=e[r];let n=0;t[r]=i.map((e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:n,stride:0};return n+=e.count*Z(e.type),t})),t[r].forEach((e=>e.stride=n))}return t}(t),i={strides:Q(r),bufferLayouts:r,attributes:Y(t)};K.set(e,i)}return K.get(e)};function ee(e){e(i.MARKER),e(i.FILL),e(i.LINE),e(i.TEXT),e(i.LABEL)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return L})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return _})),r.d(t,"h",(function(){return x})),r.d(t,"i",(function(){return v})),r.d(t,"j",(function(){return w})),r.d(t,"k",(function(){return O})),r.d(t,"l",(function(){return I})),r.d(t,"m",(function(){return S})),r.d(t,"n",(function(){return T})),r.d(t,"o",(function(){return j})),r.d(t,"p",(function(){return E})),r.d(t,"q",(function(){return A})),r.d(t,"r",(function(){return M})),r.d(t,"s",(function(){return R})),r.d(t,"t",(function(){return F})),r.d(t,"u",(function(){return C})),r.d(t,"v",(function(){return D})),r.d(t,"w",(function(){return i})),r.d(t,"x",(function(){return l})),r.d(t,"y",(function(){return n})),r.d(t,"z",(function(){return c})),r.d(t,"A",(function(){return u})),r.d(t,"B",(function(){return s})),r.d(t,"C",(function(){return a})),r.d(t,"D",(function(){return o})),r.d(t,"E",(function(){return N})),r.d(t,"F",(function(){return h})),r.d(t,"G",(function(){return d})),r.d(t,"H",(function(){return f}));const i=1e-30,n=4294967295,s=512,a=8,o=29,l=16,c=8,u={metrics:{width:15,height:17,left:0,top:-7,advance:14}},h=0,d=0,f=0,p=1,y=2,g=3,m=4,b=5,_=6,x=5,v=6,w=1,O=2,I=2,S=1,T=2,j=4,E=2.5,A=6,M=5,R=6,F=1.15,C=2,D=7,L=500,N=128},function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return D})),r.d(t,"c",(function(){return k})),r.d(t,"d",(function(){return M})),r.d(t,"e",(function(){return I})),r.d(t,"f",(function(){return z})),r.d(t,"g",(function(){return R})),r.d(t,"h",(function(){return E})),r.d(t,"i",(function(){return L})),r.d(t,"j",(function(){return F})),r.d(t,"k",(function(){return N})),r.d(t,"l",(function(){return A})),r.d(t,"m",(function(){return P})),r.d(t,"n",(function(){return h})),r.d(t,"o",(function(){return C})),r.d(t,"p",(function(){return d})),r.d(t,"q",(function(){return m})),r.d(t,"r",(function(){return f})),r.d(t,"s",(function(){return g})),r.d(t,"t",(function(){return _})),r.d(t,"u",(function(){return o})),r.d(t,"v",(function(){return S})),r.d(t,"w",(function(){return U})),r.d(t,"x",(function(){return p})),r.d(t,"y",(function(){return b})),r.d(t,"z",(function(){return u})),r.d(t,"A",(function(){return y})),r.d(t,"B",(function(){return B})),r.d(t,"C",(function(){return s})),r.d(t,"D",(function(){return l})),r.d(t,"E",(function(){return a})),r.d(t,"F",(function(){return c})),r.d(t,"G",(function(){return T})),r.d(t,"H",(function(){return w})),r.d(t,"I",(function(){return v})),r.d(t,"J",(function(){return x})),r.d(t,"K",(function(){return j}));var i=r(222),n=r(328);function s(e){return i.a.extendedSpatialReferenceInfo(e)}function a(e,t,r){return i.a.clip(n.a,e,t,r)}function o(e,t,r){return i.a.cut(n.a,e,t,r)}function l(e,t,r){return i.a.contains(n.a,e,t,r)}function c(e,t,r){return i.a.crosses(n.a,e,t,r)}function u(e,t,r,s){return i.a.distance(n.a,e,t,r,s)}function h(e,t,r){return i.a.equals(n.a,e,t,r)}function d(e,t,r){return i.a.intersects(n.a,e,t,r)}function f(e,t,r){return i.a.touches(n.a,e,t,r)}function p(e,t,r){return i.a.within(n.a,e,t,r)}function y(e,t,r){return i.a.disjoint(n.a,e,t,r)}function g(e,t,r){return i.a.overlaps(n.a,e,t,r)}function m(e,t,r,s){return i.a.relate(n.a,e,t,r,s)}function b(e,t){return i.a.isSimple(n.a,e,t)}function _(e,t){return i.a.simplify(n.a,e,t)}function x(e,t,r=!1){return i.a.convexHull(n.a,e,t,r)}function v(e,t,r){return i.a.difference(n.a,e,t,r)}function w(e,t,r){return i.a.symmetricDifference(n.a,e,t,r)}function O(e,t,r){return i.a.intersect(n.a,e,t,r)}function I(e,t,r=null){return i.a.union(n.a,e,t,r)}function S(e,t,r,s,a,o,l){return i.a.offset(n.a,e,t,r,s,a,o,l)}function T(e,t,r,s,a=!1){return i.a.buffer(n.a,e,t,r,s,a)}function j(e,t,r,s,a,o,l){return i.a.geodesicBuffer(n.a,e,t,r,s,a,o,l)}function E(e,t,r,s=!0){return i.a.nearestCoordinate(n.a,e,t,r,s)}function A(e,t,r){return i.a.nearestVertex(n.a,e,t,r)}function M(e,t,r,s,a){return i.a.nearestVertices(n.a,e,t,r,s,a)}function R(e,t,r,n){if(null==t||null==n)throw new Error("Illegal Argument Exception");const s=i.a.rotate(t,r,n);return s.spatialReference=e,s}function F(e,t,r){if(null==t||null==r)throw new Error("Illegal Argument Exception");const n=i.a.flipHorizontal(t,r);return n.spatialReference=e,n}function C(e,t,r){if(null==t||null==r)throw new Error("Illegal Argument Exception");const n=i.a.flipVertical(t,r);return n.spatialReference=e,n}function D(e,t,r,s,a){return i.a.generalize(n.a,e,t,r,s,a)}function L(e,t,r,s){return i.a.densify(n.a,e,t,r,s)}function N(e,t,r,s,a=0){return i.a.geodesicDensify(n.a,e,t,r,s,a)}function P(e,t,r){return i.a.planarArea(n.a,e,t,r)}function B(e,t,r){return i.a.planarLength(n.a,e,t,r)}function k(e,t,r,s){return i.a.geodesicArea(n.a,e,t,r,s)}function U(e,t,r,s){return i.a.geodesicLength(n.a,e,t,r,s)}var z=Object.freeze({__proto__:null,extendedSpatialReferenceInfo:s,clip:a,cut:o,contains:l,crosses:c,distance:u,equals:h,intersects:d,touches:f,within:p,disjoint:y,overlaps:g,relate:m,isSimple:b,simplify:_,convexHull:x,difference:v,symmetricDifference:w,intersect:O,union:I,offset:S,buffer:T,geodesicBuffer:j,nearestCoordinate:E,nearestVertex:A,nearestVertices:M,rotate:R,flipHorizontal:F,flipVertical:C,generalize:D,densify:L,geodesicDensify:N,planarArea:P,planarLength:B,geodesicArea:k,geodesicLength:U})},function(e,t,r){"use strict";r.d(t,"a",(function(){return E})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return I})),r.d(t,"e",(function(){return O}));r(25);var i=r(1),n=r(0),s=r(312),a=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=999,l=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function c(){var e,t,r,i=0,n=0,a=o,c=[],u=[],h=1,d=0,f=0,p=!1,y=!1,g="";return function(e){return u=[],null!==e?b(e.replace?e.replace(/\r\n/g,"\n"):e):(c.length&&m(c.join("")),a=10,m("(eof)"),u)};function m(e){e.length&&u.push({type:l[a],data:e,position:f,line:h,column:d})}function b(s){var l;for(i=0,r=(g+=s).length;e=g[i],i<r;){switch(l=i,a){case 0:i="/"===e&&"*"===t?(c.push(e),m(c.join("")),a=o,i+1):(c.push(e),t=e,i+1);break;case 1:case 2:i=_();break;case 3:i=x();break;case 4:i="."===e||/[eE]/.test(e)?(c.push(e),a=5,t=e,i+1):"x"===e&&1===c.length&&"0"===c[0]?(a=11,c.push(e),t=e,i+1):/[^\d]/.test(e)?(m(c.join("")),a=o,i):(c.push(e),t=e,i+1);break;case 11:i=/[^a-fA-F0-9]/.test(e)?(m(c.join("")),a=o,i):(c.push(e),t=e,i+1);break;case 5:"f"===e&&(c.push(e),t=e,i+=1),i=/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(c.push(e),t=e,i+1):/[^\d]/.test(e)?(m(c.join("")),a=o,i):(c.push(e),t=e,i+1);break;case 9999:i=w();break;case 9:i=/[^\s]/g.test(e)?(m(c.join("")),a=o,i):(c.push(e),t=e,i+1);break;case o:c=c.length?[]:c,i="/"===t&&"*"===e?(f=n+i-1,a=0,t=e,i+1):"/"===t&&"/"===e?(f=n+i-1,a=1,t=e,i+1):"#"===e?(a=2,f=n+i,i):/\s/.test(e)?(a=9,f=n+i,i):(p=/\d/.test(e),y=/[^\w_]/.test(e),f=n+i,a=p?4:y?3:9999,i)}if(l!==i)switch(g[l]){case"\n":d=0,++h;break;default:++d}}return n+=i,g=g.slice(i),u}function _(){return"\r"!==e&&"\n"!==e||"\\"===t?(c.push(e),t=e,i+1):(m(c.join("")),a=o,i)}function x(){if("."===t&&/\d/.test(e))return a=5,i;if("/"===t&&"*"===e)return a=0,i;if("/"===t&&"/"===e)return a=1,i;if("."===e&&c.length){for(;v(c););return a=5,i}if(";"===e||")"===e||"("===e){if(c.length)for(;v(c););return m(e),a=o,i+1}var r=2===c.length&&"="!==e;if(/[\w_\d\s]/.test(e)||r){for(;v(c););return a=o,i}return c.push(e),t=e,i+1}function v(e){for(var t,r,i=0;;){if(t=s.a.indexOf(e.slice(0,e.length+i).join("")),r=s.a[t],-1===t){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return m(r),f+=r.length,(c=c.slice(r.length)).length}}function w(){if(/[^\d\w_]/.test(e)){var r=c.join("");return a=s.b.indexOf(r)>-1?8:s.c.indexOf(r)>-1?7:6,m(c.join("")),a=o,i}return c.push(e),t=e,i+1}}function u(e){return function(e){var t=c(),r=[];return(r=r.concat(t(e))).concat(t(null))}(e)}const h=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function d(e,t){for(let r=t-1;r>=0;r--){const t=e[r];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function f(e,t,r,i){i=i||r;for(const n of e)if("ident"===n.type&&n.data===r)return i in t?t[i]++:t[i]=0,f(e,t,i+"_"+t[i],i);return r}function p(e,t,r="afterVersion"){function i(e,t){for(let r=t;r<e.length;r++){const t=e[r];if("operator"===t.type&&";"===t.data)return r}return null}const n={data:"\n",type:"whitespace"},s=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let a=function(e){let t=-1,n=0,s=-1;for(let a=0;a<e.length;a++){const o=e[a];if("preprocessor"===o.type&&(o.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++n:o.data.match(/\#endif\s*.*/)&&--n),"afterVersion"!==r&&"afterPrecision"!==r||"preprocessor"===o.type&&/^#version/.test(o.data)&&(s=Math.max(s,a)),"afterPrecision"===r&&"keyword"===o.type&&"precision"===o.data){const t=i(e,a);if(null===t)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,t)}t<s&&0===n&&(t=a)}return t+1}(e);s(a-1)&&e.splice(a++,0,n);for(const r of t)e.splice(a++,0,r);s(a-1)&&s(a)&&e.splice(a,0,n)}function y(e,t,r,i="lowp"){p(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function g(e,t,r,i,n="lowp"){p(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function m(e,t){let r,i,n=-1;for(let s=t;s<e.length;s++){const t=e[s];if("operator"===t.type&&("["===t.data&&(r=s),"]"===t.data)){i=s;break}"integer"===t.type&&(n=parseInt(t.data,10))}return r&&i&&e.splice(r,i-r+1),n}function b(e,t){const r=u(e);if("300 es"===function(e,t="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of e)if("preprocessor"===n.type){const e=i.exec(n.data);if(e){const i=e[1].replace(/\s\s+/g," ");if(i===r)return i;if(i===t)return n.data="#version "+r,t;throw new Error("unknown glsl version: "+i)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"}),null}(r,"100","300 es"))throw new Error("shader is already glsl 300 es");let i=null,n=null;const s={},o={};for(let e=0;e<r.length;++e){const l=r[e];switch(l.type){case"keyword":"vertex"===t&&"attribute"===l.data?l.data="in":"varying"===l.data&&(l.data="vertex"===t?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replace(/(2D|Cube|EXT)/g,"")),"fragment"===t&&"gl_FragColor"===l.data&&(i||(i=f(r,s,"fragColor"),y(r,i,"vec4")),l.data=i),"fragment"===t&&"gl_FragData"===l.data){const t=m(r,e+1),i=f(r,s,"fragData");g(r,i,"vec4",t,"mediump"),l.data=i}else"fragment"===t&&"gl_FragDepthEXT"===l.data&&(n||(n=f(r,s,"gl_FragDepth")),l.data=n);break;case"ident":if(a.indexOf(l.data)>=0){if("vertex"===t&&d(r,e))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=f(r,s,l.data)),l.data=o[l.data]}}}for(let e=r.length-1;e>=0;--e){const t=r[e];if("preprocessor"===t.type){const i=t.data.match(/\#extension\s+(.*)\:/);if(i&&i[1]&&h.indexOf(i[1].trim())>=0){const t=r[e+1];r.splice(e,t&&"whitespace"===t.type?2:1)}const n=t.data.match(/\#ifdef\s+(.*)/);n&&n[1]&&h.indexOf(n[1].trim())>=0&&(t.data="#if 1");const s=t.data.match(/\#ifndef\s+(.*)/);s&&s[1]&&h.indexOf(s[1].trim())>=0&&(t.data="#if 0")}}return function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(r)}class _{constructor(e,t,r,i,n={}){if(this._context=null,this._glName=null,this._locations={},this._initialized=!1,this._vShader=null,this._fShader=null,this._defines={},this._nameToUniformLocation={},this._nameToAttribLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),e.instanceCounter.increment(3,this),this._context=e,this._vertexShaderSource=t,this._fragmentShaderSource=r,Array.isArray(n))for(const e of n)this._defines[e]="1";else this._defines=n;this._locations=i}get glName(){return this._glName}get locations(){return this._locations}getDefine(e){return this._defines[e]}dispose(){if(!this._context)return;const e=this._context.gl;if(this._vShader){const t=this._vShader;e.deleteShader(t),this._vShader=null}if(this._fShader){const t=this._fShader;e.deleteShader(t),this._fShader=null}this._glName&&(e.deleteProgram(this._glName),this._glName=null),this._context.instanceCounter.decrement(3,this),this._context=null}initialize(){if(this._initialized)return;this._vShader=this._loadShader(35633),this._fShader=this._loadShader(35632),this._vShader&&this._fShader||console.error("Error loading shaders!");const e=this._context.gl,t=e.createProgram();e.attachShader(t,this._vShader),e.attachShader(t,this._fShader);for(const r in this._locations){const i=this._locations[r];e.bindAttribLocation(t,i,r)}e.linkProgram(t),this._glName=t,this._initialized=!0}getUniformLocation(e){return this.initialize(),void 0===this._nameToUniformLocation[e]&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this._glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return null!==this.getUniformLocation(e)}getAttribLocation(e){return this.initialize(),void 0===this._nameToAttribLocation[e]&&(this._nameToAttribLocation[e]=this._context.gl.getAttribLocation(this._glName,e)),this._nameToAttribLocation[e]}setUniform1i(e,t){const r=this._nameToUniform1[e];void 0!==r&&t===r||(this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1iv(e,t){const r=this._nameToUniform1v[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform1v[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniform2iv(e,t){const r=this._nameToUniform2[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform2[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniform3iv(e,t){const r=this._nameToUniform3[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform3[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniform4iv(e,t){const r=this._nameToUniform4[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform4[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniform1f(e,t){const r=this._nameToUniform1[e];void 0!==r&&t===r||(this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1fv(e,t){const r=this._nameToUniform1v[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform1v[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniform2f(e,t,r){const i=this._nameToUniform2[e];void 0!==i&&t===i[0]&&r===i[1]||(this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(e),t,r),void 0===i?this._nameToUniform2[e]=[t,r]:(i[0]=t,i[1]=r))}setUniform2fv(e,t){const r=this._nameToUniform2[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform2[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniform3f(e,t,r,i){const n=this._nameToUniform3[e];void 0!==n&&t===n[0]&&r===n[1]&&i===n[2]||(this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(e),t,r,i),void 0===n?this._nameToUniform3[e]=[t,r,i]:(n[0]=t,n[1]=r,n[2]=i))}setUniform3fv(e,t){const r=this._nameToUniform3[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform3[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniform4f(e,t,r,i,n){const s=this._nameToUniform4[e];void 0!==s&&t===s[0]&&r===s[1]&&i===s[2]&&n===s[3]||(this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(e),t,r,i,n),void 0===s?this._nameToUniform4[e]=[t,r,i,n]:(s[0]=t,s[1]=r,s[2]=i,s[3]=n))}setUniform4fv(e,t){const r=this._nameToUniform4[e];x(r,t)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(e),t),void 0===r?this._nameToUniform4[e]=_._arrayCopy(t):_._arrayAssign(t,r))}setUniformMatrix3fv(e,t,r=!1){const i=this._nameToUniformMatrix3[e];v(i,t)&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(e),r,t),void 0===i?this._nameToUniformMatrix3[e]=_._arrayCopy(t):_._arrayAssign(t,i))}setUniformMatrix4fv(e,t,r=!1){const i=this._nameToUniformMatrix4[e];w(i,t)&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(e),r,t),void 0===i?this._nameToUniformMatrix4[e]=_._arrayCopy(t):_._arrayAssign(t,i))}assertCompatibleVertexAttributeLocations(e){const t=e.locations===this.locations;return t||console.error("VertexAttributeLocations are incompatible"),t}static _padToThree(e){let t=e.toString();return e<1e3&&(t=("  "+e).slice(-3)),t}_addLineNumbers(e){let t=2;return e.replace(/\n/g,(()=>"\n"+_._padToThree(t++)+":"))}_loadShader(e){const t=35633===e;let r=t?this._vertexShaderSource:this._fragmentShaderSource,i="";for(const e in this._defines)i+=`#define ${e} ${this._defines[e]}\n`;r=i+r,"webgl2"===this._context.contextVersion&&(r=b(r,t?"vertex":"fragment"));const n=this._context.gl,s=n.createShader(e);return n.shaderSource(s,r),n.compileShader(s),s}static _arrayCopy(e){const t=[];for(let r=0;r<e.length;++r)t.push(e[r]);return t}static _arrayAssign(e,t){for(let r=0;r<e.length;++r)t[r]=e[r]}}function x(e,t){if(Object(n.J)(e)||e.length!==t.length)return!0;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!0;return!1}function v(e,t){return!!Object(n.J)(e)||(9!==e.length?x(e,t):9!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8])}function w(e,t){return!!Object(n.J)(e)||(16!==e.length?x(e,t):16!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8]||e[9]!==t[9]||e[10]!==t[10]||e[11]!==t[11]||e[12]!==t[12]||e[13]!==t[13]||e[14]!==t[14]||e[15]!==t[15])}class O{constructor(e,t,r,i,n){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(1,this),this._glName=this._context.gl.createBuffer(),Object(s.d)(this._context.gl),i&&this.setData(i,n)}static createIndex(e,t,r,i){return new O(e,34963,t,r,i)}static createVertex(e,t,r){return new O(e,34962,t,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}dispose(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(1,this),this._context=null)}setData(e,t){if(!e)return;if("number"==typeof e){if(e<0&&console.error("Buffer size cannot be negative!"),34963===this.bufferType&&t)switch(this._indexType=t,this._size=e,t){case 5123:e*=2;break;case 5125:e*=4}}else{let t=e.byteLength;Object(i.n)(e)&&(t/=2,this._indexType=5123),Object(i.f)(e)&&(t/=4,this._indexType=5125),this._size=t}const r=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this),this._context.gl.bufferData(this.bufferType,e,this.usage),this._context.bindVAO(r)}setSubData(e,t=0,r=0,n=e.byteLength){if(!e)return;(t<0||t>=this._size)&&console.error("offset is out of range!");let s=t,a=r,o=n,l=e.byteLength;Object(i.n)(e)&&(l/=2,s*=2,a*=2,o*=2),Object(i.f)(e)&&(l/=4,s*=4,a*=4,o*=4),void 0===n&&(n=l-1),r>=n&&console.error("end must be bigger than start!"),t+r-n>this._size&&console.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const u=this._context.gl,h=ArrayBuffer.isView(e)?e.buffer:e,d=0===a&&o===e.byteLength?h:h.slice(a,o);u.bufferSubData(this.bufferType,s,d),this._context.bindVAO(c)}}function I(e,t){return e.vertexBuffers[t].size/function(e){return e[0].stride}(e.layout[t])}function S(e,t,r,i,n){const s=e.gl,a=e.capabilities.instancing;e.bindBuffer(r);for(const e of i){const r=t[e.name],i=(n||(0+e.baseInstance?e.baseInstance:0))*e.stride;if(void 0===r&&console.error(`There is no location for vertex attribute '${e.name}' defined.`),e.baseInstance&&!e.divisor&&console.error(`Vertex attribute '${e.name}' uses baseInstanceOffset without divisor.`),e.count<=4)s.vertexAttribPointer(r,e.count,e.type,e.normalized,e.stride,e.offset+i),s.enableVertexAttribArray(r),e.divisor&&e.divisor>0&&a&&a.vertexAttribDivisor(r,e.divisor);else if(9===e.count)for(let t=0;t<3;t++)s.vertexAttribPointer(r+t,3,e.type,e.normalized,e.stride,e.offset+12*t+i),s.enableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&a&&a.vertexAttribDivisor(r+t,e.divisor);else if(16===e.count)for(let t=0;t<4;t++)s.vertexAttribPointer(r+t,4,e.type,e.normalized,e.stride,e.offset+16*t+i),s.enableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&a&&a.vertexAttribDivisor(r+t,e.divisor);else console.error("Unsupported vertex attribute element count: "+e.count)}}function T(e,t,r,i){const n=e.gl,s=e.capabilities.instancing;e.bindBuffer(r);for(const e of i){const r=t[e.name];if(e.count<=4)n.disableVertexAttribArray(r),e.divisor&&e.divisor>0&&s&&s.vertexAttribDivisor(r,0);else if(9===e.count)for(let t=0;t<3;t++)n.disableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&s&&s.vertexAttribDivisor(r+t,0);else if(16===e.count)for(let t=0;t<4;t++)n.disableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&s&&s.vertexAttribDivisor(r+t,0);else console.error("Unsupported vertex attribute element count: "+e.count)}e.unbindBuffer(34962)}function j(e){switch(e){case 6406:case 6409:case 36168:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}class E{constructor(e,t,r,i,n){this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(2,this)}get glName(){return this._glName}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].size),this._indexBuffer?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){if(!this._context)return;const t=this._context.capabilities.vao;if(t&&this._glName&&(t.deleteVertexArray(this._glName),this._glName=null),this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer=Object(n.c3)(this._indexBuffer)}this._context.instanceCounter.decrement(2,this),this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const e=this._buffers,t=!!this._context.capabilities.vao,r=this._layout,i=this._indexBuffer;e||console.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const t in e){const i=e[t];i||console.error("Vertex buffer is uninitialized!");const n=r[t];n||console.error("Vertex element descriptor is empty!"),S(this._context,this._locations,i,n)}i&&(t?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const e=this._buffers,t=this._layout;e||console.error("Vertex buffer dictionary is empty!");for(const r in e){const i=e[r];i||console.error("Vertex buffer is uninitialized!");const n=t[r];T(this._context,this._locations,i,n)}this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return k})),r.d(t,"c",(function(){return C}));r(25);var i=r(1),n=r(0),s=r(318),a=r(137),o=r(310);const l=1/Object(i.a)("mapview-transitions-duration");class c extends n.m{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Object(n.b$)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Object(n.b$)(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;null==(e=this.parent)||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,r=this.computedOpacity;if(r===t)this.computedVisible=this.visible;else{const i=e*l;this.computedOpacity=r>t?Math.max(t,r-i):Math.min(t,r+i),this.computedVisible=this.computedOpacity>0;const n=t===this.computedOpacity;this.inFadeTransition=!n,n||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class u{constructor(e,t,r){this.strength=e,this.radius=t,this.threshold=r,this.type="bloom"}interpolate(e,t,r){this.strength=g(e.strength,t.strength,r),this.radius=g(e.radius,t.radius,r),this.threshold=g(e.threshold,t.threshold,r)}clone(){return new u(this.strength,this.radius,this.threshold)}}class h{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,r){this.radius=Math.round(g(e.radius,t.radius,r))}clone(){return new h(this.radius)}}class d{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.amount=g(e.amount,t.amount,r),this._updateMatrix()}clone(){return new d(this.type,this.amount)}_updateMatrix(){const e=this._colorMatrix||Object(s.a)();switch(this.type){case"brightness":this._colorMatrix=((e,t)=>{const r=Object(a.i)(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Object(a.g)(r,r)})(e,this.amount);break;case"contrast":this._colorMatrix=((e,t)=>{const r=Object(a.i)(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Object(a.g)(r,r)})(e,this.amount);break;case"grayscale":this._colorMatrix=((e,t)=>{const r=1-t,i=Object(a.i)(e,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Object(a.g)(i,i)})(e,this.amount);break;case"invert":this._colorMatrix=((e,t)=>{const r=1-2*t,i=Object(a.i)(e,r,0,0,t,0,r,0,t,0,0,r,t,0,0,0,1);return Object(a.g)(i,i)})(e,this.amount);break;case"saturate":this._colorMatrix=((e,t)=>{const r=Object(a.i)(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Object(a.g)(r,r)})(e,this.amount);break;case"sepia":this._colorMatrix=((e,t)=>{const r=1-t,i=Object(a.i)(e,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Object(a.g)(i,i)})(e,this.amount)}}}class f{constructor(e,t,r,i){this.offsetX=e,this.offsetY=t,this.blurRadius=r,this.color=i,this.type="drop-shadow"}interpolate(e,t,r){this.offsetX=g(e.offsetX,t.offsetX,r),this.offsetY=g(e.offsetY,t.offsetY,r),this.blurRadius=g(e.blurRadius,t.blurRadius,r),this.color[0]=Math.round(g(e.color[0],t.color[0],r)),this.color[1]=Math.round(g(e.color[1],t.color[1],r)),this.color[2]=Math.round(g(e.color[2],t.color[2],r)),this.color[3]=g(e.color[3],t.color[3],r)}clone(){return new f(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}}class p{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.angle=g(e.angle,t.angle,r),this._updateMatrix()}clone(){return new p(this.angle)}_updateMatrix(){const e=this._colorMatrix||Object(s.a)();this._colorMatrix=((e,t)=>{const r=Math.sin(t*Math.PI/180),i=Math.cos(t*Math.PI/180),n=Object(a.i)(e,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Object(a.g)(n,n)})(e,this.angle)}}class y{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,r){this.amount=g(e.amount,t.amount,r)}clone(){return new y(this.amount)}}function g(e,t,r){return e+(t-e)*r}var m=Object(o.b)((function(e){var t;t=function(){function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return r[e.type](e)}return"Expected "+function(e){var t,r,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=a(e[t]);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var i,n={},s={start:le},a=le,o=ne("none"),l="none",c=re("none",!1),u=re(")",!1),h=",",d=re(",",!1),f=function(e,t){return t.length>0?function(e,t,r){return[e].concat(function(e,t){return e.map((function(e){return e[t]}))}(t,r))}(e,t,3):[e]},p=ne("whitespace"),y=/^[ \t\n\r]/,g=ie([" ","\t","\n","\r"],!1,!1),m=ne("function"),b=re("(",!1),_=ne("identifier"),x=/^[a-z\-]/,v=ie([["a","z"],"-"],!1,!1),w=ne("percentage"),O=re("%",!1),I=ne("length"),S=re("px",!1),T=re("cm",!1),j=re("mm",!1),E=re("in",!1),A=re("pt",!1),M=re("pc",!1),R=ne("angle"),F=re("deg",!1),C=re("rad",!1),D="grad",L=re("grad",!1),N="turn",P=re("turn",!1),B=ne("number"),k=ne("color"),U=re("#",!1),z=/^[0-9a-fA-F]/,V=ie([["0","9"],["a","f"],["A","F"]],!1,!1),G=/^[+\-]/,q=ie(["+","-"],!1,!1),H=/^[0-9]/,W=ie([["0","9"]],!1,!1),Z=re(".",!1),X=re("e",!1),J=0,Y=0,Q=[{line:1,column:1}],K=0,$=[],ee=0;if("startRule"in r){if(!(r.startRule in s))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=s[r.startRule]}function te(){return t.substring(Y,J)}function re(e,t){return{type:"literal",text:e,ignoreCase:t}}function ie(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function ne(e){return{type:"other",description:e}}function se(e){var r,i=Q[e];if(i)return i;for(r=e-1;!Q[r];)r--;for(i={line:(i=Q[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Q[e]=i,i}function ae(e,t){var r=se(e),i=se(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function oe(e){J<K||(J>K&&(K=J,$=[]),$.push(e))}function le(){var e;return(e=ce())===n&&(e=function(){var e,t;if(e=[],(t=ue())!==n)for(;t!==n;)e.push(t),t=ue();else e=n;return e}()),e}function ce(){var e,r;return ee++,e=J,de()!==n?(t.substr(J,4)===l?(r=l,J+=4):(r=n,0===ee&&oe(c)),r!==n&&de()!==n?(Y=e,e=[]):(J=e,e=n)):(J=e,e=n),ee--,e===n&&0===ee&&oe(o),e}function ue(){var e,r,i,s;return e=J,de()!==n&&(r=function(){var e,r,i;return ee++,e=J,(r=fe())!==n?(40===t.charCodeAt(J)?(i="(",J++):(i=n,0===ee&&oe(b)),i!==n?(Y=e,e=r=r):(J=e,e=n)):(J=e,e=n),ee--,e===n&&(r=n,0===ee&&oe(m)),e}())!==n&&de()!==n?((i=function(){var e,r,i,s,a,o,l,c;if(e=J,(r=he())!==n){for(i=[],s=J,(a=de())!==n?(44===t.charCodeAt(J)?(o=h,J++):(o=n,0===ee&&oe(d)),o===n&&(o=null),o!==n&&(l=de())!==n&&(c=he())!==n?s=a=[a,o,l,c]:(J=s,s=n)):(J=s,s=n);s!==n;)i.push(s),s=J,(a=de())!==n?(44===t.charCodeAt(J)?(o=h,J++):(o=n,0===ee&&oe(d)),o===n&&(o=null),o!==n&&(l=de())!==n&&(c=he())!==n?s=a=[a,o,l,c]:(J=s,s=n)):(J=s,s=n);i!==n?(Y=e,e=r=f(r,i)):(J=e,e=n)}else J=e,e=n;return e}())===n&&(i=null),i!==n&&de()!==n?(41===t.charCodeAt(J)?(s=")",J++):(s=n,0===ee&&oe(u)),s!==n&&de()!==n?(Y=e,e=function(e,t){return{type:"function",name:e,parameters:t||[]}}(r,i)):(J=e,e=n)):(J=e,e=n)):(J=e,e=n),e}function he(){var e,t;return e=J,(t=pe())===n&&(t=ye())===n&&(t=ge())===n&&(t=function(){var e,t;return ee++,e=J,de()!==n&&(t=be())!==n?(Y=e,e=function(e){return{value:e,unit:null}}(t)):(J=e,e=n),ee--,e===n&&0===ee&&oe(B),e}()),t!==n&&(Y=e,t=function(e){return{type:"quantity",value:e.value,unit:e.unit}}(t)),(e=t)===n&&(e=J,(t=me())!==n&&(Y=e,t=function(e){return{type:"color",colorType:e.type,value:e.value}}(t)),e=t),e}function de(){var e,r;for(ee++,e=[],y.test(t.charAt(J))?(r=t.charAt(J),J++):(r=n,0===ee&&oe(g));r!==n;)e.push(r),y.test(t.charAt(J))?(r=t.charAt(J),J++):(r=n,0===ee&&oe(g));return ee--,e===n&&(r=n,0===ee&&oe(p)),e}function fe(){var e,r,i;if(ee++,e=J,r=[],x.test(t.charAt(J))?(i=t.charAt(J),J++):(i=n,0===ee&&oe(v)),i!==n)for(;i!==n;)r.push(i),x.test(t.charAt(J))?(i=t.charAt(J),J++):(i=n,0===ee&&oe(v));else r=n;return r!==n&&(Y=e,r=te()),ee--,(e=r)===n&&(r=n,0===ee&&oe(_)),e}function pe(){var e,r,i;return ee++,e=J,de()!==n&&(r=be())!==n?(37===t.charCodeAt(J)?(i="%",J++):(i=n,0===ee&&oe(O)),i!==n?(Y=e,e=function(e){return{value:e,unit:"%"}}(r)):(J=e,e=n)):(J=e,e=n),ee--,e===n&&0===ee&&oe(w),e}function ye(){var e,r,i;return ee++,e=J,de()!==n&&(r=be())!==n?("px"===t.substr(J,2)?(i="px",J+=2):(i=n,0===ee&&oe(S)),i!==n?(Y=e,e=function(e){return{value:e,unit:"px"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,de()!==n&&(r=be())!==n?("cm"===t.substr(J,2)?(i="cm",J+=2):(i=n,0===ee&&oe(T)),i!==n?(Y=e,e=function(e){return{value:e,unit:"cm"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,de()!==n&&(r=be())!==n?("mm"===t.substr(J,2)?(i="mm",J+=2):(i=n,0===ee&&oe(j)),i!==n?(Y=e,e=function(e){return{value:e,unit:"mm"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,de()!==n&&(r=be())!==n?("in"===t.substr(J,2)?(i="in",J+=2):(i=n,0===ee&&oe(E)),i!==n?(Y=e,e=function(e){return{value:e,unit:"in"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,de()!==n&&(r=be())!==n?("pt"===t.substr(J,2)?(i="pt",J+=2):(i=n,0===ee&&oe(A)),i!==n?(Y=e,e=function(e){return{value:e,unit:"pt"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,de()!==n&&(r=be())!==n?("pc"===t.substr(J,2)?(i="pc",J+=2):(i=n,0===ee&&oe(M)),i!==n?(Y=e,e=function(e){return{value:e,unit:"pc"}}(r)):(J=e,e=n)):(J=e,e=n)))))),ee--,e===n&&0===ee&&oe(I),e}function ge(){var e,r,i;return ee++,e=J,(r=be())!==n?("deg"===t.substr(J,3)?(i="deg",J+=3):(i=n,0===ee&&oe(F)),i!==n?(Y=e,e=r=function(e){return{value:e,unit:"deg"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,(r=be())!==n?("rad"===t.substr(J,3)?(i="rad",J+=3):(i=n,0===ee&&oe(C)),i!==n?(Y=e,e=r=function(e){return{value:e,unit:"rad"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,(r=be())!==n?(t.substr(J,4)===D?(i=D,J+=4):(i=n,0===ee&&oe(L)),i!==n?(Y=e,e=r=function(e){return{value:e,unit:"grad"}}(r)):(J=e,e=n)):(J=e,e=n),e===n&&(e=J,(r=be())!==n?(t.substr(J,4)===N?(i=N,J+=4):(i=n,0===ee&&oe(P)),i!==n?(Y=e,e=r=function(e){return{value:e,unit:"turn"}}(r)):(J=e,e=n)):(J=e,e=n)))),ee--,e===n&&(r=n,0===ee&&oe(R)),e}function me(){var e,r,i,s;if(ee++,e=J,35===t.charCodeAt(J)?(r="#",J++):(r=n,0===ee&&oe(U)),r!==n){if(i=[],z.test(t.charAt(J))?(s=t.charAt(J),J++):(s=n,0===ee&&oe(V)),s!==n)for(;s!==n;)i.push(s),z.test(t.charAt(J))?(s=t.charAt(J),J++):(s=n,0===ee&&oe(V));else i=n;i!==n?(Y=e,e=r={type:"hex",value:te()}):(J=e,e=n)}else J=e,e=n;return e===n&&(e=J,(r=ue())!==n&&(Y=e,r=function(e){return{type:"function",value:e}}(r)),(e=r)===n&&(e=J,(r=fe())!==n&&(Y=e,r={type:"named",value:te()}),e=r)),ee--,e===n&&(r=n,0===ee&&oe(k)),e}function be(){var e,r,i,s,a,o,l,c;if(e=J,G.test(t.charAt(J))?(r=t.charAt(J),J++):(r=n,0===ee&&oe(q)),r===n&&(r=null),r!==n){for(i=J,s=[],H.test(t.charAt(J))?(a=t.charAt(J),J++):(a=n,0===ee&&oe(W));a!==n;)s.push(a),H.test(t.charAt(J))?(a=t.charAt(J),J++):(a=n,0===ee&&oe(W));if(s!==n)if(46===t.charCodeAt(J)?(a=".",J++):(a=n,0===ee&&oe(Z)),a!==n){if(o=[],H.test(t.charAt(J))?(l=t.charAt(J),J++):(l=n,0===ee&&oe(W)),l!==n)for(;l!==n;)o.push(l),H.test(t.charAt(J))?(l=t.charAt(J),J++):(l=n,0===ee&&oe(W));else o=n;o!==n?i=s=[s,a,o]:(J=i,i=n)}else J=i,i=n;else J=i,i=n;if(i===n)if(i=[],H.test(t.charAt(J))?(s=t.charAt(J),J++):(s=n,0===ee&&oe(W)),s!==n)for(;s!==n;)i.push(s),H.test(t.charAt(J))?(s=t.charAt(J),J++):(s=n,0===ee&&oe(W));else i=n;if(i!==n){if(s=J,101===t.charCodeAt(J)?(a="e",J++):(a=n,0===ee&&oe(X)),a!==n)if(G.test(t.charAt(J))?(o=t.charAt(J),J++):(o=n,0===ee&&oe(q)),o===n&&(o=null),o!==n){if(l=[],H.test(t.charAt(J))?(c=t.charAt(J),J++):(c=n,0===ee&&oe(W)),c!==n)for(;c!==n;)l.push(c),H.test(t.charAt(J))?(c=t.charAt(J),J++):(c=n,0===ee&&oe(W));else l=n;l!==n?s=a=[a,o,l]:(J=s,s=n)}else J=s,s=n;else J=s,s=n;s===n&&(s=null),s!==n?(Y=e,e=r=parseFloat(te())):(J=e,e=n)}else J=e,e=n}else J=e,e=n;return e}if((i=a())!==n&&J===t.length)return i;throw i!==n&&J<t.length&&oe({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}($,K<t.length?t.charAt(K):null,K<t.length?ae(K,K+1):ae(K,K))}}},e.exports&&(e.exports=t())}));function b(e){let t;try{t=e?m.parse(e):[]}catch(t){return{input:e,parsedFunctions:[],effects:[],error:new n.s("effect:invalid-syntax","Invalid effect syntax",{input:e,error:t})}}const r={input:e,parsedFunctions:t,effects:[],error:null};try{for(const e of t)r.effects.push(_(e))}catch(e){r.effects.length=0,r.error=e}return r}function _(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return x(e.parameters,1),1===e.parameters.length&&(t=S(e.parameters[0])),new d(e.name,t)}(e);case"opacity":return function(e){let t=1;return x(e.parameters,1),1===e.parameters.length&&(t=S(e.parameters[0])),new y(t)}(e);case"hue-rotate":return function(e){let t=0;return x(e.parameters,1),1===e.parameters.length&&(t=function(e){return function(e){if("quantity"!==e.type||(0!==e.value||null!==e.unit)&&null==O[e.unit])throw new n.s("effect:type-error",`Expected <angle>, Actual: ${v(e)}`,{term:e})}(e),e.value*O[e.unit]||0}(e.parameters[0])),new p(t)}(e);case"blur":return function(e){let t=0;return x(e.parameters,1),1===e.parameters.length&&(t=j(e.parameters[0]),w(t,e.parameters[0])),new h(t)}(e);case"drop-shadow":return function(e){const t=[];let r;for(const i of e.parameters)if("color"===i.type){if(t.length&&Object.freeze(t),r)throw new n.s("effect:type-error","Accepts only one color",{});r=E(i)}else{const e=j(i);if(Object.isFrozen(t))throw new n.s("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&w(e,i)}if(t.length<2||t.length>3)throw new n.s("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new f(t[0],t[1],t[2]||0,r||A("black"))}(e);case"bloom":return function(e){let t=1,r=0,i=0;return x(e.parameters,3),e.parameters[0]&&(t=S(e.parameters[0])),e.parameters[1]&&(r=j(e.parameters[1]),w(r,e.parameters[1])),e.parameters[2]&&(i=S(e.parameters[2])),new u(t,r,i)}(e)}}catch(t){throw t.details.filter=e,t}throw new n.s("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function x(e,t){if(e.length>t)throw new n.s("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function v(e){return"color"===e.type?"<color>":I[e.unit]?"<length>":O[e.unit]?"<angle>":"%"===e.unit?"<percentage>":"<double>"}function w(e,t){if(e<0)throw new n.s("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}const O={deg:1,grad:.9,rad:180/Math.PI,turn:360};const I={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/73};function S(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new n.s("effect:type-error",`Expected <double> or <percentage>, Actual: ${v(e)}`,{term:e})}(e);const t=e.value;return w(t,e),"%"===e.unit?.01*t:t}function T(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new n.s("effect:type-error",`Expected <double>, Actual: ${v(e)}`,{term:e})}(e),w(e.value,e),e.value}function j(e){return function(e){if("quantity"!==e.type||(0!==e.value||null!==e.unit)&&null==I[e.unit])throw new n.s("effect:type-error",`Expected <length>, Actual: ${v(e)}`,{term:e})}(e),e.value*I[e.unit]||0}function E(e){switch(e.colorType){case"hex":return Object(n.cf)(e.value);case"named":return A(e.value);case"function":return function(e){if(x(e.parameters,4),M.test(e.name))return[S(e.parameters[0]),S(e.parameters[1]),S(e.parameters[2]),e.parameters[3]?S(e.parameters[3]):1];if(R.test(e.name))return Object(n.ch)(T(e.parameters[0]),S(e.parameters[1]),S(e.parameters[2]),e.parameters[3]?S(e.parameters[3]):1);throw new n.s("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function A(e){const t=Object(n.cg)(e);if(!t)throw new n.s("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return t}const M=/^rgba?/i,R=/^hsla?/i;const F=-1;class C{constructor(e=200){this.duration=e,this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this._effect="",this._effects=[],this._scale=0}get effect(){return this._effect}set effect(e){if(e=e||"",this._effect===e)return;this._effect=e;const t=function(e){if(!e)return[];if("string"==typeof e){const t=b(e);return t.error?t.error:[{scale:F,effects:t.effects}]}const t=[];for(const r of e){if(!isFinite(r.scale)||r.scale<=0)return new n.s("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});const e=b(r.value);if(e.error)return e.error;t.push({scale:r.scale,effects:e.effects})}t.sort(((e,t)=>t.effects.length-e.effects.length));for(let e=0;e<t.length-1;e++){if(!L(t[e].effects,t[e+1].effects))return new n.s("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});N(t[e].effects,t[e+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}(e);Array.isArray(t)?this._transitionTo(t):(this._transitionTo([]),n.n.getLogger("esri.views.layers.effects.EffectList").warn("Invalid Effect",{effect:e,error:t}))}get hasEffects(){return this.transitioning||!!this._effects.length}get effects(){return this._effects}get scale(){return this._scale}get transitioning(){return null!==this._to}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}_transitionTo(e){this.scale>0&&function(e,t,r){var i,n,s,a;return null==(i=e[0])||!i.effects||null==(n=t[0])||!n.effects||!(((null==(s=e[0])?void 0:s.scale)===F||(null==(a=t[0])?void 0:a.scale)===F)&&(e.length>1||t.length>1)&&r<=0)&&L(e[0].effects,t[0].effects)}(this._current,e,this.scale)?(this._final=e,this._to=Object(i.o)(e),function(e,t,r){var i,n;const s=e.length>t.length?e:t,a=e.length>t.length?t:e,o=a[a.length-1],l=null!=(i=null==o?void 0:o.scale)?i:r,c=null!=(n=null==o?void 0:o.effects)?n:[];for(let e=a.length;e<s.length;e++)a.push({scale:l,effects:[...c]});for(let e=0;e<s.length;e++)a[e].scale=a[e].scale===F?r:a[e].scale,s[e].scale=s[e].scale===F?r:s[e].scale,N(a[e].effects,s[e].effects)}(this._current,this._to,this.scale),this._from=Object(i.o)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._effects=this._current[0]?Object(i.o)(this._current[0].effects):[]}_applyTimeTransition(e){if(!this._to)return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let e=0;e<this._current.length;e++){const r=this._current[e],i=this._from[e],n=this._to[e];r.scale=P(i.scale,n.scale,t);for(let e=0;e<r.effects.length;e++){const s=r.effects[e],a=i.effects[e],o=n.effects[e];s.interpolate(a,o,t)}}1===t&&(this._current=this._final,this._effects=this._current[0]?Object(i.o)(this._current[0].effects):[],this._from=this._to=this._final=null)}_updateForScale(e){if(0===this._current.length)return;this._scale=e;const t=this._current,r=this._current.length-1;let i,n,s=1;if(1===t.length||e>=t[0].scale)n=i=t[0].effects;else if(e<=t[r].scale)n=i=t[r].effects;else for(let a=0;a<r;a++){const r=t[a],o=t[a+1];if(r.scale>=e&&o.scale<=e){s=(e-r.scale)/(o.scale-r.scale),i=r.effects,n=o.effects;break}}for(let e=0;e<this._effects.length;e++)this._effects[e].interpolate(i[e],n[e],s)}}function D(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new d(e.type,0);case"saturate":case"brightness":case"contrast":return new d(e.type,1);case"opacity":return new y(1);case"hue-rotate":return new p(0);case"blur":return new h(0);case"drop-shadow":return new f(0,0,0,[...Object(n.ci)("transparent")]);case"bloom":return new u(0,0,0)}}function L(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every(((e,t)=>e.type===r[t].type))}function N(e,t){const r=e.length>t.length?e:t,i=e.length>t.length?t:e;for(let e=i.length;e<r.length;e++)i.push(D(r[e]))}function P(e,t,r){return e+(t-e)*r}const B=Object(i.a)("mapview-transitions-duration");class k extends c{constructor(){super(...arguments),this._childrenSet=new Set,this.children=[],this._effectList=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e))}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effect)?e:""}set effect(e){(this._effectList||e)&&(this._effectList||(this._effectList=new C(B)),this._effectList.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectList&&(this._effectList.transitionStep(e,t),this._effectList.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;const r=e.parent;return r&&r!==this&&r.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear();for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){return this.children.sort(e)}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.beforeRender(e);for(const t of this.children)t.processRender(e);for(const t of this.children)t.afterRender(e)}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r(88);function i(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}const n=i();Object.freeze({__proto__:null,create:i,clone:function(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(e,t,r,i,n,s,a,o,l,c,u,h,d,f,p,y){const g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=i,g[4]=n,g[5]=s,g[6]=a,g[7]=o,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=f,g[14]=p,g[15]=y,g},createView:function(e,t){return new Float32Array(e,t,16)},IDENTITY:n})},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s}));var i=r(316);function n(e){let t="";for(const r in e){const i=e[r];if("boolean"==typeof i)i&&(t+=`#define ${r}\n`);else if("number"==typeof i)t+=`#define ${r} ${i.toFixed()}\n`;else if("object"==typeof i){const e=i.options;let n=0;for(const r in e)t+=`#define ${e[r]} ${(n++).toFixed()}\n`;t+=`#define ${r} ${e[i.value]}\n`}}return t}function s(e,t,r,n){r=r||{},n=n||"";const s="function"==typeof t.shaders?t.shaders(r):t.shaders;return new i.c(e,n+s.vertexShader,n+s.fragmentShader,t.attributes)}class a{constructor(e){this.readFile=e}resolveIncludes(e){return this.resolve(e)}resolve(e,t=new Map){if(t.has(e))return t.get(e);const r=this.read(e);if(!r)throw new Error(`cannot find shader file ${e}`);const i=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let n=i.exec(r);const s=[];for(;null!=n;)s.push({path:n[1],start:n.index,length:n[0].length}),n=i.exec(r);let a=0,o="";return s.forEach((e=>{o+=r.slice(a,e.start),o+=t.has(e.path)?"":this.resolve(e.path,t),a=e.start+e.length})),o+=r.slice(a),t.set(e,o),o}read(e){return this.readFile(e)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return s})),r.d(t,"h",(function(){return o})),r.d(t,"i",(function(){return p}));var i=r(0),n=r(313);function s(e){switch(e){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}function a(e,t,r,i,s){switch(e){case n.c.FILL:return f.from(t,i);case n.c.LINE:return y.from(t,r);case n.c.MARKER:return p.from(t);case n.c.TEXT:return g.from(t);case n.c.LABEL:return m.from(t,s);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function o(e){switch(l.load(e).geometryType){case n.c.MARKER:return new p(e);case n.c.FILL:return new f(e);case n.c.LINE:return new y(e);case n.c.TEXT:return new g(e);case n.c.LABEL:return new m(e)}}class l{constructor(e){this._data=0,this._data=e}static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get geometryTypeString(){switch(this.geometryType){case n.c.FILL:return"fill";case n.c.MARKER:return"marker";case n.c.LINE:return"line";case n.c.TEXT:return"text";case n.c.LABEL:return"label";default:throw new i.s(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const r=1<<e;t?this._data|=r:this._data&=~r}bit(e){return(this._data&1<<e)>>e}setBits(e,t,r){for(let i=t,n=0;i<r;i++,n++)this.setBit(i,0!=(e&1<<n))}bits(e,t){let r=0;for(let i=e,n=0;i<t;i++,n++)r|=this.bit(i)<<n;return r}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}l.shared=new l(0);const c=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const r=function(e,t=!1){const r=n.a.SIZE_FIELD_STOPS|n.a.SIZE_MINMAX_VALUE|n.a.SIZE_SCALE_STOPS|n.a.SIZE_UNIT_VALUE,i=(e&(n.r.FIELD_TARGETS_OUTLINE|n.r.MINMAX_TARGETS_OUTLINE|n.r.SCALE_TARGETS_OUTLINE|n.r.UNIT_TARGETS_OUTLINE))>>>4;return t?r&i:r&~i}(e,t)&e;this.vvSizeMinMaxValue=!!(r&n.a.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(r&n.a.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(r&n.a.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(r&n.a.SIZE_SCALE_STOPS)}},u=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t&&!!(e&n.a.ROTATION)}},h=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t&&!!(e&n.a.COLOR)}},d=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t&&!!(e&n.a.OPACITY)}};class f extends(h(d(l))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const r=this.load(0);return r.geometryType=n.c.FILL,t?r.dotDensity=!0:r.setVV(e,!1),r.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(e){this.setBit(15,e)}}f.shared=new f(0);class p extends(h(d(u(c(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=n.c.MARKER,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}p.shared=new p(0);class y extends(h(d(c(l)))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const r=this.load(0);return r.geometryType=n.c.LINE,r.setVV(e,t),r.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0);class g extends(h(d(u(c(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(e);return t.geometryType=n.c.TEXT,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0);class m extends(c(l)){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const r=this.load(0);return r.geometryType=n.c.LABEL,r.setVV(e,!1),r.mapAligned=!!s(t),r.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}m.shared=new m(0)},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return a}));const i=128/Math.PI,n=1/Math.LN2;function s(e,t){return(e%=t)>=0?e:e+t}function a(e){return s(e*i,256)}function o(e){return s(.7111111111111111*e,256)}function l(e){return Math.log(e)*n}function c(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l}));r(163),r(1);var i=r(0),n=r(9),s=r(17),a=r(83),o=r(324);class l{constructor(e,t){this._mask=0,this._buf=e,this._mask=t}static fromBuffer(e,t){return new l(e,t)}static create(e,t=4294967295){const r=new Uint32Array(Math.ceil(e/32));return new l(r,t)}_getIndex(e){return Math.floor(e/32)}has(e){const t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}hasRange(e,t){let r=e,i=t;for(;r%32&&r!==i;){if(this.has(r))return!0;r++}for(;i%32&&r!==i;){if(this.has(r))return!0;i--}if(r===i)return!1;for(let e=r/32;e!==i/32;e++)if(this._buf[e])return!0;return!1}set(e){const t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]|=i}setRange(e,t){let r=e,i=t;for(;r%32&&r!==i;)this.set(r++);for(;i%32&&r!==i;)this.set(i--);if(r!==i)for(let e=r/32;e!==i/32;e++)this._buf[e]=4294967295}unset(e){const t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]&=4294967295^i}resize(e){const t=this._buf,r=new Uint32Array(Math.ceil(e/32));r.set(t),this._buf=r}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new l(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0}forEachSet(e){for(let t=0;t<this._buf.length;t++){let r=this._buf[t],i=32*t;if(r)for(;r;)1&r&&e(i),r>>>=1,i++}}countSet(){let e=0;return this.forEachSet((t=>{e++})),e}}let c=0;class u{constructor(e){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._deleted=null,this._joined=[],this.instance=e}static createInstance(){return c++,c=c>65535?0:c,c}get isEmpty(){return Object(i.P)(this._deleted)&&this._deleted.countSet()===this.getApproximateSize()}get _hasFilter(){return-1!==this._xmin}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t,r,i){const n=this.copy();return n._tx+=e,n._ty+=t,n._sx*=r,n._sy*=i,n}extent(e,t,r,i){const n=this.copy();return n._xmin=e,n._xmax=r,n._ymin=t,n._ymax=i,n}hasFilter(){return this._hasFilter}readAttribute(e,t=!1){const r=this._readAttribute(e,t);if(void 0!==r)return r;for(const r of this._joined){r.setIndex(this.getIndex());const i=r._readAttribute(e,t);if(void 0!==i)return i}}readAttributes(){return this._readAttributes()}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),t=Object(a.p)(e,this.geometryType,this.hasZ,this.hasM),r=Object(n.e)(t);return r.spatialReference=this._arcadeSpatialReference,r}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return""}removeAtIndex(e){Object(i.J)(this._deleted)&&(this._deleted=l.create(this.getApproximateSize())),this._deleted.set(e)}_getExists(){return Object(i.J)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const t=Object(i.bJ)(this.getQuantizationTransform(),null);return Object(o.a)(new s.a,e,this.hasM,this.hasZ,t)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._xmin=this._xmin,e._xmax=this._xmax,e._ymin=this._ymin,e._ymax=this._ymax}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));r(88);function i(){return new Float32Array(4)}function n(e,t,r,i){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function s(){return i()}function a(){return n(1,1,1,1)}function o(){return n(1,0,0,0)}function l(){return n(0,1,0,0)}function c(){return n(0,0,1,0)}function u(){return n(0,0,0,1)}const h=s(),d=a(),f=o(),p=l(),y=c(),g=u();Object.freeze({__proto__:null,create:i,clone:function(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:n,createView:function(e,t){return new Float32Array(e,t,4)},zeros:s,ones:a,unitX:o,unitY:l,unitZ:c,unitW:u,ZEROS:h,ONES:d,UNIT_X:f,UNIT_Y:p,UNIT_Z:y,UNIT_W:g})},function(e,t,r){"use strict";function i(e,t){return e?t?4:3:t?3:2}function n(e,t,r,n,o){if(!t||!t.lengths.length)return null;const l="upperLeft"===(null==o?void 0:o.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const c=e.coords,u=[],h=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:f}=t,p=i(r,n);let y=0;for(const e of d){const t=s(h,f,y,e,r,n,l);t&&u.push(t),y+=e*p}if(u.sort(((e,t)=>{let i=l*e[2]-l*t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),u.length){let e=6*u[0][2];c[0]=u[0][0]/e,c[1]=u[0][1]/e,r&&(e=6*u[0][4],c[2]=0!==e?u[0][3]/e:0),(c[0]<h[0]||c[0]>h[1]||c[1]<h[2]||c[1]>h[3]||r&&(c[2]<h[4]||c[2]>h[5]))&&(c.length=0)}if(!c.length){const e=t.lengths[0]?a(f,0,d[0],r,n):null;if(!e)return null;c[0]=e[0],c[1]=e[1],r&&e.length>2&&(c[2]=e[2])}return e}function s(e,t,r,n,s,a,o=1){const l=i(s,a);let c=r,u=r+l,h=0,d=0,f=0,p=0,y=0;for(let r=0,i=n-1;r<i;r++,c+=l,u+=l){const r=t[c],i=t[c+1],n=t[c+2],a=t[u],o=t[u+1],l=t[u+2];let g=r*o-a*i;p+=g,h+=(r+a)*g,d+=(i+o)*g,s&&(g=r*l-a*n,f+=(n+l)*g,y+=g),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),s&&(n<e[4]&&(e[4]=n),n>e[5]&&(e[5]=n))}if(p*o>0&&(p*=-1),y*o>0&&(y*=-1),!p)return null;const g=[h,d,.5*p];return s&&(g[3]=f,g[4]=.5*y),g}function a(e,t,r,n,s){const a=i(n,s);let h=t,d=t+a,f=0,p=0,y=0,g=0;for(let t=0,i=r-1;t<i;t++,h+=a,d+=a){const t=e[h],r=e[h+1],i=e[h+2],s=e[d],a=e[d+1],m=e[d+2],b=n?l(t,r,i,s,a,m):o(t,r,s,a);if(b)if(f+=b,n){const e=u(t,r,i,s,a,m);p+=b*e[0],y+=b*e[1],g+=b*e[2]}else{const e=c(t,r,s,a);p+=b*e[0],y+=b*e[1]}}return f>0?n?[p/f,y/f,g/f]:[p/f,y/f]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,i){const n=r-e,s=i-t;return Math.sqrt(n*n+s*s)}function l(e,t,r,i,n,s){const a=i-e,o=n-t,l=s-r;return Math.sqrt(a*a+o*o+l*l)}function c(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function u(e,t,r,i,n,s){return[e+.5*(i-e),t+.5*(n-t),r+.5*(s-r)]}r.d(t,"a",(function(){return n}))},,function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return i})),r.d(t,"e",(function(){return _})),r.d(t,"f",(function(){return n}));const i=!0,n=32,s=1.5,a=200;function o(e,t,r){const i=t&&t.length,n=i?t[0]*r:e.length;let s=l(e,0,n,r,!0);const a=new Array;if(!s||s.next===s.prev)return a;let o,c,h,d,f;if(i&&(s=g(e,t,s,r)),e.length>80*r){o=h=e[0],c=d=e[1];for(let t=r;t<n;t+=r){const r=e[t],i=e[t+1];o=Math.min(o,r),c=Math.min(c,i),h=Math.max(h,r),d=Math.max(d,i)}f=Math.max(h-o,d-c),f=0!==f?1/f:0}return u(s,a,r,o,c,f),a}function l(e,t,r,i,n){let s;if(n===w(e,t,r,i)>0)for(let n=t;n<r;n+=i)s=f(n,e[n],e[n+1],s);else for(let n=r-i;n>=t;n-=i)s=f(n,e[n],e[n+1],s);return s&&T(s,s.next)&&(p(s),s=s.next),s}function c(e,t=e){if(!e)return e;let r,i=e;do{if(r=!1,i.steiner||!T(i,i.next)&&0!==x(i.prev,i,i.next))i=i.next;else{if(p(i),i=t=i.prev,i===i.next)break;r=!0}}while(r||i!==t);return t}function u(e,t,r,i,n,s,a=0){if(!e)return;!a&&s&&(e=b(e,i,n,s));let o=e;for(;e.prev!==e.next;){const l=e.prev,f=e.next;if(s?d(e,i,n,s):h(e))t.push(l.index/r),t.push(e.index/r),t.push(f.index/r),p(e),e=f.next,o=f.next;else if((e=f)===o){a?1===a?u(e=E(e,t,r),t,r,i,n,s,2):2===a&&A(e,t,r,i,n,s):u(c(e),t,r,i,n,s,1);break}}}function h(e){const t=e.prev,r=e,i=e.next;if(x(t,r,i)>=0)return!1;let n=e.next.next;const s=n;let a=0;for(;n!==e.prev&&(0===a||n!==s);){if(a++,O(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&x(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function d(e,t,r,i){const n=e.prev,s=e,a=e.next;if(x(n,s,a)>=0)return!1;const o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,l=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,c=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,u=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,h=S(o,l,t,r,i),d=S(c,u,t,r,i);let f=e.prevZ,p=e.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&O(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&x(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&O(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&O(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&x(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&O(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function f(e,t,r,i){const n=new F(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function p(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function y(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function g(e,t,r,i){const n=new Array;for(let r=0,s=t.length;r<s;r++){const a=l(e,t[r]*i,r<s-1?t[r+1]*i:e.length,i,!1);a===a.next&&(a.steiner=!0),n.push(y(a))}n.sort(j);for(const e of n)m(e,r),r=c(r,r.next);return r}function m(e,t){if(t=function(e,t){let r=t;const i=e.x,n=e.y;let s,a=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const e=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=i&&e>a){if(a=e,e===i){if(n===r.y)return r;if(n===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!s)return null;if(i===a)return s.prev;const o=s,l=s.x,c=s.y;let u,h=1/0;for(r=s.next;r!==o;)i>=r.x&&r.x>=l&&i!==r.x&&O(n<c?i:a,n,l,c,n<c?a:i,n,r.x,r.y)&&(u=Math.abs(n-r.y)/(i-r.x),(u<h||u===h&&r.x>s.x)&&I(r,e)&&(s=r,h=u)),r=r.next;return s}(e,t)){const r=R(t,e);c(r,r.next)}}function b(e,t,r,i){for(let n;n!==e;n=n.next){if(n=n||e,null===n.z&&(n.z=S(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,b(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let t,r=1;for(;;){let i,n=e;e=null,t=null;let s=0;for(;n;){s++,i=n;let a=0;for(;a<r&&i;a++)i=i.nextZ;let o=r;for(;a>0||o>0&&i;){let r;0===a?(r=i,i=i.nextZ,o--):0!==o&&i?n.z<=i.z?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,a--),t?t.nextZ=r:e=r,r.prevZ=t,t=r}n=i}if(t.nextZ=null,r*=2,s<2)return e}}(e)}function _(e,t,r,i){const n=t&&t.length,s=n?t[0]*r:e.length;let a=Math.abs(w(e,0,s,r));if(n)for(let i=0,n=t.length;i<n;i++){const s=t[i]*r,o=i<n-1?t[i+1]*r:e.length;a-=Math.abs(w(e,s,o,r))}let o=0;for(let t=0;t<i.length;t+=3){const n=i[t]*r,s=i[t+1]*r,a=i[t+2]*r;o+=Math.abs((e[n]-e[a])*(e[s+1]-e[n+1])-(e[n]-e[s])*(e[a+1]-e[n+1]))}return 0===a&&0===o?0:Math.abs((o-a)/a)}function x(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function v(e,t,r,i){return!!(T(e,t)&&T(r,i)||T(e,i)&&T(r,t))||x(e,t,r)>0!=x(e,t,i)>0&&x(r,i,e)>0!=x(r,i,t)>0}function w(e,t,r,i){let n=0;for(let s=t,a=r-i;s<r;s+=i)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}function O(e,t,r,i,n,s,a,o){return(n-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(i-o)-(r-a)*(t-o)>=0&&(r-a)*(s-o)-(n-a)*(i-o)>=0}function I(e,t){return x(e.prev,e,e.next)<0?x(e,t,e.next)>=0&&x(e,e.prev,t)>=0:x(e,t,e.prev)<0||x(e,e.next,t)<0}function S(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function T(e,t){return e.x===t.x&&e.y===t.y}function j(e,t){return e.x-t.x}function E(e,t,r){let i=e;do{const n=i.prev,s=i.next.next;!T(n,s)&&v(n,i,i.next,s)&&I(n,s)&&I(s,n)&&(t.push(n.index/r),t.push(i.index/r),t.push(s.index/r),p(i),p(i.next),i=e=s),i=i.next}while(i!==e);return i}function A(e,t,r,i,n,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.index!==e.index&&M(a,e)){let o=R(a,e);return a=c(a,a.next),o=c(o,o.next),u(a,t,r,i,n,s),void u(o,t,r,i,n,s)}e=e.next}a=a.next}while(a!==e)}function M(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&v(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&I(e,t)&&I(t,e)&&function(e,t){let r=e,i=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function R(e,t){const r=new F(e.index,e.x,e.y),i=new F(t.index,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}class F{constructor(e,t,r){this.index=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return A})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return F})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return D})),r.d(t,"f",(function(){return x})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return L})),r.d(t,"i",(function(){return N})),r.d(t,"j",(function(){return p}));var i=r(0),n=r(86),s=r(328),a=r(9);const o=[0,0];function l(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,o),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,o),[r.xmax,r.ymax]=e(t.xmax,t.ymax,o),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:u(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function c(e,t){const r=[];for(const i of e)r.push(u(i,t));return r}function u(e,t){const r=[];for(const i of e){const e=t(i[0],i[1],[0,0]);r.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return r}async function h(e,t){if(!t)return;const r=Array.isArray(e)?e.map((e=>{var t;return null==(t=e.geometry)?void 0:t.spatialReference})):[e];await Object(n.g)(r.map((e=>({source:e,dest:t}))))}const d=l.bind(null,i.cm),f=l.bind(null,i.cn);function p(e,t,r){return e?(r||(r=t,t=e.spatialReference),Object(i.an)(t)&&Object(i.an)(r)&&!Object(i.ak)(t,r)?Object(i.ah)(t,r)?Object(i.bp)(r)?d(e):f(e):Object(n.c)(s.a,[e],t,r,null)[0]:e):e}const y=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,r){!e||!e.length||!t||!r||Object(i.ak)(t,r);const n={geometries:e,inSpatialReference:t,outSpatialReference:r,resolve:null};return this._jobs.push(n),new Promise((e=>{n.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:a,resolve:o}=e;Object(i.ah)(r,a)?Object(i.bp)(a)?o(t.map(d)):o(t.map(f)):o(Object(n.c)(s.a,t,r,a,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function g(e,t,r){return y.push(e,t,r)}const m=(e,t,r)=>[t,r],b=(e,t,r)=>[t,r,e[2]],_=(e,t,r)=>[t,r,e[2],e[3]];function x(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function v({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function w({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function O(e,t,r){const i=[];let n,s,a,o;for(let l=0;l<r.length;l++){const c=r[l];l>0?(a=v(e,c[0]),o=w(e,c[1]),a===n&&o===s||(i.push(t(c,a-n,o-s)),n=a,s=o)):(n=v(e,c[0]),s=w(e,c[1]),i.push(t(c,n,s)))}return i.length>0?i:null}function I({scale:e,translate:t},r){return r*e[0]+t[0]}function S({scale:e,translate:t},r){return t[1]-r*e[1]}function T(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=e.scale;let a=I(e,r[0][0]),o=S(e,r[0][1]);i[0]=t(r[0],a,o);for(let e=1;e<r.length;e++){const l=r[e];a+=l[0]*n,o-=l[1]*s,i[e]=t(l,a,o)}return i}function j(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=T(e,t,r[n]);return i}function E(e,t,r,i,n){return t.points=function(e,t,r,i){return O(e,r?i?_:b:i?b:m,t)}(e,r.points,i,n),t}function A(e,t,r,i,n){return t.x=v(e,r.x),t.y=w(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function M(e,t,r,i,n){const s=function(e,t,r,i){const n=[],s=r?i?_:b:i?b:m;for(let r=0;r<t.length;r++){const i=O(e,s,t[r]);i&&i.length>=3&&n.push(i)}return n.length?n:null}(e,r.rings,i,n);return s?(t.rings=s,t):null}function R(e,t,r,i,n){const s=function(e,t,r,i){const n=[],s=r?i?_:b:i?b:m;for(let r=0;r<t.length;r++){const i=O(e,s,t[r]);i&&i.length>=2&&n.push(i)}return n.length?n:null}(e,r.paths,i,n);return s?(t.paths=s,t):null}function F(e,t){return e&&t?Object(a.d)(t)?A(e,{},t,!1,!1):Object(a.c)(t)?R(e,{},t,!1,!1):Object(a.h)(t)?M(e,{},t,!1,!1):Object(a.f)(t)?E(e,{},t,!1,!1):Object(a.g)(t)?function(e,t,r,i,n){return t.xmin=v(e,r.xmin),t.ymin=w(e,r.ymin),t.xmax=v(e,r.xmax),t.ymax=w(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),n&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}(e,{},t,!1,!1):null:null}function C(e,t,r,i,n){return t.points=function(e,t,r,i){return T(e,r?i?_:b:i?b:m,t)}(e,r.points,i,n),t}function D(e,t,r,i,n){return t.x=I(e,r.x),t.y=S(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function L(e,t,r,i,n){return t.rings=function(e,t,r,i){return j(e,r?i?_:b:i?b:m,t)}(e,r.rings,i,n),t}function N(e,t,r,i,n){return t.paths=function(e,t,r,i){return j(e,r?i?_:b:i?b:m,t)}(e,r.paths,i,n),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){const i=new n(e.getPointX(t),e.getPointY(t),r),s=e.hasZ(t),a=e.hasM(t);return s&&(i.z=e.getPointZ(t)),a&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const i=e.hasZ(t),n=e.hasM(t),s=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){const r=e.getZExtent(t);s.zmin=r.vmin,s.zmax=r.vmax}if(n){const r=e.getMExtent(t);s.mmin=r.vmin,s.mmax=r.vmax}return s}};class n{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class s{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class a{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class l{constructor(e,t,r,i,n){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(310),n=Object(i.b)((function(e){var t;void 0!==(t=function(){function e(r,i,n,s,a){for(;s>n;){if(s-n>600){var o=s-n+1,l=i-n+1,c=Math.log(o),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(o-u)/o)*(l-o/2<0?-1:1);e(r,i,Math.max(n,Math.floor(i-l*u/o+h)),Math.min(s,Math.floor(i+(o-l)*u/o+h)),a)}var d=r[i],f=n,p=s;for(t(r,n,i),a(r[s],d)>0&&t(r,n,s);f<p;){for(t(r,f,p),f++,p--;a(r[f],d)<0;)f++;for(;a(r[p],d)>0;)p--}0===a(r[n],d)?t(r,n,p):t(r,++p,s),p<=i&&(n=p+1),i<=p&&(s=p-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,n,s,a){e(t,i,n||0,s||t.length-1,a||r)}}())&&(e.exports=t)}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(313);const s=i.n.getLogger("esri.views.2d.engine.webgl");function a(e){return Object(n.s)(e.minDataValue)&&Object(n.s)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?n.a.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?n.a.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?n.a.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?n.a.SIZE_UNIT_VALUE:(s.error(new i.s("mapview-bad-type","Found invalid size VisualVariable",e)),n.a.NONE)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return f}));r(88);var i=r(0),n=r(4),s=r(314),a=r(313),o=r(330);function l(e,t=0,r=!1){const i=e[t+3];return e[t+0]*=i,e[t+1]*=i,e[t+2]*=i,r||(e[t+3]*=255),e}function c(e){if(!e)return 0;const{r:t,g:r,b:i,a:n}=e;return Object(a.x)(t*n,r*n,i*n,255*n)}function u(e){if(!e)return 0;const[t,r,i,n]=e;return Object(a.x)(t*(n/255),r*(n/255),i*(n/255),n)}const h=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),d=!1;function f(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function p(e){return e.map((e=>function(e){return{value:e.value,size:Object(n.v)(e.size)}}(e)))}function y(e){if("string"==typeof e||"number"==typeof e)return Object(n.v)(e);const t=e;return{type:"size",expression:t.expression,stops:p(t.stops)}}const g=e=>{const t=[],r=[],i=p(e),a=i.length;for(let e=0;e<6;e++){const o=i[Math.min(e,a-1)];t.push(o.value),r.push(null==o.size?s.w:Object(n.A)(o.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function m(e){const t=e&&e.length>0?{}:null,r=t?{}:null;if(!t)return{vvFields:t,vvRanges:r};for(const i of e)if(i.field&&(t[i.type]=i.field),"size"===i.type){r.size||(r.size={});const e=i;switch(Object(o.a)(e)){case a.a.SIZE_MINMAX_VALUE:r.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:y(e.minSize),maxSize:y(e.maxSize)};break;case a.a.SIZE_SCALE_STOPS:r.size.scaleStops={stops:p(e.stops)};break;case a.a.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const r in e.levels)t[r]=g(e.levels[r]);r.size.fieldStops={type:"level-dependent",levels:t}}else r.size.fieldStops={type:"static",...g(e.stops)};break;case a.a.SIZE_UNIT_VALUE:r.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===i.type)r.color=x(i);else if("opacity"===i.type)r.opacity=b(i);else if("rotation"===i.type){const e=i;r.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:r}}function b(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.values[e]=i.value,t.opacities[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=r}}return t}function _(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function x(e){if(Object(i.J)(e))return null;if(e.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;t.field=e.field;const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.values[e]=i.value,_(t.colors,e,i.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let e=0;e<8;e++)t.values[e]=1/0,_(t.colors,e,r)}}for(let e=0;e<32;e+=4)l(t.colors,e,!0);return t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return c}));r(1);var i=r(11),n=r(54),s=r(138),a=r(317),o=r(313),l=r(325);class c extends a.a{constructor(e,t,r,i=r){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:Object(s.l)(),tileMat3:Object(s.l)()},this.triangleCount=0,this.key=new n.a(e),this.bounds=t,this.size=r,this.coordRange=i}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(e){this._coords=[e[0],e[3]],this._bounds=e}setTransform(e,t){const r=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,[s,a]=e.toScreenNoRotation([0,0],this.coords),o=this.size[0]/this.coordRange[0]*r,l=this.size[1]/this.coordRange[1]*r;Object(i.j)(n,o,0,0,0,l,0,s,a,1),Object(i.f)(this.transforms.dvs,e.displayViewMat3,n)}}const u=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class h extends l.g{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(u),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:t}=e;return{...super.createRenderParams(e),requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)}}prepareRenderPasses(e){const t=e.registerRenderPass({name:"stencil",brushes:[l.a],drawPhase:o.d.DEBUG|o.d.MAP|o.d.HIGHLIGHT,target:()=>this.getStencilTarget()}),r=e.registerRenderPass({name:"tileInfo",brushes:[l.e],drawPhase:o.d.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(e),t,r]}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const r=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,r)}}setStencilReference(){let e=1;for(const t of this.children)t.stencilRef=e++}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return f}));const i={Base64:0,Hex:1,String:2,Raw:3};function n(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s(e){const t=[];for(let r=0,i=8*e.length;r<i;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function a(e){const t=[];for(let r=0,i=32*e.length;r<i;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function o(e,t,r,i,s,a){return n(function(e,t){return e<<t|e>>>32-t}(n(n(t,e),n(i,a)),s),r)}function l(e,t,r,i,n,s,a){return o(t&r|~t&i,e,t,n,s,a)}function c(e,t,r,i,n,s,a){return o(t&i|r&~i,e,t,n,s,a)}function u(e,t,r,i,n,s,a){return o(t^r^i,e,t,n,s,a)}function h(e,t,r,i,n,s,a){return o(r^(t|~i),e,t,n,s,a)}function d(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,i=-271733879,s=-1732584194,a=271733878;for(let t=0;t<e.length;t+=16){const o=r,d=i,f=s,p=a;r=l(r,i,s,a,e[t+0],7,-680876936),a=l(a,r,i,s,e[t+1],12,-389564586),s=l(s,a,r,i,e[t+2],17,606105819),i=l(i,s,a,r,e[t+3],22,-1044525330),r=l(r,i,s,a,e[t+4],7,-176418897),a=l(a,r,i,s,e[t+5],12,1200080426),s=l(s,a,r,i,e[t+6],17,-1473231341),i=l(i,s,a,r,e[t+7],22,-45705983),r=l(r,i,s,a,e[t+8],7,1770035416),a=l(a,r,i,s,e[t+9],12,-1958414417),s=l(s,a,r,i,e[t+10],17,-42063),i=l(i,s,a,r,e[t+11],22,-1990404162),r=l(r,i,s,a,e[t+12],7,1804603682),a=l(a,r,i,s,e[t+13],12,-40341101),s=l(s,a,r,i,e[t+14],17,-1502002290),i=l(i,s,a,r,e[t+15],22,1236535329),r=c(r,i,s,a,e[t+1],5,-165796510),a=c(a,r,i,s,e[t+6],9,-1069501632),s=c(s,a,r,i,e[t+11],14,643717713),i=c(i,s,a,r,e[t+0],20,-373897302),r=c(r,i,s,a,e[t+5],5,-701558691),a=c(a,r,i,s,e[t+10],9,38016083),s=c(s,a,r,i,e[t+15],14,-660478335),i=c(i,s,a,r,e[t+4],20,-405537848),r=c(r,i,s,a,e[t+9],5,568446438),a=c(a,r,i,s,e[t+14],9,-1019803690),s=c(s,a,r,i,e[t+3],14,-187363961),i=c(i,s,a,r,e[t+8],20,1163531501),r=c(r,i,s,a,e[t+13],5,-1444681467),a=c(a,r,i,s,e[t+2],9,-51403784),s=c(s,a,r,i,e[t+7],14,1735328473),i=c(i,s,a,r,e[t+12],20,-1926607734),r=u(r,i,s,a,e[t+5],4,-378558),a=u(a,r,i,s,e[t+8],11,-2022574463),s=u(s,a,r,i,e[t+11],16,1839030562),i=u(i,s,a,r,e[t+14],23,-35309556),r=u(r,i,s,a,e[t+1],4,-1530992060),a=u(a,r,i,s,e[t+4],11,1272893353),s=u(s,a,r,i,e[t+7],16,-155497632),i=u(i,s,a,r,e[t+10],23,-1094730640),r=u(r,i,s,a,e[t+13],4,681279174),a=u(a,r,i,s,e[t+0],11,-358537222),s=u(s,a,r,i,e[t+3],16,-722521979),i=u(i,s,a,r,e[t+6],23,76029189),r=u(r,i,s,a,e[t+9],4,-640364487),a=u(a,r,i,s,e[t+12],11,-421815835),s=u(s,a,r,i,e[t+15],16,530742520),i=u(i,s,a,r,e[t+2],23,-995338651),r=h(r,i,s,a,e[t+0],6,-198630844),a=h(a,r,i,s,e[t+7],10,1126891415),s=h(s,a,r,i,e[t+14],15,-1416354905),i=h(i,s,a,r,e[t+5],21,-57434055),r=h(r,i,s,a,e[t+12],6,1700485571),a=h(a,r,i,s,e[t+3],10,-1894986606),s=h(s,a,r,i,e[t+10],15,-1051523),i=h(i,s,a,r,e[t+1],21,-2054922799),r=h(r,i,s,a,e[t+8],6,1873313359),a=h(a,r,i,s,e[t+15],10,-30611744),s=h(s,a,r,i,e[t+6],15,-1560198380),i=h(i,s,a,r,e[t+13],21,1309151649),r=h(r,i,s,a,e[t+4],6,-145523070),a=h(a,r,i,s,e[t+11],10,-1120210379),s=h(s,a,r,i,e[t+2],15,718787259),i=h(i,s,a,r,e[t+9],21,-343485551),r=n(r,o),i=n(i,d),s=n(s,f),a=n(a,p)}return[r,i,s,a]}function f(e,t=i.Hex){const r=t||i.Base64,n=d(s(e),8*e.length);switch(r){case i.Raw:return n;case i.Hex:return function(e){const t="0123456789abcdef",r=[];for(let i=0,n=4*e.length;i<n;i++)r.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return r.join("")}(n);case i.String:return a(n);case i.Base64:return function(e){const t=[];for(let r=0,i=4*e.length;r<i;r+=3){const i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255;for(let n=0;n<4;n++)8*r+6*n>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-n)&63))}return t.join("")}(n)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return w}));var i=r(0),n=(r(1),r(40)),s=r(5),a=r(317),o=r(9);let l=class extends(Object(n.a)(Object(i.z)(Object(i.aj)(i.m.EventedMixin(i.u))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",r=this.layer&&this.layer.title||"no title";throw i.n.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${r}', id: '${t}')`,e),e}}))}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(i.e)([Object(i.y)()],l.prototype,"fullOpacity",null),Object(i.e)([Object(i.y)()],l.prototype,"layer",void 0),Object(i.e)([Object(i.y)()],l.prototype,"parent",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"suspended",null),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"suspendInfo",null),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"legendEnabled",null),Object(i.e)([Object(i.y)({type:Boolean,readOnly:!0})],l.prototype,"updating",null),Object(i.e)([Object(i.y)()],l.prototype,"visible",null),l=Object(i.e)([Object(i.i)("esri.views.layers.LayerView")],l);var c=l;let u=class extends i.a{};u=Object(i.e)([Object(i.i)("esri.views.layers.support.ClipArea")],u);var h,d=u;let f=h=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new h({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(i.e)([Object(i.y)({type:[Number,String],json:{write:!0}})],f.prototype,"left",void 0),Object(i.e)([Object(i.y)({type:[Number,String],json:{write:!0}})],f.prototype,"right",void 0),Object(i.e)([Object(i.y)({type:[Number,String],json:{write:!0}})],f.prototype,"top",void 0),Object(i.e)([Object(i.y)({type:[Number,String],json:{write:!0}})],f.prototype,"bottom",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],f.prototype,"version",null),f=h=Object(i.e)([Object(i.i)("esri.views.layers.support.ClipRect")],f);var p,y=f;const g={base:i.ao,key:"type",typeMap:{extent:i.M,polygon:i.au}};let m=p=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new p({geometry:this.geometry.clone()})}};Object(i.e)([Object(i.y)({types:g,json:{read:o.e,write:!0}})],m.prototype,"geometry",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],m.prototype,"version",null),m=p=Object(i.e)([Object(i.i)("esri.views.layers.support.Geometry")],m);var b=m;let _=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(i.e)([Object(i.y)({type:[[[Number]]],json:{write:!0}})],_.prototype,"path",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],_.prototype,"version",null),_=Object(i.e)([Object(i.i)("esri.views.layers.support.Path")],_);var x=_;const v=i.L.ofType({key:"type",base:d,typeMap:{rect:y,path:x,geometry:b}}),w=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new v,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new a.b),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(s.g)(this,"suspended",(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),!0),Object(s.g)(this,["layer.opacity","container"],(()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)}),!0),Object(s.g)(this,["layer.blendMode"],(e=>{this.container&&(this.container.blendMode=e)}),!0),Object(s.g)(this,["layer.effect"],(e=>{this.container&&(this.container.effect=e)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const r=this.layer,i=r.minScale,n=r.maxScale;if(null!=i&&null!=n){let r=!i,s=!n;!r&&e<=i&&(r=!0),!s&&e>=n&&(s=!0),t=r&&s}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(i.e)([Object(i.y)({type:v,set(e){const t=Object(i.c)(e,this._get("clips"),v);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(i.e)([Object(i.y)()],t.prototype,"moving",void 0),Object(i.e)([Object(i.y)()],t.prototype,"attached",void 0),Object(i.e)([Object(i.y)()],t.prototype,"container",void 0),Object(i.e)([Object(i.y)()],t.prototype,"suspended",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(i.e)([Object(i.y)()],t.prototype,"updateRequested",void 0),Object(i.e)([Object(i.y)()],t.prototype,"updating",null),Object(i.e)([Object(i.y)()],t.prototype,"view",void 0),t=Object(i.e)([Object(i.i)("esri.views.2d.layers.LayerView2D")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return a})),r.d(t,"h",(function(){return o})),r.d(t,"i",(function(){return y})),r.d(t,"j",(function(){return c})),r.d(t,"k",(function(){return s})),r.d(t,"l",(function(){return u}));var i=r(0);r(1);function n(e=m){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function s(e,t,r,i,s,a,o=n()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=a,o}function a(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function o(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function l(e,t=[0,0,0]){return t[0]=function(e){return e[0]>=e[3]?0:e[3]-e[0]}(e),t[1]=function(e){return e[1]>=e[4]?0:e[4]-e[1]}(e),t[2]=function(e){return e[2]>=e[5]?0:e[5]-e[2]}(e),t}function c(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function u(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function h(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function d(e){return e?h(e,g):n(g)}function f(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function p(e){return 6===e.length}function y(e,t,r){if(Object(i.J)(e)||Object(i.J)(t))return e===t;if(!p(e)||!p(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const g=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=[0,0,0,0,0,0];n()},,function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));const i=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],n=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],a=["ﻶ","ﻸ","ﻺ","ﻼ"],o=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],c=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],u=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],f=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],p=["ء","ف"],y=["غ","ي"],g=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],m=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],b=10,_=11,x=12,v=18,w=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],O=100,I=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],S=[[v,v,v,v,v,v,v,v,v,6,5,6,8,5,v,v,v,v,v,v,v,v,v,v,v,v,v,v,5,5,5,6,8,4,4,_,_,_,4,4,4,4,4,b,9,b,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,v,v,v,v,v,v,5,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,9,4,_,_,_,_,4,4,4,4,0,4,4,v,4,4,_,_,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,1,x,1,x,x,1,x,x,1,x,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,_,_,7,9,7,4,4,x,x,x,x,x,x,x,x,x,x,x,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,3,3,3,3,3,3,3,3,3,3,_,3,3,7,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,3,4,x,x,x,x,x,x,7,7,x,x,4,x,x,x,x,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,x,x,x,x,x,x,x,x,x,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,v,v,v,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,_,_,_,_,_,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,v,v,v,v,v,4,4,4,4,4,v,v,v,v,v,v,2,0,4,4,2,2,2,2,2,2,b,b,4,4,4,0,2,2,2,2,2,2,2,2,2,2,b,b,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,x,1,1,1,1,1,1,1,1,1,1,b,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,_,4,4,b,b,4,4,4,4,4,_,_,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,v],[4,4,4,_,_,_,4,4,4,4,4,b,9,b,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,_,_,4,4,4,_,_,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];class T{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,t,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(function(e,t,r){X=[],Y=[];for(let i=0;i<r;i++)e[i]=i,t[i]=i,X[i]=i}(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(t,r))return e;t=this.inputFormat,r=this.outputFormat;let i=e;const o=Q,u=q(t.charAt(1)),d=q(r.charAt(1)),p=("I"===t.charAt(0)?"L":t.charAt(0))+u,y=("I"===r.charAt(0)?"L":r.charAt(0))+d,g=t.charAt(2)+r.charAt(2);o.defInFormat=p,o.defOutFormat=y,o.defSwap=g;const m=j(e,p,y,g,o);let b=!1;return"R"===r.charAt(1)?b=!0:"C"!==r.charAt(1)&&"D"!==r.charAt(1)||(b="rtl"===this.checkContextual(m)),this.sourceToTarget=X,this.targetToSource=function(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[e[r]]=r;return t}(this.sourceToTarget),J=this.targetToSource,i=t.charAt(3)===r.charAt(3)?m:"S"===r.charAt(3)?function(e,t,r){if(0===t.length)return"";void 0===e&&(e=!0),void 0===r&&(r=!0);const i=(t=String(t)).split("");let n=0,o=1,u=i.length;e||(n=i.length-1,o=-1,u=1);const d=function(e,t,r,i,n){let o=0;const u=[];let d=0;for(let f=t;f*r<i;f+=r)if(D(e[f])||G(e[f])){if("ل"===e[f]&&N(e,f+r,r,i)){e[f]=W(e[f+r],0===o?s:a),f+=r,H(e,f,r,i),n&&(u[d]=f,d++),o=0;continue}const t=e[f];1===o?e[f]=L(e,f+r,r,i)?z(e[f]):V(e[f],c):!0===L(e,f+r,r,i)?e[f]=V(e[f],h):e[f]=V(e[f],l),G(t)||(o=1),!0===U(t)&&(o=0)}else o=0;return u}(i,n,o,u,r);let f="";for(let t=0;t<i.length;t++)r&&C(d,d.length,t)>-1?(Z(J,t,!e,-1),X.splice(t,1)):f+=i[t];return f}(b,m,!0):function(e,t,r){if(0===e.length)return"";void 0===r&&(r=!0),void 0===t&&(t=!0);let i="";const s=(e=String(e)).split("");for(let a=0;a<e.length;a++){let o=!1;if(s[a]>="ﹰ"&&s[a]<"\ufeff"){const l=e.charCodeAt(a);s[a]>="ﻵ"&&s[a]<="ﻼ"?(t?(a>0&&r&&" "===s[a-1]?i=i.substring(0,i.length-1)+"ل":(i+="ل",o=!0),i+=n[(l-65269)/2]):(i+=n[(l-65269)/2],i+="ل",a+1<e.length&&r&&" "===s[a+1]?a++:o=!0),o&&(Z(J,a,!0,1),X.splice(a,0,X[a]))):i+=f[l-65136]}else i+=s[a]}return i}(m,b,!0),this.sourceToTarget=X,this.targetToSource=J,this.levels=Y,i}_inputFormatSetter(e){if(!re.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!re.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=E(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(e){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return ie.test(e)}}function j(e,t,r,i,n){const s=function(e,t,r){if(void 0===t.inFormat&&(t.inFormat=r.defInFormat),void 0===t.outFormat&&(t.outFormat=r.defOutFormat),void 0===t.swap&&(t.swap=r.defSwap),t.inFormat===t.outFormat)return t;const i=t.inFormat.substring(0,1),n=t.outFormat.substring(0,1);let s,a=t.inFormat.substring(1,4),o=t.outFormat.substring(1,4);return"C"===a.charAt(0)&&(s=E(e),a="ltr"===s||"rtl"===s?s.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=i+a),"C"===o.charAt(0)&&(s=E(e),"rtl"===s?o="RTL":"ltr"===s?(s=function(e){const t=e.split("");return t.reverse(),E(t.join(""))}(e),o=s.toUpperCase()):o="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=n+o),t}(e,{inFormat:t,outFormat:r,swap:i},n);if(s.inFormat===s.outFormat)return e;t=s.inFormat,r=s.outFormat,i=s.swap;const a=t.substring(0,1),o=t.substring(1,4),l=r.substring(0,1),c=r.substring(1,4);if(n.inFormat=t,n.outFormat=r,n.swap=i,"L"===a&&"VLTR"===r){if("LTR"===o)return n.dir=ee,A(e,n);if("RTL"===o)return n.dir=te,A(e,n)}if("V"===a&&"V"===l)return n.dir="RTL"===o?te:ee,F(e,n);if("L"===a&&"VRTL"===r)return"LTR"===o?(n.dir=ee,e=A(e,n)):(n.dir=te,e=A(e,n)),F(e);if("VLTR"===t&&"LLTR"===r)return n.dir=ee,A(e,n);if("V"===a&&"L"===l&&o!==c)return e=F(e),"RTL"===o?j(e,"LLTR","VLTR",i,n):j(e,"LRTL","VRTL",i,n);if("VRTL"===t&&"LRTL"===r)return j(e,"LRTL","VRTL",i,n);if("L"===a&&"L"===l){const t=n.swap;return n.swap=t.substr(0,1)+"N","RTL"===o?(n.dir=te,e=A(e,n),n.swap="N"+t.substr(1,2),n.dir=ee,e=A(e,n)):(n.dir=ee,e=A(e,n),n.swap="N"+t.substr(1,2),e=j(e,"VLTR","LRTL",n.swap,n)),e}return e}function E(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function A(e,t){const r=e.split(""),i=[];return M(r,i,t),function(e,t,r){if(0!==r.hiLevel&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(let r=0;r<e.length;r++)1===t[r]&&(e[r]=k(e[r]))}(r,i,t),P(2,r,i,t),P(1,r,i,t),Y=i,r.join("")}function M(e,t,r){const i=e.length,n=r.dir?m:g;let s=0,a=-1;const o=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let t=0;t<i;t++)o[t]=R(e[t]);for(let c=0;c<i;c++){const i=s,u=B(e,o,l,c,r);l[c]=u,s=n[i][u];const h=240&s;s&=15;const d=n[s][K];if(t[c]=d,h>0)if(16===h){for(let e=a;e<c;e++)t[e]=1;a=-1}else a=-1;if(n[s][$])-1===a&&(a=c);else if(a>-1){for(let e=a;e<c;e++)t[e]=d;a=-1}5===o[c]&&(t[c]=0),r.hiLevel|=d}r.hasUbatS&&function(e,t,r,i){for(let n=0;n<r;n++)if(6===e[n]){t[n]=i.dir;for(let r=n-1;r>=0&&8===e[r];r--)t[r]=i.dir}}(o,t,i,r)}function R(e){const t=e.charCodeAt(0),r=I[t>>8];return r<O?r:S[r-O][255&t]}function F(e,t){const r=e.split("");if(t){const e=[];M(r,e,t),Y=e}return r.reverse(),X.reverse(),r.join("")}function C(e,t,r){for(let i=0;i<t;i++)if(e[i]===r)return i;return-1}function D(e){for(let t=0;t<p.length;t++)if(e>=p[t]&&e<=y[t])return!0;return!1}function L(e,t,r,i){for(;t*r<i&&G(e[t]);)t+=r;return!!(t*r<i&&D(e[t]))}function N(e,t,r,i){for(;t*r<i&&G(e[t]);)t+=r;let s=" ";if(!(t*r<i))return!1;s=e[t];for(let e=0;e<n.length;e++)if(n[e]===s)return!0;return!1}function P(e,t,r,i){if(i.hiLevel<e)return;if(1===e&&i.dir===te&&!i.hasUbatB)return t.reverse(),void X.reverse();const n=t.length;let s,a,o,l,c,u=0;for(;u<n;){if(r[u]>=e){for(s=u+1;s<n&&r[s]>=e;)s++;for(a=u,o=s-1;a<o;a++,o--)l=t[a],t[a]=t[o],t[o]=l,c=X[a],X[a]=X[o],X[o]=c;u=s}u++}}function B(e,t,r,i,n){const s=t[i];return{UBAT_L:()=>(n.lastArabic=!1,0),UBAT_R:()=>(n.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>n.lastArabic?3:2,UBAT_AL:()=>(n.lastArabic=!0,n.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let e,s;return i<1||i+1>=t.length||2!==(e=r[i-1])&&3!==e||2!==(s=t[i+1])&&3!==s?4:(n.lastArabic&&(s=3),s===e?s:4)},UBAT_ES:()=>2===(i>0?r[i-1]:5)&&i+1<t.length&&2===t[i+1]?2:4,UBAT_ET:()=>{if(i>0&&2===r[i-1])return 2;if(n.lastArabic)return 4;let e=i+1;const s=t.length;for(;e<s&&t[e]===_;)e++;return e<s&&2===t[e]?2:4},UBAT_NSM:()=>{if("VLTR"===n.inFormat){const r=t.length;let n=i+1;for(;n<r&&t[n]===x;)n++;if(n<r){const r=e[i].charCodeAt[0],s=r>=1425&&r<=2303||64286===r,a=t[n];if(s&&(1===a||7===a))return 1}}return i<1||5===t[i-1]?4:r[i-1]},UBAT_B:()=>(n.lastArabic=!0,n.hasUbatB=!0,n.dir),UBAT_S:()=>(n.hasUbatS=!0,4),UBAT_LRE:()=>(n.lastArabic=!1,4),UBAT_RLE:()=>(n.lastArabic=!1,4),UBAT_LRO:()=>(n.lastArabic=!1,4),UBAT_RLO:()=>(n.lastArabic=!1,4),UBAT_PDF:()=>(n.lastArabic=!1,4),UBAT_BN:()=>4}[w[s]]()}function k(e){let t,r=0,n=i.length-1;for(;r<=n;)if(t=Math.floor((r+n)/2),e<i[t][0])n=t-1;else{if(!(e>i[t][0]))return i[t][1];r=t+1}return e}function U(e){for(let t=0;t<d.length;t++)if(d[t]===e)return!0;return!1}function z(e){for(let t=0;t<o.length;t++)if(e===o[t])return u[t];return e}function V(e,t){for(let r=0;r<o.length;r++)if(e===o[r])return t[r];return e}function G(e){return e>="ً"&&e<="ٕ"}function q(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function H(e,t,r,i){for(;t*r<i&&G(e[t]);)t+=r;return t*r<i&&(e[t]=" ",!0)}function W(e,t){for(let r=0;r<n.length;r++)if(e===n[r])return t[r];return e}function Z(e,t,r,i){for(let n=0;n<e.length;n++)(e[n]>t||!r&&e[n]===t)&&(e[n]+=i)}let X=[],J=[],Y=[];const Q={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},K=5,$=6,ee=0,te=1,re=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,ie=/[\u0591-\u06ff\ufb1d-\ufefc]/},function(e,t,r){"use strict";r.d(t,"a",(function(){return z})),r.d(t,"b",(function(){return W})),r.d(t,"c",(function(){return P})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return N})),r.d(t,"f",(function(){return Y})),r.d(t,"g",(function(){return V}));var i=r(1),n=r(0),s=r(54),a=r(35),o=r(84),l=r(14),c=r(329),u=r(83),h=r(322),d=r(109),f=r(104),p=r(314),y=r(313),g=r(331);class m{constructor(e,t){this.key=new s.a(0,0,0,0),this.bounds=Object(o.f)(),this.objectIds=new Set,this.key.set(t);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return n.M.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){const e=this.bounds;return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}clone(){return new m(this.tileInfoView,this.key)}createChildTiles(){const e=this.key.getChildKeys(),t=n.F.acquire();for(let r=0;r<e.length;r++)t[r]=new m(this.tileInfoView,e[r]);return t}getQuantizationParameters(){return l.c.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}function b(e,t){if(!(this instanceof b))return new b(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function _(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function x(e,t){v(e,0,e.children.length,t,e)}function v(e,t,r,i,n){n||(n=R(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s,a=t;a<r;a++)s=e.children[a],w(n,e.leaf?i(s):s);return n}function w(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function O(e,t){return e.minX-t.minX}function I(e,t){return e.minY-t.minY}function S(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function T(e){return e.maxX-e.minX+(e.maxY-e.minY)}function j(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function E(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function A(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function M(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function R(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function F(e,t,r,i,n){for(var s,a=[t,r];a.length;)(r=a.pop())-(t=a.pop())<=i||(s=t+Math.ceil((r-t)/i/2)*i,Object(c.a)(e,s,t,r,n),a.push(t,s,s,r))}b.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],i=this.toBBox;if(!M(e,t))return r;for(var n,s,a,o,l=[];t;){for(n=0,s=t.children.length;n<s;n++)a=t.children[n],M(e,o=t.leaf?i(a):a)&&(t.leaf?r.push(a):A(e,o)?this._all(a,r):l.push(a));t=l.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!M(e,t))return!1;for(var i,n,s,a,o=[];t;){for(i=0,n=t.children.length;i<n;i++)if(s=t.children[i],M(e,a=t.leaf?r(s):s)){if(t.leaf||A(e,a))return!0;o.push(s)}t=o.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=R([]),this},remove:function(e,t){if(!e)return this;for(var r,i,n,s,a=this.data,o=this.toBBox(e),l=[],c=[];a||l.length;){if(a||(a=l.pop(),i=l[l.length-1],r=c.pop(),s=!0),a.leaf&&-1!==(n=_(e,a.children,t)))return a.children.splice(n,1),l.push(a),this._condense(l),this;s||a.leaf||!A(a,o)?i?(r++,a=i.children[r],s=!1):a=null:(l.push(a),c.push(r),r=0,i=a,a=a.children[0])}return this},toBBox:function(e){return e},compareMinX:O,compareMinY:I,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,i){var n,s=r-t+1,a=this._maxEntries;if(s<=a)return x(n=R(e.slice(t,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,i-1))),(n=R([])).leaf=!1,n.height=i;var o,l,c,u,h=Math.ceil(s/a),d=h*Math.ceil(Math.sqrt(a));for(F(e,t,r,d,this.compareMinX),o=t;o<=r;o+=d)for(F(e,o,c=Math.min(o+d-1,r),h,this.compareMinY),l=o;l<=c;l+=h)u=Math.min(l+h-1,c),n.children.push(this._build(e,l,u,i-1));return x(n,this.toBBox),n},_chooseSubtree:function(e,t,r,i){for(var n,s,a,o,l,c,u,h;i.push(t),!t.leaf&&i.length-1!==r;){for(u=h=1/0,n=0,s=t.children.length;n<s;n++)l=S(a=t.children[n]),(c=j(e,a)-l)<h?(h=c,u=l<u?l:u,o=a):c===h&&l<u&&(u=l,o=a);t=o||t.children[0]}return t},_insert:function(e,t,r){var i=this.toBBox,n=r?e:i(e),s=[],a=this._chooseSubtree(n,this.data,t,s);for(a.children.push(e),w(a,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)},_split:function(e,t){var r=e[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var s=this._chooseSplitIndex(r,n,i),a=R(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,x(r,this.toBBox),x(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(e,t){this.data=R([e,t]),this.data.height=e.height+1,this.data.leaf=!1,x(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var i,n,s,a,o,l,c,u;for(l=c=1/0,i=t;i<=r-t;i++)a=E(n=v(e,0,i,this.toBBox),s=v(e,i,r,this.toBBox)),o=S(n)+S(s),a<l?(l=a,u=i,c=o<c?o:c):a===l&&o<c&&(c=o,u=i);return u},_chooseSplitAxis:function(e,t,r){var i=e.leaf?this.compareMinX:O,n=e.leaf?this.compareMinY:I;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)},_allDistMargin:function(e,t,r,i){e.children.sort(i);var n,s,a=this.toBBox,o=v(e,0,t,a),l=v(e,r-t,r,a),c=T(o)+T(l);for(n=t;n<r-t;n++)s=e.children[n],w(o,e.leaf?a(s):s),c+=T(o);for(n=r-t-1;n>=t;n--)s=e.children[n],w(l,e.leaf?a(s):s),c+=T(l);return c},_adjustParentBBoxes:function(e,t,r){for(var i=r;i>=0;i--)w(t[i],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():x(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};const C={added:[],removed:[]},D=new Set,L=new s.a(0,0,0,0);class N extends n.m{constructor(e){super(),this._tiles=new Map,this._index=b(9,Object(i.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}findByKey(e){return this._tiles.get(e.id)}minLOD(){return Math.min(...this.tiles.map((e=>e.level)))}intersections(e,t){const r="string"==typeof e?this.get(e):e;if(!r)return[];const i=t*r.resolution,n=r.bounds[0]-i,s=r.bounds[1]-i,a=r.bounds[2]+i,o=r.bounds[3]+i,l=[];for(const e of this._index.search({minX:n,minY:s,maxX:a,maxY:o})){const t=e.bounds.slice();t[0]=Math.max(t[0],n),t[1]=Math.max(t[1],s),t[2]=Math.min(t[2],a),t[3]=Math.min(t[3],o),t[2]-t[0]>0&&t[3]-t[1]>0&&l.push({bounds:t,tile:e})}return l}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const e=new m(this.tileScheme,r);this._tiles.set(r,e),this._index.insert(e),t.added.push(e)}for(const r of e.removed)if(this.has(r)){const e=this.get(r);this._tiles.delete(r),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:r,lodInfo:i}=t,{level:n}=i;if(r.length>0)for(const{row:e,colFrom:t,colTo:s}of r)for(let r=t;r<=s;r++){const t=L.set(n,e,i.normalizeCol(r),i.getWorldForColumn(r)).id;if(D.add(t),!this.has(t)){const e=new m(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),C.added.push(e)}}for(let e=this.tiles.length-1;e>=0;e--){const t=this.tiles[e];D.has(t.id)||(this._tiles.delete(t.id),this.tiles.splice(e,1),this._index.remove(t),C.removed.push(t))}(C.added.length||C.removed.length)&&this.emit("update",C),a.c.pool.release(t),D.clear(),C.added.length=0,C.removed.length=0}}class P extends h.a{constructor(e,t,r){super(e),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=r,this._features=t}static fromFeatures(e,t,r){const i=Object(u.g)([],e,t,!1,!1,r);for(let t=0;t<i.length;t++)i[t].displayId=e[t].displayId;return P.fromOptimizedFeatures(i,t)}static fromFeatureSet(e,t){const r=Object(u.u)(e,t);return P.fromOptimizedFeatureSet(r)}static fromOptimizedFeatureSet(e){const{features:t,geometryType:r}=e,i=P.fromOptimizedFeatures(t,r);i._exceededTransferLimit=e.exceededTransferLimit,i._transform=e.transform;for(const t of e.fields)"esriFieldTypeDate"===t.type&&i._dateFields.add(t.name);return i}static fromOptimizedFeatures(e,t,r){const i=h.a.createInstance(),n=new P(i,e,t);return n._transform=r,n}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}getGroupId(){return this._current.groupId}setGroupId(e){this._current.groupId=e}copy(){const e=new P(this.instance,this._features,this.geometryType);return this.copyInto(e),e}next(){for(;++this._featureIndex<this._features.length&&!this._passesFilter()&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return Object(u.k)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const e=this.readGeometry();return Object(u.p)(e,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const e=this.readCentroid();return e?{x:e.coords[0]*this._sx+this._tx,y:e.coords[1]*this._sy+this._ty}:null}readGeometryArea(){return Object(u.z)(this._current.geometry,2)}readUnquantizedGeometry(){const e=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!e)return e;const t=e.clone();return function({coords:e,lengths:t}){let r=0;for(const i of t){for(let t=1;t<i;t++)e[2*(r+t)]+=e[2*(r+t)-2],e[2*(r+t)+1]+=e[2*(r+t)-1];r+=i}}(t),t}readHydratedGeometry(){const e=this._current.geometry;if(!e)return null;const t=e.clone();return Object(n.P)(this._transform)&&Object(u.m)(t,t,this.hasZ,this.hasM,this._transform),t}getXHydrate(){const e=this._current.geometry.coords[0],t=this.getQuantizationTransform();return Object(n.J)(t)?e:e*t.scale[0]+t.translate[0]}getYHydrate(){const e=this._current.geometry.coords[1],t=this.getQuantizationTransform();return Object(n.J)(t)?e:t.translate[1]-e*t.scale[1]}getX(){return this._current.geometry.coords[0]*this._sx+this._tx}getY(){return this._current.geometry.coords[1]*this._sy+this._ty}readGeometry(){if(!this._current.hasGeometry)return null;const e=this._current.geometry.clone();if(e.isPoint)return e.coords[0]=e.coords[0]*this._sx+this._tx,e.coords[1]=e.coords[1]*this._sy+this._ty,e;let t=0;for(const r of e.lengths)e.coords[2*t]=e.coords[2*t]*this._sx+this._tx,e.coords[2*t+1]=e.coords[2*t+1]*this._sy+this._ty,t+=r;return e}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const e=this._computeCentroid();if(!e)return null;e.coords[0]=(e.coords[0]-this._tx)/this._sx,e.coords[1]=(e.coords[1]-this._ty)/this._sy,this._current.centroid=e}const e=this._current.centroid.clone();return e.coords[0]=e.coords[0]*this._sx+this._tx,e.coords[1]=e.coords[1]*this._sx+this._ty,e}_readAttribute(e,t){const r=this._current.attributes[e];if(void 0!==r)return null!=r&&t&&this._dateFields.has(e)?new Date(r):r;const i=this.readAttributes(),n=e.toLocaleLowerCase().trim();for(const e in i)if(e.toLocaleLowerCase().trim()===n){const r=this._current.attributes[e];return null!=r&&t&&this._dateFields.has(e)?new Date(r):r}}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;let e=0,t=0;switch(this.geometryType){case"esriGeometryPoint":{const r=this._current.geometry;if(!r)return!1;[e,t]=r.coords;break}case"esriGeometryPolygon":{const r=this.readCentroid();if(!r)return!1;[e,t]=r.coords,e-=this._tx,t-=this._ty;break}default:return!1}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}}const B=n.n.getLogger("esri.views.layers.2d.features.support.AttributeStore"),k=Object(g.e)(g.c,B),U=e=>(2147483648&e)>>>31,z=e=>2147483647&e;function V(e){return 1===U(e)}const G={sharedArrayBuffer:Object(i.a)("esri-shared-array-buffer"),atomics:Object(i.a)("esri-atomics")};function q(e,t){return r=>t(e(r))}class H{constructor(e,t,r,i){this.size=0,this.texelSize=4;const{pixelType:n,layout:s,textureOnly:a}=i;this.textureOnly=a||!1,this.pixelType=n,this._ctype=t,this.layout=s,this._resetRange(),this._shared=e,this.size=r,a||(this.data=this._initData(n,r,e,t))}get buffer(){return Object(n.c6)(this.data,(e=>e.buffer))}unsetComponentAllTexels(e,t){const r=Object(n.Y)(this.data);for(let i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){const r=Object(n.Y)(this.data);for(let i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,r){const i=Object(n.Y)(this.data);for(const n of r)i[n*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)}setComponentTexel(e,t,r){Object(n.Y)(this.data)[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}unsetComponentTexel(e,t,r){Object(n.Y)(this.data)[r*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}getData(e,t){const r=z(e);return Object(n.Y)(this.data)[r*this.texelSize+t]}setData(e,t,r){const i=z(e),n=1<<t;0!=(this.layout&n)?(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):B.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&G.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&G.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(e){if(this.size=e,!this.textureOnly){const t=this._initData(this.pixelType,e,this._shared,this._ctype),r=Object(n.Y)(this.data);t.set(r),this.data=t}}toMessage(){const e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();const i=!(this._shared||"local"===this._ctype),s=this.pixelType,a=this.layout,o=Object(n.Y)(this.data);return o.slice?{start:e,end:t,data:i&&o.slice(e*r,(t+1)*r)||null,pixelType:s,layout:a}:i?{start:e,end:t,data:new(Object(y.n)(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:s,layout:a}:{start:e,end:t,data:null,pixelType:s,layout:a}}_initData(e,t,r,i){const n=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,s=Object(y.n)(e),a=new s(new n(t*t*4*s.BYTES_PER_ELEMENT));for(let e=0;e<a.length;e+=4)a[e+1]=255;return a}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class W{constructor(e,t){this._client=e,this.config=t,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(p.l),this._targetType=0,this._abortController=Object(n.V)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const r=t.supportsTextureFloat?5126:5121;k(`Creating AttributeStore ${G.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:r,layout:15},{pixelType:r,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(e,t){this.config=t;const r=t.schema.processors[0].storage,s=Object(d.b)(this._schema,r);if((e.targets.feature||e.targets.aggregate)&&(e.storage.data=!0),s&&(Object(i.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",s),e.storage.data=!0,this._schema=r,this._attributeComputeMap.clear(),!Object(n.J)(r))){switch(r.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(const e of r.mapping)this._bindAttribute(e)}}onTileData(e,t){if(Object(n.J)(t.addOrUpdate))return;const r=t.addOrUpdate.getCursor();for(;r.next();){const e=r.getDisplayId();this.setAttributeData(e,r)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=Object(n.V)()}async setHighlight(e,t){const r=this._getBlock(0),i=t.map((e=>z(e)));r.lock(),r.unsetComponentAllTexels(0,1),r.setComponent(0,1,i),r.unlock(),this._idsToHighlight.clear();for(const t of e)this._idsToHighlight.add(t);await this.sendUpdates()}async updateFilters(e,t){const{config:r,service:n,spatialReference:s}=t,{filters:a}=r,o=a.map(((e,t)=>this._updateFilter(e,t,n,s)));(await Promise.all(o)).some((e=>e))&&(e.storage.filters=!0,Object(i.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(e,t,r,i){const n=z(e);this._ensureSizeForTexel(n),this._getBlock(t).setData(e,r,i)}getData(e,t,r){return this._getBlock(t).getData(e,r)}getHighlightFlag(e){return this._idsToHighlight.has(e)?p.m:0}unsetAttributeData(e){const t=z(e);this._getBlock(0).setData(t,0,0)}setAttributeData(e,t){const r=z(e);if(this._ensureSizeForTexel(r),this._getBlock(0).setData(r,0,this.getFilterFlags(t)),this._targetType!==U(e))return;const i=this._attributeComputeMap,s=this.config.supportsTextureFloat?1:2;i.size&&i.forEach(((e,i)=>{const a=i*s%4,o=Math.floor(i*s/4),l=this._getBlock(o+p.k),c=e(t);if(this.config.supportsTextureFloat)l.setData(r,a,c);else if(c===p.w)l.setData(r,a,255),l.setData(r,a+1,255);else{const e=Object(n.D)(Math.round(c),-32767,32766)+32768,t=255&e,i=(65280&e)>>8;l.setData(r,a,t),l.setData(r,a+1,i)}}))}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=Object(n.b$)(),this._nextUpdate.promise;const e={blocks:this._blocks.map((e=>Object(n.P)(e)?e.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{const t=()=>{if(this._currUpdate=null,this._nextUpdate){const e=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>e.resolve()))}},r=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),r})).catch((e=>Object(n.B)(e)?(this._createResourcesPromise=null,this._createResources()):(B.error(new n.s("mapview-attribute-store","Encountered an error during client update",e)),Promise.resolve()))),this._currUpdate}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}_bindAttribute(e){let t;if(null!=e.fieldIndex)e.normalizationField&&B.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),t=t=>t.getComputedNumericAtIndex(e.fieldIndex);else{if(!e.field)return;t=e.normalizationField?t=>{const r=t.readAttribute(e.normalizationField);return r?t.readAttribute(e.field)/r:null}:t=>t.readAttribute(e.field)}e.valueRepresentation&&(t=q(t,(t=>Object(g.f)(t,e.valueRepresentation))));this._attributeComputeMap.set(e.binding,q(t,(e=>null===e||isNaN(e)||e===1/0?p.w:e)))}_createResources(){if(Object(n.P)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(p.j),k("Initializing AttributeStore");const e={shared:G.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:Object(n.co)(this._blocks,(e=>({textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType})))},t=this._client.initialize(e,this._signal).catch((e=>{Object(n.B)(e)?this._createResourcesPromise=null:B.error(new n.s("mapview-attribute-store","Encountered an error during client initialization",e))}));return this._createResourcesPromise=t,t.then((()=>Object(n.J)(this._createResourcesPromise)?this._createResources():void 0)),t}_getBlock(e){const t=this._blocks[e];if(Object(n.P)(t))return t;k(`Initializing AttributeBlock at index ${e}`);const r=G.sharedArrayBuffer,i=this._client.type,s=new H(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=s,this._createResourcesPromise=null,s}_expand(){if(this._size<this.config.maxTextureSize){const e=this._size<<=1;return k("Expanding block size to",e,this._blocks),Object(n.cp)(this._blocks,(t=>t.expand(e))),this._createResourcesPromise=null,this._size=e,0}return B.error(new n.s("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}async _updateFilter(e,t,r,i){const s=this._filters[t],a=Object(n.P)(s)&&s.hash;if(!s&&!e)return!1;if(a===JSON.stringify(e))return!1;if(Object(n.J)(e)){const e=1<<t+1,r=this._getBlock(0);return this._filters[t]=null,r.setComponentAllTexels(0,e),this.sendUpdates(),!0}const o=await this._getFilter(t,r);return await o.update(e,i),!0}async _getFilter(e,t){const i=this._filters[e];if(Object(n.P)(i))return i;const{default:s}=await Promise.all([r.e(0),r.e(42)]).then(r.bind(null,412)),a=new s({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new f.a(t.fields)});return this._filters[e]=a,a}isVisible(e){return!!(2&this._getBlock(0).getData(e,0))}getFilterFlags(e){let t=0;const r=(e=>1===U(e)?254:255)(e.getDisplayId());for(let i=0;i<this._filters.length;i++){const s=!!(r&1<<i),a=this._filters[i];t|=(!s||Object(n.J)(a)||a.check(e)?1:0)<<i}let i=0;if(this._idsToHighlight.size){const t=e.getObjectId();i=this.getHighlightFlag(t)}return t<<1|i}}class Z{constructor(){this._freeIds=[],this._idCounter=1}createId(e=!1){return function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeId(),e)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}function X(e,t,r){if(!(e.length>t))for(;e.length<=t;)e.push(r)}const J=2147483647;class Y{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new Z,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const e=this._bitsets.length;return this._bitsets.push(h.b.create(this._allocatedSize,J)),e+1}getBitset(e){return this._bitsets[e-1]}_expand(){this._allocatedSize<<=1;for(const e of this._bitsets)e.resize(this._allocatedSize)}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),X(this._numerics[e],t,0)}_ensureInstanceId(e){X(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),X(this._strings[e],t,null)}createDisplayId(e=!1){const t=this._idGenerator.createId();return t>this._allocatedSize&&this._expand(),((e,t)=>((t?2147483648:0)|e)>>>0)(t,e)}releaseDisplayId(e){for(const t of this._bitsets)t.unset(e);return this._idGenerator.releaseId(e&J)}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(e&J,0)}setComputedNumeric(e,t,r){return this.setComputedNumericAtIndex(e&J,r,0)}getComputedString(e,t){return this.getComputedStringAtIndex(e&J,0)}setComputedString(e,t,r){return this.setComputedStringAtIndex(e&J,0,r)}getComputedNumericAtIndex(e,t){const r=e&J;return this._ensureNumeric(t,r),this._numerics[t][r]}setComputedNumericAtIndex(e,t,r){const i=e&J;this._ensureNumeric(t,i),this._numerics[t][i]=r}getInstanceId(e){const t=e&J;return this._ensureInstanceId(t),this._instanceIds[t]}setInstanceId(e,t){const r=e&J;this._ensureInstanceId(r),this._instanceIds[r]=t}getComputedStringAtIndex(e,t){const r=e&J;return this._ensureString(t,r),this._strings[t][r]}setComputedStringAtIndex(e,t,r){const i=e&J;this._ensureString(t,i),this._strings[t][i]=r}getXMin(e){return this._bounds[4*(e&J)]}getYMin(e){return this._bounds[4*(e&J)+1]}getXMax(e){return this._bounds[4*(e&J)+2]}getYMax(e){return this._bounds[4*(e&J)+3]}setBounds(e,t){const r=t.readHydratedGeometry();if(!r||!r.coords.length)return!1;let i=1/0,n=1/0,s=-1/0,a=-1/0;r.forEachVertex(((e,t)=>{i=Math.min(i,e),n=Math.min(n,t),s=Math.max(s,e),a=Math.max(a,t)}));const o=e&J;return X(this._bounds,4*o+4,0),this._bounds[4*o]=i,this._bounds[4*o+1]=n,this._bounds[4*o+2]=s,this._bounds[4*o+3]=a,!0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r(0),r(1),r(14),r(54);function i(e,t,r,i){const n=e.clone(),s=1<<n.level,a=n.col+t,o=n.row+r;return i&&a<0?(n.col=a+s,n.world-=1):a>=s?(n.col=a-s,n.world+=1):n.col=a,n.row=o,n}},function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return c})),r.d(t,"i",(function(){return b})),r.d(t,"j",(function(){return _})),r.d(t,"k",(function(){return o})),r.d(t,"l",(function(){return x})),r.d(t,"m",(function(){return k}));var i=r(314),n=r(321),s=r(0),a=r(310);class o{constructor(e,t){this.x=e,this.y=t}clone(){return new o(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){this.x=e,this.y=t}normalize(){const e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);this.x/=r,this.y/=r}rightPerpendicular(){const e=this.x;this.x=this.y,this.y=-e}move(e,t){this.x+=e,this.y+=t}assign(e){this.x=e.x,this.y=e.y}assignAdd(e,t){this.x=e.x+t.x,this.y=e.y+t.y}assignSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}rotate(e,t){const r=this.x,i=this.y;this.x=r*e-i*t,this.y=r*t+i*e}scale(e){this.x*=e,this.y*=e}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}static distance(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}static add(e,t){return new o(e.x+t.x,e.y+t.y)}static sub(e,t){return new o(e.x-t.x,e.y-t.y)}}class l{constructor(e,t,r){this.ratio=e,this.x=t,this.y=r}}class c{constructor(e,t,r,n=8,s=8){this.lines=[],this.starts=[],this.validateTessellation=!0,this.pixelRatio=n,this.pixelMargin=s,this.tileSize=i.B*n,this.dz=e,this.yPos=t,this.xPos=r}setPixelMargin(e){e!==this.pixelMargin&&(this.pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this.finalRatio=this.tileSize/e*(1<<this.dz);let t=this.pixelRatio*this.pixelMargin;t/=this.finalRatio;const r=e>>this.dz;t>r&&(t=r),this.margin=t,this.xmin=r*this.xPos-t,this.ymin=r*this.yPos-t,this.xmax=this.xmin+r+2*t,this.ymax=this.ymin+r+2*t}reset(e){this.type=e,this.lines=[],this.starts=[],this.line=null,this.start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new o(e,t),this._firstPt=new o(e,t),this._dist=0}lineTo(e,t){const r=this._isIn(e,t),i=new o(e,t),n=o.distance(this._prevPt,i);let s,a,c,u,h,d,f,p;if(r)this._prevIsIn?this._lineTo(e,t,!0):(s=this._prevPt,a=i,c=this._intersect(a,s),this.start=this._dist+n*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,s=i,c=this._intersect(a,s),this._lineTo(c.x,c.y,!0),this._lineTo(s.x,s.y,!1);else{const e=this._prevPt,t=i;if(e.x<=this.xmin&&t.x<=this.xmin||e.x>=this.xmax&&t.x>=this.xmax||e.y<=this.ymin&&t.y<=this.ymin||e.y>=this.ymax&&t.y>=this.ymax)this._lineTo(t.x,t.y,!1);else{const r=[];if((e.x<this.xmin&&t.x>this.xmin||e.x>this.xmin&&t.x<this.xmin)&&(u=(this.xmin-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this.ymin?d=!1:p>=this.ymax?d=!0:r.push(new l(u,this.xmin,p))),(e.x<this.xmax&&t.x>this.xmax||e.x>this.xmax&&t.x<this.xmax)&&(u=(this.xmax-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this.ymin?d=!1:p>=this.ymax?d=!0:r.push(new l(u,this.xmax,p))),(e.y<this.ymin&&t.y>this.ymin||e.y>this.ymin&&t.y<this.ymin)&&(u=(this.ymin-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this.xmin?h=!1:f>=this.xmax?h=!0:r.push(new l(u,f,this.ymin))),(e.y<this.ymax&&t.y>this.ymax||e.y>this.ymax&&t.y<this.ymax)&&(u=(this.ymax-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this.xmin?h=!1:f>=this.xmax?h=!0:r.push(new l(u,f,this.ymax))),0===r.length)h?d?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):d?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(r.length>1&&r[0].ratio>r[1].ratio)this.start=this._dist+n*r[1].ratio,this._lineTo(r[1].x,r[1].y,!0),this._lineTo(r[0].x,r[0].y,!0);else{this.start=this._dist+n*r[0].ratio;for(let e=0;e<r.length;e++)this._lineTo(r[e].x,r[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=i}close(){if(this.line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const r=this.line;let i=r.length;for(;i>=4&&(r[0].x===r[1].x&&r[0].x===r[i-2].x||r[0].y===r[1].y&&r[0].y===r[i-2].y);)r.pop(),r[0].x=r[i-2].x,r[0].y=r[i-2].y,--i}}result(e=!0){return this._pushLine(),0===this.lines.length?null:(3===this.type&&e&&h.simplify(this.tileSize,this.margin*this.finalRatio,this.lines),this.lines)}resultWithStarts(){if(2!==this.type)throw new Error("Only valid for lines");this._pushLine();const e=this.lines,t=e.length;if(0===t)return null;const r=[];for(let i=0;i<t;i++)r.push({line:e[i],start:this.starts[i]||0});return r}_isIn(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax}_intersect(e,t){let r,i,n;if(t.x>=this.xmin&&t.x<=this.xmax)i=t.y<=this.ymin?this.ymin:this.ymax,n=(i-e.y)/(t.y-e.y),r=e.x+n*(t.x-e.x);else if(t.y>=this.ymin&&t.y<=this.ymax)r=t.x<=this.xmin?this.xmin:this.xmax,n=(r-e.x)/(t.x-e.x),i=e.y+n*(t.y-e.y);else{i=t.y<=this.ymin?this.ymin:this.ymax,r=t.x<=this.xmin?this.xmin:this.xmax;const s=(r-e.x)/(t.x-e.x),a=(i-e.y)/(t.y-e.y);s<a?(n=s,i=e.y+s*(t.y-e.y)):(n=a,r=e.x+a*(t.x-e.x))}return this._r=n,new o(r,i)}_pushLine(){this.line&&(1===this.type?this.line.length>0&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?this.line.length>1&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&this.line.length>3&&(this.lines.push(this.line),this.starts.push(this.start))),this.line=[],this.start=0}_moveTo(e,t,r){3!==this.type?r&&(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new o(e,t))):(r||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new o(e,t)),this._is_h=!1,this._is_v=!1)}_lineTo(e,t,r){let i,n;if(3!==this.type)if(r){if(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.length>0&&(i=this.line[this.line.length-1],i.equals(e,t)))return;this.line.push(new o(e,t))}else this.line&&this.line.length>0&&this._pushLine();else if(r||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line&&this.line.length>0){i=this.line[this.line.length-1];const r=i.x===e,s=i.y===t;if(r&&s)return;this._is_h&&r||this._is_v&&s?(i.x=e,i.y=t,n=this.line[this.line.length-2],n.x===e&&n.y===t?(this.line.pop(),this.line.length<=1?(this._is_h=!1,this._is_v=!1):(n=this.line[this.line.length-2],this._is_h=n.x===e,this._is_v=n.y===t)):(this._is_h=n.x===e,this._is_v=n.y===t)):(this.line.push(new o(e,t)),this._is_h=r,this._is_v=s)}else this.line.push(new o(e,t))}}class u{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this.lines=[],this.line=null}moveTo(e,t){this.line&&this.lines.push(this.line),this.line=[];const r=this._ratio;this.line.push(new o(e*r,t*r))}lineTo(e,t){const r=this._ratio;this.line.push(new o(e*r,t*r))}close(){const e=this.line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this.line&&this.lines.push(this.line),0===this.lines.length?null:this.lines}}class h{static simplify(e,t,r){if(!r)return;const i=-t,n=e+t,s=-t,a=e+t,o=[],l=[],c=r.length;for(let e=0;e<c;++e){const t=r[e];if(!t||t.length<2)continue;let c,u=t[0];const h=t.length;for(let r=1;r<h;++r)c=t[r],u.x===c.x&&(u.x<=i&&(u.y>c.y?(o.push(e),o.push(r),o.push(0),o.push(-1)):(l.push(e),l.push(r),l.push(0),l.push(-1))),u.x>=n&&(u.y<c.y?(o.push(e),o.push(r),o.push(1),o.push(-1)):(l.push(e),l.push(r),l.push(1),l.push(-1)))),u.y===c.y&&(u.y<=s&&(u.x<c.x?(o.push(e),o.push(r),o.push(2),o.push(-1)):(l.push(e),l.push(r),l.push(2),l.push(-1))),u.y>=a&&(u.x>c.x?(o.push(e),o.push(r),o.push(3),o.push(-1)):(l.push(e),l.push(r),l.push(3),l.push(-1)))),u=c}if(0===o.length||0===l.length)return;h.fillParent(r,l,o),h.fillParent(r,o,l);const u=[];h.calcDeltas(u,l,o),h.calcDeltas(u,o,l),h.addDeltas(u,r)}static fillParent(e,t,r){const i=r.length,s=t.length;for(let a=0;a<s;a+=4){const s=t[a],o=t[a+1],l=t[a+2],c=e[s][o-1],u=e[s][o];let h=8092,d=-1;for(let t=0;t<i;t+=4){if(r[t+2]!==l)continue;const i=r[t],s=r[t+1],a=e[i][s-1],o=e[i][s];switch(l){case 0:case 1:if(Object(n.c)(c.y,a.y,o.y)&&Object(n.c)(u.y,a.y,o.y)){const e=Math.abs(o.y-a.y);e<h&&(h=e,d=t)}break;case 2:case 3:if(Object(n.c)(c.x,a.x,o.x)&&Object(n.c)(u.x,a.x,o.x)){const e=Math.abs(o.x-a.x);e<h&&(h=e,d=t)}}}t[a+3]=d}}static calcDeltas(e,t,r){const i=t.length;for(let n=0;n<i;n+=4){const i=[],s=h.calcDelta(n,t,r,i);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(s)}}static calcDelta(e,t,r,i){const n=t[e+3];if(-1===n)return 0;const s=i.length;return s>1&&i[s-2]===n?0:(i.push(n),h.calcDelta(n,r,t,i)+1)}static addDeltas(e,t){const r=e.length;let i=0;for(let t=0;t<r;t+=4){const r=e[t+3];r>i&&(i=r)}for(let n=0;n<r;n+=4){const r=t[e[n]],s=e[n+1],a=i-e[n+3];switch(e[n+2]){case 0:r[s-1].x-=a,r[s].x-=a,1===s&&(r[r.length-1].x-=a),s===r.length-1&&(r[0].x-=a);break;case 1:r[s-1].x+=a,r[s].x+=a,1===s&&(r[r.length-1].x+=a),s===r.length-1&&(r[0].x+=a);break;case 2:r[s-1].y-=a,r[s].y-=a,1===s&&(r[r.length-1].y-=a),s===r.length-1&&(r[0].y-=a);break;case 3:r[s-1].y+=a,r[s].y+=a,1===s&&(r[r.length-1].y+=a),s===r.length-1&&(r[0].y+=a)}}}}var d=Object(a.b)((function(e){var t,r;t=function(){var e={DEBUG:!1,assert:function(t,r){if(e.DEBUG&&!t)throw new Error("Assertion failed"+(r?": "+r:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};return e.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.geom.edgeEval=function(t,r,i){e.assert(e.geom.vertLeq(t,r)&&e.geom.vertLeq(r,i));var n=r.s-t.s,s=i.s-r.s;return n+s>0?n<s?r.t-t.t+(t.t-i.t)*(n/(n+s)):r.t-i.t+(i.t-t.t)*(s/(n+s)):0},e.geom.edgeSign=function(t,r,i){e.assert(e.geom.vertLeq(t,r)&&e.geom.vertLeq(r,i));var n=r.s-t.s,s=i.s-r.s;return n+s>0?(r.t-i.t)*n+(r.t-t.t)*s:0},e.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.geom.transEval=function(t,r,i){e.assert(e.geom.transLeq(t,r)&&e.geom.transLeq(r,i));var n=r.t-t.t,s=i.t-r.t;return n+s>0?n<s?r.s-t.s+(t.s-i.s)*(n/(n+s)):r.s-i.s+(i.s-t.s)*(s/(n+s)):0},e.geom.transSign=function(t,r,i){e.assert(e.geom.transLeq(t,r)&&e.geom.transLeq(r,i));var n=r.t-t.t,s=i.t-r.t;return n+s>0?(r.s-i.s)*n+(r.s-t.s)*s:0},e.geom.edgeGoesLeft=function(t){return e.geom.vertLeq(t.dst(),t.org)},e.geom.edgeGoesRight=function(t){return e.geom.vertLeq(t.org,t.dst())},e.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.geom.vertCCW=function(e,t,r){return e.s*(t.t-r.t)+t.s*(r.t-e.t)+r.s*(e.t-t.t)>=0},e.geom.interpolate_=function(e,t,r,i){return(e=e<0?0:e)<=(r=r<0?0:r)?0===r?(t+i)/2:t+e/(e+r)*(i-t):i+r/(e+r)*(t-i)},e.geom.edgeIntersect=function(t,r,i,n,s){var a,o,l;e.geom.vertLeq(t,r)||(l=t,t=r,r=l),e.geom.vertLeq(i,n)||(l=i,i=n,n=l),e.geom.vertLeq(t,i)||(l=t,t=i,i=l,l=r,r=n,n=l),e.geom.vertLeq(i,r)?e.geom.vertLeq(r,n)?((a=e.geom.edgeEval(t,i,r))+(o=e.geom.edgeEval(i,r,n))<0&&(a=-a,o=-o),s.s=e.geom.interpolate_(a,i.s,o,r.s)):((a=e.geom.edgeSign(t,i,r))+(o=-e.geom.edgeSign(t,n,r))<0&&(a=-a,o=-o),s.s=e.geom.interpolate_(a,i.s,o,n.s)):s.s=(i.s+r.s)/2,e.geom.transLeq(t,r)||(l=t,t=r,r=l),e.geom.transLeq(i,n)||(l=i,i=n,n=l),e.geom.transLeq(t,i)||(l=t,t=i,i=l,l=r,r=n,n=l),e.geom.transLeq(i,r)?e.geom.transLeq(r,n)?((a=e.geom.transEval(t,i,r))+(o=e.geom.transEval(i,r,n))<0&&(a=-a,o=-o),s.t=e.geom.interpolate_(a,i.t,o,r.t)):((a=e.geom.transSign(t,i,r))+(o=-e.geom.transSign(t,n,r))<0&&(a=-a,o=-o),s.t=e.geom.interpolate_(a,i.t,o,n.t)):s.t=(i.t+r.t)/2},e.mesh={},e.mesh.makeEdge=function(t){var r=e.mesh.makeEdgePair_(t.eHead);return e.mesh.makeVertex_(r,t.vHead),e.mesh.makeVertex_(r.sym,t.vHead),e.mesh.makeFace_(r,t.fHead),r},e.mesh.meshSplice=function(t,r){var i=!1,n=!1;t!==r&&(r.org!==t.org&&(n=!0,e.mesh.killVertex_(r.org,t.org)),r.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(r.lFace,t.lFace)),e.mesh.splice_(r,t),n||(e.mesh.makeVertex_(r,t.org),t.org.anEdge=t),i||(e.mesh.makeFace_(r,t.lFace),t.lFace.anEdge=t))},e.mesh.deleteEdge=function(t){var r=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,e.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?e.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,e.mesh.splice_(t,t.oPrev()),i||e.mesh.makeFace_(t,t.lFace)),r.oNext===r?(e.mesh.killVertex_(r.org,null),e.mesh.killFace_(r.lFace,null)):(t.lFace.anEdge=r.oPrev(),r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev())),e.mesh.killEdge_(t)},e.mesh.addEdgeVertex=function(t){var r=e.mesh.makeEdgePair_(t),i=r.sym;return e.mesh.splice_(r,t.lNext),r.org=t.dst(),e.mesh.makeVertex_(i,r.org),r.lFace=i.lFace=t.lFace,r},e.mesh.splitEdge=function(t){var r=e.mesh.addEdgeVertex(t).sym;return e.mesh.splice_(t.sym,t.sym.oPrev()),e.mesh.splice_(t.sym,r),t.sym.org=r.org,r.dst().anEdge=r.sym,r.sym.lFace=t.rFace(),r.winding=t.winding,r.sym.winding=t.sym.winding,r},e.mesh.connect=function(t,r){var i=!1,n=e.mesh.makeEdgePair_(t),s=n.sym;return r.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(r.lFace,t.lFace)),e.mesh.splice_(n,t.lNext),e.mesh.splice_(s,r),n.org=t.dst(),s.org=r.org,n.lFace=s.lFace=t.lFace,t.lFace.anEdge=s,i||e.mesh.makeFace_(n,t.lFace),n},e.mesh.zapFace=function(t){var r,i=t.anEdge,n=i.lNext;do{if(n=(r=n).lNext,r.lFace=null,null===r.rFace()){r.oNext===r?e.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev()));var s=r.sym;s.oNext===s?e.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,e.mesh.splice_(s,s.oPrev())),e.mesh.killEdge_(r)}}while(r!==i);var a=t.prev,o=t.next;o.prev=a,a.next=o},e.mesh.meshUnion=function(e,t){var r=e.fHead,i=e.vHead,n=e.eHead,s=t.fHead,a=t.vHead,o=t.eHead;return s.next!==s&&(r.prev.next=s.next,s.next.prev=r.prev,s.prev.next=r,r.prev=s.prev),a.next!==a&&(i.prev.next=a.next,a.next.prev=i.prev,a.prev.next=i,i.prev=a.prev),o.next!==o&&(n.sym.next.sym.next=o.next,o.next.sym.next=n.sym.next,o.sym.next.sym.next=n,n.sym.next=o.sym.next),e},e.mesh.deleteMesh=function(e){},e.mesh.makeEdgePair_=function(t){var r=new e.GluHalfEdge,i=new e.GluHalfEdge,n=t.sym.next;return i.next=n,n.sym.next=r,r.next=t,t.sym.next=i,r.sym=i,r.oNext=r,r.lNext=i,i.sym=r,i.oNext=i,i.lNext=r,r},e.mesh.splice_=function(e,t){var r=e.oNext,i=t.oNext;r.sym.lNext=t,i.sym.lNext=e,e.oNext=i,t.oNext=r},e.mesh.makeVertex_=function(t,r){var i=r.prev,n=new e.GluVertex(r,i);i.next=n,r.prev=n,n.anEdge=t;var s=t;do{s.org=n,s=s.oNext}while(s!==t)},e.mesh.makeFace_=function(t,r){var i=r.prev,n=new e.GluFace(r,i);i.next=n,r.prev=n,n.anEdge=t,n.inside=r.inside;var s=t;do{s.lFace=n,s=s.lNext}while(s!==t)},e.mesh.killEdge_=function(e){var t=e.next,r=e.sym.next;t.sym.next=r,r.sym.next=t},e.mesh.killVertex_=function(e,t){var r=e.anEdge,i=r;do{i.org=t,i=i.oNext}while(i!==r);var n=e.prev,s=e.next;s.prev=n,n.next=s},e.mesh.killFace_=function(e,t){var r=e.anEdge,i=r;do{i.lFace=t,i=i.lNext}while(i!==r);var n=e.prev,s=e.next;s.prev=n,n.next=s},e.normal={},e.normal.S_UNIT_X_=1,e.normal.S_UNIT_Y_=0,e.normal.projectPolygon=function(t,r,i,n){var s=!1,a=[r,i,n];0===r&&0===i&&0===n&&(e.normal.computeNormal_(t,a),s=!0);var o,l=e.normal.longAxis_(a),c=t.mesh.vHead;if(e.TRUE_PROJECT){e.normal.normalize_(a);var u=[0,0,0],h=[0,0,0];u[l]=0,u[(l+1)%3]=e.normal.S_UNIT_X_,u[(l+2)%3]=e.normal.S_UNIT_Y_;var d=e.normal.dot_(u,a);for(u[0]-=d*a[0],u[1]-=d*a[1],u[2]-=d*a[2],e.normal.normalize_(u),h[0]=a[1]*u[2]-a[2]*u[1],h[1]=a[2]*u[0]-a[0]*u[2],h[2]=a[0]*u[1]-a[1]*u[0],e.normal.normalize_(h),o=c.next;o!==c;o=o.next)o.s=e.normal.dot_(o.coords,u),o.t=e.normal.dot_(o.coords,h)}else{var f=(l+1)%3,p=(l+2)%3,y=a[l]>0?1:-1;for(o=c.next;o!==c;o=o.next)o.s=o.coords[f],o.t=y*o.coords[p]}s&&e.normal.checkOrientation_(t)},e.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.normal.normalize_=function(t){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e.assert(r>0),r=Math.sqrt(r),t[0]/=r,t[1]/=r,t[2]/=r},e.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.normal.computeNormal_=function(t,r){var i,n=[-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD],s=[2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD],a=[],o=[],l=t.mesh.vHead;for(i=l.next;i!==l;i=i.next)for(var c=0;c<3;++c){var u=i.coords[c];u<s[c]&&(s[c]=u,o[c]=i),u>n[c]&&(n[c]=u,a[c]=i)}var h=0;if(n[1]-s[1]>n[0]-s[0]&&(h=1),n[2]-s[2]>n[h]-s[h]&&(h=2),s[h]>=n[h])return r[0]=0,r[1]=0,void(r[2]=1);var d=0,f=o[h],p=a[h],y=[0,0,0],g=[f.coords[0]-p.coords[0],f.coords[1]-p.coords[1],f.coords[2]-p.coords[2]],m=[0,0,0];for(i=l.next;i!==l;i=i.next){m[0]=i.coords[0]-p.coords[0],m[1]=i.coords[1]-p.coords[1],m[2]=i.coords[2]-p.coords[2],y[0]=g[1]*m[2]-g[2]*m[1],y[1]=g[2]*m[0]-g[0]*m[2],y[2]=g[0]*m[1]-g[1]*m[0];var b=y[0]*y[0]+y[1]*y[1]+y[2]*y[2];b>d&&(d=b,r[0]=y[0],r[1]=y[1],r[2]=y[2])}d<=0&&(r[0]=r[1]=r[2]=0,r[e.normal.longAxis_(g)]=1)},e.normal.checkOrientation_=function(e){for(var t=0,r=e.mesh.fHead,i=r.next;i!==r;i=i.next){var n=i.anEdge;if(!(n.winding<=0))do{t+=(n.org.s-n.dst().s)*(n.org.t+n.dst().t),n=n.lNext}while(n!==i.anEdge)}if(t<0)for(var s=e.mesh.vHead,a=s.next;a!==s;a=a.next)a.t=-a.t},e.render={},e.render.renderMesh=function(t,r,i){for(var n=!1,s=-1,a=r.fHead.prev;a!==r.fHead;a=a.prev)if(a.inside){n||(t.callBeginCallback(e.primitiveType.GL_TRIANGLES),n=!0);var o=a.anEdge;e.assert(o.lNext.lNext.lNext===o,"renderMesh called with non-triangulated mesh");do{if(i){var l=o.rFace().inside?0:1;s!==l&&(s=l,t.callEdgeFlagCallback(!!s))}t.callVertexCallback(o.org.data),o=o.lNext}while(o!==a.anEdge)}n&&t.callEndCallback()},e.render.renderBoundary=function(t,r){for(var i=r.fHead.next;i!==r.fHead;i=i.next)if(i.inside){t.callBeginCallback(e.primitiveType.GL_LINE_LOOP);var n=i.anEdge;do{t.callVertexCallback(n.org.data),n=n.lNext}while(n!==i.anEdge);t.callEndCallback()}},e.sweep={},e.sweep.SENTINEL_COORD_=4*e.GLU_TESS_MAX_COORD,e.sweep.TOLERANCE_NONZERO_=!1,e.sweep.computeInterior=function(t){var r;for(t.fatalError=!1,e.sweep.removeDegenerateEdges_(t),e.sweep.initPriorityQ_(t),e.sweep.initEdgeDict_(t);null!==(r=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!e.geom.vertEq(i,r))break;i=t.pq.extractMin(),e.sweep.spliceMergeVertices_(t,r.anEdge,i.anEdge)}e.sweep.sweepEvent_(t,r)}var n=t.dict.getMin().getKey();t.event=n.eUp.org,e.sweep.doneEdgeDict_(t),e.sweep.donePriorityQ_(t),e.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},e.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},e.sweep.edgeLeq_=function(t,r,i){var n=t.event,s=r.eUp,a=i.eUp;return s.dst()===n?a.dst()===n?e.geom.vertLeq(s.org,a.org)?e.geom.edgeSign(a.dst(),s.org,a.org)<=0:e.geom.edgeSign(s.dst(),a.org,s.org)>=0:e.geom.edgeSign(a.dst(),n,a.org)<=0:a.dst()===n?e.geom.edgeSign(s.dst(),n,s.org)>=0:e.geom.edgeEval(s.dst(),n,s.org)>=e.geom.edgeEval(a.dst(),n,a.org)},e.sweep.deleteRegion_=function(t,r){r.fixUpperEdge&&e.assert(0===r.eUp.winding),r.eUp.activeRegion=null,t.dict.deleteNode(r.nodeUp),r.nodeUp=null},e.sweep.fixUpperEdge_=function(t,r){e.assert(t.fixUpperEdge),e.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=r,r.activeRegion=t},e.sweep.topLeftRegion_=function(t){var r=t.eUp.org;do{t=t.regionAbove()}while(t.eUp.org===r);if(t.fixUpperEdge){var i=e.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);e.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},e.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},e.sweep.addRegionBelow_=function(t,r,i){var n=new e.ActiveRegion;return n.eUp=i,n.nodeUp=t.dict.insertBefore(r.nodeUp,n),i.activeRegion=n,n},e.sweep.isWindingInside_=function(t,r){switch(t.windingRule){case e.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&r);case e.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==r;case e.windingRule.GLU_TESS_WINDING_POSITIVE:return r>0;case e.windingRule.GLU_TESS_WINDING_NEGATIVE:return r<0;case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return r>=2||r<=-2}return e.assert(!1),!1},e.sweep.computeWinding_=function(t,r){r.windingNumber=r.regionAbove().windingNumber+r.eUp.winding,r.inside=e.sweep.isWindingInside_(t,r.windingNumber)},e.sweep.finishRegion_=function(t,r){var i=r.eUp,n=i.lFace;n.inside=r.inside,n.anEdge=i,e.sweep.deleteRegion_(t,r)},e.sweep.finishLeftRegions_=function(t,r,i){for(var n=r,s=r.eUp;n!==i;){n.fixUpperEdge=!1;var a=n.regionBelow(),o=a.eUp;if(o.org!==s.org){if(!a.fixUpperEdge){e.sweep.finishRegion_(t,n);break}o=e.mesh.connect(s.lPrev(),o.sym),e.sweep.fixUpperEdge_(a,o)}s.oNext!==o&&(e.mesh.meshSplice(o.oPrev(),o),e.mesh.meshSplice(s,o)),e.sweep.finishRegion_(t,n),s=a.eUp,n=a}return s},e.sweep.addRightEdges_=function(t,r,i,n,s,a){var o=!0,l=i;do{e.assert(e.geom.vertLeq(l.org,l.dst())),e.sweep.addRegionBelow_(t,r,l.sym),l=l.oNext}while(l!==n);null===s&&(s=r.regionBelow().eUp.rPrev());for(var c,u=r,h=s;(l=(c=u.regionBelow()).eUp.sym).org===h.org;)l.oNext!==h&&(e.mesh.meshSplice(l.oPrev(),l),e.mesh.meshSplice(h.oPrev(),l)),c.windingNumber=u.windingNumber-l.winding,c.inside=e.sweep.isWindingInside_(t,c.windingNumber),u.dirty=!0,!o&&e.sweep.checkForRightSplice_(t,u)&&(e.sweep.addWinding_(l,h),e.sweep.deleteRegion_(t,u),e.mesh.deleteEdge(h)),o=!1,u=c,h=l;u.dirty=!0,e.assert(u.windingNumber-l.winding===c.windingNumber),a&&e.sweep.walkDirtyRegions_(t,u)},e.sweep.callCombine_=function(t,r,i,n,s){var a=[r.coords[0],r.coords[1],r.coords[2]];r.data=null,r.data=t.callCombineCallback(a,i,n),null===r.data&&(s?t.fatalError||(t.callErrorCallback(e.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):r.data=i[0])},e.sweep.spliceMergeVertices_=function(t,r,i){var n=[null,null,null,null];n[0]=r.org.data,n[1]=i.org.data,e.sweep.callCombine_(t,r.org,n,[.5,.5,0,0],!1),e.mesh.meshSplice(r,i)},e.sweep.vertexWeights_=function(t,r,i,n,s){var a=e.geom.vertL1dist(r,t),o=e.geom.vertL1dist(i,t),l=s,c=s+1;n[l]=.5*o/(a+o),n[c]=.5*a/(a+o),t.coords[0]+=n[l]*r.coords[0]+n[c]*i.coords[0],t.coords[1]+=n[l]*r.coords[1]+n[c]*i.coords[1],t.coords[2]+=n[l]*r.coords[2]+n[c]*i.coords[2]},e.sweep.getIntersectData_=function(t,r,i,n,s,a){var o=[0,0,0,0],l=[i.data,n.data,s.data,a.data];r.coords[0]=r.coords[1]=r.coords[2]=0,e.sweep.vertexWeights_(r,i,n,o,0),e.sweep.vertexWeights_(r,s,a,o,2),e.sweep.callCombine_(t,r,l,o,!0)},e.sweep.checkForRightSplice_=function(t,r){var i=r.regionBelow(),n=r.eUp,s=i.eUp;if(e.geom.vertLeq(n.org,s.org)){if(e.geom.edgeSign(s.dst(),n.org,s.org)>0)return!1;e.geom.vertEq(n.org,s.org)?n.org!==s.org&&(t.pq.remove(n.org.pqHandle),e.sweep.spliceMergeVertices_(t,s.oPrev(),n)):(e.mesh.splitEdge(s.sym),e.mesh.meshSplice(n,s.oPrev()),r.dirty=i.dirty=!0)}else{if(e.geom.edgeSign(n.dst(),s.org,n.org)<0)return!1;r.regionAbove().dirty=r.dirty=!0,e.mesh.splitEdge(n.sym),e.mesh.meshSplice(s.oPrev(),n)}return!0},e.sweep.checkForLeftSplice_=function(t,r){var i,n=r.regionBelow(),s=r.eUp,a=n.eUp;if(e.assert(!e.geom.vertEq(s.dst(),a.dst())),e.geom.vertLeq(s.dst(),a.dst())){if(e.geom.edgeSign(s.dst(),a.dst(),s.org)<0)return!1;r.regionAbove().dirty=r.dirty=!0,i=e.mesh.splitEdge(s),e.mesh.meshSplice(a.sym,i),i.lFace.inside=r.inside}else{if(e.geom.edgeSign(a.dst(),s.dst(),a.org)>0)return!1;r.dirty=n.dirty=!0,i=e.mesh.splitEdge(a),e.mesh.meshSplice(s.lNext,a.sym),i.rFace().inside=r.inside}return!0},e.sweep.checkForIntersect_=function(t,r){var i=r.regionBelow(),n=r.eUp,s=i.eUp,a=n.org,o=s.org,l=n.dst(),c=s.dst(),u=new e.GluVertex;if(e.assert(!e.geom.vertEq(c,l)),e.assert(e.geom.edgeSign(l,t.event,a)<=0),e.assert(e.geom.edgeSign(c,t.event,o)>=0),e.assert(a!==t.event&&o!==t.event),e.assert(!r.fixUpperEdge&&!i.fixUpperEdge),a===o)return!1;if(Math.min(a.t,l.t)>Math.max(o.t,c.t))return!1;if(e.geom.vertLeq(a,o)){if(e.geom.edgeSign(c,a,o)>0)return!1}else if(e.geom.edgeSign(l,o,a)<0)return!1;e.geom.edgeIntersect(l,a,c,o,u),e.assert(Math.min(a.t,l.t)<=u.t),e.assert(u.t<=Math.max(o.t,c.t)),e.assert(Math.min(c.s,l.s)<=u.s),e.assert(u.s<=Math.max(o.s,a.s)),e.geom.vertLeq(u,t.event)&&(u.s=t.event.s,u.t=t.event.t);var h=e.geom.vertLeq(a,o)?a:o;if(e.geom.vertLeq(h,u)&&(u.s=h.s,u.t=h.t),e.geom.vertEq(u,a)||e.geom.vertEq(u,o))return e.sweep.checkForRightSplice_(t,r),!1;if(!e.geom.vertEq(l,t.event)&&e.geom.edgeSign(l,t.event,u)>=0||!e.geom.vertEq(c,t.event)&&e.geom.edgeSign(c,t.event,u)<=0){if(c===t.event)return e.mesh.splitEdge(n.sym),e.mesh.meshSplice(s.sym,n),n=(r=e.sweep.topLeftRegion_(r)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,r.regionBelow(),i),e.sweep.addRightEdges_(t,r,n.oPrev(),n,n,!0),!0;if(l===t.event){e.mesh.splitEdge(s.sym),e.mesh.meshSplice(n.lNext,s.oPrev()),i=r;var d=(r=e.sweep.topRightRegion_(r)).regionBelow().eUp.rPrev();return i.eUp=s.oPrev(),s=e.sweep.finishLeftRegions_(t,i,null),e.sweep.addRightEdges_(t,r,s.oNext,n.rPrev(),d,!0),!0}return e.geom.edgeSign(l,t.event,u)>=0&&(r.regionAbove().dirty=r.dirty=!0,e.mesh.splitEdge(n.sym),n.org.s=t.event.s,n.org.t=t.event.t),e.geom.edgeSign(c,t.event,u)<=0&&(r.dirty=i.dirty=!0,e.mesh.splitEdge(s.sym),s.org.s=t.event.s,s.org.t=t.event.t),!1}return e.mesh.splitEdge(n.sym),e.mesh.splitEdge(s.sym),e.mesh.meshSplice(s.oPrev(),n),n.org.s=u.s,n.org.t=u.t,n.org.pqHandle=t.pq.insert(n.org),e.sweep.getIntersectData_(t,n.org,a,l,o,c),r.regionAbove().dirty=r.dirty=i.dirty=!0,!1},e.sweep.walkDirtyRegions_=function(t,r){for(var i=r.regionBelow();;){for(;i.dirty;)r=i,i=i.regionBelow();if(!r.dirty&&(i=r,null===(r=r.regionAbove())||!r.dirty))return;r.dirty=!1;var n=r.eUp,s=i.eUp;if(n.dst()!==s.dst()&&e.sweep.checkForLeftSplice_(t,r)&&(i.fixUpperEdge?(e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(s),s=(i=r.regionBelow()).eUp):r.fixUpperEdge&&(e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(n),n=(r=i.regionAbove()).eUp)),n.org!==s.org)if(n.dst()===s.dst()||r.fixUpperEdge||i.fixUpperEdge||n.dst()!==t.event&&s.dst()!==t.event)e.sweep.checkForRightSplice_(t,r);else if(e.sweep.checkForIntersect_(t,r))return;n.org===s.org&&n.dst()===s.dst()&&(e.sweep.addWinding_(s,n),e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(n),r=i.regionAbove())}},e.sweep.connectRightVertex_=function(t,r,i){var n,s=i.oNext,a=r.regionBelow(),o=r.eUp,l=a.eUp,c=!1;o.dst()!==l.dst()&&e.sweep.checkForIntersect_(t,r),e.geom.vertEq(o.org,t.event)&&(e.mesh.meshSplice(s.oPrev(),o),s=(r=e.sweep.topLeftRegion_(r)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,r.regionBelow(),a),c=!0),e.geom.vertEq(l.org,t.event)&&(e.mesh.meshSplice(i,l.oPrev()),i=e.sweep.finishLeftRegions_(t,a,null),c=!0),c?e.sweep.addRightEdges_(t,r,i.oNext,s,s,!0):(n=e.geom.vertLeq(l.org,o.org)?l.oPrev():o,n=e.mesh.connect(i.lPrev(),n),e.sweep.addRightEdges_(t,r,n,n.oNext,n.oNext,!1),n.sym.activeRegion.fixUpperEdge=!0,e.sweep.walkDirtyRegions_(t,r))},e.sweep.connectLeftDegenerate_=function(t,r,i){var n=r.eUp;if(e.geom.vertEq(n.org,i))return e.assert(e.sweep.TOLERANCE_NONZERO_),void(e.sweep.TOLERANCE_NONZERO_&&e.sweep.spliceMergeVertices_(t,n,i.anEdge));if(!e.geom.vertEq(n.dst(),i))return e.mesh.splitEdge(n.sym),r.fixUpperEdge&&(e.mesh.deleteEdge(n.oNext),r.fixUpperEdge=!1),e.mesh.meshSplice(i.anEdge,n),void e.sweep.sweepEvent_(t,i);if(e.assert(e.sweep.TOLERANCE_NONZERO_),e.sweep.TOLERANCE_NONZERO_){var s=(r=e.sweep.topRightRegion_(r)).regionBelow(),a=s.eUp.sym,o=a.oNext,l=o;s.fixUpperEdge&&(e.assert(o!==a),e.sweep.deleteRegion_(t,s),e.mesh.deleteEdge(a),a=o.oPrev()),e.mesh.meshSplice(i.anEdge,a),e.geom.edgeGoesLeft(o)||(o=null),e.sweep.addRightEdges_(t,r,a.oNext,l,o,!0)}},e.sweep.connectLeftVertex_=function(t,r){var i=new e.ActiveRegion;i.eUp=r.anEdge.sym;var n=t.dict.search(i).getKey(),s=n.regionBelow(),a=n.eUp,o=s.eUp;if(0!==e.geom.edgeSign(a.dst(),r,a.org)){var l,c=e.geom.vertLeq(o.dst(),a.dst())?n:s;n.inside||c.fixUpperEdge?(l=c===n?e.mesh.connect(r.anEdge.sym,a.lNext):e.mesh.connect(o.dNext(),r.anEdge).sym,c.fixUpperEdge?e.sweep.fixUpperEdge_(c,l):e.sweep.computeWinding_(t,e.sweep.addRegionBelow_(t,n,l)),e.sweep.sweepEvent_(t,r)):e.sweep.addRightEdges_(t,n,r.anEdge,r.anEdge,null,!0)}else e.sweep.connectLeftDegenerate_(t,n,r)},e.sweep.sweepEvent_=function(t,r){t.event=r;for(var i=r.anEdge;null===i.activeRegion;)if((i=i.oNext)===r.anEdge)return void e.sweep.connectLeftVertex_(t,r);var n=e.sweep.topLeftRegion_(i.activeRegion),s=n.regionBelow(),a=s.eUp,o=e.sweep.finishLeftRegions_(t,s,null);o.oNext===a?e.sweep.connectRightVertex_(t,n,o):e.sweep.addRightEdges_(t,n,o.oNext,a,a,!0)},e.sweep.addSentinel_=function(t,r){var i=new e.ActiveRegion,n=e.mesh.makeEdge(t.mesh);n.org.s=e.sweep.SENTINEL_COORD_,n.org.t=r,n.dst().s=-e.sweep.SENTINEL_COORD_,n.dst().t=r,t.event=n.dst(),i.eUp=n,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},e.sweep.initEdgeDict_=function(t){t.dict=new e.Dict(t,e.sweep.edgeLeq_),e.sweep.addSentinel_(t,-e.sweep.SENTINEL_COORD_),e.sweep.addSentinel_(t,e.sweep.SENTINEL_COORD_)},e.sweep.doneEdgeDict_=function(t){for(var r,i=0;null!==(r=t.dict.getMin().getKey());)r.sentinel||(e.assert(r.fixUpperEdge),e.assert(1==++i)),e.assert(0===r.windingNumber),e.sweep.deleteRegion_(t,r);t.dict=null},e.sweep.removeDegenerateEdges_=function(t){for(var r,i=t.mesh.eHead,n=i.next;n!==i;n=r){r=n.next;var s=n.lNext;e.geom.vertEq(n.org,n.dst())&&n.lNext.lNext!==n&&(e.sweep.spliceMergeVertices_(t,s,n),e.mesh.deleteEdge(n),s=(n=s).lNext),s.lNext===n&&(s!==n&&(s!==r&&s!==r.sym||(r=r.next),e.mesh.deleteEdge(s)),n!==r&&n!==r.sym||(r=r.next),e.mesh.deleteEdge(n))}},e.sweep.initPriorityQ_=function(t){var r=new e.PriorityQ;t.pq=r;var i,n=t.mesh.vHead;for(i=n.next;i!==n;i=i.next)i.pqHandle=r.insert(i);r.init()},e.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},e.sweep.removeDegenerateFaces_=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r){r=i.next;var n=i.anEdge;e.assert(n.lNext!==n),n.lNext.lNext===n&&(e.sweep.addWinding_(n.oNext,n),e.mesh.deleteEdge(n))}},e.tessmono={},e.tessmono.tessellateMonoRegion_=function(t){var r=t.anEdge;for(e.assert(r.lNext!==r&&r.lNext.lNext!==r);e.geom.vertLeq(r.dst(),r.org);r=r.lPrev());for(;e.geom.vertLeq(r.org,r.dst());r=r.lNext);for(var i,n=r.lPrev();r.lNext!==n;)if(e.geom.vertLeq(r.dst(),n.org)){for(;n.lNext!==r&&(e.geom.edgeGoesLeft(n.lNext)||e.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0);)n=(i=e.mesh.connect(n.lNext,n)).sym;n=n.lPrev()}else{for(;n.lNext!==r&&(e.geom.edgeGoesRight(r.lPrev())||e.geom.edgeSign(r.dst(),r.org,r.lPrev().org)>=0);)i=e.mesh.connect(r,r.lPrev()),r=i.sym;r=r.lNext}for(e.assert(n.lNext!==r);n.lNext.lNext!==r;)n=(i=e.mesh.connect(n.lNext,n)).sym},e.tessmono.tessellateInterior=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)r=i.next,i.inside&&e.tessmono.tessellateMonoRegion_(i)},e.tessmono.discardExterior=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)r=i.next,i.inside||e.mesh.zapFace(i)},e.tessmono.setWindingNumber=function(t,r,i){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.rFace().inside!==s.lFace.inside?s.winding=s.lFace.inside?r:-r:i?e.mesh.deleteEdge(s):s.winding=0},e.Dict=function(t,r){this.head_=new e.DictNode,this.frame_=t,this.leq_=r},e.Dict.prototype.deleteDict_=function(){},e.Dict.prototype.insertBefore=function(t,r){do{t=t.prev}while(null!==t.key&&!this.leq_(this.frame_,t.key,r));var i=new e.DictNode(r,t.next,t);return t.next.prev=i,t.next=i,i},e.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},e.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},e.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},e.Dict.prototype.getMin=function(){return this.head_.next},e.Dict.prototype.getMax=function(){return this.head_.prev},e.DictNode=function(e,t,r){this.key=e||null,this.next=t||this,this.prev=r||this},e.DictNode.prototype.getKey=function(){return this.key},e.DictNode.prototype.getSuccessor=function(){return this.next},e.DictNode.prototype.getPredecessor=function(){return this.prev},e.GluTesselator=function(){this.state_=e.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=e.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},e.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},e.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(e.GluTesselator.tessState_.T_DORMANT)},e.GluTesselator.prototype.gluTessProperty=function(t,r){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return;case e.gluEnum.GLU_TESS_WINDING_RULE:var i=r;switch(i){case e.windingRule.GLU_TESS_WINDING_ODD:case e.windingRule.GLU_TESS_WINDING_NONZERO:case e.windingRule.GLU_TESS_WINDING_POSITIVE:case e.windingRule.GLU_TESS_WINDING_NEGATIVE:case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!r);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(e.gluEnum.GLU_INVALID_VALUE)},e.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return 0;case e.gluEnum.GLU_TESS_WINDING_RULE:var r=this.windingRule;return e.assert(r===e.windingRule.GLU_TESS_WINDING_ODD||r===e.windingRule.GLU_TESS_WINDING_NONZERO||r===e.windingRule.GLU_TESS_WINDING_POSITIVE||r===e.windingRule.GLU_TESS_WINDING_NEGATIVE||r===e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),r;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return e.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}return!1},e.GluTesselator.prototype.gluTessNormal=function(e,t,r){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=r},e.GluTesselator.prototype.gluTessCallback=function(t,r){var i=r||null;switch(t){case e.gluEnum.GLU_TESS_BEGIN:case e.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case e.gluEnum.GLU_TESS_EDGE_FLAG:case e.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case e.gluEnum.GLU_TESS_VERTEX:case e.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case e.gluEnum.GLU_TESS_END:case e.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case e.gluEnum.GLU_TESS_ERROR:case e.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case e.gluEnum.GLU_TESS_COMBINE:case e.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case e.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}},e.GluTesselator.prototype.gluTessVertex=function(t,r){var i=!1,n=[0,0,0];this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR);for(var s=0;s<3;++s){var a=t[s];a<-e.GLU_TESS_MAX_COORD&&(a=-e.GLU_TESS_MAX_COORD,i=!0),a>e.GLU_TESS_MAX_COORD&&(a=e.GLU_TESS_MAX_COORD,i=!0),n[s]=a}i&&this.callErrorCallback(e.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(n,r)},e.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(e.GluTesselator.tessState_.T_DORMANT),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new e.GluMesh,this.polygonData_=t},e.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},e.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON},e.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_DORMANT,e.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),e.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly_?e.tessmono.setWindingNumber(t,1,!0):e.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)e.render.renderBoundary(this,this.mesh);else{var r=!!this.edgeFlagCallback_;e.render.renderMesh(this,this.mesh,r)}if(this.meshCallback_)return e.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}e.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},e.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},e.GluTesselator.prototype.gotoState_=function(t){for(;this.state_!==t;)if(this.state_<t)switch(this.state_){case e.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case e.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},e.GluTesselator.prototype.addVertex_=function(t,r){var i=this.lastEdge_;null===i?(i=e.mesh.makeEdge(this.mesh),e.mesh.meshSplice(i,i.sym)):(e.mesh.splitEdge(i),i=i.lNext),i.org.data=r,i.org.coords[0]=t[0],i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},e.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},e.GluTesselator.prototype.callCombineCallback=function(e,t,r){return this.combineCallback_&&this.combineCallback_(e,t,r,this.polygonData_)||null},e.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},e.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.inside=!1},e.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},e.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},e.GluHalfEdge.prototype.dst=function(){return this.sym.org},e.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},e.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},e.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},e.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},e.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},e.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},e.GluMesh=function(){this.vHead=new e.GluVertex,this.fHead=new e.GluFace,this.eHead=new e.GluHalfEdge,this.eHeadSym=new e.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},e.GluMesh.prototype.checkMesh=function(){if(e.DEBUG){var t,r,i,n=this.fHead,s=this.vHead,a=this.eHead,o=n;for(o=n;(r=o.next)!==n;o=r){e.assert(r.prev===o),t=r.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.lFace===r),t=t.lNext}while(t!==r.anEdge)}e.assert(r.prev===o&&null===r.anEdge);var l=s;for(l=s;(i=l.next)!==s;l=i){e.assert(i.prev===l),t=i.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.org===i),t=t.oNext}while(t!==i.anEdge)}e.assert(i.prev===l&&null===i.anEdge&&null===i.data);var c=a;for(c=a;(t=c.next)!==a;c=t)e.assert(t.sym.next===c.sym),e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(null!==t.org),e.assert(null!==t.dst()),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t);e.assert(t.sym.next===c.sym&&t.sym===this.eHeadSym&&t.sym.sym===t&&null===t.org&&null===t.dst()&&null===t.lFace&&null===t.rFace())}},e.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},e.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new e.PriorityQHeap},e.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},e.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var r,i=(r=this.verts_,function(t,i){return e.geom.vertLeq(r[t],r[i])?1:-1});if(this.order_.sort(i),this.initialized_=!0,this.heap_.init(),e.DEBUG){var n=0+this.size_-1;for(t=0;t<n;++t)e.assert(e.geom.vertLeq(this.verts_[this.order_[t+1]],this.verts_[this.order_[t]]))}},e.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},e.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var r=this.heap_.minimum();if(e.geom.vertLeq(r,t))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return t},e.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var r=this.heap_.minimum();if(e.geom.vertLeq(r,t))return r}return t},e.PriorityQ.prototype.remove=function(t){if(t>=0)this.heap_.remove(t);else for(t=-(t+1),e.assert(t<this.verts_.length&&null!==this.verts_[t]),this.verts_[t]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},e.PriorityQHeap=function(){this.heap_=e.PriorityQHeap.reallocNumeric_([0],e.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=e.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},e.PriorityQHeap.INIT_SIZE_=32,e.PriorityQHeap.reallocNumeric_=function(e,t){for(var r=new Array(t),i=0;i<e.length;i++)r[i]=e[i];for(;i<t;i++)r[i]=0;return r},e.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},e.PriorityQHeap.prototype.insert=function(t){var r,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=e.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?r=i:(r=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[r]=t,this.handles_[r]=i,this.heap_[i]=r,this.initialized_&&this.floatUp_(i),r},e.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},e.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},e.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,r=this.handles_,i=e[1],n=t[i];return this.size_>0&&(e[1]=e[this.size_],r[e[1]]=1,t[i]=null,r[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),n},e.PriorityQHeap.prototype.remove=function(t){var r=this.heap_,i=this.verts_,n=this.handles_;e.assert(t>=1&&t<=this.max_&&null!==i[t]);var s=n[t];if(r[s]=r[this.size_],n[r[s]]=s,s<=--this.size_)if(s<=1)this.floatDown_(s);else{var a=i[r[s]],o=i[r[s>>1]];e.geom.vertLeq(o,a)?this.floatDown_(s):this.floatUp_(s)}i[t]=null,n[t]=this.freeList_,this.freeList_=t},e.PriorityQHeap.prototype.floatDown_=function(t){for(var r=this.heap_,i=this.verts_,n=this.handles_,s=t,a=r[s];;){var o=s<<1;o<this.size_&&e.geom.vertLeq(i[r[o+1]],i[r[o]])&&(o+=1),e.assert(o<=this.max_);var l=r[o];if(o>this.size_||e.geom.vertLeq(i[a],i[l]))return r[s]=a,void(n[a]=s);r[s]=l,n[l]=s,s=o}},e.PriorityQHeap.prototype.floatUp_=function(t){for(var r=this.heap_,i=this.verts_,n=this.handles_,s=t,a=r[s];;){var o=s>>1,l=r[o];if(0===o||e.geom.vertLeq(i[l],i[a]))return r[s]=a,void(n[a]=s);r[s]=l,n[l]=s,s=o}},e.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},e.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},e.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e},void 0!==(r=t())&&(e.exports=r)}));const f=s.n.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");class p{constructor(){this._currentVertexIndex=0,this._indexCounter=0,this._triangleIndices=[-1,-1,-1],this.glu=new d.GluTesselator,this.glu.gluTessCallback(d.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this)),this.glu.gluTessCallback(d.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this)),this.glu.gluTessCallback(d.gluEnum.GLU_TESS_END,this._endcallback.bind(this)),this.glu.gluTessCallback(d.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this)),this.glu.gluTessCallback(d.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this)),this.glu.gluTessCallback(d.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this)),this.glu.gluTessProperty(d.gluEnum.GLU_TESS_WINDING_RULE,d.windingRule.GLU_TESS_WINDING_ODD)}beginPolygon(e,t){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0,this._indexCounter=0,this.glu.gluTessBeginPolygon(e),this._indices=t}endPolygon(){this.glu.gluTessEndPolygon()}beginContour(){this.glu.gluTessBeginContour()}endContour(){this.glu.gluTessEndContour()}addVertex(e,t){this.glu.gluTessVertex(e,t)}_vertexCallback(e,t){if(t[t.length]=e[0],t[t.length]=e[1],this._triangleIndices[this._currentVertexIndex]=-1,this._currentVertexIndex>=2){for(let e=0;e<3;e++)-1===this._triangleIndices[e]&&(this._triangleIndices[e]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[e];this._currentVertexIndex=0}else this._currentVertexIndex++}_begincallback(){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0}_endcallback(){this._currentVertexIndex=0}_errorcallback(e){f.error(`Encountered error during tesselation: ${e}`)}_combinecallback(e){return[e[0],e[1],e[2]]}_edgeCallback(){}}function y(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function g(e,t){return Math.sqrt(e*e+t*t)}function m(e){const t=g(e[0],e[1]);e[0]/=t,e[1]/=t}function b(e,t){return g(e[0]-t[0],e[1]-t[1])}function _(e){return"function"==typeof e}function x(e){return 1/Math.max(e,1)}function v(e,t,r){S.trackDistance=null!=t.trackDistance&&t.trackDistance,S.wrapDistance=null!=t.wrapDistance?t.wrapDistance:65535,S.thin=null!=t.thin&&t.thin,S.initialDistance=null!=t.initialDistance?t.initialDistance:0,S.enableOuterBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,S.outerBisectorAutoSplitThreshold=null!=t.outerBisectorAutoSplitThreshold?t.outerBisectorAutoSplitThreshold:0,S.enableInnerBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,S.innerBisectorAutoSplitThreshold=null!=t.innerBisectorAutoSplitThreshold?t.innerBisectorAutoSplitThreshold:0,I=e,T=r,j=0,E=0,A=0,M=!1,R=null,F=null,C.currentVertex.x=null,C.currentVertex.y=null,C.distance=S.initialDistance;const i=I[0],n=I[I.length-1];C.canSplit=!1,C.closed=i.x===n.x&&i.y===n.y,I.length<2||2===I.length&&C.closed||(S.thin?S.trackDistance?function(){for(D(),L(),B(1);E-A>S.wrapDistance||j<I.length;)D(),L(),B(2),T.bridge(C),C.leftExit0=C.rightExit0,C.leftExit2=C.rightExit2}():function(){for(;j<I.length;){if(j>0&&(C.inbound.x=C.outbound.x,C.inbound.y=C.outbound.y),j<I.length-1){C.outbound.x=I[j+1].x-I[j].x,C.outbound.y=I[j+1].y-I[j].y;const e=Math.sqrt(C.outbound.x*C.outbound.x+C.outbound.y*C.outbound.y);C.distance+=e,C.outbound.x/=e,C.outbound.y/=e}else C.outbound.x=C.inbound.x,C.outbound.y=C.inbound.y;0===j&&(C.inbound.x=C.outbound.x,C.inbound.y=C.outbound.y),C.currentVertex.x=I[j].x,C.currentVertex.y=I[j].y,C.prevNormal.x=-C.inbound.y,C.prevNormal.y=C.inbound.x,C.nextNormal.x=-C.outbound.y,C.nextNormal.y=C.outbound.x,0===j?(T.vertex(C),C.leftEntry0=C.entry0,C.leftEntry2=C.entry2,C.leftExit0=C.exit0,C.leftExit2=C.exit2):(T.vertex(C),C.rightEntry0=C.entry0,C.rightEntry2=C.entry2,C.rightExit0=C.exit0,C.rightExit2=C.exit2,T.bridge(C),C.leftExit0=C.rightExit0,C.leftExit2=C.rightExit2),++j}}():S.enableOuterBisectorSplit||S.outerBisectorAutoSplitThreshold>0||S.enableInnerBisectorSplit||S.innerBisectorAutoSplitThreshold>0?(C.canSplit=!0,function(){for(D(),N(),C.splitInner=C.gapInner=C.splitOuter=C.gapOuter=!1,P(1),C.closure0=C.leftEntry0,C.closure1=C.leftEntry1,C.closure2=C.leftEntry2;E-A>S.wrapDistance||j<I.length-1||j<I.length&&(!C.closed||S.trackDistance);)D(),N(),C.splitInner=C.gapInner=C.splitOuter=C.gapOuter=!1,P(2),T.bridge(C),C.leftExit0=C.rightExit0,C.leftExit1=C.rightExit1,C.leftExit2=C.rightExit2;C.closed&&!S.trackDistance&&(C.rightEntry0=C.closure0,C.rightEntry1=C.closure1,C.rightEntry2=C.closure2,T.bridge(C),C.leftExit0=C.rightExit0,C.leftExit1=C.rightExit1,C.leftExit2=C.rightExit2)}()):function(){for(D(),N(),P(1),C.closure0=C.leftEntry0,C.closure1=C.leftEntry1,C.closure2=C.leftEntry2;E-A>S.wrapDistance||j<I.length-1||j<I.length&&(!C.closed||S.trackDistance);)D(),N(),P(2),T.bridge(C),C.leftExit0=C.rightExit0,C.leftExit1=C.rightExit1,C.leftExit2=C.rightExit2;C.closed&&!S.trackDistance&&(C.rightEntry0=C.closure0,C.rightEntry1=C.closure1,C.rightEntry2=C.closure2,T.bridge(C),C.leftExit0=C.rightExit0,C.leftExit1=C.rightExit1,C.leftExit2=C.rightExit2)}())}function w(){I=null,T=null}function O(){if(C.cosine<S.innerBisectorAutoSplitThreshold){C.splitInner=!0,C.gapInner=!0;const e=Math.max(S.innerBisectorAutoSplitThreshold,C.cosine),t=Math.sqrt(1-e*e)/e;C.leftInner.x=C.nextNormal.x+C.sign*t*C.outbound.x,C.leftInner.y=C.nextNormal.y+C.sign*t*C.outbound.y,C.rightInner.x=C.prevNormal.x-C.sign*t*C.inbound.x,C.rightInner.y=C.prevNormal.y-C.sign*t*C.inbound.y}else S.enableInnerBisectorSplit&&(C.splitInner=!0,C.gapInner=!1,C.leftInner.x=C.rightInner.x=C.bisector.x/C.cosine,C.leftInner.y=C.rightInner.y=C.bisector.y/C.cosine);if(C.cosine<S.outerBisectorAutoSplitThreshold){C.splitOuter=!0,C.gapOuter=!0;const e=Math.max(S.outerBisectorAutoSplitThreshold,C.cosine),t=Math.sqrt(1-e*e)/e;C.leftOuter.x=C.prevNormal.x-C.sign*t*C.inbound.x,C.leftOuter.y=C.prevNormal.y-C.sign*t*C.inbound.y,C.rightOuter.x=C.nextNormal.x+C.sign*t*C.outbound.x,C.rightOuter.y=C.nextNormal.y+C.sign*t*C.outbound.y}else S.enableOuterBisectorSplit&&(C.splitOuter=!0,C.gapOuter=!1,C.leftOuter.x=C.rightOuter.x=C.bisector.x/C.cosine,C.leftOuter.y=C.rightOuter.y=C.bisector.y/C.cosine)}let I;const S={};let T,j,E,A,M,R,F;const C=new class{constructor(){this.closed=void 0,this.isFirstVertex=void 0,this.isLastVertex=void 0,this.isCap=void 0,this.currentVertex={x:void 0,y:void 0},this.inbound={x:void 0,y:void 0},this.outbound={x:void 0,y:void 0},this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.bisector={x:void 0,y:void 0},this.leftInner={x:void 0,y:void 0},this.rightInner={x:void 0,y:void 0},this.leftOuter={x:void 0,y:void 0},this.rightOuter={x:void 0,y:void 0}}};function D(){if(M)return C.distance=0,C.isCap=C.isFirstVertex=C.isLastVertex=!1,void(M=!1);if(0===E)if(C.isFirstVertex=0===j,F=I[j],0===j){if(E=0,C.closed){C.inbound.x=F.x-I[I.length-2].x,C.inbound.y=F.y-I[I.length-2].y;const e=Math.sqrt(C.inbound.x*C.inbound.x+C.inbound.y*C.inbound.y);C.inbound.x/=e,C.inbound.y/=e}}else C.inbound.x=F.x-R.x,C.inbound.y=F.y-R.y,E=Math.sqrt(C.inbound.x*C.inbound.x+C.inbound.y*C.inbound.y),C.inbound.x/=E,C.inbound.y/=E;if(C.distance+E-A<=S.wrapDistance){if(j<I.length-1){C.outbound.x=I[j+1].x-F.x,C.outbound.y=I[j+1].y-F.y;const e=Math.sqrt(C.outbound.x*C.outbound.x+C.outbound.y*C.outbound.y);C.outbound.x/=e,C.outbound.y/=e}else if(C.closed){C.outbound.x=I[1].x-F.x,C.outbound.y=I[1].y-F.y;const e=Math.sqrt(C.outbound.x*C.outbound.x+C.outbound.y*C.outbound.y);C.outbound.x/=e,C.outbound.y/=e}else C.outbound.x=C.inbound.x,C.outbound.y=C.inbound.y;return 0!==j||C.closed||(C.inbound.x=C.outbound.x,C.inbound.y=C.outbound.y),++j,C.isLastVertex=j===I.length,C.isCap=!C.closed&&(C.isFirstVertex||C.isLastVertex),C.distance+=E-A,E=0,A=0,M=C.distance+E-A===S.wrapDistance,C.currentVertex.x=F.x,C.currentVertex.y=F.y,R=F,void(F=null)}C.outbound.x=C.inbound.x,C.outbound.y=C.inbound.y,A+=S.wrapDistance-C.distance,C.distance=S.wrapDistance,M=!0;const e=A/E;C.currentVertex.x=(1-e)*R.x+e*F.x,C.currentVertex.y=(1-e)*R.y+e*F.y}function L(){C.prevNormal.x=-C.inbound.y,C.prevNormal.y=C.inbound.x,C.nextNormal.x=-C.outbound.y,C.nextNormal.y=C.outbound.x}function N(){L(),C.bisector.x=C.prevNormal.x+C.nextNormal.x,C.bisector.y=C.prevNormal.y+C.nextNormal.y;const e=Math.sqrt(C.bisector.x*C.bisector.x+C.bisector.y*C.bisector.y);if(e<.001)return C.bisector.x=void 0,C.bisector.y=void 0,C.cosine=0,void(C.sign=void 0);C.bisector.x/=e,C.bisector.y/=e,C.cosine=C.bisector.x*C.nextNormal.x+C.bisector.y*C.nextNormal.y,C.sign=C.prevNormal.x*C.nextNormal.y-C.prevNormal.y*C.nextNormal.x>=0?1:-1}function P(e){T.vertex(C),1===e?(C.leftEntry0=C.entry0,C.leftEntry1=C.entry1,C.leftEntry2=C.entry2,C.leftExit0=C.exit0,C.leftExit1=C.exit1,C.leftExit2=C.exit2):2===e&&(C.rightEntry0=C.entry0,C.rightEntry1=C.entry1,C.rightEntry2=C.entry2,C.rightExit0=C.exit0,C.rightExit1=C.exit1,C.rightExit2=C.exit2)}function B(e){T.vertex(C),1===e?(C.leftEntry0=C.entry0,C.leftEntry2=C.entry2,C.leftExit0=C.exit0,C.leftExit2=C.exit2):2===e&&(C.rightEntry0=C.entry0,C.rightEntry2=C.entry2,C.rightExit0=C.exit0,C.rightExit2=C.exit2)}class k{constructor(e,t){this.writeVertex=e,this.writeTriangle=t,this.capType=0,this.joinType=2,this.miterLimitCosine=x(2),this.roundLimitCosine=Math.cos(23*Math.PI/180),this.almostParallelCosine=.97,this.radsPerSlice=.8,this.textured=!1,this.joinOnUTurn=!1}vertex(e){const t=2===this.joinType?this.miterLimitCosine:this.roundLimitCosine,r=e.isCap&&0!==this.capType;let i=!1;e.cosine>this.almostParallelCosine?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):e.cosine<1-this.almostParallelCosine?(i=!e.isCap&&this.joinOnUTurn,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.canSplit?(O(),e.sign>0?(e.splitInner?(e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.leftInner.x,e.leftInner.y,0,-1,e.distance),e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.rightInner.x,e.rightInner.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(i=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.splitOuter?(i=i||e.gapOuter,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.leftOuter.x,-e.leftOuter.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.rightOuter.x,-e.rightOuter.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.splitInner?(e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.leftInner.x,-e.leftInner.y,0,1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.rightInner.x,-e.rightInner.y,0,1,e.distance)):e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(i=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.splitOuter?(i=i||e.gapOuter,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.leftOuter.x,e.leftOuter.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.rightOuter.x,e.rightOuter.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance))):e.sign>0?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(i=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(i=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance));const n=e.canSplit&&(e.splitInner||e.splitOuter);let s;if(s=e.entry1=e.exit1=n||i||r?this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,0,0,0,0,e.distance):null,i&&1!==this.joinType)this.writeTriangle(s,e.sign>0?e.exit2:e.entry0,e.sign>0?e.entry2:e.exit0);else if(r&&1===this.capType||i&&1===this.joinType){let t,r,i,n,a,o;if(e.isCap){const s=Math.PI;a=Math.ceil(s/this.radsPerSlice),o=s/a,e.isFirstVertex?(t=e.prevNormal.x,r=e.prevNormal.y,i=e.entry0,n=e.entry2):e.isLastVertex&&(t=-e.nextNormal.x,r=-e.nextNormal.y,i=e.exit2,n=e.exit0)}else{const s=2*Math.acos(e.cosine);a=Math.ceil(s/this.radsPerSlice),o=s/a,t=e.sign>0?-e.prevNormal.x:e.nextNormal.x,r=e.sign>0?-e.prevNormal.y:e.nextNormal.y,i=e.sign>0?e.entry2:e.exit0,n=e.sign>0?e.exit2:e.entry0}const l=Math.cos(o),c=Math.sin(o),u=c*t+l*r;let h,d;t=l*t-c*r,r=u;for(let o=0;o<a;++o){if(h=d,o<a-1)if(e.isCap){const i=e.isFirstVertex?-1:1;d=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,t,r,i,0,e.distance)}else d=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,t,r,0,e.sign,e.distance);this.writeTriangle(0===o?i:h,s,o===a-1?n:d);const u=c*t+l*r;t=l*t-c*r,r=u}}else if(r&&2===this.capType){const t=e.isFirstVertex?1:-1;let r,i;this.textured?(r=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-t*e.inbound.x,e.prevNormal.y-t*e.inbound.y,-t,-1,e.distance),i=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-t*e.inbound.x,-e.prevNormal.y-t*e.inbound.y,-t,1,e.distance)):(r=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-t*e.inbound.x,e.prevNormal.y-t*e.inbound.y,0,-1,e.distance),i=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-t*e.inbound.x,-e.prevNormal.y-t*e.inbound.y,0,1,e.distance)),t>0?(this.writeTriangle(s,e.entry2,i),this.writeTriangle(s,i,r),this.writeTriangle(s,r,e.entry0)):(this.writeTriangle(s,i,e.exit2),this.writeTriangle(s,r,i),this.writeTriangle(s,e.exit0,r))}}bridge(e){this.writeTriangle(e.leftExit0,e.rightEntry0,null!=e.leftExit1?e.leftExit1:e.leftExit2),this.writeTriangle(e.rightEntry0,null!=e.rightEntry1?e.rightEntry1:e.rightEntry2,null!=e.leftExit1?e.leftExit1:e.leftExit2),null!=e.leftExit1&&null!=e.rightEntry1?(this.writeTriangle(e.leftExit1,e.rightEntry1,e.leftExit2),this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)):null!=e.leftExit1?this.writeTriangle(e.leftExit1,e.rightEntry2,e.leftExit2):null!=e.rightEntry1&&this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return we})),r.d(t,"b",(function(){return Oe}));r(18),r(163),r(87),r(139);var i=r(0),n=r(1),s=r(9),a=r(4),o=r(84),l=r(113),c=r(40),u=r(314),h=r(122),d=r(106),f=r(337),p=r(344),y=r(327),g=r(313),m=(r(312),r(316)),b=r(343),_=r(339),x=r(83),v=r(322),w=r(10),O=r(17);function I(e){if(!e)return null;if("mesh"===e.type)return e.toJSON();let t=null;const r=e.spatialReference,n=Object(i.aq)(r);if(!n)return e.toJSON();const a=r.isWebMercator?102100:4326,o=d.e[a].maxX,l=d.e[a].minX,c=d.e[a].plus180Line,u=d.e[a].minus180Line;let h;const f=e.toJSON();if(Object(s.d)(f))h=S(f,o,l);else if(Object(s.f)(f))f.points=f.points.map((e=>S(e,o,l))),h=f;else if(Object(s.g)(f))h=function(e,t){if(!t)return e;const r=function(e,t){const r=[],{ymin:i,ymax:n}=e,s=e.xmax-e.xmin,a=e.xmin,o=e.xmax;let l;const[c,u]=t.valid;l=T(e.xmin,t);const h=l.x,d=l.frameId;l=T(e.xmax,t);const f=l.x,p=l.frameId,y=h===f&&s>0;if(s>2*u){const e={xmin:a<o?h:f,ymin:i,xmax:u,ymax:n},t={xmin:c,ymin:i,xmax:a<o?f:h,ymax:n},s={xmin:0,ymin:i,xmax:u,ymax:n},l={xmin:c,ymin:i,xmax:0,ymax:n},y=[],g=[];j(e,s)&&y.push(d),j(e,l)&&g.push(d),j(t,s)&&y.push(p),j(t,l)&&g.push(p);for(let e=d+1;e<p;e++)y.push(e),g.push(e);r.push({extent:e,frameIds:[d]},{extent:t,frameIds:[p]},{extent:s,frameIds:y},{extent:l,frameIds:g})}else h>f||y?r.push({extent:{xmin:h,ymin:i,xmax:u,ymax:n},frameIds:[d]},{extent:{xmin:c,ymin:i,xmax:f,ymax:n},frameIds:[p]}):r.push({extent:{xmin:h,ymin:i,xmax:f,ymax:n},frameIds:[d]});return r}(e,t).map((e=>e.extent));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}(f,n);else if(Object(s.h)(f)||Object(s.c)(f)){const e=M;Object(i.ca)(e,f);const r={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},n=Object(d.c)(r.xmin,l)*(2*o),s=0===n?f:function(e,t){const r=Object(d.f)(e);for(const e of r)for(const r of e)r[0]+=t;return e}(f,n);r.xmin+=n,r.xmax+=n,Object(i.cb)(r,c)&&r.xmax!==o||Object(i.cb)(r,u)&&r.xmin!==l?t=s:h=s}else h=e.toJSON();return null!==t?(new A).cut(t,o):h}function S(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const r=Object(d.c)(i,t);e[0]=i+r*(-2*t)}else if(i<r){const t=Object(d.c)(i,r);e[0]=i+t*(-2*r)}}else{const i=e.x;if(i>t){const r=Object(d.c)(i,t);e.x+=r*(-2*t)}else if(i<r){const t=Object(d.c)(i,r);e.x+=t*(-2*r)}}return e}function T(e,t){const[r,i]=t.valid,n=2*i;let s,a=0;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n,a=s):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n,a=-s),{x:e,frameId:a}}function j(e,t){const{xmin:r,ymin:i,xmax:n,ymax:s}=t;return E(e,r,i)&&E(e,r,s)&&E(e,n,s)&&E(e,n,i)}function E(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}class A{cut(e,t){let r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}const i=r.length,n=-2*t;for(let e=0;e<i;e++){const t=r[e];if(t&&t.length>=this.minPts){const e=[];for(const r of t)e.push([r[0]+n,r[1]]);r.push(e)}}return this.closed?e.rings=r:e.paths=r,e}}const M=Object(o.f)();function R(e,t,r){if(!e.allDirty)if(null!=e.from&&null!=e.count){const i=Math.min(e.from,t),n=Math.max(e.from+e.count,t+r)-i;e.from=i,e.count=n}else e.from=t,e.count=r}class F{constructor(){this._dirties=Object(g.u)((()=>({indices:{from:null,count:null,allDirty:!1}})),(()=>({vertices:{from:null,count:null,allDirty:!1}})))}hasDirty(){for(const e of this._dirties)if(null!==e.data.indices.count||e.data.indices.allDirty)return!0;return!1}markAllClean(){for(const e of this._dirties){e.data.indices.from=null,e.data.indices.count=null,e.data.indices.allDirty=!1;for(const t in e.buffers)e.buffers[t].data.vertices.from=null,e.buffers[t].data.vertices.count=null,e.buffers[t].data.vertices.allDirty=!1}}markAllDirty(){for(const e of this._dirties){e.data.indices.allDirty=!0;for(const t in e.buffers)e.buffers[t].data.vertices.allDirty=!0}}forEach(e){for(let t=0;t<this._dirties.length;++t){const r=this._dirties[t],i={};for(const e in r.buffers){const t=r.buffers[e].data.vertices;(t.allDirty||null!=t.from&&null!=t.count&&t.count>0)&&(i[e]=t)}const n=r.data.indices;let s;s=n.allDirty||null!=n.from&&null!=n.count&&n.count>0?{indices:n,vertices:i}:{indices:null,vertices:i},(s.indices||Object.keys(s).length>0)&&e(s,t)}}markDirtyIndices(e,t,r){R(this._dirties[e].data.indices,t,r)}markDirtyVertices(e,t,r,i){R(this._dirties[e].buffers[t].data.vertices,r,i)}}class C{constructor(e){this._largestRange=null,this._parent=e,this._updateLargestRange()}get largestRange(){return this._largestRange}rangeCreated(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}rangeResized(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}findBestRange(e){let t=this._parent._freeHead,r=null;for(;null!==t;)t.count>=e&&(!r||t.count-e<r.count-e)&&(r=t),t=t.next;return r}findAdjacentRanges(e,t){let r=!0,i=!1,n=null,s=this._parent._freeHead;for(;r&&!i;){const a=null!==n?n.from+n.count:0,o=null!==s?s.from:this._parent._size;e>=a&&e+t<=o?(r=!1,i=!0):null!==s?(n=s,s=s.next):r=!1}return[n,s]}_updateLargestRange(){let e=null,t=this._parent._freeHead;for(;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}class D{constructor(e,t){this._allocated=0,this._size=e,this._freeHead=e>0?{from:0,count:e,prev:null,next:null}:null,this._bookKeeper=t||new C(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}allocate(e){const t=this._bookKeeper.findBestRange(e);if(null===t)return-1;const r=t.from,i=t.count;if(t.from+=e,t.count-=e,this._bookKeeper.rangeResized(t,r,i),this._allocated+=e,0===t.count){const e=null!==t.prev?this._freeHead:t.next;D._removeRange(t),this._freeHead=e}return r}free(e,t){const[r,i]=this._bookKeeper.findAdjacentRanges(e,t),n={from:e,count:t,prev:r,next:i};if(null!==r&&(r.next=n),null!==i&&(i.prev=n),this._bookKeeper.rangeCreated(n),this._allocated-=t,null!==i&&n.from+n.count===i.from){const e=n.from,t=n.count;D._fuse(n,i),D._removeRange(i),this._bookKeeper.rangeResized(n,e,t),this._bookKeeper.rangeResized(i,void 0,0)}if(null!==r&&r.from+r.count===n.from){const e=r.from,t=r.count;D._fuse(r,n),D._removeRange(n),this._bookKeeper.rangeResized(r,e,t),this._bookKeeper.rangeResized(n,void 0,0)}this._freeHead=null!==n.prev?this._freeHead:n}get fragmentation(){const e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}static _removeRange(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}static _fuse(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}const L=["FILL","LINE","MARKER","TEXT","LABEL"];class N{constructor(e,t,r,i){this._strides=e,this._displayList=t,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=r;for(const t in e){this._freeListsAndStorage[t]={vtxFreeList:i?new D(i):null,idxFreeList:i?new D(i):null,vertexBuffers:{},indexBuffer:i?new Uint32Array(i):null};for(const r in e[t])this._freeListsAndStorage[t].vertexBuffers[r]={data:i?Object(g.j)(i,e[t][r]):null,stride:e[t][r]}}}static fromTileData(e,t){const r=function(e){const t=e.getStrides(),r={};for(let e=0;e<t.length;e++)r[L[e]]=t[e];return r}(e),i=[0,0,0,0,0],n=[0,0,0,0,0],s=e.tileDisplayData.displayObjects;for(const e of s)for(const t of e.displayRecords)i[t.geometryType]=Math.max(i[t.geometryType],t.vertexFrom+t.vertexCount),n[t.geometryType]=Math.max(n[t.geometryType],t.indexFrom+t.indexCount);const a=new N(r,e.tileDisplayData.displayList,t,null);for(let t=0;t<e.tileBufferData.geometries.length;++t){const r=i[t],s=n[t],o=e.tileBufferData.geometries[t],l=L[t],c=a._storageFor(l),u=e.tileBufferData.geometries[t].indexBuffer;let h;c.indexBuffer=u,c.idxFreeList=new D(u.length),c.idxFreeList.allocate(s);for(const r in o.vertexBuffer){const i=e.tileBufferData.geometries[t].vertexBuffer[r];c.vertexBuffers[r].data=i.data,c.vertexBuffers[r].stride=i.stride;const n=Object(g.b)(i.stride),s=i.data.length*n/i.stride;h||(h=s)}c.vtxFreeList=new D(h),c.vtxFreeList.allocate(r)}return a}delete(e){const t=L[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}setMeshData(e,t,r,i,n){const s=L[e.geometryType];let a,o;e.meshData=null,void 0===e.vertexFrom?(o=t.vertexCount,a=this._allocateVertices(s,o)):t.vertexCount>e.vertexCount?(this._freeVertices(s,e.vertexFrom,e.vertexCount),o=t.vertexCount,a=this._allocateVertices(s,o)):t.vertexCount===e.vertexCount?(a=e.vertexFrom,o=e.vertexCount):(this._freeVertices(s,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),a=e.vertexFrom,o=t.vertexCount);let l,c,u,h=!0;if(void 0===e.indexFrom?(l=n,u=t.indexCount,c=this._allocateIndices(s,u)):t.indexCount>e.indexCount?(l=this._displayList.removeFromList(e),this._freeIndices(s,e.indexFrom,e.indexCount),u=t.indexCount,c=this._allocateIndices(s,u)):t.indexCount===e.indexCount?(h=!1,c=e.indexFrom,u=e.indexCount):(l=this._displayList.removeFromList(e),this._freeIndices(s,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),c=e.indexFrom,u=t.indexCount),-1!==a&&-1!==c){const n=this._storageFor(s);if(Object(g.o)(a,c,n.vertexBuffers,n.indexBuffer,t,r,i),e.vertexFrom=a,e.indexFrom=c,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in r)this._dirtyMap.markDirtyVertices(e.geometryType,t,e.vertexFrom,e.vertexCount)}return h&&this._displayList.addToList(e,l),!0}return-1!==a&&this._freeVertices(s,a,o),-1!==c&&this._freeIndices(s,c,u),e.setMeshDataFromBuffers(t,r,i),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}tryAddMeshData(e,t){const r=t.vertexBuffer,i=t.indexBuffer,n=L[e.geometryType],s=this._allocateVertices(n,e.vertexCount);if(-1===s)return this._freeVertices(n,s,e.vertexCount),!1;const a=this._allocateIndices(n,e.indexCount);if(-1===a)return this._freeVertices(n,s,e.vertexCount),this._freeIndices(n,a,e.indexCount),!1;const o=this._storageFor(n);if(Object(g.o)(s,a,o.vertexBuffers,o.indexBuffer,e,r,i),e.vertexFrom=s,e.indexFrom=a,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in r)this._dirtyMap.markDirtyVertices(e.geometryType,t,s,e.vertexCount)}return this._displayList.addToList(e),!0}_allocateVertices(e,t){const r=this._storageFor(e),i=r.vtxFreeList.allocate(t);return-1===i||r.vtxFreeList.fragmentation>.5?-1:i}_freeVertices(e,t,r){this._storageFor(e).vtxFreeList.free(t,r)}_freeIndices(e,t,r){this._storageFor(e).idxFreeList.free(t,r)}_allocateIndices(e,t){const r=this._storageFor(e),i=r.idxFreeList.allocate(t);return-1===i||r.idxFreeList.fragmentation>.5?-1:i}_storageFor(e){return this._freeListsAndStorage[e]}_stridesFor(e,t){return this._strides[e][t]}}class P{constructor(e){this.geometryMap=Object(g.u)((()=>({indexBuffer:m.e.createIndex(e,35044),vao:null})),((t,r)=>({vertexBuffer:m.e.createVertex(e,g.p[r])})))}dispose(){for(let e=0;e<5;e++){const t=this.geometryMap[e];if(t){t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose();for(const e in t.buffers)t.buffers[e]&&t.buffers[e].data.vertexBuffer.dispose()}}}get(e){const t=this.geometryMap[e];return{draw(e,r,i,n,s){if(!t.data.vao){const n={};for(const e in t.buffers)n[e]=t.buffers[e].data.vertexBuffer;t.data.vao=new m.a(e,i,r,n,t.data.indexBuffer)}const a=t.data.vao;e.bindVAO(a),e.drawElements(4,s,5125,Uint32Array.BYTES_PER_ELEMENT*n),e.bindVAO(null)}}}has(e){return null!=this.geometryMap[e]}upload(e,t){t.forEach(((t,r)=>{this._upload(t,r,e)}))}_upload(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){const i=e.vertices;for(const e in i){const n=i[e];n.allDirty?this._uploadVertices(r,t,e):null!=n.from&&null!=n.count&&this._uploadVertices(r,t,e,n.from,n.count)}}}_uploadVertices(e,t,r,i,n){const s=this.geometryMap[t];if(!s)return;const a=e.geometries[t].vertexBuffer[r];if(!a)return;const o=a.stride,l=a.data.buffer;s.buffers[r]&&l.byteLength>0&&(null!=i&&null!=n?s.buffers[r].data.vertexBuffer.setSubData(l,i*o,i*o,(i+n)*o):s.buffers[r].data.vertexBuffer.setData(l))}_uploadIndices(e,t,r,i){const n=this.geometryMap[t];if(!n)return;const s=e.geometries[t].indexBuffer.buffer;n.data.indexBuffer&&s.byteLength>0&&(null!=r&&null!=i?n.data.indexBuffer.setSubData(s,4*r,4*r,4*(r+i)):n.data.indexBuffer.setData(s))}}class B extends b.b{constructor(){super(...arguments),this._data=null,this._displayList=null,this._lastCommitTime=0,this._hasData=!1,this._invalidated=!1,this._wglBuffers=null,this._dirtyMap=new F}destroy(){super.destroy(),this.clear()}get hasData(){return!!this._hasData}get displayObjects(){var e;return null!=(e=this._displayObjects)?e:[]}getGeometry(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}getDisplayList(){return this._displayList}patch(e){if(!0===e.clear)return this.clear(),void(this._hasData=!1);const t=e.addOrUpdate,r=e.remove;!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(),this._dirtyMap=new F,this._dispRecStore=N.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||r.length)?this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}commit(e){e.time&&e.time===this._lastCommitTime||(this._lastCommitTime=e.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new P(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean())))}clear(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}_doPatchData(e){this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=N.fromTileData(this._data,this._dirtyMap)),this.requestRender()}_patchData(e){let t=!0;const r=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],i=(e.remove||[]).slice();for(const e of r)null!=e.insertAfter&&i.push(e.id);for(const e of i){const t=this._data.tileDisplayData.displayObjectRegistry.get(e);if(t){this._data.tileDisplayData.displayList.removeFromList(t.displayRecords);for(const e of t.displayRecords)this._dispRecStore.delete(e);this._data.tileDisplayData.displayObjectRegistry.delete(e);const r=this._data.tileDisplayData.displayObjects.indexOf(t);this._data.tileDisplayData.displayObjects.splice(r,1)}}for(const i of r){let r,n=this._data.tileDisplayData.displayObjectRegistry.get(i.id);if(n){const e=n.displayRecords;n.set(i),n.displayRecords=e;const t=n.displayRecords.length;for(let e=0;e<t;++e){const t=n.displayRecords[e],r=i.displayRecords[e];(e>=i.displayRecords.length||t.geometryType!==r.geometryType||t.symbolLevel!==r.symbolLevel||t.zOrder!==r.zOrder||t.materialKey!==r.materialKey)&&(this._dispRecStore.delete(n.displayRecords[e]),e<i.displayRecords.length&&(n.displayRecords[e]=void 0))}n.displayRecords.length=i.displayRecords.length}else{let e;n=i.copy(),n.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(i.id,n);const t=this._data.tileDisplayData.displayObjects;if(null!=n.insertAfter)if(r={},n.insertAfter>=0){const r=this._data.tileDisplayData.displayObjectRegistry.get(n.insertAfter);r?(e=t.indexOf(r)+1,e<t.length?t.splice(e,0,n):(t.push(n),e=t.length)):(t.push(n),e=t.length)}else t.unshift(n),e=0;else t.push(n),e=t.length;if(r){const n=i.displayRecords.length>0?1:0;let s=0;for(let i=e-1;i>=0&&s<n;--i)for(let e=t[i].displayRecords.length-1;e>=0&&s<n;--e){const n=t[i].displayRecords[e],a=this._data.tileDisplayData.displayList.getDPInfoType();r[a]||(r[a]=n,++s)}}}const s=i.displayRecords.length;for(let a=0;a<s;++a){const s=i.displayRecords[a];let o=n.displayRecords[a];o?(o.meshData=s.meshData,o.materialKey=s.materialKey):(o=s.copy(),o.vertexFrom=void 0,o.indexFrom=void 0,n.displayRecords[a]=o);const l=s.geometryType,c=this._data.tileDisplayData.displayList.getDPInfoType(),u=e.addOrUpdate.tileBufferData.geometries[l],h=u.vertexBuffer,d=u.indexBuffer;let f;r&&(f=r[c]?this._data.tileDisplayData.displayList.splitAfter(r[c]):-1),t=this._dispRecStore.setMeshData(o,s,h,d,f)&&t,r&&null!=o.indexFrom&&null!=o.indexFrom&&(r[c]=o)}}return t}}class k{constructor(){this._byGeometryType=null}get satisfied(){return!this._byGeometryType}reset(){this._byGeometryType=null}verticesFor(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}indicesFor(e){return this._byGeometryType?this._byGeometryType[e].indices:0}needMore(e,t,r){if(!t&&!r)return;this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);const i=this._byGeometryType[e];i.vertices+=t,i.indices+=r}}class U{constructor(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}clone(){const e=new U;for(let t=0;t<this.geometries.length;t++){const r=this.geometries[t],i=e.geometries[t];i.indexBuffer=r.indexBuffer.slice(),i.vertexBuffer={};for(const e in r.vertexBuffer){const{data:t,stride:n}=r.vertexBuffer[e];i.vertexBuffer[e]={data:t.slice(),stride:n}}}return e}static deserialize(e){const t=new U;for(let r=0;r<5;++r){t.geometries[r].indexBuffer=new Uint32Array(e.geometries[r].indexBuffer),t.geometries[r].vertexBuffer={};for(const i in e.geometries[r].vertexBuffer)t.geometries[r].vertexBuffer[i]={data:Object(g.q)(e.geometries[r].vertexBuffer[i].data,e.geometries[r].vertexBuffer[i].stride),stride:e.geometries[r].vertexBuffer[i].stride}}return t}serialize(){const e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]};for(let t=0;t<5;++t)for(const r in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[r]={data:this.geometries[t].vertexBuffer[r].data.buffer,stride:this.geometries[t].vertexBuffer[r].stride};return e}getBuffers(){const e=[];for(let t=0;t<5;++t){e.push(this.geometries[t].indexBuffer.buffer);for(const r in this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[r].data.buffer)}return e}}class z{constructor(){this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}clear(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}update(e,t,r){for(const t in e)this.vertexData.set(t,e[t]);for(const t in this.vertexData)null===e[t]&&this.vertexData.delete(t);this.vertexCount=t,this.indexData=r}}class V{constructor(e,t,r,i=0,n=0){this.id=e,this.geometryType=t,this.materialKey=r,this.minZoom=i,this.maxZoom=n,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}get sortKey(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}clone(){return this.copy()}copy(){const e=new V(this.id,this.geometryType,this.materialKey);return e.vertexFrom=this.vertexFrom,e.vertexCount=this.vertexCount,e.indexFrom=this.indexFrom,e.indexCount=this.indexCount,e.zOrder=this.zOrder,e.symbolLevel=this.symbolLevel,e.meshData=this.meshData,e.minZoom=this.minZoom,e.maxZoom=this.maxZoom,e}setMeshDataFromBuffers(e,t,r){const i=new z;for(const r in t){const n=t[r].stride,s=t[r].data,a=[],o=Object(g.b)(n);for(let t=0;t<n*e.vertexCount/o;++t)a[t]=s[t+n*e.vertexFrom/o];i.vertexData.set(r,a)}i.indexData.length=0;for(let t=0;t<e.indexCount;++t)i.indexData[t]=r[t+e.indexFrom]-e.vertexFrom;i.vertexCount=e.vertexCount,this.meshData=i}readMeshDataFromBuffers(e,t){this.meshData?this.meshData.clear():this.meshData=new z;for(const t in e){const r=e[t].stride,i=e[t].data,n=[],s=Object(g.b)(r);for(let e=0;e<r*this.vertexCount/s;++e)n[e]=i[e+r*this.vertexFrom/s];this.meshData.vertexData.set(t,n)}this.meshData.indexData.length=0;for(let e=0;e<this.indexCount;++e)this.meshData.indexData[e]=t[e+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(e,t,r,i){for(const r in t){const i=t[r].stride,n=this.meshData.vertexData.get(r),s=t[r].data,a=Object(g.b)(i);for(let t=0;t<i*this.meshData.vertexCount/a;++t)s[t+i*e/a]=n[t]}for(let t=0;t<this.meshData.indexData.length;++t)i[t+r]=this.meshData.indexData[t]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}static writeAllMeshDataToBuffers(e,t,r){let i=0,n=0;for(const s of e)s.writeMeshDataToBuffers(i,t,n,r),i+=s.vertexCount,n+=s.indexCount}_computeSortKey(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}serialize(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}static deserialize(e,t){const r=e.readInt32(),i=e.readInt32(),n=new V(t.id,r,i);return n.vertexFrom=e.readInt32(),n.vertexCount=e.readInt32(),n.indexFrom=e.readInt32(),n.indexCount=e.readInt32(),n.minZoom=e.readInt32(),n.maxZoom=e.readInt32(),n}}function G(e,t){if(null!==t){e.push(t.length);for(const r of t)r.serialize(e);return e}e.push(0)}class q{constructor(e){this.insertAfter=null,this.id=e,this.displayRecords=[]}copy(){const e=new q(this.id);return e.set(this),e}clone(){const e=new q(this.id);return e.displayRecords=this.displayRecords.map((e=>e.clone())),e.insertAfter=this.insertAfter,e}set(e){this.id=e.id,this.displayRecords=e.displayRecords,this.insertAfter=e.insertAfter}serialize(e){return e.push(this.id),G(e,this.displayRecords),e}static deserialize(e){const t=e.readInt32(),r=new q(t),i={id:t};return r.displayRecords=function(e,t,r){const i=e.readInt32(),n=new Array(i);for(let i=0;i<n.length;i++)n[i]=t.deserialize(e,r);return n}(e,V,i),r}}function H(e,t,r,...i){t<e.length?e.splice(t,r,...i):e.push(...i)}const W=new Map;W.set(g.d.MAP,[g.c.FILL,g.c.LINE,g.c.MARKER,g.c.TEXT]),W.set(g.d.LABEL,[g.c.LABEL]),W.set(g.d.LABEL_ALPHA,[g.c.LABEL]);class Z{constructor(){this.symbolLevels=[]}replay(e,t,r){for(const i of this.symbolLevels)for(const n of i.zLevels){const i=n.geometryDPInfo.unified;if(i)for(const n of i){const i=e.painter.getGeometryBrush(n.geometryType),s=t.getGeometry(n.geometryType),a={geometryType:n.geometryType,materialKey:n.materialKey,indexFrom:n.indexFrom,indexCount:n.indexCount,draw:(e,t,r)=>{s.draw(e,t,r,n.indexFrom,n.indexCount)}};i.prepareState(e,t),i.drawGeometry(e,t,a,r)}}}get empty(){return!this.symbolLevels||0===this.symbolLevels.length}clear(){this.symbolLevels.length=0}addToList(e,t){if(Array.isArray(e))for(const r of e)this._addToList(r,t);else this._addToList(e,t)}removeFromList(e){Array.isArray(e)||(e=[e]);let t=null;for(const r of e)t=this._removeFromList(r);return t}clone(){const e=new Z;for(const t of this.symbolLevels)e.symbolLevels.push(t.clone());return e}splitAfter(e){const t=this._getDisplayList(e.symbolLevel,e.zOrder),r=t.length,i=e.indexFrom+e.indexCount;for(let n=0;n<r;++n){const r=t[n];if(r.geometryType===e.geometryType&&i>r.indexFrom&&i<=r.indexFrom+r.indexCount){if(i<r.indexFrom+r.indexCount){const e=new X;e.geometryType=r.geometryType,e.materialKey=r.materialKey,e.indexFrom=i,e.indexCount=r.indexFrom+r.indexCount-i,t.splice(n+1,0,e),r.indexCount=i-r.indexFrom}return n}}}_addToList(e,t){const r=e.symbolLevel,i=e.zOrder,n=this._getDisplayList(r,i),s=null!=t?t:n.length-1,a=s>=0&&s<n.length?n[s]:null;if(null!==a&&a.materialKey===e.materialKey&&a.indexFrom+a.indexCount===e.indexFrom&&a.geometryType===e.geometryType)a.indexCount+=e.indexCount;else{const t=new X;t.indexFrom=e.indexFrom,t.indexCount=e.indexCount,t.materialKey=e.materialKey,t.geometryType=e.geometryType,H(n,s+1,0,t)}}_removeFromList(e){const t=e.symbolLevel,r=e.zOrder,i=this._getDisplayList(t,r),n=i.length;let s;for(let t=0;t<n;++t){const r=i[t];if(e.indexFrom+e.indexCount>r.indexFrom&&e.indexFrom<r.indexFrom+r.indexCount&&r.geometryType===e.geometryType){s=t;break}}if(void 0!==s){const t=i[s];if(e.indexFrom===t.indexFrom)return t.indexCount-=e.indexCount,t.indexFrom+=e.indexCount,0===t.indexCount&&H(i,s,1),s-1;if(e.indexFrom+e.indexCount===t.indexFrom+t.indexCount)return t.indexCount-=e.indexCount,0===t.indexCount?(H(i,s,1),s-1):s;{const r=t.indexFrom,n=e.indexFrom-t.indexFrom,a=e.indexCount,o=t.indexFrom+t.indexCount-(e.indexFrom+e.indexCount);t.indexCount=n;const l=new X;return l.geometryType=t.geometryType,l.materialKey=t.materialKey,l.indexFrom=r+n+a,l.indexCount=o,H(i,s+1,0,l),s}}return null}_getDisplayList(e,t){let r;const i=this.symbolLevels.length;for(let t=0;t<i;t++)if(this.symbolLevels[t].symbolLevel===e){r=this.symbolLevels[t];break}let n;r||(r=new Q,r.symbolLevel=e,this.symbolLevels.push(r));const s=r.zLevels.length;for(let e=0;e<s;e++)if(r.zLevels[e].zLevel===t){n=r.zLevels[e];break}return n||(n=new Y,n.geometryDPInfo=new J,n.zLevel=t,r.zLevels.push(n)),n.geometryDPInfo.unified||(n.geometryDPInfo.unified=[]),n.geometryDPInfo.unified}getDPInfoType(){return"unified"}}class X{constructor(){this.materialKey=null,this.indexFrom=0,this.indexCount=0}clone(){const e=new X;return e.geometryType=this.geometryType,e.materialKey=this.materialKey,e.indexFrom=this.indexFrom,e.indexCount=this.indexCount,e}}class J{constructor(){this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}clone(){const e=new J;return e.fill=this.fill&&this.fill.map((e=>e.clone())),e.line=this.line&&this.line.map((e=>e.clone())),e.marker=this.marker&&this.marker.map((e=>e.clone())),e.text=this.text&&this.text.map((e=>e.clone())),e.label=this.label&&this.label.map((e=>e.clone())),e.unified=this.unified&&this.unified.map((e=>e.clone())),e}}class Y{constructor(){this.geometryDPInfo=new J}clone(){const e=new Y;return e.zLevel=this.zLevel,e.geometryDPInfo=this.geometryDPInfo.clone(),e}}class Q{constructor(){this.zLevels=[]}clone(){const e=new Q;e.symbolLevel=this.symbolLevel;for(const t of this.zLevels)e.zLevels.push(t.clone());return e}}class K{constructor(){}get displayObjectRegistry(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(const e of this.displayObjects)this._displayObjectRegistry.set(e.id,e)}return this._displayObjectRegistry}get displayList(){return this._displayList}computeDisplayList(){this._displayList=new Z;for(const e of this.displayObjects)for(const t of e.displayRecords)this._displayList.addToList(t)}clone(){const e=new K;return this.displayObjects&&(e.displayObjects=this.displayObjects.map((e=>e.clone()))),e}serialize(e){return G(e,this.displayObjects),e}_deserializeObjects(e){const t=e.readInt32(),r=new Array(t),i=new Map;for(let t=0;t<r.length;++t){const n=q.deserialize(e);r[t]=n,i.set(n.id,n)}this.displayObjects=r,this._displayList=null,this._displayObjectRegistry=i}static deserialize(e){const t=new K;return t._deserializeObjects(e),t}}class ${constructor(e,t){this.data=e,this.stride=t}static decode(e){const t=Object(g.q)(e.data,e.stride),r=e.stride;return new $(t,r)}static fromVertexVector(e){const t=Object(g.q)(e.data.buffer(),e.stride),r=e.stride;return new $(t,r)}}class ee{constructor(e,t,r){this.geometryType=e,this.indexBuffer=new Uint32Array(t),this.namedBuffers=r}static decode(e){const t=e.geometryType,r=e.indexBuffer,i={};for(const t in e.namedBuffers)i[t]=$.decode(e.namedBuffers[t]);return new ee(t,r,i)}static fromVertexData(e,t){const r=e.indices,i=Object(g.q)(e.vertices,e.stride),n=e.stride,s={geometry:new $(i,n)};return new ee(t,r,s)}static fromVertexVectors(e){const t=e.geometryType,r=e.indexVector.buffer(),i={};for(const t in e.namedVectors)i[t]=$.fromVertexVector(e.namedVectors[t]);return new ee(t,r,i)}}class te{constructor(e,t){this.data=e,this.stride=t}get vertexCount(){const e=this.stride/4,t=this.data.length/e;return t!==(0|t)&&console.debug("Corrupted stride"),t}transfer(e,t){const r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)}}class re{constructor(e,t,r=!1){this.geometryType=e,this.indexVector=new p.d(Uint32Array,6*t),this.namedVectors={};const i=Object(g.l)(e,r);for(const e in i){const r=i[e];let n;switch(r%4){case 0:case 2:n=new p.d(Uint32Array,r*t);break;case 1:case 3:n=new p.d(Uint8Array,r*t)}this.namedVectors[e]=new te(n,r)}}get(e){return this.namedVectors[e].data}getVector(e){return this.namedVectors[e]}transfer(e,t){const r=this.indexVector.buffer(),i={};t.push(r);for(const e in this.namedVectors){const r=this.namedVectors[e];i[e]={},r.transfer(i[e],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=i,this.destroy()}intoBuffers(){const e=ee.fromVertexVectors(this);return this.destroy(),e}destroy(){this.indexVector=null,this.namedVectors=null}}const ie=new k,ne=new k;function se(e,t){const r={};for(const i in e){const n={data:Object(g.j)(t,e[i]),stride:e[i]};r[i]=n}return r}class ae{constructor(){this.tileDisplayData=null,this.tileBufferData=null}reshuffle(){ie.reset();const e=function(e){const t=[[],[],[],[],[]],r=e;for(const e of r)for(const r of e.displayRecords)t[r.geometryType].push(r);return t}(this.tileDisplayData.displayObjects);for(const t of e)for(const e of t)e&&ie.needMore(e.geometryType,e.meshData?e.meshData.vertexCount:e.vertexCount,e.meshData?e.meshData.indexData.length:e.indexCount);const t=e.length,r=new U;for(let e=0;e<t;++e){r.geometries[e].indexBuffer=new Uint32Array(Math.round(1.5*ie.indicesFor(e)));const t=[];for(const r in this.tileBufferData.geometries[e].vertexBuffer)t.push(this.tileBufferData.geometries[e].vertexBuffer[r].stride);const i=ae._computeVertexAlignment(t),n=Math.round(1.5*ie.verticesFor(e)),s=ae._align(n,i);for(const t in this.tileBufferData.geometries[e].vertexBuffer){const i=this.tileBufferData.geometries[e].vertexBuffer[t].stride;r.geometries[e].vertexBuffer[t]={stride:i,data:Object(g.j)(s,i)}}}ne.reset(),this.tileDisplayData.displayList.clear();for(let i=0;i<t;++i){const t=e[i];for(const e of t){if(e.meshData)e.writeMeshDataToBuffers(ne.verticesFor(i),r.geometries[i].vertexBuffer,ne.indicesFor(i),r.geometries[i].indexBuffer),e.meshData=null;else{const t=this.tileBufferData.geometries[i].vertexBuffer,n=this.tileBufferData.geometries[i].indexBuffer,s=r.geometries[i].vertexBuffer,a=r.geometries[i].indexBuffer,o=ne.verticesFor(i),l=ne.indicesFor(i);Object(g.o)(o,l,s,a,e,t,n),e.vertexFrom=o,e.indexFrom=l}ne.needMore(i,e.vertexCount,e.indexCount)}}for(const e of this.tileDisplayData.displayObjects)this.tileDisplayData.displayList.addToList(e.displayRecords);this.tileBufferData=r}getStrides(){const e=[];for(let t=0;t<this.tileBufferData.geometries.length;++t){const r=this.tileBufferData.geometries[t];e[t]={};for(const i in r.vertexBuffer)e[t][i]=r.vertexBuffer[i].stride}return e}clone(){const e=new ae;return e.tileBufferData=this.tileBufferData.clone(),e.tileDisplayData=this.tileDisplayData.clone(),e}_guessSize(){const{displayObjects:e}=this.tileDisplayData,t=Math.min(e.length,4);let r=0;for(let i=0;i<t;i++)r=Math.max(r,e[i].displayRecords.length);return 2*(12*e.length+e.length*r*40)}serialize(){const e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),r=this.tileDisplayData.serialize(new p.d(Int32Array,this._guessSize())).buffer();return t.push(r),{result:{displayData:r,bufferData:e},transferList:t}}static fromVertexData(e){const t=[],r={},n=new Map;return Object(g.w)((s=>{const a=e.data[s];if(Object(i.P)(a)){const e=p.c.from(a.records).getCursor();for(;e.next();){const r=e.id,i=e.materialKey,a=e.insertAfter,o=e.indexFrom,l=e.indexCount,c=e.vertexFrom,u=e.vertexCount;if(!n.has(r)){const e=new q(r);e.insertAfter=a,n.set(r,e),t.push(e)}const h=n.get(r),d=new V(r,s,i);d.indexFrom=o,d.indexCount=l,d.vertexFrom=c,d.vertexCount=u,h.displayRecords.push(d)}r[s]=ee.fromVertexData(a,s)}else r[s]=new re(s,0).intoBuffers()})),t.sort(((e,t)=>e.id-t.id)),ae.fromMeshData({displayObjects:t,vertexBuffersMap:r})}static fromMeshData(e){const t=new ae,r=new K,i=new U;r.displayObjects=e.displayObjects;for(const t in e.vertexBuffersMap){const r=e.vertexBuffersMap[t];i.geometries[t].indexBuffer=r.indexBuffer,i.geometries[t].vertexBuffer=r.namedBuffers}return t.tileDisplayData=r,t.tileBufferData=i,t}static bind(e,t){const r=new ae;return r.tileDisplayData=e,r.tileBufferData=t,r}static create(e,t){const r=new ae;r.tileDisplayData=new K,r.tileDisplayData.displayObjects=e;const i=[0,0,0,0,0],n=[0,0,0,0,0],s=[[],[],[],[],[]];for(const t of e)for(const e of t.displayRecords)s[e.geometryType].push(e),i[e.geometryType]+=e.meshData.vertexCount,n[e.geometryType]+=e.meshData.indexData.length;const a=new U,o=function(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(t);for(let e=0;e<5;e++){const t=new Uint32Array(n[e]),r=se(o[e],i[e]);V.writeAllMeshDataToBuffers(s[e],r,t),a.geometries[e]={indexBuffer:t,vertexBuffer:r}}return r.tileBufferData=a,r}static _align(e,t){const r=e%t;return 0===r?e:e+(t-r)}static _computeVertexAlignment(e){let t=!1,r=!1;for(const i of e)i%4==2?t=!0:i%4!=0&&(r=!0);return r?4:t?2:1}}class oe extends _.c{constructor(e,t){super(e,t,null)}static from(e){const t=v.a.createInstance(),r=[],i=e.filter((e=>!!e.geometry));for(const e of i){const t=Object(s.b)(e.geometry);Object(x.h)(r,[e],t,!1,!1,"uid")}return new oe(t,r)}get geometryType(){const e=this._current;return e?e.geometryType:null}get insertAfter(){return this._current.insertAfter}readGraphic(){return this._current}getCursor(){return this.copy()}copy(){const e=new oe(this.instance,this._features);return this.copyInto(e),e}}const le=new O.a,ce=new O.a,ue="esriGeometryPolyline";function he(e){e.coords.length=0,e.lengths.length=0}class de{constructor(){this.bounds=Object(o.f)(),this.graphic=null,this.size=[0,0,0,0]}static acquire(e=null,t,r,i,n,s){let a;return 0===de._pool.length?a=new de:(a=de._pool.pop(),this._set.delete(a)),a.acquire(e,t,r,i,n,s),a}static release(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}static getCentroidQuantized(e,t){if(Object(s.h)(e.geometry)){const r=e.symbol;if(Object(i.J)(r))return null;if(Object(f.g)(r.type)||Object(f.c)(r.type)){const r=Object(i.cc)(e.geometry);return Object(y.a)(t,{},{x:r[0],y:r[1]},!1,!1)}}return null}acquire(e=null,t,r,i,n,s){e&&this.set(e,t,r,i,n,s)}release(){this.graphic=null,this.symbolResource=null,this.geometry=null}get symbol(){return this.symbolResource.symbol}set(e,t,r,i,n,s){this.graphic=e,this.geometry=r,this.symbolResource=t,this.updateBounds(i,n,s)}updateBounds(e,t,r){Object(f.a)(this.bounds,this.size,this.symbolResource,this.geometry,e,t,r)}getGeometryQuantized(e){if(Object(s.h)(this.geometry)){const t=this.geometry.rings;if(1===t.length&&2===t[0].length)return Object(y.c)(e,{paths:[[t[0][0],t[0][1]]]})}else if(Object(s.c)(this.geometry))return he(le),he(ce),Object(x.i)(le,this.geometry),Object(x.s)(ce,le,this.geometry.hasZ,this.geometry.hasM,ue,e.scale[0]),Object(x.o)(le,ce,this.geometry.hasZ,this.geometry.hasM,ue,e),Object(x.b)(le,this.geometry.hasZ,this.geometry.hasM);return Object(y.c)(e,this.geometry)}}de._pool=[],de._set=new Set;const fe={minX:0,minY:0,maxX:0,maxY:0},pe=Object(o.f)(),ye=[],ge=1e-5;function me(e,t,r,i,n){return fe.minX=t,fe.minY=r,fe.maxX=i,fe.maxY=n,e.search(fe)}class be{constructor(e,t,r,s,a,o){this._graphics=s,this._onAdd=a,this._onRemove=o,this._index=Object(_.d)(9,Object(n.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this._itemByGraphic=new Map,this._currentLevel=-1/0,this._tileInfoView=e,this._uidFieldName=r;const l=e.getClosestInfoForScale(t);l&&(this._currentLevel=l.level,this._resolution=this._tileInfoView.getTileResolution(l.level));const c=e.spatialReference;this._metersPerUnit=Object(i.an)(c)?Object(w.c)(e.spatialReference):1}hitTest(e,t,r,n,l){e=Object(d.d)(e,this._tileInfoView.spatialReference);const c=.5*n*r;pe[0]=e-c,pe[1]=t-c,pe[2]=e+c,pe[3]=t+c;const u=.5*n*(r+f.j),h=me(this._index,e-u,t-u,e+u,t+u);if(!h||0===h.length)return[];const p={x:e,y:t},y=[];let g;for(const r of h)if(r.graphic.visible)switch(Object(s.b)(r.geometry)){case"esriGeometryPoint":{const e=r.symbol;if(!e)continue;const t=r.geometry,{x:s,y:a}=t,o=n*this._metersPerUnit;let c;switch(e.type){case"esriTS":c=Object(f.i)(s,a,e,r.size,n,l);break;case"expanded-cim":c=Object(f.h)(s,a,e,n,o,l);break;case"esriSMS":case"esriPMS":c=Object(f.f)(s,a,e,n,o,l)}Object(i.at)(c,p)&&y.push(r)}break;case"esriGeometryPolyline":{const i=r.symbol;if(!i||!i.layers.length)continue;const s=i.layers[0];g=1.5*n*window.devicePixelRatio*Object(a.A)(s.width),Object(f.d)(r.geometry,e,t,g)&&y.push(r)}break;case"esriGeometryEnvelope":{const e=r.geometry,t=Object(o.j)(e.xmin,e.ymin,e.xmax,e.ymax);Object(o.a)(t,pe)&&y.push(r);break}case"esriGeometryPolygon":{if(Object(i.at)(r.geometry,p)){y.push(r);break}const e=Object(i.cd)(r.geometry);if(Math.abs(e.ymax-e.ymin)<5*n||Math.abs(e.xmax-e.xmin)<5*n){const t=Object(o.j)(e.xmin,e.ymin,e.xmax,e.ymax);Object(o.a)(t,pe)&&y.push(r)}break}case"esriGeometryMultipoint":{const e=r.symbol;if(!e)continue;const t=r.geometry.points;let s;for(let a=0;a<t.length;a++)if(s="esriTS"===e.type?Object(f.i)(t[a][0],t[a][1],e,r.size,n,l):Object(f.f)(t[a][0],t[a][1],e,n,n*this._metersPerUnit,l),Object(i.at)(s,p)){y.push(r);break}break}}return y.sort(((e,t)=>{const r=Object(f.m)(e.graphic),i=Object(f.m)(t.graphic);return r===i?t.zorder-e.zorder:r-i})),y.map((e=>e.graphic))}getGraphicsData(e,t,r){const i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort(((e,t)=>e.zorder-t.zorder)),i[0].insertAfter=-1;for(let e=1;e<i.length;e++)i[e].insertAfter=i[e-1].graphic.uid;i.sort(((e,t)=>e.graphic.uid-t.graphic.uid)),r.sort(((e,t)=>e.uid-t.uid));let n,s=0,a=0;const o=[],l={originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]};for(const t of r){for(a=-2;s<i.length;)if(n=i[s],s++,t.uid===n.graphic.uid){a=n.insertAfter;break}if(!n.geometry||-2===a)continue;const r=n.getGeometryQuantized(l),c={...n.graphic.attributes};c[this._uidFieldName]=t.uid,null==n.groupId&&(n.groupId=e.createTemplateGroup(n.symbol,null)),o.push({centroid:de.getCentroidQuantized(n,l),geometry:r,attributes:c,symbol:n.symbol,groupId:n.groupId,insertAfter:a,zorder:n.zorder})}return o.sort(((e,t)=>e.zorder-t.zorder)),o}queryTileData(e,t){const{bounds:r,resolution:i}=t,n=this._searchForItems(t),s=[];return this._createTileGraphics(s,e,n,{originPosition:"upperLeft",scale:[i,i],translate:[r[0],r[3]]}),s}has(e){return this._itemByGraphic.has(e)}getBounds(e){return this._itemByGraphic.has(e)?this._itemByGraphic.get(e).bounds:null}addOrModify(e,t,r){if(!e)return;this.has(e)&&this.remove(e),this._onAdd(e);const i=de.acquire(e,t,r,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference);return this._itemByGraphic.set(e,i),r&&this._index.insert(i),i.bounds}remove(e){if(!this._itemByGraphic.has(e))return;this._onRemove(e);const t=this._itemByGraphic.get(e);this._index.remove(t),this._itemByGraphic.delete(e)}updateZ(){const e=this._graphics.items;let t,r;for(let i=0;i<e.length;i++)r=e[i],t=this._itemByGraphic.get(r),t&&(t.zorder=i)}update(e,t,r){const i=this._itemByGraphic.get(e);i.groupId=null;const n=Object(o.e)(i.bounds);return i.size[0]=i.size[1]=0,this._index.remove(i),i.set(e,t,r,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),r&&this._index.insert(i),{oldBounds:n,newBounds:i.bounds}}updateLevel(e){if(this._currentLevel===e)return;this._currentLevel=e;const t=this._tileInfoView.getTileResolution(e);this._resolution=t,this._index.clear(),ye.length=0,this._itemByGraphic.forEach((e=>{e.updateBounds(this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),e.geometry&&ye.push(e)})),this._index.load(ye)}clear(){this._itemByGraphic.clear(),this._index.clear()}_createTileGraphics(e,t,r,i){const n=this._uidFieldName;let s,a,o,l;r.sort(((e,t)=>e.zorder-t.zorder));for(let c=0;c<r.length;c++){o=r[c],s=o.graphic,a=o.getGeometryQuantized(i),l=0===c?-1:r[c-1].graphic.uid;const u={...o.graphic.attributes};u[n]=s.uid,null==o.groupId&&(o.groupId=t.createTemplateGroup(o.symbol,null)),e.push({centroid:de.getCentroidQuantized(o,i),geometry:a,attributes:u,symbol:o.symbol,groupId:o.groupId,insertAfter:l,zorder:o.zorder})}}_searchForItems(e){const t=this._tileInfoView.spatialReference,r=e.bounds;if(t.isWrappable){const[i,n]=Object(d.b)(t),s=Math.abs(r[2]-n)<ge,a=Math.abs(r[0]-i)<ge;if((!s||!a)&&(s||a)){const t=e.resolution;let a;a=Object(o.f)(s?[i,r[1],i+t*f.j,r[3]]:[n-t*f.j,r[1],n,r[3]]);const l=me(this._index,r[0],r[1],r[2],r[3]),c=me(this._index,a[0],a[1],a[2],a[3]);return[...new Set([...l,...c])]}}return me(this._index,r[0],r[1],r[2],r[3])}}const _e=e=>{let t=class extends(Object(i.z)(e)){constructor(){super(...arguments),this.graphics=null,this.renderer=null,this.view=null}};return Object(i.e)([Object(i.y)()],t.prototype,"graphics",void 0),Object(i.e)([Object(i.y)()],t.prototype,"renderer",void 0),Object(i.e)([Object(i.y)()],t.prototype,"updating",void 0),Object(i.e)([Object(i.y)()],t.prototype,"view",void 0),t=Object(i.e)([Object(i.i)("esri.views.layers.GraphicsView")],t),t};function xe(e,t,r){if(r.has(e))return r.get(e);const i={tile:t,addedOrModified:[],removed:[]};return r.set(e,i),i}let ve=class extends(_e(Object(c.a)(i.u))){constructor(e){super(e),this._storage=new _.f,this._displayIds=new Map,this._tiles=new Map,this._graphicStoreUpdate=!1,this._graphicsSet=new Set,this._matcher=Promise.resolve(null),this._tileUpdateSet=new Set,this._tilesToUpdate=new Map,this._graphicIdToAbortController=new Map,this._attached=!1,this._highlightIds=new Map,this._updatingGraphicsTimer=null,this._hashToExpandedSymbol=new Map,this._hashTpExpandedSymbolPromise=new Map,this._processing=!1,this._needsProcessing=!1,this._pendingUpdate={added:new Set,updated:new Set,removed:new Set},this.lastUpdateId=-1,this.updateRequested=!1,this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}_createMatcher(e,t){if(e){const r=Object(f.n)({indexCount:0,fields:{}},"feature",e);this._matcher=Object(p.l)(r,t,null)}}_createDisplayId(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}initialize(){this._tileStore=new _.e(this.view.featuresTilingScheme),this._attributeStore=new _.b({type:"local",initialize:e=>Promise.resolve(this.container.attributeView.initialize(e)),update:e=>this.container.attributeView.requestUpdate(e),render:()=>this.container.requestRender()},Object(h.b)());this._graphicStore=new be(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,(e=>{this._createDisplayId(e.uid),this._setFilterState(e.uid,e.visible)}),(e=>{const t=this._displayIds.get(e.uid);this._displayIds.delete(e.uid),this._storage.releaseDisplayId(t)}));const e=new p.j(this.container.getMaterialItems.bind(this.container),!0);this._createMatcher(this.renderer,e),this._meshFactory=new p.e(null,this.uid,e),this._templateStore=e,this.watch("renderer",(t=>{this._createMatcher(t,e);for(const e of this.graphics)this._pendingUpdate.updated.add(e);this.requestUpdate()})),this._tileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(()=>{this.graphics.items.length>0&&this._graphicsChangeHandler({target:this.graphics,added:this.graphics.items,removed:[],moved:[]}),this.handles.add(this.graphics.on("change",(e=>this._graphicsChangeHandler(e))),"graphics"),this._attached=!0,this.notifyChange("updating")}))}destroy(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._tileStore.destroy(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null}get updating(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}hitTest(e,t){if(!this.view||!this.view.position)return Promise.resolve(null);const r=this.view.toMap(Object(a.j)(e,t));return this.searchFeatures(r).then((e=>e&&e.length?e[0]:null))}async searchFeatures(e,t=2){return this._graphicStore.hitTest(e.x,e.y,t,this.view.state.resolution,this.view.state.rotation)}update(e){const t=e.state,r=this.view.featuresTilingScheme.getClosestInfoForScale(t.scale).level;if(this._graphicStore.updateLevel(r),this._tileStore.setViewState(t),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}processUpdate(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}graphicUpdateHandler(e){const{graphic:t,property:r,newValue:i}=e;switch(r){case"attributes":break;case"geometry":case"symbol":this._pendingUpdate.updated.add(t),this.requestUpdate();break;case"visible":this._setFilterState(t.uid,i),this._attributeStore.sendUpdates()}}addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight()}removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight()}_updateHighlight(){const e=Array.from(this._highlightIds.keys()),t=e.map((e=>this._displayIds.get(e)));this._attributeStore.setHighlight(e,t)}_getIntersectingTiles(e){const t=this._graphicStore.getBounds(e);if(!t||0===Object(o.k)(t)||0===Object(o.c)(t))return[];const r=Object(f.l)(t,this.view.spatialReference);return Object(i.P)(r)?[...this._tileStore.boundsIntersections(r[0]),...this._tileStore.boundsIntersections(r[1])]:this._tileStore.boundsIntersections(t)}async _updateTile(e){const t=e.tile,r=this._getGraphicsData(this._templateStore,t,e.addedOrModified),i=await this._processGraphics(t,r);return this._patchTile(t.key,{type:"update",addOrUpdate:i,remove:e.removed,end:!0,clear:!1}),i}_patchTile(e,t){if(!this._tiles.has(e))return;const r=this._tiles.get(e);this.container.onTileData(r,t),this.container.requestRender()}_graphicsChangeHandler(e){for(const t of e.added)this._pendingUpdate.added.add(t);for(const t of e.moved)this._pendingUpdate.added.add(t);for(const t of e.removed)this._pendingUpdate.added.has(t)?this._pendingUpdate.added.delete(t):this._pendingUpdate.removed.add(t);this._processing?this._needsProcessing=!0:this._updateGraphics()}_getGraphicsToUpdate(){const e={added:[],removed:[],updated:[]};if(!this.graphics)return e;const t=this._pendingUpdate;for(const r of this.graphics.items)t.added.has(r)?e.added.push(r):t.updated.has(r)&&e.updated.push(r);for(const r of t.removed)this._graphicStore.has(r)&&e.removed.push(r);return t.added.clear(),t.removed.clear(),t.updated.clear(),e}async _updateGraphics(){this._processing=!0;const{added:e,removed:t,updated:r}=this._getGraphicsToUpdate(),i=this._tilesToUpdate;let n;try{if(!this._graphicStoreUpdate){const e=this.view.state,t=this.view.featuresTilingScheme.getClosestInfoForScale(e.scale).level;this._graphicStore.updateLevel(t),this._tileStore.setViewState(e)}const s=[],a=new Array(e.length+t.length);for(let e=0;e<r.length;e++){const t=r[e],o=this._getIntersectingTiles(t);for(const e of o)n=e.id,xe(n,e,i).removed.push(this._displayIds.get(t.uid));s.push(this._updateGraphic(t,null)),a[e]=t}const o=r.length;for(let t=0;t<e.length;t++){const r=e[t];a[o+t]=r,this._graphicsSet.add(r),s.push(this._addGraphic(r))}for(const e of t){this._abortProcessingGraphic(e.uid);const t=this._getIntersectingTiles(e);for(const r of t)n=r.id,xe(n,r,i).removed.push(this._displayIds.get(e.uid));this._graphicsSet.delete(e),this._graphicStore.remove(e)}let l;this._flipUpdatingGraphics(),await Promise.all(s);for(let e=0;e<a.length;e++){l=a[e];const t=this._getIntersectingTiles(l);for(const e of t)n=e.id,xe(n,e,i).addedOrModified.push(l)}this._graphicStore.updateZ();const c=[];for(const[e,t]of i)c.push(this._updateTile(t));await Promise.all(c)}catch(e){}for(const e of t){const t=await this._getSymbolForGraphic(e,{});t&&this._hashToExpandedSymbol.delete(t.hash())}i.clear(),this.notifyChange("updating"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics())}_getArcadeInfo(e){const t=(e.attributes?Object.keys(e.attributes):[]).map((t=>({name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"})));return Object(i.J)(e.geometry)?null:{geometryType:Object(s.b)(e.geometry),spatialReference:i.A.fromJSON(e.geometry.spatialReference),fields:t}}async _getSymbolForGraphic(e,t){return Object(i.P)(e.symbol)?e.symbol:Object(i.P)(this.renderer)?this.renderer.getSymbolAsync(e,{scale:this.view.scale,abortOptions:t}):this._getNullSymbol(e)}async _getSymbolResources(e,t){if(!this.container.stage)return Promise.resolve(null);const r=await this._getSymbolForGraphic(e,t),n=r.hash();let s=this._hashToExpandedSymbol.get(n);if(!s){let a=this._hashTpExpandedSymbolPromise.get(n);if(a)s=await a;else{const o=this._getArcadeInfo(e),l=Object(f.k)(r);a=Object(p.g)(l,o,t),this._hashTpExpandedSymbolPromise.set(n,a);try{s=await a,this._hashTpExpandedSymbolPromise.delete(n),this._hashToExpandedSymbol.set(n,s)}catch(e){this._hashTpExpandedSymbolPromise.delete(n),Object(i.h)(e)}}}if("esriTS"===s.type){const e=[],[t]=Object(f.A)(s.text);for(let r=0;r<t.length;r++)e.push(t.charCodeAt(r));const r={symbol:s,id:0,glyphIds:e},[{mosaicItem:i}]=await this.container.getMaterialItems([r]);return{symbol:s,mosaicItem:i}}return{symbol:s,mosaicItem:null}}async _projectAndNormalizeGeometry(e,t){if(Object(i.J)(e.geometry)||"mesh"===e.geometry.type)return Promise.resolve(null);let r=e.geometry;if(Object(s.h)(r)){const e=r.rings;r.rings=e}else if(Object(s.c)(r)){const e=r.paths;r.paths=e}else if(Object(s.g)(r)){const n=await this._getSymbolForGraphic(e,t);r=Object(f.g)(n.type)||Object(f.c)(n.type)?r.center:i.au.fromExtent(r)}await Object(y.g)(r.spatialReference,this.view.spatialReference);const n=I(r),a=Object(y.j)(n,r.spatialReference,this.view.spatialReference);return Object(i.ce)(a),a}_onTileUpdate(e){const t=Object(i.aq)(this.view.spatialReference);if(e.added&&e.added.length>0)for(const r of e.added)this._addNewTile(r,t);if(e.removed&&e.removed.length>0)for(const t of e.removed)this._removeTile(t.key)}async _addGraphic(e){this._abortProcessingGraphic(e.uid);const t=Object(i.V)();this._graphicIdToAbortController.set(e.uid,t);const r={signal:t.signal};try{await this._addOrUpdateGraphic(e,r),this._graphicIdToAbortController.delete(e.uid)}catch(t){if(this._graphicIdToAbortController.delete(e.uid),!Object(i.B)(t))throw t}}async _updateGraphic(e,t){const r=this._projectAndNormalizeGeometry(e,t),i=this._getSymbolResources(e,t),[n,s]=await Promise.all([r,i]);this._graphicStore.addOrModify(e,s,n)}async _addOrUpdateGraphic(e,t){const r=this._projectAndNormalizeGeometry(e,t),n=this._getSymbolResources(e,t);try{const[t,i]=await Promise.all([r,n]);this._addProjectedGraphic(e,i,t)}catch(e){if(!Object(i.B)(e))throw e}}_addProjectedGraphic(e,t,r){this._graphicsSet.has(e)&&this._graphicStore.addOrModify(e,t,r)}_addTile(e){const t=this.view.featuresTilingScheme.getTileBounds(Object(o.f)(),e),r=new B(e,t);return this._tiles.set(e,r),this.container.addChild(r),r}_addNewTile(e,t){const r=this._addTile(e.key),n=this._graphicStore.queryTileData(this._templateStore,e);if(t){const r=Math.round((t.valid[1]-t.valid[0])/e.resolution);for(const e of n)e.geometry&&(Object(s.d)(e.geometry)||Object(s.f)(e.geometry))&&this._wrapPoints(e,r)}const a=e.key;this._tileUpdateSet.add(e.key),this.notifyChange("updating"),this._processGraphics(e,n).then((e=>{const t={type:"update",clear:!1,addOrUpdate:e,remove:[],end:!0};r.patch(t),this._tileUpdateSet.delete(a),this.notifyChange("updating")})).catch((e=>{if(this._tileUpdateSet.delete(a),this.notifyChange("updating"),!Object(i.B)(e))throw e}))}_removeTile(e){if(!this._tiles.has(e))return;const t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}_setFilterState(e,t){const r=this._displayIds.get(e),i=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(r,0,0,i|(t?u.n:0))}_getGraphicsData(e,t,r){const n=Object(i.aq)(this.view.spatialReference),a=this._graphicStore.getGraphicsData(e,t,r);if(n){const e=Math.round((n.valid[1]-n.valid[0])/t.resolution);for(const t of a)t.geometry&&(Object(s.d)(t.geometry)||Object(s.f)(t.geometry))&&this._wrapPoints(t,e)}return a}_wrapPoints(e,t){const r=e.geometry;Object(s.f)(r)?this._wrapMultipoint(r,t):this._wrapPoint(e,t)}_wrapMultipoint(e,t){const r=e.points,i=[];let n=0,s=0;for(const[e,a]of r){if(i.push([e+n,a]),n=0,t===f.M){const r=5*f.j;e+s<r?(i.push([t,0]),n=-t):e+s>f.M-r&&(i.push([-t,0]),n=t)}else e+s<-f.j?(i.push([t,0]),n=-t):e+s>f.M+f.j&&(i.push([-t,0]),n=t);s+=e}e.points=i}_wrapPoint(e,t){const r=e.geometry;if(t===f.M){const i=5*f.j;r.x<i?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>f.M-i&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}else r.x<-f.j?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>f.M+f.j&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}async _processGraphics(e,t,r){if(!t||!t.length||!this._meshFactory)return null;const i=oe.from(t),n=this._meshFactory,s=await this._matcher;return await n.analyzeGraphics(i,s,null,null,r),this._attributeStore.sendUpdates(),this._processAnalyzedGraphics(e,i)}_processAnalyzedGraphics(e,t){const r=this._meshFactory,i=t.getApproximateSize(),n=t.getCursor(),s={features:i,records:i,metrics:0},a=new p.a(e.key.id,s,!1,!1,!1);for(;n.next();){const e=n.readGraphic();e.insertAfter=-1===e.insertAfter?-1:this._displayIds.get(e.insertAfter),e.displayId=this._displayIds.get(e.attributes[this.uid]),r.writeGraphic(a,n)}const o=e.tileInfoView.tileInfo.isWrappable,l=a.serialize(o);if(1!==l.length)return new ae;const c=l[0].message;return ae.fromVertexData(c)}_abortProcessingGraphic(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()}_getNullSymbol(e){const t=e.geometry;return Object(s.c)(t)?l.b:Object(s.h)(t)||Object(s.g)(t)?l.c:l.a}_flipUpdatingGraphics(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((()=>{this._updatingGraphicsTimer=null,this.notifyChange("updating")}),160),this.notifyChange("updating")}};Object(i.e)([Object(i.y)({constructOnly:!0})],ve.prototype,"requestUpdateCallback",void 0),Object(i.e)([Object(i.y)()],ve.prototype,"container",void 0),Object(i.e)([Object(i.y)({constructOnly:!0})],ve.prototype,"graphics",void 0),Object(i.e)([Object(i.y)()],ve.prototype,"updating",null),Object(i.e)([Object(i.y)()],ve.prototype,"view",void 0),Object(i.e)([Object(i.y)()],ve.prototype,"updateRequested",void 0),ve=Object(i.e)([Object(i.i)("esri.views.2d.layers.support.GraphicsView2D")],ve);var we=ve;class Oe extends b.a{constructor(e){super(e)}get hasLabels(){return!1}get labelsVisible(){return!1}onTileData(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}_renderChildren(e,t){for(const r of this.children)r.isReady&&r.hasData&&(r.commit(e),e.context.setStencilFunction(514,r.stencilRef,255),r._displayList.replay(e,r,t))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return y}));r(87),r(88);var i=r(314),n=r(332),s=r(0),a=r(35),o=r(1),l=r(312),c=r(313),u=r(331),h=r(4),d=r(10),f=r(70),p=r(122);class y extends n.b{constructor(e,t){super(e,t,[i.B,i.B])}}const g=s.n.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),m=Object(u.e)(u.c,g),b=e=>2147483647&e;class _{constructor(e,t,r){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:i,pixelType:n,textureOnly:a}=e,o=Object(c.n)(n);this.shared=r,this.pixelType=n,this.size=t,this.textureOnly=a,a||(this.data=new o(Object(s.Y)(i))),this._resetRange()}destroy(){Object(s.c6)(this._texture,(e=>e.dispose()));for(const e in this._fbos)Object(s.c6)(this._fbos[e],(t=>{"0"===e&&t.detachColorTexture(),t.dispose()})),this._fbos[e]=null;this._texture=null}get _textureDesc(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}setData(e,t,r){const i=b(e),n=Object(s.Y)(this.data),a=i*this.texelSize+t;!n||a>=n.length||(n[a]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i))}getData(e,t){if(Object(s.J)(this.data))return null;const r=b(e)*this.texelSize+t;return!this.data||r>=this.data.length?null:this.data[r]}getTexture(e){return Object(s.bJ)(this._texture,(()=>this._initTexture(e)))}getFBO(e,t=0){if(Object(s.J)(this._fbos[t])){const r={colorTarget:0,depthStencilTarget:0},i=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new l.g(e,r,i)}return this._fbos[t]}get locked(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!Object(o.a)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}updateTexture(e){if(!this.locked)try{const t=this.dirtyStart,r=this.dirtyEnd;if(t>r)return;this._resetRange();const i=Object(s.Y)(this.data).buffer,n=this.getTexture(e),a=4,o=(t-t%this.size)/this.size,l=(r-r%this.size)/this.size,u=o,h=this.size,d=l,f=o*this.size*a,p=(h+d*this.size)*a-f,y=Object(c.n)(this.pixelType),m=y.BYTES_PER_ELEMENT;try{new y(i,f*m,p)}catch(e){}const b=new y(i,f*m,p),_=this.size,x=d-u+1;if(x>this.size)return void g.error(new s.s("mapview-webgl","Out-of-bounds index when updating AttributeData"));n.updateData(0,0,u,_,x,b)}catch(e){}}update(e){const{data:t,start:r,end:i}=e;if(Object(s.P)(t)){const i=this.data,n=r*this.texelSize;for(let r=0;r<t.length;r++){const s=1<<r%this.texelSize;e.layout&s&&(i[n+r]=t[r])}}this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,i)}resize(e,t){const r=this.size;if(this.size=t,this.textureOnly)return void(r!==this.size&&(this._lastTexture=this._texture,this._texture=null));const i=Object(c.n)(this.pixelType);this.destroy(),this.data=new i(Object(s.Y)(e.buffer))}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(e){const t=new l.f(e,this._textureDesc,Object(s.bJ)(this.data,void 0));if(Object(s.P)(this._lastTexture)&&this._fbos[0]){const r=this._lastTexture.descriptor.width,i=this._lastTexture.descriptor.height,n=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,a=this.getFBO(e),o=Object(c.m)(n),l=new(Object(c.n)(n))(new ArrayBuffer(r*i*o*this.texelSize)),u=e.getBoundFramebufferObject(),{x:h,y:d,width:f,height:p}=e.getViewport();e.bindFramebuffer(a),a.readPixels(0,0,r,i,s,n,l),t.updateData(0,0,0,2*r,i/2,l),e.setViewport(h,d,f,p),e.bindFramebuffer(u)}return this.destroy(),this._texture=t,this._texture}}class x{constructor(e){this._onUpdate=e,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(e){const{blocks:t,shared:r,size:i}=e;if(this.shared=r,this.size=i,m("Initializing AttributeStoreView",e),Object(s.J)(this._data))this._data=Object(s.co)(t,(e=>new _(e,i,r)));else for(let e=0;e<this._data.length;e++){const n=this._data[e],a=t[e];Object(s.P)(a)&&(Object(s.J)(n)?this._data[e]=new _(a,i,r):n.resize(a,i))}this._initialized=!0}destroy(){Object(s.c6)(this._data,(e=>Object(s.co)(e,(e=>e.destroy())))),Object(s.c6)(this._defaultTexture,(e=>e.dispose()))}getBlock(e){return Object(s.J)(this._data)?null:this._data[e]}setLabelMinZoom(e,t){this.setData(e,0,1,t)}getLabelMinZoom(e){return this.getData(e,0,1,255)}getFilterFlags(e){return this.getData(e,0,0,0)}getVVSize(e){return this.getData(e,i.k,0,0)}getData(e,t,r,i){if(!this._data)return 0;const n=Object(s.Y)(this._data)[t];if(Object(s.J)(n))return 0;const a=n.getData(e,r);return Object(s.P)(a)?a:i}setData(e,t,r,i){const n=Object(s.Y)(this._data)[t];Object(s.Y)(n).setData(e,r,i)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}async requestUpdate(e){if(this._pendingAttributeUpdate)return void g.error(new s.s("mapview-webgl","Tried to update attribute data with a pending update"));const t=Object(s.b$)();return m("AttributeStoreView Update Requested",e),this._pendingAttributeUpdate={data:e,resolver:t},t.promise}update(){if(this._initialized&&(this._onUpdate(),Object(s.P)(this._pendingAttributeUpdate))){const{data:e,resolver:t}=this._pendingAttributeUpdate,r=Object(s.Y)(this._data);for(let t=0;t<e.blocks.length;t++){const i=e.blocks[t],n=r[t];Object(s.c6)(n,(e=>Object(s.c6)(i,(r=>{m(`Updating block ${t}`,r),e.update(r)}))))}this._pendingAttributeUpdate=null,t()}}bindTextures(e){this.update();const t=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(t,i.b),e.bindTexture(t,i.c),e.bindTexture(t,i.d),void e.bindTexture(t,i.e);const r=Object(s.Y)(this._data);this._locked&&!this._forceNextUpload||(Object(s.cp)(r,(t=>t.updateTexture(e))),this._forceNextUpload=!1),e.bindTexture(Object(s.cr)(r[0],t,(t=>t.getTexture(e))),i.b),e.bindTexture(Object(s.cr)(r[1],t,(t=>t.getTexture(e))),i.c),e.bindTexture(Object(s.cr)(r[2],t,(t=>t.getTexture(e))),i.d),e.bindTexture(Object(s.cr)(r[3],t,(t=>t.getTexture(e))),i.e)}_getDefaultTexture(e){if(Object(s.J)(this._defaultTexture)){const t={wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1};this._defaultTexture=new l.f(e,t,new Uint8Array(4))}return this._defaultTexture}}function v(e,t){const r=t.length;if(e<t[0].value||1===r)return t[0].size;for(let i=1;i<r;i++)if(e<t[i].value){const r=(e-t[i-1].value)/(t[i].value-t[i-1].value);return t[i-1].size+r*(t[i].size-t[i-1].size)}return t[r-1].size}function w(e,t,r=0){if(Object(s.J)(t))return e[r+0]=0,e[r+1]=0,e[r+2]=0,void(e[r+3]=0);const{r:i,g:n,b:a,a:o}=t;e[r+0]=i*o/255,e[r+1]=n*o/255,e[r+2]=a*o/255,e[r+3]=o}class O{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}getSizeVVFieldStops(e){const t=this._vvSizeFieldStops;switch(t.type){case"static":return t;case"level-dependent":return Object(s.bJ)(t.levels[e],(()=>{let r=1/0,i=0;for(const n in t.levels){const t=parseFloat(n),s=Math.abs(e-t);s<r&&(r=s,i=t)}if(r===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const n=2**((e-i)/2),a=Object(s.Y)(t.levels[i]),o=new Float32Array(a.values);return o[2]*=n,o[3]*=n,{sizes:Object(s.Y)(a.sizes),values:o}}))}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){Object(s.P)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,r){switch(Object(s.P)(r)&&r.forEach((e=>this._updateEffects(e))),this._vvInfo=t,e.type){case"dot-density":this._updateDotDensityInfo(e)}}getVariation(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:Object(p.b)().supportsTextureFloat}}getVariationHash(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}_updateEffects(e){Object(s.P)(e)&&e.filter&&e.filter.enabled&&(this.outsideLabelsVisible=e.excludedLabelsVisible)}_updateVisualVariables(e,t){const r=this._vvMaterialParameters;if(r.vvOpacityEnabled=!1,r.vvSizeEnabled=!1,r.vvColorEnabled=!1,r.vvRotationEnabled=!1,!e)return;const i=e.size;if(i){if(r.vvSizeEnabled=!0,i.minMaxValue){const e=i.minMaxValue;let r,n;if(Object(c.g)(e.minSize)&&Object(c.g)(e.maxSize))if(Object(c.s)(e.minSize)&&Object(c.s)(e.maxSize))r=Object(h.A)(e.minSize),n=Object(h.A)(e.maxSize);else{const i=t.scale;r=Object(h.A)(v(i,e.minSize.stops)),n=Object(h.A)(v(i,e.maxSize.stops))}this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,r,n])}if(i.scaleStops&&(this.vvSizeScaleStopsValue=Object(h.A)(v(t.scale,i.scaleStops.stops))),i.unitValue){const e=Object(d.b)(t.spatialReference)/f.a[i.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/t.resolution}i.fieldStops&&(this._vvSizeFieldStops=i.fieldStops)}const n=e.color;n&&(r.vvColorEnabled=!0,this.vvColorValues.set(n.values),this.vvColors.set(n.colors));const s=e.opacity;s&&(r.vvOpacityEnabled=!0,this.vvOpacityValues.set(s.values),this.vvOpacities.set(s.opacities));const a=e.rotation;a&&(r.vvRotationEnabled=!0,r.vvRotationType=a.type)}_updateDotDensityInfo(e){const t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(let e=0;e<i.C;e++){const r=e>=t.length?new s.j([0,0,0,0]):t[e].color;w(this.ddColors,r,4*e)}for(let t=0;t<8;t++)this.ddActiveDots[t]=t<e.attributes.length?1:0;w(this.ddBackgroundColor,e.backgroundColor)}}class I extends n.a{constructor(e){super(e),this._rendererInfo=new O,this._materialItemsRequestQueue=new a.d,this.attributeView=new x((()=>this.onAttributeStoreUpdate()))}destroy(){this.removeAllChildren(),this.children.forEach((e=>e.destroy())),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(e,t){if(!e||0===e.length)return null;const r=Object(s.b$)();return this._materialItemsRequestQueue.push({items:e,abortOptions:t,resolver:r}),this.requestRender(),r.promise}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}createRenderParams(e){return{...super.createRenderParams(e),rendererInfo:this._rendererInfo,attributeView:this.attributeView}}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:i}){const{painter:n,pixelRatio:s}=e,a=t.map((e=>n.textureManager.rasterizeItem(e.symbol,s,e.glyphIds,r)));Promise.all(a).then((e=>{if(!this.stage)return void i.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));i.resolve(r)}),i.reject)}}},,function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l}));r(87),r(1);var i=r(11),n=r(138),s=r(19),a=r(312),o=r(317);class l{constructor(e,t,r){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=r}get width(){return this.pixelBlock?this.pixelBlock.width:0}get height(){return this.pixelBlock?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if(!t)return;const r=this.filter({pixelBlock:t}),i=r.pixelBlock.getAsRGBA(),n=e.createImageData(r.pixelBlock.width,r.pixelBlock.height);n.data.set(i),e.putImageData(n,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}function c(e,t,r){const i={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return t&&r&&(i.width=t,i.height=r),new a.f(e,i)}class u extends o.a{constructor(e=null,t,r=!0){super(),this.requestRenderOnSourceChangedEnabled=r,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.transforms={dvs:Object(n.l)()},this.blendFunction=t,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){this._source=e,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}setTransform(e){const t=Object(i.i)(this.transforms.dvs),[r,n]=e.toScreenNoRotation([0,0],this.x,this.y),a=this.resolution/this.pixelRatio/e.resolution,o=a*this.width,l=a*this.height,c=Math.PI*this.rotation/180;Object(i.a)(t,t,Object(s.n)(r,n)),Object(i.a)(t,t,Object(s.n)(o/2,l/2)),Object(i.e)(t,t,-c),Object(i.a)(t,t,Object(s.n)(-o/2,-l/2)),Object(i.c)(t,t,Object(s.n)(o,l)),Object(i.f)(this.transforms.dvs,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind({context:e},t){this._texture&&e.bindTexture(this._texture,t)}updateTexture({context:e}){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=c(e,this.sourceWidth,this.sourceHeight):this._texture=c(e));const r=this.source;if(r){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function(e){return e&&"render"in e}(r))if(r instanceof l){const e=r.getRenderedRasterPixels();this._texture.setData(e.renderedRasterPixels)}else this._texture.setData(function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}(r));else(function(e){return e&&!("render"in e)})(r)&&this._texture.setData(r);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(313),n=r(342);class s extends n.b{renderChildren(e){this.attributeView.bindTextures(e.context),this.children.some((e=>e.hasData))&&(super.renderChildren(e),e.drawPhase===i.d.MAP&&this._renderChildren(e),e.drawPhase===i.d.HIGHLIGHT&&this._renderHighlight(e))}_renderHighlight(e){const{painter:t}=e,r=t.effects.highlight;r.bind(e),this._renderChildren(e,r.defines),r.draw(e),r.unbind()}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return c}));r(25);var i=r(0);const n={ar:[".",","],bs:[",","."],ca:[",","."],cs:[","," "],da:[",","."],de:[",","."],"de-ch":[".","’"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[","," "],fi:[","," "],fr:[","," "],"fr-ch":[","," "],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[","," "],id:[",","."],it:[",","."],"it-ch":[".","’"],ja:[".",","],ko:[".",","],lt:[","," "],lv:[","," "],mk:[",","."],nb:[","," "],nl:[",","."],pl:[","," "],pt:[",","."],"pt-pt":[","," "],ro:[",","."],ru:[","," "],sk:[","," "],sl:[",","."],sr:[",","."],sv:[","," "],th:[".",","],tr:[",","."],uk:[","," "],vi:[",","."],zh:[".",","]};function s(e){e||(e=Object(i.R)());let t=e in n;if(!t){const r=e.split("-");r.length>1&&r[0]in n&&(e=r[0],t=!0),t||(e="en")}const[r,s,a="#,##0.###"]=n[e];return{decimal:r,group:s,pattern:a}}function a(e,t){const r=s((t={...t}).locale);t.customs=r;const i=t.pattern||r.pattern;return isNaN(e)||Math.abs(e)===1/0?null:function(e,t,r){const i=(r=r||{}).customs.group,n=r.customs.decimal,s=t.split(";"),a=s[0];if(-1!==(t=s[e<0?1:0]||"-"+a).indexOf("%"))e*=100;else if(-1!==t.indexOf("‰"))e*=1e3;else{if(-1!==t.indexOf("¤"))throw new Error("currency notation not supported");if(-1!==t.indexOf("E"))throw new Error("exponential notation not supported")}const l=o,c=a.match(l);if(!c)throw new Error("unable to find a number expression in pattern: "+t);return!1===r.fractional&&(r.places=0),t.replace(l,function(e,t,r){!0===(r=r||{}).places&&(r.places=0),r.places===1/0&&(r.places=6);const i=t.split("."),n="string"==typeof r.places&&r.places.indexOf(",");let s=r.places;n?s=r.places.substring(n+1):s>=0||(s=(i[1]||[]).length),r.round<0||(e=Number(e.toFixed(Number(s))));const a=String(Math.abs(e)).split("."),o=a[1]||"";if(i[1]||r.places){n&&(r.places=r.places.substring(0,n));const e=void 0!==r.places?r.places:i[1]&&i[1].lastIndexOf("0")+1;e>o.length&&(a[1]=o.padEnd(Number(e),"0")),s<o.length&&(a[1]=o.substr(0,Number(s)))}else a[1]&&a.pop();const l=i[0].replace(",","");let c=l.indexOf("0");-1!==c&&(c=l.length-c,c>a[0].length&&(a[0]=a[0].padStart(c,"0")),-1===l.indexOf("#")&&(a[0]=a[0].substr(a[0].length-c)));let u,h,d=i[0].lastIndexOf(",");if(-1!==d){u=i[0].length-d-1;const e=i[0].substr(0,d);d=e.lastIndexOf(","),-1!==d&&(h=e.length-d-1)}const f=[];for(let e=a[0];e;){const t=e.length-u;f.push(t>0?e.substr(t):e),e=t>0?e.slice(0,t):"",h&&(u=h,h=void 0)}return a[0]=f.reverse().join(r.group||","),a.join(r.decimal||".")}(e,c[0],{decimal:n,group:i,places:r.places,round:r.round}))}(e,i,t)}const o=/[#0,]*[#0](?:\.0*#*)?/;function l(e){const t=s((e=e||{}).locale),r=e.pattern||t.pattern,n=t.group,a=t.decimal;let l=1;if(-1!==r.indexOf("%"))l/=100;else if(-1!==r.indexOf("‰"))l/=1e3;else if(-1!==r.indexOf("¤"))throw new Error("currency notation not supported");const c=r.split(";");return 1===c.length&&c.push("-"+c[0]),{regexp:h(c,(function(t){return(t="(?:"+Object(i.bP)(t,".")+")").replace(o,(function(t){const r={signed:!1,separator:e.strict?n:[n,""],fractional:e.fractional,decimal:a,exponent:!1},i=t.split(".");let s=e.places;1===i.length&&1!==l&&(i[1]="###"),1===i.length||0===s?r.fractional=!1:(void 0===s&&(s=e.pattern?i[1].lastIndexOf("0")+1:1/0),s&&null==e.fractional&&(r.fractional=!0),!e.places&&s<i[1].length&&(s+=","+i[1].length),r.places=s);const o=i[0].split(",");return o.length>1&&(r.groupSize=o.pop().length,o.length>1&&(r.groupSize2=o.pop().length)),"("+function(e){"places"in(e=e||{})||(e.places=1/0),"string"!=typeof e.decimal&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=u(e),r=h(e.fractional,(function(t){let r="";return t&&0!==e.places&&(r="\\"+e.decimal,e.places===1/0?r="(?:"+r+"\\d+)?":r+="\\d{"+e.places+"}"),r}),!0);let i=t+r;return r&&(i="(?:(?:"+i+")|(?:"+r+"))"),i+h(e.exponent,(function(t){return t?"([eE]"+u({signed:e.eSigned})+")":""}))}(r)+")"}))}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:n,decimal:a,factor:l}}function c(e,t){const r=l(t),i=new RegExp("^"+r.regexp+"$").exec(e);if(!i)return NaN;let n=i[1];if(!i[1]){if(!i[2])return NaN;n=i[2],r.factor*=-1}return n=n.replace(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,"."),Number(n)*r.factor}function u(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",h(e.signed,(function(e){return e?"[-+]":""}),!0)+h(e.separator,(function(t){if(!t)return"(?:\\d+)";" "===(t=Object(i.bP)(t))?t="\\s":" "===t&&(t="\\s\\xa0");const r=e.groupSize,n=e.groupSize2;if(n){const e="(?:0|[1-9]\\d{0,"+(n-1)+"}(?:["+t+"]\\d{"+n+"})*["+t+"]\\d{"+r+"})";return r-n>0?"(?:"+e+"|(?:0|[1-9]\\d{0,"+(r-1)+"}))":e}return"(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*)"}),!0)}const h=function(e,t,r){if(!(e instanceof Array))return t(e);const i=[];for(let r=0;r<e.length;r++)i.push(t(e[r]));return d(i.join("|"),r)},d=function(e,t){return"("+(t?"?:":"")+e+")"}},function(e,t,r){"use strict";function i(e,t,r=32774,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function n(e,t,r,i,n=32774,s=32774,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}r.d(t,"a",(function(){return L})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"f",(function(){return y}));const s={zNear:0,zFar:1},a={r:!0,g:!0,b:!0,a:!0};function o(e){return b.intern(e)}function l(e){return x.intern(e)}function c(e){return w.intern(e)}function u(e){return I.intern(e)}function h(e){return T.intern(e)}function d(e){return E.intern(e)}function f(e){return M.intern(e)}function p(e){return F.intern(e)}function y(e){return D.intern(e)}class g{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),r=this.interns;return r.has(t)||r.set(t,this.makeRef(e)),r.get(t)}}function m(e){return"["+e.join(",")+"]"}const b=new g(_,(e=>({__tag:"Blending",...e})));function _(e){return e?m([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const x=new g(v,(e=>({__tag:"Culling",...e})));function v(e){return e?m([e.face,e.mode]):null}const w=new g(O,(e=>({__tag:"PolygonOffset",...e})));function O(e){return e?m([e.factor,e.units]):null}const I=new g(S,(e=>({__tag:"DepthTest",...e})));function S(e){return e?m([e.func]):null}const T=new g(j,(e=>({__tag:"StencilTest",...e})));function j(e){return e?m([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const E=new g(A,(e=>({__tag:"DepthWrite",...e})));function A(e){return e?m([e.zNear,e.zFar]):null}const M=new g(R,(e=>({__tag:"ColorWrite",...e})));function R(e){return e?m([e.r,e.g,e.b,e.a]):null}const F=new g(C,(e=>({__tag:"StencilWrite",...e})));function C(e){return e?m([e.mask]):null}const D=new g((function(e){return e?m([_(e.blending),v(e.culling),O(e.polygonOffset),S(e.depthTest),j(e.stencilTest),A(e.depthWrite),R(e.colorWrite),C(e.stencilWrite)]):null}),(e=>({blending:o(e.blending),culling:l(e.culling),polygonOffset:c(e.polygonOffset),depthTest:u(e.depthTest),stencilTest:h(e.stencilTest),depthWrite:d(e.depthWrite),colorWrite:f(e.colorWrite),stencilWrite:p(e.stencilWrite)})));class L{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}setBlending(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}setCulling(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}setPolygonOffset(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}setDepthTest(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}setStencilTest(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}setDepthWrite(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}setColorWrite(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}setStencilWrite(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}setSubState(e,t,r,i){return(r||e!==t)&&(i(e),this._pipelineInvalid=!0),e}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return M})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return _})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return g})),r.d(t,"g",(function(){return m})),r.d(t,"h",(function(){return h})),r.d(t,"i",(function(){return d})),r.d(t,"j",(function(){return v})),r.d(t,"k",(function(){return u})),r.d(t,"l",(function(){return p})),r.d(t,"m",(function(){return w})),r.d(t,"n",(function(){return f})),r.d(t,"o",(function(){return y})),r.d(t,"p",(function(){return l}));r(87),r(140),r(163),r(164),r(165),r(139),r(88),r(76),r(167);var i,n=r(0),s=r(1);const a=n.n.getLogger("esri.layers.support.PixelBlock");let o=i=class extends n.a{constructor(e){super(e),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.pixels=null,this.statistics=null}static createEmptyBand(e,t){return new(i.getPixelArrayConstructor(e))(t)}static getPixelArrayConstructor(e){let t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"u32":t=Uint32Array;break;case"f32":t=Float32Array;break;case"f64":t=Float64Array;break;case"c64":case"c128":case"unknown":t=Float32Array}return t}castPixelType(e){if(!e)return"f32";let t=e.toLowerCase();return["u1","u2","u4"].indexOf(t)>-1?t="u8":-1===["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].indexOf(t)&&(t="f32"),t}getPlaneCount(){return this.pixels&&this.pixels.length}addData(e){if(!e.pixels||e.pixels.length!==this.width*this.height)throw new n.s("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push(e.statistics||{minValue:null,maxValue:null})}getAsRGBA(){const e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)}getAsRGBAFloat(){const e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e}updateStatistics(){this.statistics=this.pixels.map((e=>this._calculateBandStatistics(e,this.mask)));const e=this.mask;let t=0;if(e)for(let r=0;r<e.length;r++)e[r]&&t++;else t=this.width*this.height;this.validPixelCount=t}clamp(e){if(!e||"f64"===e||"f32"===e)return;let t;switch(e){case"u8":t=[0,255];break;case"u16":t=[0,65535];break;case"u32":t=[0,4294967295];break;case"s8":t=[-128,127];break;case"s16":t=[-32768,32767];break;case"s32":t=[-2147483648,2147483647];break;default:t=[-34e38,34e38]}const[r,n]=t,s=this.pixels,a=this.width*this.height,o=s.length;let l,c,u;const h=[];for(let t=0;t<o;t++){u=i.createEmptyBand(e,a),l=s[t];for(let e=0;e<a;e++)c=l[e],u[e]=c>n?n:c<r?r:c;h.push(u)}this.pixels=h,this.pixelType=e}extractBands(e){if(Object(n.J)(e)||0===e.length||null==this.pixels||0===this.pixels.length)return this;const t=this.pixels.length,r=e.some((e=>e>=this.pixels.length)),s=t===e.length&&!e.some(((e,t)=>e!==t));return r||s?this:new i({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:e.map((e=>this.pixels[e])),statistics:this.statistics&&e.map((e=>this.statistics[e]))})}clone(){const e=new i({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let t;this.mask&&(this.mask instanceof Uint8Array?e.mask=new Uint8Array(this.mask):e.mask=this.mask.slice(0));const r=i.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){e.pixels=[];const i=this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)e.pixels[t]=i?this.pixels[t].slice(0,this.pixels[t].length):new r(this.pixels[t])}if(this.statistics)for(e.statistics=[],t=0;t<this.statistics.length;t++)e.statistics[t]=Object(s.o)(this.statistics[t]);return e}_fillFrom8Bit(e){const{mask:t,maskIsAlpha:r,pixels:i}=this;if(!e||!i||!i.length)return void a.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let n,s,o,l;n=s=o=i[0],i.length>=3?(s=i[1],o=i[2]):2===i.length&&(s=i[1]);const c=new Uint32Array(e),u=this.width*this.height;if(n.length===u)if(t&&t.length===u)if(r)for(l=0;l<u;l++)t[l]&&(c[l]=t[l]<<24|o[l]<<16|s[l]<<8|n[l]);else for(l=0;l<u;l++)t[l]&&(c[l]=255<<24|o[l]<<16|s[l]<<8|n[l]);else for(l=0;l<u;l++)c[l]=255<<24|o[l]<<16|s[l]<<8|n[l];else a.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(e){const{pixels:t,mask:r,statistics:i}=this;if(!e||!t||!t.length)return void a.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const n=this.pixelType;let s=1,o=0,l=1;if(i&&i.length>0)o=i.map((e=>e.minValue)).reduce(((e,t)=>Math.min(e,t))),l=i.map((e=>e.maxValue-e.minValue)).reduce(((e,t)=>Math.max(e,t))),s=255/l;else{let e=255;"s8"===n?(o=-128,e=127):"u16"===n?e=65535:"s16"===n?(o=-32768,e=32767):"u32"===n?e=4294967295:"s32"===n?(o=-2147483648,e=2147483647):"f32"===n?(o=-34e38,e=34e38):"f64"===n&&(o=-Number.MAX_VALUE,e=Number.MAX_VALUE),s=255/(e-o)}const c=new Uint32Array(e),u=this.width*this.height;let h,d,f,p,y;if(h=d=f=t[0],h.length!==u)return a.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(d=t[1],t.length>=3&&(f=t[2]),r&&r.length===u)for(p=0;p<u;p++)r[p]&&(c[p]=255<<24|(f[p]-o)*s<<16|(d[p]-o)*s<<8|(h[p]-o)*s);else for(p=0;p<u;p++)c[p]=255<<24|(f[p]-o)*s<<16|(d[p]-o)*s<<8|(h[p]-o)*s;else if(r&&r.length===u)for(p=0;p<u;p++)y=(h[p]-o)*s,r[p]&&(c[p]=255<<24|y<<16|y<<8|y);else for(p=0;p<u;p++)y=(h[p]-o)*s,c[p]=255<<24|y<<16|y<<8|y}_fillFrom32Bit(e){const{pixels:t,mask:r}=this;if(!e||!t||!t.length)return a.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let i,n,s,o;i=n=s=t[0],t.length>=3?(n=t[1],s=t[2]):2===t.length&&(n=t[1]);const l=this.width*this.height;if(i.length!==l)return a.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let c=0;if(r&&r.length===l)for(o=0;o<l;o++)e[c++]=i[o],e[c++]=n[o],e[c++]=s[o],e[c++]=1&r[o];else for(o=0;o<l;o++)e[c++]=i[o],e[c++]=n[o],e[c++]=s[o],e[c++]=1}_calculateBandStatistics(e,t){let r=1/0,i=-1/0;const n=e.length;let s,a=0;if(t)for(s=0;s<n;s++)t[s]&&(a=e[s],r=a<r?a:r,i=a>i?a:i);else for(s=0;s<n;s++)a=e[s],r=a<r?a:r,i=a>i?a:i;return{minValue:r,maxValue:i}}};Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"width",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"height",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"pixelType",void 0),Object(n.e)([Object(n.v)("pixelType")],o.prototype,"castPixelType",null),Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"validPixelCount",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"mask",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"maskIsAlpha",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"pixels",void 0),Object(n.e)([Object(n.y)({json:{write:!0}})],o.prototype,"statistics",void 0),o=i=Object(n.e)([Object(n.i)("esri.layers.support.PixelBlock")],o);var l=o;const c=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0};function u(e,t){if(null==t||!t.length||!c(e))return e;const r=e.pixels.length;return t&&t.some((e=>e>=r))||1===r&&1===t.length&&0===t[0]?e:r!==t.length||t.some(((e,t)=>e!==t))?new l({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:t.map((t=>e.pixels[t])),statistics:e.statistics&&t.map((t=>e.statistics[t]))}):e}function h(e){if(!e)return;const t=e.colormap;if(!t||0===t.length)return;const r=t.sort(((e,t)=>e[0]-t[0]));let i=0;r[0][0]<0&&(i=r[0][0]);const n=Math.max(256,r[r.length-1][0]-i+1),s=new Uint8Array(4*n),a=[];let o,l=0,c=0;const u=5===r[0].length;if(n>65536)return r.forEach((e=>{a[e[0]-i]=u?e.slice(1):e.slice(1).concat([255])})),{indexed2DColormap:a,offset:i,alphaSpecified:u};if(e.fillUnspecified)for(o=r[c],l=o[0]-i;l<n;l++)s[4*l]=o[1],s[4*l+1]=o[2],s[4*l+2]=o[3],s[4*l+3]=u?o[4]:255,l===o[0]-i&&(o=c===r.length-1?o:r[++c]);else for(l=0;l<r.length;l++)o=r[l],c=4*(o[0]-i),s[c]=o[1],s[c+1]=o[2],s[c+2]=o[3],s[c+3]=u?o[4]:255;return{indexedColormap:s,offset:i,alphaSpecified:u}}function d(e,t){if(!c(e))return e;if(!t&&(t.indexedColormap||t.indexed2DColormap))return e;const r=e.clone(),i=r.pixels;let n=r.mask;const s=r.width*r.height;if(1!==i.length)return e;const{indexedColormap:a,indexed2DColormap:o,offset:l,alphaSpecified:u}=t,h=a.length-1;let d=0;const f=i[0],p=new Uint8Array(f.length),y=new Uint8Array(f.length),g=new Uint8Array(f.length);let m,b=0;if(a)if(n)for(d=0;d<s;d++)n[d]&&(b=4*(f[d]-l),b<l||b>h?n[d]=0:(p[d]=a[b],y[d]=a[b+1],g[d]=a[b+2],n[d]=a[b+3]));else{for(n=new Uint8Array(s),d=0;d<s;d++)b=4*(f[d]-l),b<l||b>h?n[d]=0:(p[d]=a[b],y[d]=a[b+1],g[d]=a[b+2],n[d]=a[b+3]);r.mask=n}else if(n)for(d=0;d<s;d++)n[d]&&(m=o[f[d]],p[d]=m[0],y[d]=m[1],g[d]=m[2],n[d]=m[3]);else{for(n=new Uint8Array(s),d=0;d<s;d++)m=o[f[d]],p[d]=m[0],y[d]=m[1],g[d]=m[2],n[d]=m[3];r.mask=n}return r.pixels=[p,y,g],r.statistics=null,r.pixelType="u8",r.maskIsAlpha=u,r}function f(e){if(!c(e))return null;e.statistics||e.updateStatistics();const{pixels:t,mask:r,pixelType:i,statistics:n}=e,s=e.width*e.height,a=t.length;let o,l,u,h,d;const f=[],p=[];let y,g,m,b,_,x,v,w,O,I;const S=256;for(h=0;h<a;h++){if(y=new Uint32Array(S),m=t[h],"u8"===i)if(o=-.5,l=255.5,r)for(d=0;d<s;d++)r[d]&&y[m[d]]++;else for(d=0;d<s;d++)y[m[d]]++;else{if(o=n[h].minValue,l=n[h].maxValue,u=(l-o)/S,g=new Uint32Array(257),r)for(d=0;d<s;d++)r[d]&&g[Math.floor((m[d]-o)/u)]++;else for(d=0;d<s;d++)g[Math.floor((m[d]-o)/u)]++;for(d=0;d<255;d++)y[d]=g[d];y[255]=g[255]+g[256]}for(f.push({min:o,max:l,size:S,counts:y}),b=0,_=0,w=0,d=0;d<S;d++)b+=y[d],_+=d*y[d];for(O=_/b,d=0;d<S;d++)w+=y[d]*(d-O)**2;I=Math.sqrt(w/(b-1)),u=(l-o)/S,x=(O+.5)*u+o,v=I*u,p.push({min:o,max:l,avg:x,stddev:v})}return{statistics:p,histograms:f}}function p(e){const t=[];for(let r=0;r<e.length;r++){const{min:i,max:n,size:s,counts:a}=e[r];let o=0,l=0;for(let e=0;e<s;e++)o+=a[e],l+=e*a[e];const c=l/o;let u=0;for(let e=0;e<s;e++)u+=a[e]*(e-c)**2;const h=(n-i)/s,d=(c+.5)*h+i,f=Math.sqrt(u/(o-1))*h;t.push({min:i,max:n,avg:d,stddev:f})}return t}function y(e){const{minCutOff:t,maxCutOff:r,gamma:i,pixelType:n}=e,s=e.outMin||0,a=e.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(n))return null;const o=t.length;let l,c,u=0;"s8"===n?u=-127:"s16"===n&&(u=-32767);let h=256;["u16","s16"].indexOf(n)>-1&&(h=65536);const d=[],f=[],p=a-s;for(l=0;l<o;l++)f[l]=r[l]-t[l],d[l]=p/(r[l]-t[l]);const y=i&&i.length>=o,g=[];if(y)for(l=0;l<o;l++)i[l]>1?i[l]>2?g[l]=6.5+(i[l]-2)**2.5:g[l]=6.5+100*(2-i[l])**4:g[l]=1;let m;const b=[];let _,x,v;if(y)for(l=0;l<o;l++){for(v=[],c=0;c<h;c++)_=c+u,m=(_-t[l])/f[l],x=1,i[l]>1&&(x-=(1/p)**(m*g[l])),_<r[l]&&_>t[l]?v[c]=Math.floor(x*p*m**(1/i[l]))+s:_>=r[l]?v[c]=a:v[c]=s;b[l]=v}else for(l=0;l<o;l++){for(v=[],c=0;c<h;c++)_=c+u,_<=t[l]?v[c]=s:_>=r[l]?v[c]=a:v[c]=Math.floor((_-t[l])/f[l]*p)+s;b[l]=v}if(null!=e.contrastOffset){const t=function(e,t){const r=Math.min(Math.max(e,-100),100),i=Math.min(Math.max(t,-100),100),n=255,s=128;let a,o;const l=new Uint8Array(256);for(a=0;a<256;a++)r>0&&r<100?o=(200*a-100*n+2*n*i)/(2*(100-r))+s:r<=0&&r>-100?o=(200*a-100*n+2*n*i)*(100+r)/2e4+s:100===r?(o=200*a-100*n+(n+1)*(100-r)+2*n*i,o=o>0?n:0):-100===r&&(o=s),l[a]=o>n?n:o<0?0:o;return l}(e.contrastOffset,e.brightnessOffset);for(l=0;l<o;l++)for(v=b[l],c=0;c<h;c++)v[c]=t[v[c]]}return{lut:b,offset:u}}function g(e,t=256){t=Math.min(t,256);const{size:r,counts:i}=e,n=new Uint8Array(r),s=i.reduce(((e,r)=>e+r/t),0);let a=0,o=0,l=0,c=s;for(let e=0;e<r;e++)if(l+=i[e],!(e<r-1&&l+i[e+1]<c)){for(;a<t-1&&c<l;)a++,c+=s;for(let t=o;t<=e;t++)n[t]=a;o=e+1}for(let e=o;e<r;e++)n[e]=t-1;return n}function m(e,t){if(!c(e))return null;const r=e.clone(),{pixels:i,mask:n}=r,{minCutOff:s,maxCutOff:a,gamma:o}=t,l=t.outMin||0,u=t.outMax||255,h=r.width*r.height,d=i.length;let f,p,y,g,m;const b=u-l,_=[],x=[];for(f=0;f<d;f++)x[f]=a[f]-s[f],_[f]=b/(a[f]-s[f]);const v=o&&o.length>=d,w=[];if(v)for(f=0;f<d;f++)o[f]>1?o[f]>2?w[f]=6.5+(o[f]-2)**2.5:w[f]=6.5+100*(2-o[f])**4:w[f]=1;if(v)if(null!=n){for(p=0;p<h;p++)if(n[p])for(f=0;f<d;f++)y=i[f][p],m=(y-s[f])/x[f],g=1,o[f]>1&&(g-=(1/b)**(m*w[f])),y<a[f]&&y>s[f]?i[f][p]=Math.floor(g*b*m**(1/o[f]))+l:y>=a[f]?i[f][p]=u:i[f][p]=l}else for(p=0;p<h;p++)for(f=0;f<d;f++)y=i[f][p],m=(y-s[f])/x[f],g=1,o[f]>1&&(g-=(1/b)**(m*w[f])),y<a[f]&&y>s[f]?i[f][p]=Math.floor(g*b*m**(1/o[f]))+l:y>=a[f]?i[f][p]=u:i[f][p]=l;else if(null!=n){for(p=0;p<h;p++)if(n[p])for(f=0;f<d;f++)y=i[f][p],y<a[f]&&y>s[f]?i[f][p]=Math.floor((y-s[f])/x[f]*b)+l:y>=a[f]?i[f][p]=u:i[f][p]=l}else for(p=0;p<h;p++)for(f=0;f<d;f++)y=i[f][p],y<a[f]&&y>s[f]?i[f][p]=Math.floor((y-s[f])/x[f]*b)+l:y>=a[f]?i[f][p]=u:i[f][p]=l;return r.pixelType="u8",r.updateStatistics(),r}function b(e,t){if(!c(e))return null;const{pixels:r,mask:i}=e,n=e.width*e.height,s=r.length;let a=t.lut;const{offset:o}=t;let u,h;a&&1===a[0].length&&(a=r.map((()=>a)));const d=[];let f,p,y;if(o)if(null==i)for(u=0;u<s;u++){for(f=r[u],p=a[u],y=new Uint8Array(n),h=0;h<n;h++)y[h]=p[f[h]-o];d.push(y)}else for(u=0;u<s;u++){for(f=r[u],p=a[u],y=new Uint8Array(n),h=0;h<n;h++)i[h]&&(y[h]=p[f[h]-o]);d.push(y)}else if(null==i)for(u=0;u<s;u++){for(f=r[u],p=a[u],y=new Uint8Array(n),h=0;h<n;h++)y[h]=p[f[h]];d.push(y)}else for(u=0;u<s;u++){for(f=r[u],p=a[u],y=new Uint8Array(n),h=0;h<n;h++)i[h]&&(y[h]=p[f[h]]);d.push(y)}const g=new l({width:e.width,height:e.height,pixels:d,mask:i,pixelType:"u8"});return g.updateStatistics(),g}function _(e,t){if(!c(e))return null;const r=e.clone(),{pixels:i}=r,n=r.width*r.height,s=t.length,a=Math.floor(s/2),o=t[Math.floor(a)],l=i[0];let u,h,d,f,p,y,g=!1;const m=new Uint8Array(n),b=new Uint8Array(n),_=new Uint8Array(n);let x=r.mask;const v=4===t[0].mappedColor.length;for(x||(x=new Uint8Array(n),x.fill(v?255:1),r.mask=x),p=0;p<n;p++)if(x[p]){for(u=l[p],g=!1,y=a,h=o,d=0,f=s-1;f-d>1;){if(u===h.value){g=!0;break}u>h.value?d=y:f=y,y=Math.floor((d+f)/2),h=t[Math.floor(y)]}g||(u===t[d].value?(h=t[d],g=!0):u===t[f].value?(h=t[f],g=!0):u<t[d].value?(g=!1,h=null):u>t[d].value&&(u<t[f].value?(h=t[d],g=!0):f===s-1?(g=!1,h=null):(h=t[f],g=!0))),g?(m[p]=h.mappedColor[0],b[p]=h.mappedColor[1],_[p]=h.mappedColor[2],x[p]=h.mappedColor[3]):m[p]=b[p]=_[p]=x[p]=0}return r.pixels=[m,b,_],r.mask=x,r.pixelType="u8",r.maskIsAlpha=v,r}function x(e,t,r,i,n,s,a,o){return{xmin:n<=r*e?0:n<r*e+e?n-r*e:e,ymin:s<=i*t?0:s<i*t+t?s-i*t:t,xmax:n+a<=r*e?0:n+a<r*e+e?n+a-r*e:e,ymax:s+o<=i*t?0:s+o<i*t+t?s+o-i*t:t}}function v(e,t){if(!e||0===e.length)return null;const r=e.filter((e=>e.pixelBlock))[0];if(!r)return null;const i=(r.extent.xmax-r.extent.xmin)/r.pixelBlock.width,n=(r.extent.ymax-r.extent.ymin)/r.pixelBlock.height,s=.01*Math.min(i,n),a=e.sort(((e,t)=>Math.abs(e.extent.ymax-t.extent.ymax)>s?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>s?e.extent.xmin-t.extent.xmin:0)),o=Math.min.apply(null,a.map((e=>e.extent.xmin))),l=Math.min.apply(null,a.map((e=>e.extent.ymin))),c=Math.max.apply(null,a.map((e=>e.extent.xmax))),u=Math.max.apply(null,a.map((e=>e.extent.ymax))),h={x:Math.round((t.xmin-o)/i),y:Math.round((u-t.ymax)/n)},d={width:Math.round((c-o)/i),height:Math.round((u-l)/n)},f={width:Math.round((t.xmax-t.xmin)/i),height:Math.round((t.ymax-t.ymin)/n)};return Math.round(d.width/r.pixelBlock.width)*Math.round(d.height/r.pixelBlock.height)!==a.length||h.x<0||h.y<0||d.width<f.width||d.height<f.height?null:{extent:t,pixelBlock:w(a.map((e=>e.pixelBlock)),d,h,f)}}function w(e,t,r,i){const n=e.filter((e=>c(e)))[0];if(null==n)return null;const s=i?i.width:t.width,a=i?i.height:t.height,o=n.width,u=n.height,h=t.width/o,d=t.height/u,f=r?r.x:0,p=r?r.y:0,y=n.pixelType,g=l.getPixelArrayConstructor(y),m=n.pixels.length,b=[];let _,v,w,O,I,S,T,j,E,A,M,R,F;for(S=0;S<m;S++){for(v=new g(s*a),T=0;T<d;T++)for(j=0;j<h;j++)if(w=e[T*h+j],c(w))for(_=w.pixels[S],M=x(o,u,j,T,f,p,s,a),E=M.ymin;E<M.ymax;E++)for(O=(T*u+E-p)*s+(j*o-f),I=E*o,A=M.xmin;A<M.xmax;A++)v[O+A]=_[I+A];b.push(v)}if(e.some((e=>null==e||e.mask&&e.mask.length>0)))for(R=new Uint8Array(s*a),T=0;T<d;T++)for(j=0;j<h;j++)if(w=e[T*h+j],F=w?w.mask:null,M=x(o,u,j,T,f,p,s,a),F)for(E=M.ymin;E<M.ymax;E++)for(O=(T*u+E-p)*s+(j*o-f),I=E*o,A=M.xmin;A<M.xmax;A++)R[O+A]=F[I+A];else if(w)for(E=M.ymin;E<M.ymax;E++)for(O=(T*u+E-p)*s+(j*o-f),I=E*o,A=M.xmin;A<M.xmax;A++)R[O+A]=1;else for(E=M.ymin;E<M.ymax;E++)for(O=(T*u+E-p)*s+(j*o-f),I=E*o,A=M.xmin;A<M.xmax;A++)R[O+A]=0;const C=new l({width:s,height:a,pixels:b,pixelType:y,mask:R});return C.updateStatistics(),C}function O(e,t,r){if(!c(e))return null;const{width:i,height:n}=e,s=t.x,a=t.y,o=r.width+s,l=r.height+a;if(s<0||a<0||o>i||l>n)return e;if(0===s&&0===a&&o===i&&l===n)return e;e.mask||(e.mask=new Uint8Array(i*n));const u=e.mask;for(let e=0;e<n;e++){const t=e*i;for(let r=0;r<i;r++)u[t+r]=e<a||e>=l||r<s||r>=o?0:1}return e.updateStatistics(),e}function I(e){if(!c(e))return null;const t=e.clone(),{width:r,height:i,pixels:n,mask:s}=e,a=n[0],o=t.pixels[0];for(let e=2;e<i-1;e++){const t=new Map;for(let i=e-2;i<e+2;i++)for(let e=0;e<4;e++){const n=i*r+e;j(t,a[n],s?s[n]:1)}o[e*r]=S(t),o[e*r+1]=o[e*r+2]=o[e*r];let i=3;for(;i<r-1;i++){let n=(e-2)*r+i+1;j(t,a[n],s?s[n]:1),n=(e-1)*r+i+1,j(t,a[n],s?s[n]:1),n=e*r+i+1,j(t,a[n],s?s[n]:1),n=(e+1)*r+i+1,j(t,a[n],s?s[n]:1),n=(e-2)*r+i-3,T(t,a[n],s?s[n]:1),n=(e-1)*r+i-3,T(t,a[n],s?s[n]:1),n=e*r+i-3,T(t,a[n],s?s[n]:1),n=(e+1)*r+i-3,T(t,a[n],s?s[n]:1),o[e*r+i]=S(t)}o[e*r+i+1]=o[e*r+i]}for(let e=0;e<r;e++)o[e]=o[r+e]=o[2*r+e],o[(i-1)*r+e]=o[(i-2)*r+e];return t.updateStatistics(),t}function S(e){if(0===e.size)return 0;let t=0,r=-1,i=0;const n=e.keys();let s=n.next();for(;!s.done;)i=e.get(s.value),i>t&&(r=s.value,t=i),s=n.next();return r}function T(e,t,r){if(0===r)return;const i=e.get(t);1===i?e.delete(t):e.set(t,i-1)}function j(e,t,r){0!==r&&e.set(t,e.has(t)?e.get(t)+1:1)}function E(e,t,r){let{x:i,y:n}=t;const{width:s,height:a}=r;if(0===i&&0===n&&a===e.height&&s===e.width)return e;const{width:o,height:u}=e,h=Math.max(0,n),d=Math.max(0,i),f=Math.min(i+s,o),p=Math.min(n+a,u);if(f<0||p<0||!c(e))return null;i=Math.max(0,-i),n=Math.max(0,-n);const{pixels:y,mask:g}=e,m=s*a,b=y.length,_=[];for(let t=0;t<b;t++){const r=y[t],a=l.createEmptyBand(e.pixelType,m);for(let e=h;e<p;e++){const t=e*o;let l=(e+n-h)*s+i;for(let e=d;e<f;e++)a[l++]=r[t+e]}_.push(a)}const x=new Uint8Array(m);for(let e=h;e<p;e++){const t=e*o;let r=(e+n-h)*s+i;for(let e=d;e<f;e++)x[r++]=g?g[t+e]:1}const v=new l({width:r.width,height:r.height,pixelType:e.pixelType,pixels:_,mask:x});return v.updateStatistics(),v}function A(e,t=!0){if(!c(e))return null;const{pixels:r,width:i,height:n,mask:s,pixelType:a}=e,o=[],u=Math.round(i/2),h=Math.round(n/2),d=n-1,f=i-1;for(let e=0;e<r.length;e++){const s=r[e],c=l.createEmptyBand(a,u*h);let p=0;for(let e=0;e<n;e+=2)for(let r=0;r<i;r+=2){const n=s[e*i+r];if(t){const t=r===f?n:s[e*i+r+1],a=e===d?n:s[e*i+r+i],o=r===f?a:e===d?t:s[e*i+r+i+1];c[p++]=(n+t+a+o)/4}else c[p++]=n}o.push(c)}let p=null;if(s){p=new Uint8Array(u*h);let e=0;for(let r=0;r<n;r+=2)for(let n=0;n<i;n+=2){const a=s[r*i+n];if(t){const t=n===f?a:s[r*i+n+1],o=r===d?a:s[r*i+n+i],l=n===f?o:r===d?t:s[r*i+n+i+1];p[e++]=a*t*o*l?1:0}else p[e++]=a}}return new l({width:u,height:h,pixelType:a,pixels:o,mask:p})}function M(e,t,r){if(!c(e))return null;const{width:i,height:n}=t;let{width:s,height:a}=e;const o=new Map,l={x:0,y:0},u=null==r?1:1+r;let h=e;for(let e=0;e<u;e++){const r=Math.ceil(s/i),c=Math.ceil(a/n);for(let s=0;s<c;s++){l.y=s*n;for(let n=0;n<r;n++){l.x=n*i;const r=E(h,l,t);o.set(`${e}/${s}/${n}`,r)}}e<u-1&&(h=A(h)),s=Math.round(s/2),a=Math.round(a/2)}return o}function R(e,t,r,i,n="nearest"){if(!c(e))return null;"majority"===n&&(e=I(e));const{pixels:s,mask:a,pixelType:o}=e,u=e.width,h=e.height,d=l.getPixelArrayConstructor(o),f=s.length,{width:p,height:y}=t,g=i.cols,m=i.rows,b=Math.ceil(p/g),_=Math.ceil(y/m);let x,v,w,O,S,T,j,E=!1;for(let e=0;e<r.length;e+=3)-1===r[e]&&-1===r[e+1]&&-1===r[e+2]&&(E=!0);const A=new Float32Array(p*y),M=new Float32Array(p*y);let R,F,C=0;const D="majority"===n?0:.5;for(let e=0;e<_;e++)for(let t=0;t<b;t++){x=12*(e*b+t),v=r[x],w=r[x+1],O=r[x+2],S=r[x+3],T=r[x+4],j=r[x+5];for(let r=0;r<m;r++){C=(e*m+r)*p+t*g,F=(r+.5)/m;for(let e=0;e<r;e++)R=(e+.5)/g,A[C+e]=Math.round((v*R+w*F+O)*u-D),M[C+e]=Math.round((S*R+T*F+j)*h-D)}x+=6,v=r[x],w=r[x+1],O=r[x+2],S=r[x+3],T=r[x+4],j=r[x+5];for(let r=0;r<m;r++){C=(e*m+r)*p+t*g,F=(r+.5)/m;for(let e=r;e<g;e++)R=(e+.5)/g,A[C+e]=Math.round((v*R+w*F+O)*u-D),M[C+e]=Math.round((S*R+T*F+j)*h-D)}}const L=(e,t)=>{for(let r=0;r<y;r++){x=r*p;for(let r=0;r<p;r++)A[x]<0||M[x]<0?e[x]=0:e[x]=t[A[x]+M[x]*u],x++}},N=[];let P;for(let e=0;e<f;e++)P=new d(p*y),L(P,s[e]),N.push(P);const B=new l({width:p,height:y,pixelType:o,pixels:N});if(a)B.mask=new Uint8Array(p*y),L(B.mask,a);else if(E){B.mask=new Uint8Array(p*y);for(let e=0;e<p*y;e++)B.mask[e]=A[e]<0||M[e]<0?0:1}return B.updateStatistics(),B}},function(e,t,r){"use strict";function i(e){return"h"in e&&"s"in e&&"v"in e}function n(e){return"l"in e&&"a"in e&&"b"in e}function s(e){return"l"in e&&"c"in e&&"h"in e}r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return m}));const a=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],o=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){const r=[];let i,n;if(e[0].length!==t.length)throw"dimensions do not match";const s=e.length,a=e[0].length;let o=0;for(i=0;i<s;i++){for(o=0,n=0;n<a;n++)o+=e[i][n]*t[n];r.push(o)}return r}function c(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),r=l(a,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function u(e){const t=l(o,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function h(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function f(e){return function(e){const t=e.l,r=e.a,i=e.b,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s=s>0?s:s+2*Math.PI,{l:t,c:n,h:s}}(h(c(e)))}function p(e){return u(d(function(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}(e)))}function y(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:s(e)?p(e):n(e)?function(e){return u(d(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?u(e):i(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,n=i*r,s=n*(1-Math.abs(t%2-1));let a;switch(Math.floor(t)){case 0:a={r:n,g:s,b:0};break;case 1:a={r:s,g:n,b:0};break;case 2:a={r:0,g:n,b:s};break;case 3:a={r:0,g:s,b:n};break;case 4:a={r:s,g:0,b:n};break;case 5:case 6:a={r:n,g:0,b:s};break;default:a={r:0,g:0,b:0}}return a.r=Math.round(a.r+i-n),a.g=Math.round(a.g+i-n),a.b=Math.round(a.b+i-n),a}(e):e}function g(e){return i(e)?e:function(e){const t=e.r,r=e.g,i=e.b,n=Math.max(t,r,i),s=n-Math.min(t,r,i);let a=n,o=0===s?0:n===t?(r-i)/s%6:n===r?(i-t)/s+2:(t-r)/s+4,l=0===s?0:s/a;return o<0&&(o+=6),o*=60,l*=100,a*=100/255,{h:o,s:l,v:a}}(y(e))}function m(e){return n(e)?e:function(e){return h(c(e))}(y(e))}function b(e){return s(e)?e:f(y(e))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));r(87);var i,n=r(0),s=r(1),a=r(5),o=r(111);class l{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;const r=(e-this.location.top)*this.location.width+(t-this.location.left),i=r%8,n=r>>3,s=this._tileAvailabilityBitSet;return n<0||n>s.length?"unknown":s[n]&1<<i?"available":"unavailable"}_updateFromData(e){const t=this.location.width,r=this.location.height;let i=!0,n=!0;const s=Math.ceil(t*r/8),a=new Uint8Array(s);let o=0;for(let t=0;t<e.length;t++){const r=t%8;e[t]?(n=!1,a[o]|=1<<r):i=!1,7===r&&++o}n?this._allAvailability="unavailable":i?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)}static fromDefinition(e,t){const r=e.service.request||n.C,{row:i,col:s,width:a,height:o}=e,c={query:{f:"json"}};return t=t?{...c,...t}:c,r(function(e){let t;if("vector-tile"===e.service.type)t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const r=e.service.tileServers;t=`${r&&r.length?r[e.row%r.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const r=e.service.query;return r&&(t=`${t}?${r}`),t}(e),t).then((e=>e.data)).catch((e=>{if(e&&e.details&&422===e.details.httpStatus)return{location:{top:i,left:s,width:a,height:o},valid:!0,data:Object(n.bV)(a*o,0)};throw e})).then((e=>{if(e.location&&(e.location.top!==i||e.location.left!==s||e.location.width!==a||e.location.height!==o))throw new n.s("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:i,left:s,width:a,height:o}});return l.fromJSON(e)}))}static fromJSON(e){l.validateJSON(e);const t=new l;return t.location=Object.freeze(Object(s.o)(e.location)),t._updateFromData(e.data),Object.freeze(t)}static validateJSON(e){if(!e||!e.location)throw new n.s("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new n.s("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new n.s("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new n.s("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new n.s("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function c(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const u=n.n.getLogger("esri.layers.support.TilemapCache");let h=i=class extends n.u{constructor(e){super(e),this._handles=new n.w,this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=n.C,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new o.a(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(()=>this._initializeTilemapDefinition())),Object(a.g)(this,"layer.tileInfo.lods",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}castLevels(e){return e<=2?(u.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,r,i){if(!this._availableLevels[e])return Promise.reject(new n.s("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,r,s);if(a)return Promise.resolve(a);const o=i&&i.signal;return i={...i,signal:null},new Promise(((e,t)=>{Object(n.a8)(o,(()=>t(Object(n.ae)())));const r=c(s);let a=this._pendingTilemapRequests[r];if(!a){a=l.fromDefinition(s,i).then((e=>(this._tilemapCache.put(r,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[r];this._pendingTilemapRequests[r]=a,a.then(e,e)}a.then(e,t)}))}getAvailability(e,t,r){if(!this._availableLevels[e])return"unavailable";const i=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return i?i.getAvailability(t,r):"unknown"}getAvailabilityUpsample(e,t,r,i){i.level=e,i.row=t,i.col=r;const n=this.layer.tileInfo;for(n.updateTileInfo(i);;){const e=this.getAvailability(i.level,i.row,i.col);if("unavailable"!==e)return e;if(!n.upsampleTile(i))return"unavailable"}}fetchAvailability(e,t,r,i){return this._availableLevels[e]?this.fetchTilemap(e,t,r,i).catch((e=>e)).then((i=>{if(i instanceof l){const s=i.getAvailability(t,r);return"unavailable"===s?Promise.reject(new n.s("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})):s}if(Object(n.B)(i))throw i;return"unknown"})):Promise.reject(new n.s("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,r,i,s){i.level=e,i.row=t,i.col=r;const a=this.layer.tileInfo;a.updateTileInfo(i);const o=this.fetchAvailability(e,t,r,s).catch((e=>{if(Object(n.B)(e))throw e;if(a.upsampleTile(i))return this.fetchAvailabilityUpsample(i.level,i.row,i.col,i);throw e}));return this._fetchAvailabilityUpsamplePrefetch(i.id,e,t,r,s,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,r,s,a,o){if(!this._prefetchingEnabled)return;const l=`prefetch-${e}`;if(this._handles.has(l))return;const c=Object(n.V)();o.then((()=>c.abort()),(()=>c.abort()));let u=!1;const h={remove(){u||(u=!0,c.abort())}};if(this._handles.add(h,l),await Object(n.bW)(10,c.signal).catch((()=>{})),u||(u=!0,this._handles.remove(l)),Object(n.ad)(c))return;const d={id:e,level:t,row:r,col:s},f={...a,signal:c.signal},p=this.layer.tileInfo;for(let e=0;i._prefetches.length<i._maxPrefetch&&p.upsampleTile(d);++e){const e=this.fetchAvailability(d.level,d.row,d.col,f);i._prefetches.push(e);const t=()=>{i._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?Object(n.bU)(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,r,i){i.level=e,i.row=t-t%this.size,i.col=r-r%this.size;const n=c(i);return this._tilemapCache.get(n)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,r,i)=>!!e._tilemapFromCache(t,r,i,e._tmpTilemapDefinition)}}};h._maxPrefetch=4,h._prefetches=new n.aC({initialSize:i._maxPrefetch}),Object(n.e)([Object(n.y)({constructOnly:!0,type:Number})],h.prototype,"levels",void 0),Object(n.e)([Object(n.v)("levels")],h.prototype,"castLevels",null),Object(n.e)([Object(n.y)({readOnly:!0,type:Number})],h.prototype,"size",null),Object(n.e)([Object(n.y)({constructOnly:!0,type:Number})],h.prototype,"cacheByteSize",void 0),Object(n.e)([Object(n.y)({constructOnly:!0})],h.prototype,"layer",void 0),Object(n.e)([Object(n.y)({constructOnly:!0})],h.prototype,"request",void 0),h=i=Object(n.e)([Object(n.i)("esri.layers.support.TilemapCache")],h)},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},function(e,t,r){"use strict";r.d(t,"a",(function(){return C})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return F})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return L})),r.d(t,"i",(function(){return D})),r.d(t,"j",(function(){return R})),r.d(t,"k",(function(){return x}));r(18);var i=r(0),n=r(9),s=r(17),a=r(83),o=r(327),l=r(10),c=r(106);const u=new i.aM({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),h=Object.freeze({}),d=new s.a,f=new s.a,p=new s.a,y={esriGeometryPoint:a.y,esriGeometryPolyline:a.b,esriGeometryPolygon:a.a,esriGeometryMultipoint:a.j};function g(e,t,r,i=e.hasZ,n=e.hasM){const s=e.hasZ&&i,o=e.hasM&&n;if(r){const l=Object(a.o)(p,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,n);return Object(a.y)(l,s,o)}return Object(a.y)(t,s,o)}function m(e,t,r,i,n,s,o=t,l=r){const c=t&&o,u=r&&l,h=i?"coords"in i?i:i.geometry:null;if(!h)return null;if(n){let i=Object(a.s)(f,h,t,r,e,n,o,l);return s&&(i=Object(a.o)(p,i,c,u,e,s)),y[e](i,c,u)}if(s){const i=Object(a.o)(p,h,t,r,e,s,o,l);return y[e](i,c,u)}return Object(a.r)(d,h,t,r,o,l),y[e](d,c,u)}async function b(e,t,r){const{outFields:i,orderByFields:n,groupByFieldsForStatistics:s,outStatistics:a}=e;if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),_(e,t,r)}async function _(e,t,s){if(!e)return null;let{where:a}=e;if(e.where=a=a&&a.trim(),(!a||/^1 *= *1$/.test(a)||t&&t===a)&&(e.where=null),!e.geometry)return e;let d=await async function(e){const{geometry:t,distance:n,units:s}=e;if(null==n||"vertexAttributes"in t)return t;const a=t.spatialReference,c=s?u.fromJSON(s):Object(l.f)(a),h=a&&(Object(i.b5)(a)||Object(i.bp)(a))?t:await Object(o.g)(a,i.cu).then((()=>Object(o.j)(t,i.cu)));return(await async function(){return(await Promise.all([r.e(5),r.e(0),r.e(9)]).then(r.bind(null,391))).geodesicBuffer}())(h.spatialReference,h,n,c)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;d=Object(i.cw)(d),d.spatialReference=t}e.geometry=d,await Object(o.g)(d.spatialReference,s);const f=(await Object(c.a)(Object(n.e)(d)))[0];if(Object(i.J)(f))throw h;const p=f.toJSON(),y=await Object(o.j)(p,p.spatialReference,s);if(!y)throw h;return y.spatialReference=s,e.geometry=y,e}function x(e){return e&&v in e?JSON.parse(JSON.stringify(e,w)):e}const v="_geVersion",w=(e,t)=>e!==v?t:void 0;function O(e,t){return e?t?4:3:t?3:2}function I(e,t,r,i,n){if(!e)return!1;const s=O(t,r),{coords:a,lengths:o}=e;let l=!1,c=0;for(const e of o)l=S(l,a,s,c,e,i,n),c+=e*s;return l}function S(e,t,r,i,n,s,a){let o=e,l=i;for(let e=i,c=i+n*r;e<c;e+=r){l=e+r,l===c&&(l=i);const n=t[e],u=t[e+1],h=t[l],d=t[l+1];(u<a&&d>=a||d<a&&u>=a)&&n+(a-u)/(d-u)*(h-n)<s&&(o=!o)}return o}const T="feature-store:unsupported-query",j={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},E={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},A={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},M={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function R(e,t,o,l,c){if(Object(n.h)(t)&&"esriGeometryPoint"===o&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=Object(a.d)(new s.a,t,!1,!1);return Promise.resolve((t=>function(e,t,r,i){return I(e,t,r,i.coords[0],i.coords[1])}(e,!1,!1,t)))}if(Object(n.h)(t)&&"esriGeometryMultipoint"===o){const r=Object(a.d)(new s.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>function(e,t,r,i,n,s){const a=O(n,s),{coords:o,lengths:l}=i;if(!l)return!1;for(let i=0,n=0;i<l.length;i++,n+=a)if(!I(e,t,r,o[n],o[n+1]))return!1;return!0}(r,!1,!1,e,l,c)))}if(Object(n.g)(t)&&"esriGeometryPoint"===o&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>Object(i.as)(t,m(o,l,c,e))));if(Object(n.g)(t)&&"esriGeometryMultipoint"===o&&"esriSpatialRelContains"===e)return Promise.resolve((e=>Object(i.cx)(t,m(o,l,c,e))));if(Object(n.g)(t)&&"esriSpatialRelIntersects"===e){const e=Object(i.cy)(o);return Promise.resolve((r=>e(t,m(o,l,c,r))))}return Promise.all([r.e(5),r.e(0),r.e(9)]).then(r.bind(null,391)).then((r=>{const i=r[j[e]].bind(null,t.spatialReference,t);return e=>i(m(o,l,c,e))}))}async function F(e,t,r){const{spatialRel:s,geometry:a}=e;if(a){if(!function(e){return!0===E[e]}(s))throw new i.s(T,"Unsupported query spatial relationship",{query:e});if(Object(i.an)(a.spatialReference)&&Object(i.an)(r)){if(!function(e){return!0===A[Object(n.b)(e)]}(a))throw new i.s(T,"Unsupported query geometry type",{query:e});if(!function(e){return!0===M[e]}(t))throw new i.s(T,"Unsupported layer geometry type",{query:e});if(e.outSR)return Object(o.g)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function C(e){if(Object(n.g)(e))return!0;if(Object(n.h)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}function D(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:i,endTimeField:n}=e;let s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(i&&n)t.forEach((e=>{const t=r.getAttribute(e,i),o=r.getAttribute(e,n);null==t||isNaN(t)||(s=Math.min(s,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=i||n;t.forEach((t=>{const i=r.getAttribute(t,e);null==i||isNaN(i)||(s=Math.min(s,i),a=Math.max(a,i))}))}return{start:s,end:a}}function L(e,t,r){if(!t||!e)return null;const{startTimeField:i,endTimeField:n}=e;if(!i&&!n)return null;const{start:s,end:a}=t;return null===s&&null===a?null:void 0===s&&void 0===a?()=>!1:i&&n?function(e,t,r,i,n){return null!=i&&null!=n?s=>{const a=e.getAttribute(s,t),o=e.getAttribute(s,r);return(null==a||a<=n)&&(null==o||o>=i)}:null!=i?t=>{const n=e.getAttribute(t,r);return null==n||n>=i}:null!=n?r=>{const i=e.getAttribute(r,t);return null==i||i<=n}:void 0}(r,i,n,s,a):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e.getAttribute(i,t)===r:null!=r&&null!=i?n=>{const s=e.getAttribute(n,t);return s>=r&&s<=i}:null!=r?i=>e.getAttribute(i,t)>=r:null!=i?r=>e.getAttribute(r,t)<=i:void 0}(r,i||n,s,a)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return m})),r.d(t,"g",(function(){return u})),r.d(t,"h",(function(){return p})),r.d(t,"i",(function(){return s})),r.d(t,"j",(function(){return a})),r.d(t,"k",(function(){return f})),r.d(t,"l",(function(){return b}));var i=r(8);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function a(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function l(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function u(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function h(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function d(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function f(e){const t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function p(e){const t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function y(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a),e}function g(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function m(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function b(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function _(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function x(e,t){const r=e[0],n=e[1],s=e[2],a=e[3],o=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-o)<=i.g*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=i.g*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=i.g*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-u)<=i.g*Math.max(1,Math.abs(a),Math.abs(u))}const v=o,w=l,O=c,I=h,S=d,T=f,j=p;Object.freeze({__proto__:null,copy:n,set:s,add:a,subtract:o,multiply:l,divide:c,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:u,scaleAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},distance:h,squaredDistance:d,length:f,squaredLength:p,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:y,dot:g,lerp:m,random:function(e,t){let r,n,s,a,o,l;t=t||1;do{r=2*Object(i.s)()-1,n=2*Object(i.s)()-1,o=r*r+n*n}while(o>=1);do{s=2*Object(i.s)()-1,a=2*Object(i.s)()-1,l=s*s+a*a}while(l>=1);const c=Math.sqrt((1-o)/l);return e[0]=t*r,e[1]=t*n,e[2]=t*s*c,e[3]=t*a*c,e},transformMat4:b,transformQuat:function(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2],c=r[3],u=c*i+o*s-l*n,h=c*n+l*i-a*s,d=c*s+a*n-o*i,f=-a*i-o*n-l*s;return e[0]=u*c+f*-a+h*-l-d*-o,e[1]=h*c+f*-o+d*-a-u*-l,e[2]=d*c+f*-l+u*-o-h*-a,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:_,equals:x,sub:v,mul:w,div:O,dist:I,sqrDist:S,len:T,sqrLen:j})},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(0);class n{constructor(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}find(e){if(0===this.size)return null;for(const t of this._buffer)if(Object(i.P)(t)&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;Object(i.P)(t);)e&&e(t),t=this.dequeue()}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(0),n=r(10);function s(e,t,r,s=new i.M){let a;if("2d"===r.type)a=t*r.resolution;else if("3d"===r.type){const s=r.overlayPixelSizeInMapUnits(e),o=r.basemapSpatialReference;a=Object(i.P)(o)&&!o.equals(r.spatialReference)?Object(n.b)(o)/Object(n.b)(r.spatialReference):t*s}const o=e.x-a,l=e.y-a,c=e.x+a,u=e.y+a,{spatialReference:h}=r;return s.xmin=Math.min(o,c),s.ymin=Math.min(l,u),s.xmax=Math.max(o,c),s.ymax=Math.max(l,u),s.spatialReference=h,s}new i.M},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r(0),n=r(6);async function s(e,t=e.popupTemplate){if(!Object(i.P)(t))return[];const r=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:s}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:c}=e;if(r.includes("*"))return["*"];const u=s?await Object(n.b)(e):[],h=Object(n.F)(e.fields,[...r,...u]);return o&&h.push(o),h&&a&&Object(n.r)(e.fields,a)&&-1===h.indexOf(a)&&h.push(a),h&&l&&Object(n.r)(e.fields,l)&&-1===h.indexOf(l)&&h.push(l),c&&c.forEach((t=>{const{keyField:r}=t;h&&r&&Object(n.r)(e.fields,r)&&-1===h.indexOf(r)&&h.push(r)})),h}function a(e,t){return e.popupTemplate?e.popupTemplate:Object(i.P)(t)&&t.defaultPopupTemplateEnabled&&Object(i.P)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(0),n=r(329);class s{constructor(e=9,t){this.compareMinX=c,this.compareMinY=u,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),_.prune(),x.prune(),v.prune()}all(e){this._all(this.data,e)}search(e,t){let r=this.data;const i=this.toBBox;if(g(e,r))for(b.clear();r;){for(let n=0,s=r.children.length;n<s;n++){const s=r.children[n],a=r.leaf?i(s):s;g(e,a)&&(r.leaf?t(s):y(e,a)?this._all(s,t):b.push(s))}r=b.pop()}}collides(e){let t=this.data;const r=this.toBBox;if(!g(e,t))return!1;for(b.clear();t;){for(let i=0,n=t.children.length;i<n;i++){const n=t.children[i],s=t.leaf?r(n):n;if(g(e,s)){if(t.leaf||y(e,s))return!0;b.push(n)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=new O([]),this}remove(e){if(!e)return this;let t,r=this.data,n=null,s=0,a=!1;const o=this.toBBox(e);for(x.clear(),v.clear();r||x.length>0;){var l;if(r||(r=Object(i.b7)(x.pop()),n=x.data[x.length-1],s=null!=(l=v.pop())?l:0,a=!0),r.leaf&&(t=Object(i.cz)(r.children,e,r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),x.push(r),this._condense(x),this;a||r.leaf||!y(r,o)?n?(s++,r=n.children[s],a=!1):r=null:(x.push(r),v.push(s),s=0,n=r,r=r.children[0])}return this}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let r=e;for(_.clear();r;){var i;if(!0===r.leaf)for(const e of r.children)t(e);else _.pushArray(r.children);r=null!=(i=_.pop())?i:null}}_build(e,t,r,i){const n=r-t+1;let s=this._maxEntries;if(n<=s){const i=new O(e.slice(t,r+1));return a(i,this.toBBox),i}i||(i=Math.ceil(Math.log(n)/Math.log(s)),s=Math.ceil(n/s**(i-1)));const o=new I([]);o.height=i;const l=Math.ceil(n/s),c=l*Math.ceil(Math.sqrt(s));m(e,t,r,c,this.compareMinX);for(let n=t;n<=r;n+=c){const t=Math.min(n+c-1,r);m(e,n,t,l,this.compareMinY);for(let r=n;r<=t;r+=l){const n=Math.min(r+l-1,t);o.children.push(this._build(e,r,n,i-1))}}return a(o,this.toBBox),o}_chooseSubtree(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){let r,i=1/0,n=1/0;for(let s=0,a=t.children.length;s<a;s++){const a=t.children[s],o=h(a),l=f(e,a)-o;l<n?(n=l,i=o<i?o:i,r=a):l===n&&o<i&&(i=o,r=a)}t=r||t.children[0]}return t}_insert(e,t,r){const i=this.toBBox,n=r?e:i(e);x.clear();const s=this._chooseSubtree(n,this.data,t,x);for(s.children.push(e),l(s,n);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;this._adjustParentBBoxes(n,x,t)}_split(e,t){const r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);const s=this._chooseSplitIndex(r,n,i);if(!s)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const o=r.children.splice(s,r.children.length-s),l=r.leaf?new O(o):new I(o);l.height=r.height,a(r,this.toBBox),a(l,this.toBBox),t?e.data[t-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,t){this.data=new I([e,t]),this.data.height=e.height+1,a(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let i,n,s;i=n=1/0;for(let a=t;a<=r-t;a++){const t=o(e,0,a,this.toBBox),l=o(e,a,r,this.toBBox),c=p(t,l),u=h(t)+h(l);c<i?(i=c,s=a,n=u<n?u:n):c===i&&u<n&&(n=u,s=a)}return s}_chooseSplitAxis(e,t,r){const i=e.leaf?this.compareMinX:c,n=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);const n=this.toBBox,s=o(e,0,t,n),a=o(e,r-t,r,n);let c=d(s)+d(a);for(let i=t;i<r-t;i++){const t=e.children[i];l(s,e.leaf?n(t):t),c+=d(s)}for(let i=r-t-1;i>=t;i--){const t=e.children[i];l(a,e.leaf?n(t):t),c+=d(a)}return c}_adjustParentBBoxes(e,t,r){for(let i=r;i>=0;i--)l(t.data[i],e)}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const n=e.data[t-1],s=n.children;s.splice(Object(i.cz)(s,r,s.length,n.indexHint),1)}else this.clear();else a(r,this.toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){o(e,0,e.children.length,t,e)}function o(e,t,r,i,n){n||(n=new O([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s,a=t;a<r;a++)s=e.children[a],l(n,e.leaf?i(s):s);return n}function l(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){const r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e,t,r,s,a){const o=[t,r];for(;o.length;){const t=Object(i.b7)(o.pop()),r=Object(i.b7)(o.pop());if(t-r<=s)continue;const l=r+Math.ceil((t-r)/s/2)*s;Object(n.a)(e,l,r,t,a),o.push(r,l,l,t)}}const b=new i.aC,_=new i.aC,x=new i.aC,v=new i.aC({deallocator:void 0});class w extends class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}{constructor(){super(...arguments),this.height=1,this.indexHint=new i.cA}}class O extends w{constructor(e){super(),this.children=e,this.leaf=!0}}class I extends w{constructor(e){super(),this.children=e,this.leaf=!1}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(0);class n{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new i.s(t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new n(this.major,this.minor,this._context)}static parse(e,t=""){const[r,s]=e.split("."),a=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(a))throw new i.s((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!s.match(a))throw new i.s((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),l=parseInt(s,10);return new n(o,l,t)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0);r(1);const n=new i.aM({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"});let s=class extends i.a{constructor(e){super(e),this.description=null,this.type=null}};Object(i.e)([Object(i.y)({type:String,json:{write:!0}})],s.prototype,"description",void 0),Object(i.e)([Object(i.y)({type:String,json:{read:n.read,write:n.write}})],s.prototype,"type",void 0),s=Object(i.e)([Object(i.i)("esri.tasks.support.GPMessage")],s);var a=s},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(73);const n={type:i.b,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:s}}}}};function s(e,t,r,n){if(!e)return null;const{minScale:s,maxScale:a,minLOD:o,maxLOD:l}=t;if(null!=o&&null!=l)return n&&n.ignoreMinMaxLOD?i.b.fromJSON(e):i.b.fromJSON({...e,lods:e.lods.filter((({level:e})=>null!=e&&e>=o&&e<=l))});if(0!==s&&0!==a){const t=e=>Math.round(1e4*e)/1e4,r=s?t(s):1/0,n=a?t(a):-1/0;return i.b.fromJSON({...e,lods:e.lods.filter((e=>{const i=t(e.scale);return i<=r&&i>=n}))})}return i.b.fromJSON(e)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return o}));var i=r(319),n=(r(1),r(0)),s=r(348),a=r(312);class o{constructor(e){this._programCacheByTemplate=new Map,this._rctx=e}dispose(){this._programCacheByTemplate.forEach((e=>{e.programs.forEach((e=>{e.dispose()}))})),this._programCacheByTemplate=null}getProgram(e,t){return this._programCacheByTemplate.has(e)||this.addProgramTemplate(e,(t=>Object(i.c)(this._rctx,e,t))),this.getProgramTemplateInstance(e,t)}addProgramTemplate(e,t){this._programCacheByTemplate.set(e,{constructor:t,programs:new Map})}getProgramTemplateInstance(e,t){const r=this._programCacheByTemplate.get(e);if(r){const e=t?JSON.stringify(t):"default";if(!r.programs.has(e)){const i=r.constructor(t);r.programs.set(e,i)}return r.programs.get(e)}return null}}const l=33984;class c{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Map;this._current.length<6;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,t){const r=++this._current[e];this._max[e]=Math.max(r,this._max[e])}decrement(e,t){--this._current[e]}get max(){return this._max}get current(){return this._current}printResourceCount(){if(console.log("Live objects:"),console.log(`Textures: ${this._current[0]}`),console.log(`Buffers: ${this._current[1]}`),console.log(`VAOs: ${this._current[2]}`),console.log(`Programs: ${this._current[3]}`),console.log(`Framebuffers: ${this._current[4]}`),console.log(`Renderbuffers: ${this._current[5]}`),this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const e=new Map;this._allocations.forEach((t=>{var r;e.set(t,(null!=(r=e.get(t))?r:0)+1)})),e.forEach(((e,t)=>console.log(e," : ",t)))}}}class u{constructor(e,t,r,i,n,s,a,o){this.createQuery=e,this.resultAvailable=t,this.getResult=r,this.disjoint=i,this.beginTimeElapsed=n,this.endTimeElapsed=s,this.createTimestamp=a,this.timestampBits=o}}function h(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r&&Object(a.e)(e)?new u((()=>e.createQuery()),(t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)),(t=>e.getQueryParameter(t,e.QUERY_RESULT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(t=>e.beginQuery(r.TIME_ELAPSED_EXT,t)),(()=>e.endQuery(r.TIME_ELAPSED_EXT)),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):(r=e.getExtension("EXT_disjoint_timer_query"),r?new u((()=>r.createQueryEXT()),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT)),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(e=>r.beginQueryEXT(r.TIME_ELAPSED_EXT,e)),(()=>r.endQueryEXT(r.TIME_ELAPSED_EXT)),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):null)}function d(e,t){const r=t&&t.disabledExtensions||{},i=t&&t.debugWebGLExtensions||{};let n,s,o,l,c,u,d,p,y,g,m,b=null,_=null,x=null,v=null;return{get drawBuffers(){return m||(m=function(e,t){if(t.disjointTimerQuery)return null;if(Object(a.e)(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const r=e.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(e,r)),m},get instancing(){return n||(n=function(e){if(Object(a.e)(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}(e)),n},get vao(){return s||(s=function(e,t){if(Object(a.e)(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const r=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}(e,r)),s},get compressedTextureETC(){return o||(o=function(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(e,r)),o},get compressedTextureS3TC(){return l||(l=function(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,r)),l},get textureFilterAnisotropic(){return c||(c=function(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,r)),c},get disjointTimerQuery(){return u||(u=h(e,r)),u},get textureFloat(){return d||(d=function(e,t){if(Object(a.e)(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){const r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}(e,r)),d},get colorBufferFloat(){return p||(p=function(e,t){if(Object(a.e)(e)){const r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}(e,r)),p},get blendMinMax(){return y||(y=function(e,t){if(Object(a.e)(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const t=e.getExtension("EXT_blend_minmax");return t?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null}}(e,r)),y},get depthTexture(){return null===b&&(b=f(e,r,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),b},get standardDerivatives(){return null===_&&(_=f(e,r,"standardDerivatives",!0,["OES_standard_derivatives"])),_},get shaderTextureLOD(){return null===x&&(x=f(e,r,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),x},get fragDepth(){return null===v&&(v=f(e,r,"fragDepth",!0,["EXT_frag_depth"])),v},get loseContext(){return g||(g=function(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}(e,i)),g},enable(e){return this[e]}}}function f(e,t,r,i,n){if(i&&Object(a.e)(e))return!0;if(t[r])return!1;for(const t of n)if(e.getExtension(t))return!0;return!1}class p{constructor(e,t){this.gl=null,this.instanceCounter=new c,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap=[],this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=Object(a.e)(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=d(e,t);const r=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new s.a({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const r=e.operation;this.setStencilOp(r.fail,r.zFail,r.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)}}),this.enforceState()}isWebGL2Context(){return"webgl2"===this.contextVersion}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){if(!this._parameters){const e=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:e?this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}}return this._parameters}dispose(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap=[],this.gl=null,this._capabilities=null}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())}setBlendColor(e,t,r,i){e===this._blendColorState.r&&t===this._blendColorState.g&&r===this._blendColorState.b&&i===this._blendColorState.a||(this.gl.blendColor(e,t,r,i),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=r,this._blendColorState.a=i,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,r,i){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===r&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,r,i),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=r,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,r,i){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===r&&this._colorMaskState.a===i||(this.gl.colorMask(e,t,r,i),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=r,this._colorMaskState.a=i,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,r,i){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===r&&this._clearColor.a===i||(this.gl.clearColor(e,t,r,i),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=r,this._clearColor.a=i)}setFaceCullingEnabled(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)}setScissorRect(e,t,r,i){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===r&&this._scissorRect.height===i||(this.gl.scissor(e,t,r,i),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=r,this._scissorRect.height=i)}setDepthTestEnabled(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)}setDepthFunction(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)}setStencilFunction(e,t,r){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,r,i){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===r&&this._stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,r,i),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=r,this._stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,r){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,r,i){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===r&&this._stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,r,i),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=r,this._stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setActiveTexture(e){const t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(l+e),this._activeTextureUnit=e),t}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,r){this.gl.drawArrays(e,t,r)}drawElements(e,t,r,i){5123!==r?5125===r&&this.gl.drawElements(e,t,r,i):this.gl.drawElements(e,t,r,i)}logIno(){}get capabilities(){return this._capabilities}setViewport(e,t,r,i){const n=this._viewport;n.x===e&&n.y===t&&n.width===r&&n.height===i||(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))}getViewport(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}}bindProgram(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)}bindTexture(e,t){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const r=this._textureUnitMap[t];if(this.setActiveTexture(t),null==e||null==e.glName)return null!=r&&this.gl.bindTexture(r.descriptor.target,null),void(this._textureUnitMap[t]=null);r!==e?(this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._textureUnitMap[t]=e):e.applyChanges()}unbindTextureAllUnits(e){for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._textureUnitMap[t]===e&&this.bindTexture(null,t)}bindFramebuffer(e){if(Object(n.J)(e))return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initializeAndBind(),this._activeFramebuffer=e)}bindBuffer(e){e&&(34962===e.bufferType?this._activeVertexBuffer=y(this.gl,e,e.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=y(this.gl,e,e.bufferType,this._activeIndexBuffer))}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)}unbindBuffer(e){34962===e?this._activeVertexBuffer=y(this.gl,null,e,this._activeVertexBuffer):this._activeIndexBuffer=y(this.gl,null,e,this._activeIndexBuffer)}bindVAO(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject===e||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)}getBoundTexture(e){return this._textureUnitMap[e]}getBoundFramebufferObject(){return this._activeFramebuffer}getBoundVAO(){return this._activeVertexArrayObject}resetState(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(let e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.gl,t=this.capabilities.vao;t&&t.bindVertexArray(null);for(let t=0;t<this.parameters.maxVertexAttributes;t++)e.disableVertexAttribArray(t);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){const e=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(e)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(1),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(let t=0;t<this.parameters.maxTextureImageUnits;t++){e.activeTexture(l+t),e.bindTexture(3553,null);const r=this._textureUnitMap[t];r&&e.bindTexture(r.descriptor.target,r.glName)}e.activeTexture(l+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)}}function y(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o}));r(140),r(87),r(1);var i=r(316),n=r(312),s=r(0);async function a(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const r=new n.g(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),s=i.e.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),a=new i.a(e,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:s}),o=new i.c(e,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",{a_pos:0});e.bindProgram(o);const l=new n.f(e,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},t);e.bindTexture(l,0),o.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:u,y:h,width:d,height:f}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(a),e.drawArrays(5,0,4);const p=new Uint8Array(4);return r.readPixels(0,0,1,1,6408,5121,p),o.dispose(),a.dispose(!1),s.dispose(),r.dispose(),l.dispose(),e.setViewport(u,h,d,f),e.bindFramebuffer(c),t.src="",255===p[0]}async function o(e,t){const{data:r}=await Object(s.C)(e,{responseType:"image",...t});return r}},function(e,t,r){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,r=0;for(let i=0;i<e.length;i++){const n=e[i].size;"number"==typeof n&&(t+=n,r++)}return t/r}(e.stops):t}function s(e,t){if(!t)return e;const r=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:r,minSize:i}=t;return(n(r,e)+n(i,e))/2}));let i=0;const s=r.length;if(0===s)return e;for(let e=0;e<s;e++)i+=r[e];const a=Math.floor(i/s);return Math.max(a,e)}function a(e){const t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;const n="visualVariables"in t?s(r,t.visualVariables):r;if("simple"===t.type)return i(n,t.symbol);if("unique-value"===t.type){let e=n;return t.uniqueValueInfos.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return t.type,n}r.d(t,"a",(function(){return a}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(313),n=r(325);class s extends n.g{get requiresDedicatedFBO(){return this.children.some((e=>"additive"===e.blendFunction))}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[n.c.bitmap],target:()=>this.children,drawPhase:i.d.MAP});return[...super.prepareRenderPasses(e),t]}}},function(e,t,r){"use strict";function i(e,t,r){return t.flatten((({sublayers:e})=>e)).length!==e.length||(!!e.some((e=>e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r))||!s(e,t))}function n(e,t,r){return!!e.some((e=>{const t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===r.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2}))||!s(e,t)}function s(e,t){if(!e||!e.length)return!0;const r=t.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const n=r.length;for(const{id:t}of e){for(;i<n&&r[i]!==t;)i++;if(i>=n)return!1}return!0}function a(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return z}));r(18);var i=r(1),n=r(0),s=r(9),a=r(10),o=r(84),l=r(72),c=r(106),u=r(71),h=r(104),d=r(352),f=r(336),p=r(327),y=r(118),g=r(221),m=r(353),b=r(83);const _=new class{constructor(e,t){this._cache=new y.a(e),this._invalidCache=new y.a(t)}get(e,t){const r=`${t.uid}:${e}`,i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{const i=g.WhereClause.create(e,t);return this._cache.put(r,i),i}catch{return this._invalidCache.put(r,null),null}}}(50,500),x="feature-store:unsupported-query",v=" as ",w=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function O(e,t){if(!t)return!0;const r=_.get(t,e);if(!r)throw new n.s(x,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new n.s(x,"where clause is not standard",{where:t});return T(e,r.fieldNames,"where clause contains missing fields"),!0}function I(e,t,r){if(!t)return!0;const i=_.get(t,e);if(!i)throw new n.s(x,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new n.s(x,"having does not contain a valid aggregate function",{having:t});const s=i.fieldNames;if(T(e,s,"having contains missing fields"),!i.getExpressions().every((t=>{const{aggregateType:i,field:n}=t,s=e.has(n)&&e.get(n).name;return r.some((t=>{const{onStatisticField:r,statisticType:n}=t;return(e.has(r)&&e.get(r).name)===s&&n.toLowerCase().trim()===i}))})))throw new n.s(x,"expressions in having should also exist in outStatistics",{having:t});return!0}function S(e,t){return e?_.get(e,t):null}function T(e,t,r,i=!0){const s=[];for(const r of t)if("*"!==r&&!e.has(r))if(i){const t=j(r);try{const r=S(t,e);if(!r)throw new n.s(x,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new n.s(x,"expression is not standard",{clause:r});T(e,r.fieldNames,"expression contains missing fields")}catch(e){const t=e&&e.details;if(t&&(t.clause||t.where))throw e;t&&t.missingFields?s.push(...t.missingFields):s.push(r)}}else s.push(r);if(s.length)throw new n.s(x,r,{missingFields:s})}function j(e){return e.split(v)[0]}function E(e){return e.split(v)[1]}function A(e,t){const r=t.get(e);return!!r&&!w.has(r.type)}class M{constructor(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;const i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;let e=0;for(const t of i){const i=j(t),n=this.fieldsIndex.get(i),s=n?null:S(i,r),a=n?n.name:E(t)||"FIELD_EXP_"+e++;this._fieldDataCache.set(t,{alias:a,clause:s})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,r){const i=r?r.name:t;let n=null;return this._fieldDataCache.has(i)?n=this._fieldDataCache.get(i).clause:r||(n=S(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:n})),r?this.featureAdapter.getAttribute(e,i):n.calculateValue(e,this.featureAdapter)}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:S(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:S(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}_processAttributesForOutFields(e){const t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);const r={};for(const i of t){const{alias:t,clause:n}=this._fieldDataCache.get(i);r[t]=n?n.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(Object(n.J)(e)||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const i of t){const{alias:t}=this._fieldDataCache.get(i);r.push(e[t])}else for(const t in e)r.push(e[t]);const i=`${(t||["*"]).join(",")}=${r.join(",")}`;let s=this._returnDistinctMap.get(i)||0;return this._returnDistinctMap.set(i,++s),s>1?null:e}}function R(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function F(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function C(e,t,r){return r?t-e:e-t}function D(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){const r=new Date(e).getTime(),n=new Date(t).getTime();if(!isNaN(r)&&!isNaN(n))return C(r,n,i)}if("number"==typeof e&&"number"==typeof t)return C(e,t,i);if("string"==typeof e&&"string"==typeof t){const n=e.toUpperCase(),s=t.toUpperCase();return!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?F(n,s,i):F(R(n),R(s),i)}return i?1:-1}class L{constructor(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter,this.aggregateAdapter=r.aggregateAdapter}get size(){return this.items.length}createQueryResponseForCount(e){const t=new M(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:r,having:i}=e;if(!(null==r?void 0:r.length))return 1;const n=new Map,s=new Map,a=new Set,o=e.outStatistics;for(const e of o){const{statisticType:o}=e,l="exceedslimit"!==o?e.onStatisticField:void 0;if(!s.has(l)){const e=[];for(const i of r){const r=this._getAttributeValues(t,i,n);e.push(r)}s.set(l,this._calculateUniqueValues(e))}const c=s.get(l);for(const e in c){const{data:r,items:n}=c[e],s=r.join(",");i&&!t.validateItems(n,i)||a.add(s)}}return a.size}createQueryResponse(e){let t;return t=e.outStatistics?e.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(Object(n.an)(e.outSR)&&!Object(n.ak)(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=Object(m.k)({spatialReference:e.outSR,...Object(p.j)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR)}):t.queryGeometry=Object(m.k)({spatialReference:e.outSR,...this.queryGeometry})),t}createSnappingResponse(e,t){const r=this.featureAdapter,i=function(e,t){return e?t?4:3:t?3:2}(this.hasZ,this.hasM),{x:n,y:s}=e.point,a="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,l={candidates:[]},c="esriGeometryPolygon"===this.geometryType,u=this.getPointCreator(e.point,this.spatialReference,t);for(const t of this.items){const h=r.getGeometry(t);if(!h)continue;const{coords:d,lengths:f}=h;if(1&e.types){let e=0;for(let c=0;c<f.length;c++){const h=f[c];for(let c=0;c<h;c++,e+=i){const f=d[e],p=d[e+1];if(c!==h-1){const c=d[e+i],h=d[e+i+1],{x:y,y:g}=N(n,s,f,p,c,h),m=(n-y)/a,b=(s-g)/o,_=m*m+b*b;_<=1&&l.candidates.push({type:"edge",objectId:r.getObjectId(t),distance:Math.sqrt(_),target:u(y,g),start:u(f,p),end:u(c,h)})}}}}if(2&e.types){const e=c?d.length-i:d.length;for(let c=0;c<e;c+=i){const e=d[c],i=d[c+1],h=(n-e)/a,f=(s-i)/o,p=h*h+f*f;p<=1&&l.candidates.push({type:"vertex",objectId:r.getObjectId(t),distance:Math.sqrt(p),target:u(e,i)})}}}return l.candidates.sort(((e,t)=>e.distance-t.distance)),l}getPointCreator(e,t,r){const i=Object(n.P)(r)&&!Object(n.ak)(t,r)?e=>Object(p.j)(e,t,r):e=>e;return null!=e.z&&null!=e.m?(t,r)=>i({x:t,y:r,z:e.z,m:e.m}):null!=e.z?(t,r)=>i({x:t,y:r,z:e.z}):null!=e.m?(t,r)=>i({x:t,y:r,m:e.m}):(e,t)=>i({x:e,y:t})}executeAttributesQuery(e){const t=S(e.where,this.fieldsIndex);if(!t)return Promise.resolve(this);if(t.isStandardized){let r=0;const i=[];for(const e of this.items)t.testFeature(e,this.featureAdapter)&&(i[r++]=e);const n=new L(i,this.queryGeometry,this);return n.definitionExpression=e.where,Promise.resolve(n)}return Promise.reject(new TypeError("Where clause is not standardized"))}executeAggregateIdsQuery(e){if(!e.aggregateIds||!e.aggregateIds.length||Object(n.J)(this.aggregateAdapter))return Promise.resolve(this);const t=new Set;for(const r of e.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach((e=>t.add(e)));const r=this.featureAdapter.getObjectId;return Promise.resolve(new L(this.items.filter((e=>t.has(r(e)))),this.queryGeometry,this))}executeObjectIdsQuery(e){if(!e.objectIds||!e.objectIds.length)return Promise.resolve(this);const t=new Set(e.objectIds),r=this.featureAdapter.getObjectId;return Promise.resolve(new L(this.items.filter((e=>t.has(r(e)))),this.queryGeometry,this))}executeTimeQuery(e){const t=Object(m.h)(this.timeInfo,e.timeExtent,this.featureAdapter);if(!Object(n.P)(t))return Promise.resolve(this);const r=this.items.filter(t);return Promise.resolve(new L(r,this.queryGeometry,this))}filterLatest(){const{trackIdField:e,startTimeField:t,endTimeField:r}=this.timeInfo,i=r||t,n=new Map,s=this.featureAdapter.getAttribute;for(const t of this.items){const r=s(t,e),a=s(t,i),o=n.get(r);(!o||a>s(o,i))&&n.set(r,t)}const a=Array.from(n.values());return Promise.resolve(new L(a,this.queryGeometry,this))}async project(e){if(!e||Object(n.ak)(this.spatialReference,e))return this;const t=this.featureAdapter,r=(await Object(p.d)(this.items.map((e=>Object(m.e)(this.geometryType,this.hasZ,this.hasM,t.getGeometry(e)))),this.spatialReference,e)).map(((e,r)=>t.cloneWithGeometry(this.items[r],Object(b.l)(e,this.hasZ,this.hasM))));return new L(r,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:e,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})}_sortFeatures(e,t,r){if(e.length>1&&t&&t.length)for(const i of t.reverse()){const t=i.split(" "),n=t[0],s=this.fieldsIndex.get(n),a=t[1]&&"desc"===t[1].toLowerCase();e.sort(((e,t)=>D(r(e,n,s),r(t,n,s),s,a)))}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:r,hasM:i,hasZ:n,objectIdField:s,spatialReference:a}=this,{outFields:o,outSR:l,quantizationParameters:c,resultRecordCount:u,resultOffset:h,returnZ:d,returnM:f}=e,y=null!=u&&t.length>(h||0)+u,g=o&&(o.indexOf("*")>-1?[...this.fieldsIndex.fields]:o.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:y,features:this._createFeatures(e,t),fields:g,geometryType:r,hasM:i&&f,hasZ:n&&d,objectIdFieldName:s,spatialReference:Object(m.k)(l||a),transform:c&&Object(p.f)(c)||null}}_createFeatures(e,t){const r=new M(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:n}=this,{orderByFields:s,quantizationParameters:a,returnGeometry:o,returnCentroid:l,maxAllowableOffset:c,resultOffset:u,resultRecordCount:h,returnZ:d=!1,returnM:f=!1}=e,y=n&&d,g=i&&f;let b=[],_=0;const x=[...t];if(this._sortFeatures(x,s,((e,t,i)=>r.getFieldValue(e,t,i))),o||l){const e=Object(p.f)(a);if(o&&!l)for(const t of x)b[_++]={attributes:r.getAttributes(t),geometry:Object(m.e)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,y,g)};else if(!o&&l)for(const t of x)b[_++]={attributes:r.getAttributes(t),centroid:Object(m.c)(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of x)b[_++]={attributes:r.getAttributes(t),centroid:Object(m.c)(this,this.featureAdapter.getCentroid(t,this),e),geometry:Object(m.e)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,y,g)}}else for(const e of x){const t=r.getAttributes(e);t&&(b[_++]={attributes:t})}const v=u||0;if(null!=h){const e=v+h;b=b.slice(v,Math.min(b.length,e))}return b}_createExceedsLimitQueryResponse(e){let t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const t of e.outStatistics)if("exceedslimit"===t.statisticType){r=null!=t.maxPointCount?t.maxPointCount:Number.POSITIVE_INFINITY,i=null!=t.maxRecordCount?t.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=t.maxVertexCount?t.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{const e=this.hasZ?this.hasM?4:3:this.hasM?3:2,r=this.featureAdapter;t=this.items.reduce(((e,t)=>{const i=r.getGeometry(t);return e+(i&&i.coords.length||0)}),0)/e>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}_createStatisticsQueryResponse(e){const t={attributes:{}},r=[],i=new Map,n=new Map,s=new Map,a=new Map,o=new M(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:c,having:u,orderByFields:h}=e,d=c&&c.length,f=!!d,p=f&&c[0],y=f&&!this.fieldsIndex.get(p);for(const e of l){const{outStatisticFieldName:l,statisticType:h}=e,g=e,m="exceedslimit"!==h?e.onStatisticField:void 0,b="percentile_disc"===h||"percentile_cont"===h,_=f&&1===d&&(m===p||y)&&"count"===h;if(f){if(!s.has(m)){const e=[];for(const t of c){const r=this._getAttributeValues(o,t,i);e.push(r)}s.set(m,this._calculateUniqueValues(e,o.returnDistinctValues))}const e=s.get(m);for(const t in e){const{count:r,data:n,items:s,itemPositions:h}=e[t],d=n.join(",");if(!u||o.validateItems(s,u)){const e=a.get(d)||{attributes:{}};let t=null;if(_)t=r;else{const e=this._getAttributeValues(o,m,i),r=h.map((t=>e[t]));t=b&&"statisticParameters"in g?this._getPercentileValue(g,r):this._getStatisticValue(g,r)}e.attributes[l]=t,c.forEach(((t,r)=>e.attributes[this.fieldsIndex.get(t)?t:`EXPR_${r+1}`]=n[r])),a.set(d,e)}}}else{const e=this._getAttributeValues(o,m,i);t.attributes[l]=b&&"statisticParameters"in g?this._getPercentileValue(g,e):this._getStatisticValue(g,e,n)}r.push({name:l,alias:l,type:"esriFieldTypeDouble"})}const g=f?Array.from(a.values()):[t];return this._sortFeatures(g,h,((e,t)=>e.attributes[t])),{fields:r,features:g}}_getStatisticValue(e,t,r){const{onStatisticField:i,statisticType:n}=e,s=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,s),s["var"===n?"variance":n]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:i,statisticType:n}=e,{value:s,orderBy:a}=i,o="desc"===a,l=this.fieldsIndex.get(r),c=[...t].filter((e=>null!=e)).sort(((e,t)=>D(e,t,l,o)));return this._calculatePercentile(c,s,"percentile_disc"===n)}_getAttributeValues(e,t,r){if(r.has(t))return r.get(t);const i=this.fieldsIndex.get(t),n=this.items.map((r=>e.getFieldValue(r,t,i)));return r.set(t,n),n}_calculateStatistics(e){let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,n=null,s=null,a=null;const o=[];let l=0;for(const n of e)"string"==typeof n?l++:null==n||isNaN(n)||(i+=n,t=Math.min(t,n),r=Math.max(r,n),o.push(n),l++);if(l){n=i/l;let e=0;for(const t of o)e+=(t-n)**2;a=l>1?e/(l-1):0,s=Math.sqrt(a)}else t=null,r=null;return{avg:n,count:l,max:r,min:t,stddev:s,sum:i,variance:a}}_calculateUniqueValues(e,t){const r={},i=this.items,n=i.length;for(let s=0;s<n;s++){const n=i[s],a=[];for(const t of e)a.push(t[s]);const o=a.join(",");t?null==r[o]&&(r[o]={count:1,data:a,items:[n],itemPositions:[s]}):null==r[o]?r[o]={count:1,data:a,items:[n],itemPositions:[s]}:(r[o].count++,r[o].items.push(n),r[o].itemPositions.push(s))}return r}_calculatePercentile(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];const i=(e.length-1)*t,n=Math.floor(i),s=n+1,a=i%1,o=e[n],l=e[s];return s>=e.length||r||"string"==typeof o||"string"==typeof l?o:o*(1-a)+l*a}}function N(e,t,r,i,n,s){const a=n-r,o=s-i,l=a*a+o*o,c=(e-r)*a+(t-i)*o,u=Math.min(1,Math.max(0,c/l));return{x:r+a*u,y:i+o*u}}const P="feature-store:unsupported-query",B=new Set,k=new u.a(2e6);let U=0;class z{constructor(e){this.capabilities={query:d.a},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new u.b(U+++"$$",k)),this.fieldsIndex=new h.a(e.fields),e.scheduler&&e.task&&(this._frameQueue=new l.a,this._frameTask=e.scheduler.registerTask(e.task,(e=>this._update(e)),(()=>this._frameQueue.length>0)))}destroy(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){const e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(m.k)(this.spatialReference)}:null}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(m.i)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}async executeQuery(e={},t){let r,n=Object(i.o)(e);try{n=await this._schedule((()=>Object(m.b)(n,this.definitionExpression,this.spatialReference)),t),n=await this._reschedule((()=>this._checkQuerySupport(n)),t),r=await this._reschedule((()=>this._executeGeometryQuery(n,t)),t),r=await this._reschedule((()=>r.executeAggregateIdsQuery(n)),t),r=await this._reschedule((()=>r.executeObjectIdsQuery(n)),t),r=await this._reschedule((()=>r.executeTimeQuery(n)),t),r=await this._reschedule((()=>r.executeAttributesQuery(n)),t)}catch(e){if(e!==m.g)throw e;r=new L([],null,this)}return r.createQueryResponse(n)}async executeQueryForCount(e={},t){let r,n=Object(i.o)(e);n.returnGeometry=!1,n.returnCentroid=!1,n.outSR=null;try{n=await this._schedule((()=>Object(m.b)(n,this.definitionExpression,this.spatialReference)),t),n=await this._reschedule((()=>this._checkQuerySupport(n)),t),r=await this._reschedule((()=>this._executeGeometryQuery(n,t)),t),r=await this._reschedule((()=>r.executeAggregateIdsQuery(n)),t),r=await this._reschedule((()=>r.executeObjectIdsQuery(n)),t),r=await this._reschedule((()=>r.executeTimeQuery(n)),t),r=await this._reschedule((()=>r.executeAttributesQuery(n)),t)}catch(e){if(e!==m.g)throw e;return 0}return r.createQueryResponseForCount(n)}async executeQueryForExtent(e={},t){let r,n=Object(i.o)(e);const s=n.outSR;try{n=await this._schedule((()=>Object(m.b)(n,this.definitionExpression,this.spatialReference)),t),n=await this._reschedule((()=>this._checkQuerySupport(n)),t),n.returnGeometry=!0,n.returnCentroid=!1,n.outSR=null,r=await this._reschedule((()=>this._executeGeometryQuery(n,t)),t),r=await this._reschedule((()=>r.executeAggregateIdsQuery(n)),t),r=await this._reschedule((()=>r.executeObjectIdsQuery(n)),t),r=await this._reschedule((()=>r.executeTimeQuery(n)),t),r=await this._reschedule((()=>r.executeAttributesQuery(n)),t);const e=r.size;if(!e)return{count:e,extent:null};Object(f.a)(G,f.c),this.featureStore.forEachBounds(r.items,(e=>Object(f.g)(G,e)),V);const i={xmin:G[0],ymin:G[1],xmax:G[3],ymax:G[4],spatialReference:Object(m.k)(this.spatialReference)};this.hasZ&&isFinite(G[2])&&isFinite(G[5])&&(i.zmin=G[2],i.zmax=G[5]);const o=Object(p.j)(i,r.spatialReference,s);if(o.spatialReference=Object(m.k)(s||this.spatialReference),o.xmax-o.xmin==0){const e=Object(a.b)(o.spatialReference);o.xmin-=e,o.xmax+=e}if(o.ymax-o.ymin==0){const e=Object(a.b)(o.spatialReference);o.ymin-=e,o.ymax+=e}if(this.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0){const e=Object(a.b)(o.spatialReference);o.zmin-=e,o.zmax+=e}return{count:e,extent:o}}catch(e){if(e===m.g)return{count:0,extent:null};throw e}}async executeQueryForIds(e={},t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}async executeQueryForIdSet(e={},t){let r,n=Object(i.o)(e);n.returnGeometry=!1,n.returnCentroid=!1,n.outSR=null;try{n=await this._schedule((()=>Object(m.b)(n,this.definitionExpression,this.spatialReference)),t),n=await this._reschedule((()=>this._checkQuerySupport(n)),t),r=await this._reschedule((()=>this._executeGeometryQuery(n,t)),t),r=await this._reschedule((()=>r.executeAggregateIdsQuery(n)),t),r=await this._reschedule((()=>r.executeObjectIdsQuery(n)),t),r=await this._reschedule((()=>r.executeTimeQuery(n)),t),r=await this._reschedule((()=>r.executeAttributesQuery(n)),t);const e=r.items,i=new Set;return await this._reschedule((()=>{for(const t of e)i.add(r.featureAdapter.getObjectId(t))}),t),i}catch(e){if(e===m.g)return new Set;throw e}}async executeQueryForSnapping(e,t){const{point:r,distance:i,types:a}=e;if(0===a)return{candidates:[]};const o=await this._reschedule((()=>this._checkQuerySupport(e.query)),t),l=!Object(n.ak)(r.spatialReference,this.spatialReference);l&&await Object(p.g)(r.spatialReference,this.spatialReference);const u="number"==typeof i?i:i.x,h="number"==typeof i?i:i.y,d={xmin:r.x-u,xmax:r.x+u,ymin:r.y-h,ymax:r.y+h,spatialReference:r.spatialReference},f=l?Object(p.j)(d,this.spatialReference):d;if(!f)return{candidates:[]};const y=(await Object(c.a)(Object(s.e)(r),null,{signal:t}))[0],g=(await Object(c.a)(Object(s.e)(f),null,{signal:t}))[0];if(Object(n.J)(y)||Object(n.J)(g))return{candidates:[]};let m=new L(this._searchFeatures(this._getQueryBBoxes(g.toJSON())),null,this);m=await this._reschedule((()=>m.executeObjectIdsQuery(o)),t),m=await this._reschedule((()=>m.executeTimeQuery(o)),t),m=await this._reschedule((()=>m.executeAttributesQuery(o)),t);const b=y.toJSON(),_=l?Object(p.j)(b,this.spatialReference):b,x=l?Math.max(f.xmax-f.xmin,f.ymax-f.ymin)/2:i;return m.createSnappingResponse({...e,point:_,distance:x},r.spatialReference)}async executeQueryForLatestObservations(e={},t){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new n.s(P,"Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});let r,s=Object(i.o)(e);try{s=await this._schedule((()=>Object(m.b)(s,this.definitionExpression,this.spatialReference)),t),s=await this._reschedule((()=>this._checkQuerySupport(s)),t),r=await this._reschedule((()=>this._executeGeometryQuery(s,t)),t),r=await this._reschedule((()=>r.executeAggregateIdsQuery(s)),t),r=await this._reschedule((()=>r.executeObjectIdsQuery(s)),t),r=await this._reschedule((()=>r.executeTimeQuery(s)),t),r=await this._reschedule((()=>r.executeAttributesQuery(s)),t),r=await this._reschedule((()=>r.filterLatest()),t)}catch(e){if(e!==m.g)throw e;r=new L([],null,this)}return r.createQueryResponse(s)}async _schedule(e,t){return this._frameQueue?this._frameQueue.push(e,t):e()}async _reschedule(e,t){return this._frameQueue?this._frameQueue.unshift(e,t):e()}_update(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null}_getAll(){if(!this._allItems){const e=[];this.featureStore.forEach((t=>e.push(t))),this._allItems=new L(e,null,this)}return this._allItems}async _executeGeometryQuery(e,t){const{geometry:r,outSR:i,spatialRel:s,returnGeometry:a,returnCentroid:o}=e,l=a||o,c=Object(n.an)(i)&&!Object(n.ak)(this.spatialReference,i),u=this._geometryQueryCache?c&&l?JSON.stringify({geometry:r,spatialRelationship:s,outSpatialReference:i}):JSON.stringify({geometry:r,spatialRelationship:s}):null;if(u){const e=this._geometryQueryCache.get(u);if(!Object(n.cv)(e))return e}const h=async e=>{if(c&&l){const t=await e.project(i);return u&&this._geometryQueryCache.put(u,t,t.size||1),t}return u&&this._geometryQueryCache.put(u,e,e.size||1),e};if(!r)return h(this._getAll());const d=this.featureAdapter;if("esriSpatialRelDisjoint"===s){const e=this._searchFeatures(this._getQueryBBoxes(r));if(!e.length)return h(this._getAll());let i,n;const a=new Set;for(const t of e)a.add(d.getObjectId(t));return await this._reschedule((()=>{let e=0;i=new Array(a.size),this.featureStore.forEach((t=>i[e++]=t)),n=a}),t),h(await this._reschedule((async()=>{const e=await Object(m.j)(s,r,this.geometryType,this.hasZ,this.hasM);return new L(await this._runSpatialFilter(i,(t=>!n.has(d.getObjectId(t))||e(d.getGeometry(t))),t),r,this)}),t))}const f=this._searchFeatures(this._getQueryBBoxes(r));if(!f.length){const e=new L([],r,this);return u&&this._geometryQueryCache.put(u,e,e.size||1),e}if(this._canExecuteSoloPass(r,e))return h(new L(f,r,this));const p=await Object(m.j)(s,r,this.geometryType,this.hasZ,this.hasM),y=await this._runSpatialFilter(f,(e=>p(d.getGeometry(e))),t);return h(new L(y,r,this))}async _runSpatialFilter(e,t,r){if(!t)return e;if(!this._budget)return e.filter((e=>t(e)));let i=0;const n=new Array,s=async()=>{for(;i<e.length;){const a=e[i];t(a)&&n.push(a),this._budget.done&&await this._reschedule((()=>s()),r),++i}};return this._reschedule((()=>s()),r).then((()=>n))}_canExecuteSoloPass(e,t){const{geometryType:r}=this,{spatialRel:i}=t;return Object(m.a)(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))}_getQueryBBoxes(e){if(Object(m.a)(e)){if(Object(s.g)(e))return[Object(o.j)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(s.h)(e))return e.rings.map((e=>Object(o.j)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[Object(n.ca)(Object(o.f)(),e)]}_searchFeatures(e){for(const t of e)this.featureStore.forEachInBounds(t,(e=>{B.add(e)}));const t=new Array(B.size);let r=0;return B.forEach((e=>t[r++]=e)),B.clear(),t}async _checkQuerySupport(e){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new n.s(P,"Unsupported query options",{query:e});return Promise.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),Object(m.d)(e,this.geometryType,this.spatialReference),Object(p.g)(this.spatialReference,e.outSR)]).then((()=>e))}_checkAttributesQuerySupport(e){const{outFields:t,orderByFields:r,returnDistinctValues:i,outStatistics:s}=e,a=s?s.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())):[];if(r&&r.length>0){const e=" asc",t=" desc",i=r.map((r=>{const i=r.toLowerCase();return i.indexOf(e)>-1?i.split(e)[0]:i.indexOf(t)>-1?i.split(t)[0]:r})).filter((e=>-1===a.indexOf(e)));T(this.fieldsIndex,i,"orderByFields contains missing fields")}if(t&&t.length>0)T(this.fieldsIndex,t,"outFields contains missing fields");else if(i)throw new n.s(P,"outFields should be specified for returnDistinctValues",{query:e});O(this.fieldsIndex,e.where)}async _checkStatisticsQuerySupport(e){const{outStatistics:t,groupByFieldsForStatistics:r,having:i}=e,s=r&&r.length,a=t&&t.length;if(i){if(!s||!a)throw new n.s(P,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});I(this.fieldsIndex,i,t)}if(a){if(!function(e){return e.every((e=>"exceedslimit"!==e.statisticType))}(t))return;const i=t.map((e=>e.onStatisticField));T(this.fieldsIndex,i,"onStatisticFields contains missing fields"),s&&T(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields");for(const r of t){const{onStatisticField:t,statisticType:i}=r;if("percentile_disc"!==i&&"percentile_cont"!==i||!("statisticParameters"in r)){if("count"!==i&&t&&A(t,this.fieldsIndex))throw new n.s(P,"outStatistics contains non-numeric fields",{definition:r,query:e})}else{const{statisticParameters:t}=r;if(!t)throw new n.s(P,"statisticParamters should be set for percentile type",{definition:r,query:e})}}}}}const V=Object(f.f)(),G=Object(f.f)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));r(88),r(87),r(163);const i=new Float32Array(1);function n(e){return s(Math.max(-a,Math.min(e,a)))}function s(e){return i[0]=e,i[0]}const a=s(34028234663852886e22);var o={};o.defaultNoDataValue=n(-1/0),o.decode=function(e,t){var r=(t=t||{}).encodedMaskData||null===t.encodedMaskData,i=h(e,t.inputOffset||0,r),s=null!=t.noDataValue?n(t.noDataValue):o.defaultNoDataValue,a=l(i,t.pixelType||Float32Array,t.encodedMaskData,s,t.returnMask),d={width:i.width,height:i.height,pixelData:a.resultPixels,minValue:i.pixels.minValue,maxValue:i.pixels.maxValue,noDataValue:s};return a.resultMask&&(d.maskData=a.resultMask),t.returnEncodedMask&&i.mask&&(d.encodedMaskData=i.mask.bitset?i.mask.bitset:null),t.returnFileInfo&&(d.fileInfo=c(i,s),t.computeUsedBitDepths&&(d.fileInfo.bitDepths=u(i))),d};var l=function(e,t,r,i,n){var s,a,o=0,l=e.pixels.numBlocksX,c=e.pixels.numBlocksY,u=Math.floor(e.width/l),h=Math.floor(e.height/c),f=2*e.maxZError;r=r||(e.mask?e.mask.bitset:null),s=new t(e.width*e.height),n&&r&&(a=new Uint8Array(e.width*e.height));for(var p,y,g=new Float32Array(u*h),m=0;m<=c;m++){var b=m!==c?h:e.height%c;if(0!==b)for(var _=0;_<=l;_++){var x=_!==l?u:e.width%l;if(0!==x){var v,w,O,I,S=m*e.width*h+_*u,T=e.width-x,j=e.pixels.blocks[o];if(j.encoding<2?(0===j.encoding?v=j.rawData:(d(j.stuffedData,j.bitsPerPixel,j.numValidPixels,j.offset,f,g,e.pixels.maxValue),v=g),w=0):O=2===j.encoding?0:j.offset,r)for(y=0;y<b;y++){for(7&S&&(I=r[S>>3],I<<=7&S),p=0;p<x;p++)7&S||(I=r[S>>3]),128&I?(a&&(a[S]=1),s[S++]=j.encoding<2?v[w++]:O):(a&&(a[S]=0),s[S++]=i),I<<=1;S+=T}else if(j.encoding<2)for(y=0;y<b;y++){for(p=0;p<x;p++)s[S++]=v[w++];S+=T}else for(y=0;y<b;y++)if(s.fill)s.fill(O,S,S+x),S+=x+T;else{for(p=0;p<x;p++)s[S++]=O;S+=T}if(1===j.encoding&&w!==j.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:s,resultMask:a}},c=function(e,t){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:t}}},u=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,r={},i=0;i<t;i++){var n=e.pixels.blocks[i];0===n.encoding?r.float32=!0:1===n.encoding?r[n.bitsPerPixel]=!0:r[0]=!0}return Object.keys(r)},h=function(e,t,r){var i={},n=new Uint8Array(e,t,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,n),"CntZImage"!=i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;t+=10;var s=new DataView(e,t,24);if(i.fileVersion=s.getInt32(0,!0),i.imageType=s.getInt32(4,!0),i.height=s.getUint32(8,!0),i.width=s.getUint32(12,!0),i.maxZError=s.getFloat64(16,!0),t+=24,!r)if(s=new DataView(e,t,16),i.mask={},i.mask.numBlocksY=s.getUint32(0,!0),i.mask.numBlocksX=s.getUint32(4,!0),i.mask.numBytes=s.getUint32(8,!0),i.mask.maxValue=s.getFloat32(12,!0),t+=16,i.mask.numBytes>0){var a=new Uint8Array(Math.ceil(i.width*i.height/8)),o=(s=new DataView(e,t,i.mask.numBytes)).getInt16(0,!0),l=2,c=0;do{if(o>0)for(;o--;)a[c++]=s.getUint8(l++);else{var u=s.getUint8(l++);for(o=-o;o--;)a[c++]=u}o=s.getInt16(l,!0),l+=2}while(l<i.mask.numBytes);if(-32768!==o||c<a.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=a,t+=i.mask.numBytes}else 0==(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(a=new Uint8Array(Math.ceil(i.width*i.height/8)),i.mask.bitset=a);s=new DataView(e,t,16),i.pixels={},i.pixels.numBlocksY=s.getUint32(0,!0),i.pixels.numBlocksX=s.getUint32(4,!0),i.pixels.numBytes=s.getUint32(8,!0),i.pixels.maxValue=s.getFloat32(12,!0),t+=16;var h=i.pixels.numBlocksX,d=i.pixels.numBlocksY,f=h+(i.width%h>0?1:0),p=d+(i.height%d>0?1:0);i.pixels.blocks=new Array(f*p);for(var y=1e9,g=0,m=0;m<p;m++)for(var b=0;b<f;b++){var _=0,x=e.byteLength-t;s=new DataView(e,t,Math.min(10,x));var v={};i.pixels.blocks[g++]=v;var w=s.getUint8(0);if(_++,v.encoding=63&w,v.encoding>3)throw"Invalid block encoding ("+v.encoding+")";if(2!==v.encoding){if(0!==w&&2!==w){if(w>>=6,v.offsetType=w,2===w)v.offset=s.getInt8(1),_++;else if(1===w)v.offset=s.getInt16(1,!0),_+=2;else{if(0!==w)throw"Invalid block offset type";v.offset=s.getFloat32(1,!0),_+=4}if(y=Math.min(v.offset,y),1===v.encoding)if(w=s.getUint8(_),_++,v.bitsPerPixel=63&w,w>>=6,v.numValidPixelsType=w,2===w)v.numValidPixels=s.getUint8(_),_++;else if(1===w)v.numValidPixels=s.getUint16(_,!0),_+=2;else{if(0!==w)throw"Invalid valid pixel count type";v.numValidPixels=s.getUint32(_,!0),_+=4}}var O;if(t+=_,3!=v.encoding)if(0===v.encoding){var I=(i.pixels.numBytes-1)/4;if(I!==Math.floor(I))throw"uncompressed block has invalid length";O=new ArrayBuffer(4*I),new Uint8Array(O).set(new Uint8Array(e,t,4*I));for(var S=new Float32Array(O),T=0;T<S.length;T++)y=Math.min(y,S[T]);v.rawData=S,t+=4*I}else if(1===v.encoding){var j=Math.ceil(v.numValidPixels*v.bitsPerPixel/8),E=Math.ceil(j/4);O=new ArrayBuffer(4*E),new Uint8Array(O).set(new Uint8Array(e,t,j)),v.stuffedData=new Uint32Array(O),t+=j}}else t++,y=Math.min(y,0)}return i.pixels.minValue=y,i.eofOffset=t,i},d=function(e,t,r,i,n,s,a){var o,l,c,u=(1<<t)-1,h=0,d=0,f=Math.ceil((a-i)/n),p=4*e.length-Math.ceil(t*r/8);for(e[e.length-1]<<=8*p,o=0;o<r;o++){if(0===d&&(c=e[h++],d=32),d>=t)l=c>>>d-t&u,d-=t;else{var y=t-d;l=(c&u)<<y&u,l+=(c=e[h++])>>>(d=32-y)}s[o]=l<f?i+l*n:a}return s};const f=o.decode},function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return S})),r.d(t,"c",(function(){return N})),r.d(t,"d",(function(){return F})),r.d(t,"e",(function(){return E})),r.d(t,"f",(function(){return O})),r.d(t,"g",(function(){return P})),r.d(t,"h",(function(){return B})),r.d(t,"i",(function(){return x})),r.d(t,"j",(function(){return C})),r.d(t,"k",(function(){return I})),r.d(t,"l",(function(){return _})),r.d(t,"m",(function(){return D})),r.d(t,"n",(function(){return A})),r.d(t,"o",(function(){return L})),r.d(t,"p",(function(){return M})),r.d(t,"q",(function(){return y})),r.d(t,"r",(function(){return g})),r.d(t,"s",(function(){return v})),r.d(t,"t",(function(){return T})),r.d(t,"u",(function(){return j})),r.d(t,"v",(function(){return u})),r.d(t,"w",(function(){return p})),r.d(t,"x",(function(){return d})),r.d(t,"y",(function(){return R})),r.d(t,"z",(function(){return w})),r.d(t,"A",(function(){return f})),r.d(t,"B",(function(){return b})),r.d(t,"C",(function(){return h}));r(18),r(0);var i=r(9),n=r(72);function s(e){var t;return Array.isArray(e)?null==(t=e[0])?void 0:t.spatialReference:null==e?void 0:e.spatialReference}function a(e){return e?Array.isArray(e)?e.map(a):e.toJSON?e.toJSON():e:e}function o(e){return Array.isArray(e)?e.map((e=>Object(i.e)(e))):Object(i.e)(e)}let l;async function c(e,t){return(await async function(){return l||(l=Object(n.d)("geometryEngineWorker",{strategy:"distributed"})),l}()).invoke("executeGEOperation",{operation:e,parameters:a(t)})}async function u(e,t){return o(await c("clip",[s(e),e,t]))}async function h(e,t){return o(await c("cut",[s(e),e,t]))}function d(e,t){return c("contains",[s(e),e,t])}function f(e,t){return c("crosses",[s(e),e,t])}function p(e,t,r){return c("distance",[s(e),e,t,r])}function y(e,t){return c("equals",[s(e),e,t])}function g(e,t){return c("intersects",[s(e),e,t])}function m(e,t){return c("touches",[s(e),e,t])}function b(e,t){return c("within",[s(e),e,t])}function _(e,t){return c("disjoint",[s(e),e,t])}function x(e,t){return c("overlaps",[s(e),e,t])}function v(e,t,r){return c("relate",[s(e),e,t,r])}function w(e){return c("isSimple",[s(e),e])}async function O(e){return o(await c("simplify",[s(e),e]))}async function I(e,t){return o(await c("difference",[s(e),e,t]))}async function S(e,t){return o(await c("symmetricDifference",[s(e),e,t]))}async function T(e,t){return o(await c("intersect",[s(e),e,t]))}async function j(e,t=null){const r=function(e,t){let r;return Array.isArray(e)?r=e:(r=[],r.push(e),null!=t&&r.push(t)),r}(e,t);return o(await c("union",[s(r),r]))}async function E(e,t,r,i,n,a){return o(await c("offset",[s(e),e,t,r,i,n,a]))}async function A(e,t,r,i=!1){const n=[s(e),e,t,r,i];return o(await c("buffer",n))}async function M(e,t,r,i,n,a){const l=[s(e),e,t,r,i,n,a];return o(await c("geodesicBuffer",l))}async function R(e,t,r){var i;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;r=null!=(i=r)?i:function(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}(e);const s=e.constructor.fromJSON(await c("rotate",[n,e,t,r]));return s.spatialReference=n,s}async function F(e,t,r,i){return o(await c("generalize",[s(e),e,t,r,i]))}async function C(e,t,r){return o(await c("densify",[s(e),e,t,r]))}async function D(e,t,r,i=0){return o(await c("geodesicDensify",[s(e),e,t,r,i]))}function L(e,t){return c("planarArea",[s(e),e,t])}function N(e,t){return c("planarLength",[s(e),e,t])}function P(e,t,r){return c("geodesicArea",[s(e),e,t,r])}function B(e,t,r){return c("geodesicLength",[s(e),e,t,r])}},,function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i={BingMapsLayer:async()=>(await r.e(30).then(r.bind(null,417))).default,BuildingSceneLayer:async()=>(await Promise.all([r.e(0),r.e(33)]).then(r.bind(null,418))).default,CSVLayer:async()=>(await Promise.all([r.e(0),r.e(34)]).then(r.bind(null,419))).default,ElevationLayer:async()=>(await Promise.all([r.e(0),r.e(13)]).then(r.bind(null,226))).default,FeatureLayer:async()=>(await Promise.resolve().then(r.bind(null,115)).then((function(e){return e.F}))).default,GroupLayer:async()=>(await r.e(14).then(r.bind(null,406))).default,GeoRSSLayer:async()=>(await r.e(46).then(r.bind(null,420))).default,ImageryLayer:async()=>(await Promise.all([r.e(7),r.e(0),r.e(53)]).then(r.bind(null,421))).default,ImageryTileLayer:async()=>(await Promise.all([r.e(7),r.e(0),r.e(55)]).then(r.bind(null,422))).default,IntegratedMeshLayer:async()=>(await Promise.all([r.e(0),r.e(56)]).then(r.bind(null,423))).default,KMLLayer:async()=>(await Promise.all([r.e(0),r.e(57)]).then(r.bind(null,424))).default,MapImageLayer:async()=>(await Promise.all([r.e(0),r.e(16)]).then(r.bind(null,408))).default,MapNotesLayer:async()=>(await Promise.all([r.e(0),r.e(61)]).then(r.bind(null,425))).default,OpenStreetMapLayer:async()=>(await Promise.all([r.e(0),r.e(66)]).then(r.bind(null,426))).default,PointCloudLayer:async()=>(await Promise.all([r.e(0),r.e(69)]).then(r.bind(null,427))).default,RouteLayer:async()=>(await r.e(74).then(r.bind(null,428))).default,SceneLayer:async()=>(await Promise.all([r.e(0),r.e(77)]).then(r.bind(null,429))).default,StreamLayer:async()=>(await r.e(80).then(r.bind(null,430))).default,TileLayer:async()=>(await Promise.all([r.e(0),r.e(84)]).then(r.bind(null,431))).default,UnknownLayer:async()=>(await r.e(86).then(r.bind(null,432))).default,UnsupportedLayer:async()=>(await r.e(87).then(r.bind(null,433))).default,VectorTileLayer:async()=>(await Promise.all([r.e(0),r.e(88)]).then(r.bind(null,434))).default,WebTileLayer:async()=>(await r.e(0).then(r.bind(null,389)).then((function(e){return e.W}))).default,WMSLayer:async()=>(await Promise.all([r.e(0),r.e(90)]).then(r.bind(null,435))).default,WMTSLayer:async()=>(await Promise.all([r.e(0),r.e(92)]).then(r.bind(null,436))).default}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(84),n=r(313),s=r(325),a=r(332),o=r(345);class l extends a.b{constructor(e,t,r,i=null){super(e,t,r,r),this.bitmap=new o.a(i,"standard",!1),this.bitmap.coordScale=r,this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(e){super.beforeRender(e),this.bitmap.beforeRender(e)}afterRender(e){super.afterRender(e),this.bitmap.afterRender(e)}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}class c extends a.a{get requiresDedicatedFBO(){return this.children.some((e=>"additive"===e.bitmap.blendFunction))}createTile(e){const t=this._tileInfoView.getTileBounds(Object(i.f)(),e);return new l(e,t,this._tileInfoView.tileInfo.size)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap (tile)",brushes:[s.c.bitmap],target:()=>this.children.map((e=>e.bitmap)),drawPhase:n.d.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===n.d.MAP&&super.doRender(e)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var i=r(0),n=(r(1),r(84)),s=r(73),a=r(54),o=r(35),l=r(345);const c=Math.PI/180;function u(e){return e*c}function h(e,t){const r=u(t.rotation),i=Math.abs(Math.cos(r)),n=Math.abs(Math.sin(r)),[s,a]=t.size;return e[0]=Math.round(a*n+s*i),e[1]=Math.round(a*i+s*n),e}const d=Object(n.f)(),f=[0,0],p=new a.a(0,0,0,0),y=2048,g=2048,m=!1,b=!1,_=!1;let x=class extends i.u{constructor(e){super(e),this._imagePromise=null,this.hidpi=_,this.imageMaxWidth=y,this.imageMaxHeight=g,this.imageRotationSupported=m,this.imageNormalizationSupported=b,this.update=Object(i.aa)((async(e,t)=>{const r=e.state,n=Object(i.aq)(r.spatialReference),s=this.hidpi?e.pixelRatio:1;if(!e.stationary||this.destroyed)return null;this.imageRotationSupported?(f[0]=r.size[0],f[1]=r.size[1]):h(f,r);const a=Math.floor(f[0]*s)>this.imageMaxWidth||Math.floor(f[1]*s)>this.imageMaxHeight,o=n&&(r.extent.xmin<n.valid[0]||r.extent.xmax>n.valid[1]),l=!this.imageNormalizationSupported&&o,c=!a&&!l,u=this.imageRotationSupported?r.rotation:0;if(c)this._imagePromise=this._singleExport(r,f,u,s,t);else{let e=Math.min(this.imageMaxWidth,this.imageMaxHeight);l&&(e=Math.min(r.worldScreenWidth,e)),this._imagePromise=this._tiledExport(r,e,u,s,t)}return this._imagePromise.then((async e=>{if(this._imagePromise=null,!this.destroyed){for(const t of this.container.children)e.includes(t)||t.fadeOut().then((()=>{t.remove()}));for(const t of e)this.container.addChild(t),t.fadeIn()}})).catch((e=>{throw this._imagePromise=null,e}))}),5e3)}destroy(){}get updating(){return null!==this._imagePromise}updateExports(e){for(const t of this.container.children){if(!t.visible||!t.stage)return;e(t)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(t.invalidateTexture(),t.requestRender())}}_export(e,t,r,i,n,s){return Promise.resolve().then((()=>this.fetchSource(e,Math.floor(t*n),Math.floor(r*n),{rotation:i,pixelRatio:n,signal:s}))).then((r=>{const s=new l.a(r,"additive");return s.x=e.xmin,s.y=e.ymax,s.resolution=e.width/t,s.rotation=i,s.pixelRatio=n,s}))}_singleExport(e,t,r,n,s){!function(e,t,r,i){const[n,s]=t,[a,o]=i,l=.5*r;e[0]=n-l*a,e[1]=s-l*o,e[2]=n+l*a,e[3]=s+l*o}(d,e.center,e.resolution,t);const a=new i.M(d[0],d[1],d[2],d[3],e.spatialReference);return this._export(a,t[0],t[1],r,n,s).then((e=>[e]))}_tiledExport(e,t,r,n,a){const l=s.b.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),c=new o.b(l),u=c.getTileCoverage(e);if(!u)return null;const h=[];return u.forEach(((s,o,l,u)=>{p.set(s,o,l,u),c.getTileBounds(d,p);const f=new i.M(d[0],d[1],d[2],d[3],e.spatialReference);h.push(this._export(f,t,t,r,n,a))})),Promise.all(h)}};Object(i.e)([Object(i.y)()],x.prototype,"_imagePromise",void 0),Object(i.e)([Object(i.y)()],x.prototype,"container",void 0),Object(i.e)([Object(i.y)()],x.prototype,"fetchSource",void 0),Object(i.e)([Object(i.y)()],x.prototype,"hidpi",void 0),Object(i.e)([Object(i.y)()],x.prototype,"imageMaxWidth",void 0),Object(i.e)([Object(i.y)()],x.prototype,"imageMaxHeight",void 0),Object(i.e)([Object(i.y)()],x.prototype,"imageRotationSupported",void 0),Object(i.e)([Object(i.y)()],x.prototype,"imageNormalizationSupported",void 0),Object(i.e)([Object(i.y)()],x.prototype,"requestUpdate",void 0),Object(i.e)([Object(i.y)()],x.prototype,"updating",null),x=Object(i.e)([Object(i.i)("esri.views.2d.layers.support.ExportStrategy")],x);var v=x},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return p}));var i=r(0),n=r(349);const s=180/Math.PI,a=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0},o=new Map;function l(e,t){return o.get(e)/o.get(t)||1}function c(e){return(450-e)%360}function u(e,t="geographic"){const[r,i]=e,n=Math.sqrt(r*r+i*i);let a=Math.atan2(i,r)*s;return a=(360+a)%360,"geographic"===t&&(a=c(a)),[n,a]}function h(e,t="geographic"){let r=e[1];"geographic"===t&&(r=c(r)),r%=360;const i=e[0];return[i*Math.cos(r/s),i*Math.sin(r/s)]}function d(e,t,r="geographic",i=1){if(!a(e))return e;const{pixels:s,width:o,height:l}=e,c=o*l,d=s[0],f=s[1],p=n.p.createEmptyBand(e.pixelType,c),y=n.p.createEmptyBand(e.pixelType,c);let g=0;for(let e=0;e<l;e++)for(let e=0;e<o;e++)"vector-uv"===t?([p[g],y[g]]=u([d[g],f[g]],r),p[g]*=i):([p[g],y[g]]=h([d[g],f[g]],r),p[g]*=i,y[g]*=i),g++;const m=new n.p({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[p,y]});return m.updateStatistics(),m}function f(e,t,r=1){if(1===r||!a(e))return e;const i=e.clone(),{pixels:n,width:s,height:o}=i,l=n[0],c=n[1];let u=0;for(let e=0;e<o;e++)for(let e=0;e<s;e++)"vector-uv"===t?(l[u]*=r,c[u]*=r):l[u]*=r,u++;return i.updateStatistics(),i}function p(e,t,r,n,s){if(!Object(i.P)(s)||!s.spatialReference.equals(e.spatialReference))return{extent:e,width:t,height:r};const a=s.xmin,o=s.ymax;n=Math.max(n||0,30);const l=Math.ceil(t*(1/n)),c=Math.ceil(r*(1/n)),u=((e.xmax-e.xmin)/l+(e.ymax-e.ymin)/c)/2;return e.xmin=a+Math.floor((e.xmin-a)/u)*u,e.xmax=a+Math.ceil((e.xmax-a)/u)*u,e.ymin=o+Math.floor((e.ymin-o)/u)*u,e.ymax=o+Math.ceil((e.ymax-o)/u)*u,{extent:e,width:Math.round(e.width/u),height:Math.round(e.height/u)}}o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704)},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return l})),r.d(t,"g",(function(){return y})),r.d(t,"h",(function(){return c}));r(88);var i=r(0),n=r(10),s=r(86);const a=5e-4,o=function(e,t){const r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)};async function l(){if(Object(s.e)()||!Object(s.f)())return null;await Object(s.a)()}function c(e,t,r){if(!o(e.spatialReference,t))return null;if(!Object(s.e)())throw new i.s("rasterprojectionhelper-projectResolution","projection engine is not loaded");return r?Object(s.d)(t,e.spatialReference,e):Object(s.d)(e.spatialReference,t,e)}function u(e,t,r,n=null){if(e.spatialReference.equals(t))return e;const a=o(e.spatialReference,t);if(a&&!Object(s.e)())throw new i.s("rasterprojectionhelper-projectResolution","projection engine is not loaded");const l=r.center,c=new i.M({xmin:l.x-e.x/2,xmax:l.x+e.x/2,ymin:l.y-e.y/2,ymax:l.y+e.y/2,spatialReference:e.spatialReference}),u=a?Object(s.b)(c,t,n):Object(i.ai)(c,t);return null==u?null:{x:u.xmax-u.xmin,y:u.ymax-u.ymin}}function h(e,t=.01){return Object(n.b)(e)?t/Object(n.b)(e):0}function d(e,t,r=null,n=!0){const l=e.spatialReference;if(l.equals(t))return e;const c=o(l,t);if(c&&!Object(s.e)())throw new i.s("rasterprojectionhelper-projectResolution","projection engine is not loaded");const u=c?Object(s.b)(e,t,r):Object(i.ai)(e,t);if(u&&n&&t.isGeographic){var d,f;const[t,r]=l.isWebMercator?Object(i.aq)(l).origin:null!=(d=null==(f=Object(i.aq)(l))?void 0:f.valid)?d:[],n=h(l);n&&null!=t&&null!=r&&(Math.abs(e.x-t)<n&&Math.abs(180-u.x)<a?u.x-=360:Math.abs(e.x-r)<n&&Math.abs(180+u.x)<a&&(u.x+=360))}return u}function f(e,t,r=null,n=!0){var l,c,u,f;const p=e.spatialReference;if(p.equals(t))return e;const y=o(p,t);if(y&&!Object(s.e)())throw new i.s("rasterprojectionhelper-projectExtent","projection engine is not loaded");const g=y?Object(s.b)(e,t,r):Object(i.ai)(e,t);let[m,b]=null!=(l=null==(c=Object(i.aq)(p))?void 0:c.origin)?l:[];if(g&&n&&p.isWebMercator&&t.isGeographic&&null!=m&&null!=b){const n=.001,s=1e3;if(Math.abs(e.xmin-m)<n&&Math.abs(b-e.xmax)>s&&Math.abs(180-g.xmax)<a){g.xmin=-180;const n=[];n.push(new i._(e.xmax,e.ymin,p)),n.push(new i._(e.xmax,(e.ymin+e.ymax)/2,p)),n.push(new i._(e.xmax,e.ymax,p));const s=n.map((e=>d(e,t,r))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmax=Math.max.apply(null,s)}if(Math.abs(e.xmax-b)<n&&Math.abs(m-e.xmin)>s&&Math.abs(180+g.xmin)<a){g.xmax=180;const n=[];n.push(new i._(e.xmin,e.ymin,p)),n.push(new i._(e.xmin,(e.ymin+e.ymax)/2,p)),n.push(new i._(e.xmin,e.ymax,p));const s=n.map((e=>d(e,t,r))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmin=Math.min.apply(null,s)}}[m,b]=t.isWebMercator?Object(i.aq)(t).origin:null!=(u=null==(f=Object(i.aq)(t))?void 0:f.valid)?u:[];const _=h(t);return _&&null!=m&&null!=b&&(Math.abs(g.xmin-m)<_&&(g.xmin=m),Math.abs(g.xmax-b)<_&&(g.xmax=b)),g}function p(e,t,r,n=null,a=null,l=!1,c=[32,32]){var u,h;if(o(e.spatialReference,t.spatialReference)&&!Object(s.e)())throw new i.s("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&r))return null;const{xmin:f,ymin:p,xmax:y,ymax:g}=e,m=e.spatialReference,b=t.spatialReference,[_,x]=null!=(u=null==(h=Object(i.aq)(m))?void 0:h.valid)?u:[],v={x:c[0]*r.x,y:c[1]*r.y},w={cols:Math.ceil((y-f)/v.x-.1)+1,rows:Math.ceil((g-p)/v.y-.1)+1},O=v.x,I=v.y,S=[];let T,j=!1;for(let e=0;e<w.cols;e++){const r=[];for(let s=0;s<w.rows;s++){let o=d(new i._({x:f+O*e,y:g-I*s,spatialReference:m}),b,n);a&&(o=a.inverseTransform(o)),r.push(o),e>0&&l&&o&&T[s]&&null!=_&&o.x<T[s].x&&(o.x+=x-_),o?(S.push((o.x-t.xmin)/(t.xmax-t.xmin)),S.push((t.ymax-o.y)/(t.ymax-t.ymin))):(S.push(NaN),S.push(NaN),j=!0)}T=r}const E=function(e,t){const r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,i=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(i-e[2*t.rows+3])]}(S,w),A=new Float32Array((w.cols-1)*(w.rows-1)*2*6),M=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),R=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<w.cols-1;e++){for(let t=0;t<w.rows-1;t++){let r=e*w.rows*2+2*t;const i=S[r],n=S[r+1],s=S[r+2],a=S[r+3];r+=2*w.rows;const o=S[r],l=S[r+1],c=S[r+2],u=S[r+3];let h=0,d=12*(t*(w.cols-1)+e);for(let e=0;e<3;e++)A[d++]=M[h++]*i+M[h++]*s+M[h++]*c;h=0;for(let e=0;e<3;e++)A[d++]=M[h++]*n+M[h++]*a+M[h++]*u;h=0;for(let e=0;e<3;e++)A[d++]=R[h++]*i+R[h++]*o+R[h++]*c;h=0;for(let e=0;e<3;e++)A[d++]=R[h++]*n+R[h++]*l+R[h++]*u}if(j)for(let e=0;e<A.length;e++)isNaN(A[e])&&(A[e]=-1)}return{offsets:S,error:E,coefficients:A,spacing:c,size:[w.cols-1,w.rows-1]}}function y(e,t,r){const n=Math.log(e.x/t.pixelSize.x)/Math.LN2,s=Math.log(e.y/t.pixelSize.y)/Math.LN2,a=t.storageInfo.maximumPyramidLevel||0;let o="down"===r?Math.floor(Math.min(n,s)):"up"===r?Math.ceil(Math.max(n,s)):Math.round((n+s)/2),l=!1;o<0?o=0:o>a&&(l=o>a+3,o=a);const c=2**o;return{pyramidLevel:o,pyramidResolution:new i._({x:c*t.nativePixelSize.x,y:c*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}}function g(e,t,r=512,s=!0){const{extent:a,spatialReference:o,pixelSize:l}=e,c=u(new i._({x:l.x,y:l.y,spatialReference:o}),t,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const h=(c.x+c.y)/2,d=Object(n.b)(t),p=h*d*96*39.37,y=t.isGeographic?512/r*295828763.7958547:512/r*591657527.591555;let g=!1;const m=f(a,t);s&&(t.isGeographic||t.isWebMercator)&&(g=m.xmin*m.xmax<0);let b,_=p;const x=1.001;if(g){_=y;const e=.29858214164761665,t=e*(96*d*39.37);b=u(new i._({x:e,y:e,spatialReference:{wkid:3857}}),o,m),b.x*=_/t,b.y*=_/t}else{b={x:l.x,y:l.y};const t=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let r=0;for(;_<y*(x/2)&&r<t;)r++,_*=2,b.x*=2,b.y*=2;Math.max(_,y)/Math.min(_,y)<=x&&(_=y)}const v=[_],w=[{x:b.x,y:b.y}],O=Math.min(70.5310735,p)/x;for(;_>=O;)_/=2,b.x/=2,b.y/=2,v.push(_),w.push({x:b.x,y:b.y});return{projectedPixelSize:c,scales:v,srcResolutions:w,isCustomTilingScheme:!g}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o}));var i=r(1),n=r(41);function s(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?n.b:"esriGeometryPolyline"===e?n.c:n.a}}}function a(e,t){if(Object(i.a)("csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${t.indexOf(".")?`["${t}"]`:`.${t}`} = ${JSON.stringify(e[t])};`;const i=new Function(r);return()=>new i}catch(r){return()=>({[t]:null,...e})}}function o(e={}){return[{name:"New Feature",description:"",prototype:{attributes:Object(i.o)(e)}}]}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return p}));var i=r(0),n=r(84),s=r(83),a=r(336),o=r(1),l=r(358),c=r(17),u=r(324);const h={minX:0,minY:0,maxX:0,maxY:0};class d{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new l.a(9,Object(o.a)("csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((r,i)=>{e[t++]=i})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))),this._boundsToLoad.length=0)}}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,r){h.minX=t[0],h.minY=t[1],h.maxX=t[2],h.maxY=t[3],e.search(h,r)}(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}const f={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new c.c(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(e.centroid||(e.centroid=Object(u.a)(new c.a,e.geometry,t.hasZ,t.hasM)),e.centroid)};class p{constructor(e){this.geometryInfo=e,this._boundsStore=new d,this._featuresById=new Map,this._markedIds=new Set,this.events=new i.m,this.featureAdapter=f}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){if(!this.numFeatures)return null;const e=Object(n.f)(n.b);return this._featuresById.forEach((t=>{const r=this._boundsStore.get(t.objectId);r&&(e[0]=Math.min(r[0],e[0]),e[1]=Math.min(r[1],e[1]),e[2]=Math.max(r[2],e[2]),e[3]=Math.max(r[3],e[3]))})),e}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t,r){for(const i of e){const e=this._boundsStore.get(i.objectId);e&&t(Object(a.e)(r,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,r)=>{this._markedIds.has(r)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void i.n.getLogger("esri.layers.graphics.data.FeatureStore").error(new i.s("featurestore:invalid-feature","feature id is missing",{feature:e}));const r=this._featuresById.get(t);let a;if(this._markedIds.add(t),r?(e.displayId=r.displayId,a=this._boundsStore.get(t),this._boundsStore.delete(t)):Object(i.P)(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);a=Object(s.q)(a||Object(n.f)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,a),this._featuresById.set(t,e)}_remove(e){return Object(i.P)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return ee})),r.d(t,"b",(function(){return G})),r.d(t,"c",(function(){return q})),r.d(t,"d",(function(){return H})),r.d(t,"e",(function(){return M})),r.d(t,"f",(function(){return F})),r.d(t,"g",(function(){return W})),r.d(t,"h",(function(){return Z})),r.d(t,"i",(function(){return C})),r.d(t,"j",(function(){return R})),r.d(t,"k",(function(){return P})),r.d(t,"l",(function(){return T})),r.d(t,"m",(function(){return B})),r.d(t,"n",(function(){return w})),r.d(t,"o",(function(){return D})),r.d(t,"p",(function(){return N})),r.d(t,"q",(function(){return p})),r.d(t,"r",(function(){return m})),r.d(t,"s",(function(){return g})),r.d(t,"t",(function(){return O})),r.d(t,"u",(function(){return S})),r.d(t,"v",(function(){return d})),r.d(t,"w",(function(){return E})),r.d(t,"x",(function(){return I})),r.d(t,"y",(function(){return x})),r.d(t,"z",(function(){return L})),r.d(t,"A",(function(){return k})),r.d(t,"B",(function(){return _})),r.d(t,"C",(function(){return v})),r.d(t,"D",(function(){return Y})),r.d(t,"E",(function(){return b})),r.d(t,"F",(function(){return y})),r.d(t,"G",(function(){return U})),r.d(t,"H",(function(){return Q})),r.d(t,"I",(function(){return J})),r.d(t,"J",(function(){return X})),r.d(t,"K",(function(){return f})),r.d(t,"L",(function(){return z})),r.d(t,"M",(function(){return A})),r.d(t,"N",(function(){return j})),r.d(t,"O",(function(){return V}));r(88),r(76),r(87),r(140),r(163),r(164),r(165),r(139);var i=r(7),n=r(8),s=r(354);r(1);class a{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===i&&(i=9*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}getMat(e,t){const r=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[r+e];return t}setMat(e,t){const r=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[r+e]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer,s=e*this.typedBufferStride,a=r*t.typedBufferStride;for(let e=0;e<9;++e)i[s+e]=n[a+e]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=9;class o{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===i&&(i=16*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}getMat(e,t){const r=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[r+e];return t}setMat(e,t){const r=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[r+e]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer,s=e*this.typedBufferStride,a=r*t.typedBufferStride;for(let e=0;e<16;++e)i[s+e]=n[a+e]}get buffer(){return this.typedBuffer.buffer}}o.ElementCount=16;class l{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===i&&(i=s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}l.ElementCount=1;class c{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===i&&(i=2*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}getVec(e,t){return Object(i.m)(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1])}setVec(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r){this.typedBuffer[e*this.typedBufferStride]=t,this.typedBuffer[e*this.typedBufferStride+1]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer,s=e*this.typedBufferStride,a=r*t.typedBufferStride;i[s]=n[a],i[s+1]=n[a+1]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=2;class u{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===i&&(i=3*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}getVec(e,t){return Object(n.n)(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2])}setVec(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i){this.typedBuffer[e*this.typedBufferStride]=t,this.typedBuffer[e*this.typedBufferStride+1]=r,this.typedBuffer[e*this.typedBufferStride+2]=i}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer,s=e*this.typedBufferStride,a=r*t.typedBufferStride;i[s]=n[a],i[s+1]=n[a+1],i[s+2]=n[a+2]}get buffer(){return this.typedBuffer.buffer}}u.ElementCount=3;class h{constructor(e,t,r=0,i,n){this.TypedArrayConstructor=e,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===i&&(i=4*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,a):new s(t,a,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}getVec(e,t){return Object(s.i)(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2],this.typedBuffer[e*this.typedBufferStride+3])}setVec(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2],this.typedBuffer[e*this.typedBufferStride+3]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i,n){this.typedBuffer[e*this.typedBufferStride]=t,this.typedBuffer[e*this.typedBufferStride+1]=r,this.typedBuffer[e*this.typedBufferStride+2]=i,this.typedBuffer[e*this.typedBufferStride+3]=n}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer,s=e*this.typedBufferStride,a=r*t.typedBufferStride;i[s]=n[a],i[s+1]=n[a+1],i[s+2]=n[a+2],i[s+3]=n[a+3]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends l{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class f extends c{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class p extends u{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class y extends h{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f32";class g extends a{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class m extends a{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f64";class b extends o{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f32";class _ extends o{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class x extends l{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class v extends c{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class w extends u{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="f64";class O extends h{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="f64";class I extends l{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u8";class S extends c{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class T extends u{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u8";class j extends h{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="u8";class E extends l{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u16";class A extends c{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u16";class M extends u{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u16";class R extends h{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class F extends l{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="u32";class C extends c{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u32";class D extends u{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class L extends h{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class N extends l{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="i8";class P extends c{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="i8";class B extends u{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i8";class k extends h{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i8";class U extends l{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i16";class z extends c{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i16";class V extends u{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i16";class G extends h{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class q extends l{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class H extends c{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i32";class W extends u{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32";class Z extends h{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}function X(e){switch(e){case"u8":return 1;case"u16":return 2;case"u32":return 4;case"i8":return 1;case"i16":return 2;case"i32":case"f32":return 4;case"f64":return 8;default:return}}function J(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function Y(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function Q(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}Z.ElementType="i32";class K{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fieldNames){const r=e.fields.get(t);this[t]=new r.constructor(this.buffer,r.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new K(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,r,i){const n=this.stride;if(n%4==0){const s=new Uint32Array(e.buffer,t*n,i*n/4);new Uint32Array(this.buffer,r*n,i*n/4).set(s)}else{const s=new Uint8Array(e.buffer,t*n,i*n);new Uint8Array(this.buffer,r*n,i*n).set(s)}}}class ${constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this.appendField(e,f,t),this}vec2f64(e,t){return this.appendField(e,v,t),this}vec3f(e,t){return this.appendField(e,p,t),this}vec3f64(e,t){return this.appendField(e,w,t),this}vec4f(e,t){return this.appendField(e,y,t),this}vec4f64(e,t){return this.appendField(e,O,t),this}mat3f(e,t){return this.appendField(e,g,t),this}mat3f64(e,t){return this.appendField(e,m,t),this}mat4f(e,t){return this.appendField(e,b,t),this}mat4f64(e,t){return this.appendField(e,_,t),this}vec4u8(e,t){return this.appendField(e,j,t),this}f32(e,t){return this.appendField(e,d,t),this}f64(e,t){return this.appendField(e,x,t),this}u8(e,t){return this.appendField(e,I,t),this}u16(e,t){return this.appendField(e,E,t),this}i8(e,t){return this.appendField(e,N,t),this}vec2i8(e,t){return this.appendField(e,P,t),this}vec2i16(e,t){return this.appendField(e,z,t),this}vec2u8(e,t){return this.appendField(e,S,t),this}vec4u16(e,t){return this.appendField(e,R,t),this}u32(e,t){return this.appendField(e,F,t),this}appendField(e,t,r){const i=t.ElementCount*X(t.ElementType),n=this.stride;this.fields.set(e,{size:i,constructor:t,offset:n,optional:r}),this.stride+=i,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.indexOf(e)>=0}createBuffer(e){return new K(this,e)}createView(e){return new K(this,e)}clone(){const e=new $;return e.stride=this.stride,e.fields=new Map,this.fields.forEach(((t,r)=>e.fields.set(r,t))),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function ee(){return new $}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return P})),r.d(t,"g",(function(){return B})),r.d(t,"h",(function(){return y}));r(76),r(88);var i=r(31),n=r(8),s=r(354);function a(){return[1,0,0,0,1,0,0,0,1]}function o(e,t){return new Float64Array(e,t,9)}function l(){return[0,0,0,1]}function c(e,t){return new Float64Array(e,t,4)}Object.freeze({__proto__:null,create:a,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,r,i,n,s,a,o,l){return[e,t,r,i,n,s,a,o,l]},createView:o});const u=[0,0,0,1];function h(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function d(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>n.g?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function f(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+a*o+n*c-s*l,e[1]=n*u+a*l+s*o-i*c,e[2]=s*u+a*c+i*l-n*o,e[3]=a*u-i*o-n*l-s*c,e}function p(e,t,r,i){const s=t[0],a=t[1],o=t[2],l=t[3];let c,u,h,d,f,p=r[0],y=r[1],g=r[2],m=r[3];return u=s*p+a*y+o*g+l*m,u<0&&(u=-u,p=-p,y=-y,g=-g,m=-m),1-u>n.g?(c=Math.acos(u),h=Math.sin(c),d=Math.sin((1-i)*c)/h,f=Math.sin(i*c)/h):(d=1-i,f=i),e[0]=d*s+f*p,e[1]=d*a+f*y,e[2]=d*o+f*g,e[3]=d*l+f*m,e}function y(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function g(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*s+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*n+s]-t[3*s+n])*i,e[n]=(t[3*n+r]+t[3*r+n])*i,e[s]=(t[3*s+r]+t[3*r+s])*i}return e}Object.freeze({__proto__:null,create:l,clone:function(e){return[e[0],e[1],e[2],e[3]]},fromValues:function(e,t,r,i){return[e,t,r,i]},createView:c,IDENTITY:u});const m=s.d,b=s.i,_=s.j,x=f,v=s.g,w=s.c,O=s.f,I=s.k,S=I,T=s.h,j=T,E=s.e,A=s.a,M=s.b;const R=Object(i.d)(),F=Object(i.f)(1,0,0),C=Object(i.f)(0,1,0);const D=[0,0,0,1],L=[0,0,0,1];const N=[1,0,0,0,1,0,0,0,1];function P(){return new Float32Array(3)}function B(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function k(){return P()}function U(){return B(1,1,1)}function z(){return B(1,0,0)}function V(){return B(0,1,0)}function G(){return B(0,0,1)}Object.freeze({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:h,getAxisAngle:d,multiply:f,rotateX:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*o,e[1]=n*l+s*o,e[2]=s*l-n*o,e[3]=a*l-i*o,e},rotateY:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*o,e[1]=n*l+a*o,e[2]=s*l+i*o,e[3]=a*l-n*o,e},rotateZ:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=n*l-i*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e},calculateW:function(e,t){const r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},slerp:p,random:function(e){const t=Object(n.s)(),r=Object(n.s)(),i=Object(n.s)(),s=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*r),e[1]=s*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e},invert:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=s*o,e},conjugate:y,fromMat3:g,fromEuler:function(e,t,r,i){const n=.5*Math.PI/180;t*=n,r*=n,i*=n;const s=Math.sin(t),a=Math.cos(t),o=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-a*o*c,e[1]=a*o*u+s*l*c,e[2]=a*l*c-s*o*u,e[3]=a*l*u+s*o*c,e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:m,set:b,add:_,mul:x,scale:v,dot:w,lerp:O,length:I,len:S,squaredLength:T,sqrLen:j,normalize:E,exactEquals:A,equals:M,rotationTo:function(e,t,r){const i=Object(n.w)(t,r);return i<-.999999?(Object(n.f)(R,F,t),Object(n.e)(R)<1e-6&&Object(n.f)(R,C,t),Object(n.m)(R,R),h(e,R,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(n.f)(R,t,r),e[0]=R[0],e[1]=R[1],e[2]=R[2],e[3]=1+i,E(e,e))},sqlerp:function(e,t,r,i,n,s){return p(D,t,n,s),p(L,r,i,s),p(e,D,L,2*s*(1-s)),e},setAxes:function(e,t,r,i){const n=N;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],E(e,g(e,n))}});const q=k(),H=U(),W=z(),Z=V(),X=G();Object.freeze({__proto__:null,create:P,clone:function(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:B,createView:function(e,t){return new Float32Array(e,t,3)},zeros:k,ones:U,unitX:z,unitY:V,unitZ:G,ZEROS:q,ONES:H,UNIT_X:W,UNIT_Y:Z,UNIT_Z:X})},,function(e,t){},function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l}));r(25);var i=r(0),n=(r(1),r(32)),s=r(57),a=r(91),o=r(23);async function l(e,t,r,n,s){let a=null;if(Object(i.P)(r)){const t=`${e}/nodepages/`,o=t+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await Object(i.C)(o,{query:{f:"json"},responseType:"json",signal:s})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:t}}catch(e){Object(i.P)(n)&&n.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",o,e),a=e}}if(!t)return null;const o=`${e}/nodes/`,l=o+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await Object(i.C)(l,{query:{f:"json"},responseType:"json",signal:s})).data,urlPrefix:o}}catch(e){throw new i.s("sceneservice:root-node-missing","Root node missing.",{pageError:a,nodeError:e,url:l})}}function c(e){return e&&"getAtOrigin"in e&&"originOf"in e}function u(e){e&&e.writtenProperties&&e.writtenProperties.forEach((e=>{const t=e.target;e.newOrigin&&e.oldOrigin!==e.newOrigin&&c(t)&&t.updateOrigin(e.propName,e.newOrigin)}))}async function h(e,t,r){if(!t||!t.resources)return;const n=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map((e=>e.resource.path))),o=new Set,l=[];s.forEach((t=>{n.delete(t),e.paths.push(t)}));for(const c of t.resources.toUpdate)if(n.delete(c.resource.path),s.has(c.resource.path)||o.has(c.resource.path)){const{resource:t,content:n,finish:s,error:o}=c,u=Object(a.getSiblingOfSameTypeI)(t,Object(i.a$)());e.paths.push(u.path),l.push(d({resource:u,content:n,finish:s,error:o},r))}else e.paths.push(c.resource.path),l.push(f(c,r)),o.add(c.resource.path);for(const i of t.resources.toAdd)l.push(d(i,r)),e.paths.push(i.resource.path);if(n.forEach((e=>{const r=t.portalItem.resourceFromPath(e);l.push(r.portalItem.removeResource(r).catch((()=>{})))})),0===l.length)return;const c=await Object(i.E)(l);Object(i.h)(r);const u=c.filter((e=>"error"in e)).map((e=>e.error));if(u.length>0)throw new i.s("save:resources","Failed to save one or more resources",{errors:u})}async function d(e,t){const r=await Object(i.ax)(e.resource.portalItem.addResource(e.resource,e.content,t));if(!0!==r.ok)throw e.error&&e.error(r.error),r.error;e.finish&&e.finish(e.resource)}async function f(e,t){const r=await Object(i.ax)(e.resource.update(e.content,t));if(!0!==r.ok)throw e.error(r.error),r.error;e.finish(e.resource)}const p=i.n.getLogger("esri.layers.mixins.SceneService"),y=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=Object(i.aa)((async(e,t,r)=>{switch(e){case 0:return this._save(t);case 1:return this._saveAs(r,t)}}))}readSpatialReference(e,t){return this._readSpatialReference(t)}_readSpatialReference(e){if(null!=e.spatialReference)return i.A.fromJSON(e.spatialReference);{const t=e.store,r=t.indexCRS||t.geographicCRS,n=r&&parseInt(r.substring(r.lastIndexOf("/")+1,r.length),10);return null!=n?new i.A(n):null}}readFullExtent(e,t,r){if(null!=e&&"object"==typeof e)return i.M.fromJSON(e,r);const n=t.store,s=this._readSpatialReference(t);return null==s||null==n||null==n.extent||!Array.isArray(n.extent)||n.extent.some((e=>e<g))?null:new i.M({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:s})}readVersion(e,t){const r=t.store,i=null!=r.version?r.version.toString():"",n={major:Number.NaN,minor:Number.NaN,versionString:i},s=i.split(".");return s.length>=2&&(n.major=parseInt(s[0],10),n.minor=parseInt(s[1],10)),n}readTitlePortalItem(e){return"item-title"!==this.sublayerTitleMode?void 0:e}readTitleService(e,t){const r=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return Object(n.e)(this.url,t.name);let s=t.name;if(!s&&this.url){const e=Object(n.c)(this.url);Object(i.P)(e)&&(s=e.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&r&&(s=r+" - "+s),Object(n.h)(s)}set url(e){const t=Object(n.d)({layer:this,url:e,nonStandardUrlAllowed:!1,logger:p});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,r,i){Object(n.a)(this,e,"layers",t,i)}get parsedUrl(){const e=this._get("url");if(!e)return null;const t=Object(i.U)(e);return null!=this.layerId&&(t.path=`${t.path}/layers/${this.layerId}`),t}async _fetchIndexAndUpdateExtent(e,t){this.indexInfo=l(this.parsedUrl.path,this.rootNode,e,p,t),null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(e){if("page"===(null==e?void 0:e.type)){var t,r;const n=e.rootIndex%e.pageSize,s=null==(t=e.rootPage)||null==(r=t.nodes)?void 0:r[n];if(null==s||null==s.obb||null==s.obb.center||null==s.obb.halfSize)throw new i.s("sceneservice:invalid-node-page","Invalid node page.");if(s.obb.center[0]<g||null==this.fullExtent||this.fullExtent.hasZ)return;const a=s.obb.halfSize,o=s.obb.center[2],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);this.fullExtent.zmin=o-l,this.fullExtent.zmax=o+l}else if("node"===(null==e?void 0:e.type)){var n;const t=null==(n=e.rootNode)?void 0:n.mbs;if(!Array.isArray(t)||4!==t.length||t[0]<g)return;const r=t[2],i=t[3];this.fullExtent.zmin=r-i,this.fullExtent.zmax=r+i}}async _fetchService(e){if(null==this.url)throw new i.s("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const t=await this._fetchFirstLayerId(e);null!=t&&(this.layerId=t)}return this._fetchServiceLayer(e)}async _fetchFirstLayerId(e){const t=await Object(i.C)(this.url,{query:{f:"json"},responseType:"json",signal:e});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id}async _fetchServiceLayer(e){const t=await Object(i.C)(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:e});t.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));const r=t.data;this.read(r,{origin:"service",url:this.parsedUrl}),this.validateLayer(r)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&"function"==typeof this.beforeSave&&await this.beforeSave()}validateLayer(e){}_updateTypeKeywords(e,t,r){e.typeKeywords||(e.typeKeywords=[]);const i=t.getTypeKeywords();for(const t of i)e.typeKeywords.push(t);e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)),1===r&&(e.typeKeywords=e.typeKeywords.filter((e=>"Hosted Service"!==e))))}async _saveAs(e,t){const r={..._,...t};let n=i.bK.from(e);n||(p.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new i.s("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const s=n.portal||i.aT.getDefault();await this._ensureLoadBeforeSave(),n.type=b,n.portal=s;const a={origin:"portal-item",url:null,messages:[],portal:s,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},o={layers:[this.write(null,a)]};return await Promise.all(a.resources.pendingOperations),await this._validateAgainstJSONSchema(o,a,r),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,r,1),await s._signIn(),await s.user.addItem({item:n,folder:r&&r.folder,data:o}),await h(this.resourceReferences,a,null),this.portalItem=n,u(a),a.portalItem=n,n}async _save(e){const t={..._,...e};this.portalItem||(p.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new i.s("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==b&&(p.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+b),await Promise.reject(new i.s("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${b}"`))),await this._ensureLoadBeforeSave();const r={origin:"portal-item",url:this.portalItem.itemUrl&&Object(i.U)(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||i.aT.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write(null,r)]};return await Promise.all(r.resources.pendingOperations),await this._validateAgainstJSONSchema(n,r,t),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,t,0),await this.portalItem.update({data:n}),await h(this.resourceReferences,r,null),u(r),this.portalItem}async _validateAgainstJSONSchema(e,t,n){let s=t.messages.filter((e=>"error"===e.type)).map((e=>new i.s(e.name,e.message,e.details)));if(n&&n.validationOptions.ignoreUnsupported&&(s=s.filter((e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name&&"scenemodification:unsupported"!==e.name))),n.validationOptions.enabled||m){const t=(await Promise.all([r.e(27),r.e(0)]).then(r.bind(null,519))).validate(e,n.portalItemLayerType);if(t.length>0){const e=`Layer item did not validate:\n${t.join("\n")}`;if(p.error(`_validateAgainstJSONSchema(): ${e}`),"throw"===n.validationOptions.failPolicy){const e=t.map((e=>new i.s("sceneservice:schema-validation",e))).concat(s);throw new i.s("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:e})}}}if(s.length>0)throw new i.s("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})}};return Object(i.e)([Object(i.y)(o.c)],t.prototype,"id",void 0),Object(i.e)([Object(i.y)({type:i.A})],t.prototype,"spatialReference",void 0),Object(i.e)([Object(i.a1)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),Object(i.e)([Object(i.y)({type:i.M})],t.prototype,"fullExtent",void 0),Object(i.e)([Object(i.a1)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),Object(i.e)([Object(i.y)({readOnly:!0,type:s.a})],t.prototype,"heightModelInfo",void 0),Object(i.e)([Object(i.y)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),Object(i.e)([Object(i.y)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],t.prototype,"version",void 0),Object(i.e)([Object(i.a1)("version",["store.version"])],t.prototype,"readVersion",null),Object(i.e)([Object(i.y)({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(i.e)([Object(i.y)({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),Object(i.e)([Object(i.y)({type:String})],t.prototype,"title",void 0),Object(i.e)([Object(i.a1)("portal-item","title")],t.prototype,"readTitlePortalItem",null),Object(i.e)([Object(i.a1)("service","title",["name"])],t.prototype,"readTitleService",null),Object(i.e)([Object(i.y)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),Object(i.e)([Object(i.y)(o.f)],t.prototype,"url",null),Object(i.e)([Object(i.o)("url")],t.prototype,"writeUrl",null),Object(i.e)([Object(i.y)()],t.prototype,"parsedUrl",null),Object(i.e)([Object(i.y)({readOnly:!0})],t.prototype,"store",void 0),Object(i.e)([Object(i.y)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=Object(i.e)([Object(i.i)("esri.layers.mixins.SceneService")],t),t},g=-1e38,m=!1,b="Scene Service",_={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return S})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return v})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return u})),r.d(t,"i",(function(){return I}));r(18);var i=r(1),n=r(0),s=r(12),a=r(20),o=r(53),l=r(360);class c{constructor(e={}){this._options=e}toQueryParams(e){if(!e)return null;const t=e.toJSON(),r={};return Object.keys(t).forEach((e=>{const i=this._options[e];if(i){const n="boolean"!=typeof i&&i.name?i.name:e,s="boolean"!=typeof i&&i.getter?i.getter(t):t[e];null!=s&&(r[n]=(e=>{if(!Array.isArray(e))return!1;const[t]=e;return"number"==typeof t||"string"==typeof t})(s)?s.join(","):"object"==typeof s?JSON.stringify(s):s)}else r[e]=t[e]}),this),r}}function u(e){return new c(e)}const h=new n.aM({0:"informative",1:"process-definition",2:"process-start",3:"process-stop",50:"warning",100:"error",101:"empty",200:"abort"});let d=class extends l.a{constructor(e){super(e),this.type=null}};Object(n.e)([Object(n.y)({type:String,json:{read:h.read,write:h.write}})],d.prototype,"type",void 0),d=Object(n.e)([Object(n.i)("esri.tasks.support.NAMessage")],d);var f=d;let p=class extends o.default{constructor(e){super(e),this.extent=null,this.features=null,this.geometryType="polyline",this.routeId=null,this.routeName=null,this.totalDriveTime=null,this.totalLength=null,this.totalTime=null}readFeatures(e,t){(e||[]).forEach((e=>{this._decompressFeatureGeometry(e,t.summary.envelope.spatialReference)}));const r=n.A.fromJSON(t.spatialReference);return e.map((e=>{const t=a.a.fromJSON(e),i=e.geometry&&e.geometry.spatialReference;return t.geometry&&!i&&(Object(n.Y)(t.geometry).spatialReference=r),t.strings=e.strings,t.events=(e.events||[]).map((t=>{const r=new a.a({geometry:new n._({x:t.point.x,y:t.point.y,z:t.point.z,hasZ:void 0!==t.point.z,spatialReference:e.geometry&&e.geometry.spatialReference}),attributes:{ETA:t.ETA,arriveTimeUTC:t.arriveTimeUTC}});return r.strings=t.strings,r})),t}))}get mergedGeometry(){if(!this.features)return null;const e=this.features.map((({geometry:e})=>Object(n.Y)(e))),t=this.get("extent.spatialReference");return this._mergePolylinesToSinglePath(e,t)}get strings(){return this.features.map((({strings:e})=>e))}_decompressFeatureGeometry(e,t){e.geometry=this._decompressGeometry(e.compressedGeometry,t)}_decompressGeometry(e,t){let r=0,i=0,n=0,s=0;const a=[];let o,l,c,u,h,d,f,p,y=0,g=0,m=0;if(h=e.match(/((\+|\-)[^\+\-\|]+|\|)/g),h||(h=[]),0===parseInt(h[y],32)){y=2;const e=parseInt(h[y],32);y++,d=parseInt(h[y],32),y++,1&e&&(g=h.indexOf("|")+1,f=parseInt(h[g],32),g++),2&e&&(m=h.indexOf("|",g)+1,p=parseInt(h[m],32),m++)}else d=parseInt(h[y],32),y++;for(;y<h.length&&"|"!==h[y];){o=parseInt(h[y],32)+r,y++,r=o,l=parseInt(h[y],32)+i,y++,i=l;const e=[o/d,l/d];g&&(u=parseInt(h[g],32)+n,g++,n=u,e.push(u/f)),m&&(c=parseInt(h[m],32)+s,m++,s=c,e.push(c/p)),a.push(e)}return{paths:[a],hasZ:g>0,hasM:m>0,spatialReference:t}}_mergePolylinesToSinglePath(e,t){let r=[];(e||[]).forEach((e=>{e.paths.forEach((e=>{r=r.concat(e)}))}));const i=[];let s=[0,0];return r.forEach((e=>{e[0]===s[0]&&e[1]===s[1]||(i.push(e),s=e)})),new n.aJ({paths:[i]},t)}};Object(n.e)([Object(n.y)({type:n.M,json:{read:{source:"summary.envelope"}}})],p.prototype,"extent",void 0),Object(n.e)([Object(n.y)()],p.prototype,"features",void 0),Object(n.e)([Object(n.a1)("features")],p.prototype,"readFeatures",null),Object(n.e)([Object(n.y)()],p.prototype,"geometryType",void 0),Object(n.e)([Object(n.y)({readOnly:!0})],p.prototype,"mergedGeometry",null),Object(n.e)([Object(n.y)()],p.prototype,"routeId",void 0),Object(n.e)([Object(n.y)()],p.prototype,"routeName",void 0),Object(n.e)([Object(n.y)({value:null,readOnly:!0})],p.prototype,"strings",null),Object(n.e)([Object(n.y)({json:{read:{source:"summary.totalDriveTime"}}})],p.prototype,"totalDriveTime",void 0),Object(n.e)([Object(n.y)({json:{read:{source:"summary.totalLength"}}})],p.prototype,"totalLength",void 0),Object(n.e)([Object(n.y)({json:{read:{source:"summary.totalTime"}}})],p.prototype,"totalTime",void 0),p=Object(n.e)([Object(n.i)("esri.tasks.support.DirectionsFeatureSet")],p);var y=p;let g=class extends n.a{constructor(e){super(e),this.directions=null,this.route=null,this.routeName=null,this.stops=null}};Object(n.e)([Object(n.y)({type:y,json:{write:!0}})],g.prototype,"directions",void 0),Object(n.e)([Object(n.y)({type:a.a,json:{write:!0}})],g.prototype,"route",void 0),Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],g.prototype,"routeName",void 0),Object(n.e)([Object(n.y)({type:[a.a],json:{write:!0}})],g.prototype,"stops",void 0),g=Object(n.e)([Object(n.i)("esri.tasks.support.RouteResult")],g);var m=g;function b(e){return e&&o.default.fromJSON(e).features.map((e=>e))}let _=class extends n.a{constructor(e){super(e),this.barriers=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(e,t){return b(t.barriers||t.pointBarriers)}readPolylineBarriers(e){return b(e)}readPolygonBarriers(e){return b(e)}};Object(n.e)([Object(n.y)({aliasOf:"pointBarriers"})],_.prototype,"barriers",void 0),Object(n.e)([Object(n.y)({type:[f]})],_.prototype,"messages",void 0),Object(n.e)([Object(n.y)({type:[a.a]})],_.prototype,"pointBarriers",void 0),Object(n.e)([Object(n.a1)("pointBarriers",["barriers","pointBarriers"])],_.prototype,"readPointBarriers",null),Object(n.e)([Object(n.y)({type:[a.a]})],_.prototype,"polylineBarriers",void 0),Object(n.e)([Object(n.a1)("polylineBarriers")],_.prototype,"readPolylineBarriers",null),Object(n.e)([Object(n.y)({type:[a.a]})],_.prototype,"polygonBarriers",void 0),Object(n.e)([Object(n.a1)("polygonBarriers")],_.prototype,"readPolygonBarriers",null),Object(n.e)([Object(n.y)({type:[m]})],_.prototype,"routeResults",void 0),_=Object(n.e)([Object(n.i)("esri.tasks.support.RouteResultsContainer")],_);var x=_;function v(e,t,r,i){i[r]=[t.length,t.length+e.length],e.forEach((e=>{t.push(e.geometry)}))}function w(e,t){for(let r=0;r<t.length;r++){const i=e[t[r]];if(i&&i.length)for(const e of i)e.z=void 0}console.log("The remote Network Analysis service is powered by a network dataset which is not Z-aware.\nZ-coordinates of the input geometry are ignored.")}function O(e){const t=[],r=[],{directions:i=[],routes:{features:n=[],spatialReference:s=null}={},stops:{features:a=[],spatialReference:o=null}={},barriers:l,polygonBarriers:c,polylineBarriers:u,messages:h}=e.data,d="esri.tasks.RouteTask.NULL_ROUTE_NAME";let f,p,y=!0;const g=n&&s||a&&o||l&&l.spatialReference||c&&c.spatialReference||u&&u.spatialReference;i.forEach((e=>{t.push(f=e.routeName),r[f]={directions:e}})),n.forEach((e=>{-1===t.indexOf(f=e.attributes.Name)&&(t.push(f),r[f]={}),e.geometry&&(e.geometry.spatialReference=g),r[f].route=e})),a.forEach((e=>{p=e.attributes,-1===t.indexOf(f=p.RouteName||d)&&(t.push(f),r[f]={}),f!==d&&(y=!1),e.geometry&&(e.geometry.spatialReference=g),null==r[f].stops&&(r[f].stops=[]),r[f].stops.push(e)})),a.length>0&&!0===y&&(r[t[0]].stops=r[d].stops,delete r[d],t.splice(t.indexOf(d),1));const m=t.map((e=>(r[e].routeName=e===d?null:e,r[e])));return x.fromJSON({routeResults:m,pointBarriers:l,polygonBarriers:c,polylineBarriers:u,messages:h})}function I(e,t){for(let r=0;r<t.length;r++){const i=e[t[r]];if(i&&i.length)for(const e of i)if(Object(n.P)(e)&&e.hasZ)return!0}return!1}async function S(e){if(!e)throw new n.s("network-service:missing-url","Url to Network service is missing");const{data:t}=await Object(n.C)(e,{query:{f:"json"}});t.supportedTravelModes||(t.supportedTravelModes=[]);for(let e=0;e<t.supportedTravelModes.length;e++)t.supportedTravelModes[e].id||(t.supportedTravelModes[e].id=t.supportedTravelModes[e].itemId);const r=t.currentVersion>=10.4?async function(e){try{const{data:{supportedTravelModes:t,defaultTravelMode:r}}=await Object(n.C)(e+("/"===e[e.length-1]?"":"/")+"retrieveTravelModes",{query:{f:"json"}});return{supportedTravelModes:t,defaultTravelMode:r}}catch(e){throw new n.s("network-service:retrieveTravelModes","Could not get to the NAServer's retrieveTravelModes.",{error:e})}}(e):async function(e){const{data:t}=await Object(n.C)(e.substring(0,e.indexOf("/rest/")+6)+"info",{query:{f:"json"}});if(!t||!t.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};e=t.owningSystemUrl;const{data:r}=await Object(n.C)(e+("/"===e[e.length-1]?"":"/")+"sharing/rest/portals/self",{query:{f:"json"}}),a=Object(i.m)("helperServices.routingUtilities.url",r);if(!a)return{supportedTravelModes:[],defaultTravelMode:null};const o=Object(s.d)(e),l=/\/solve$/.test(o.path)?"Route":/\/solveClosestFacility$/.test(o.path)?"ClosestFacility":"ServiceAreas",c=await Object(n.C)(a+("/"===a[a.length-1]?"":"/")+"GetTravelModes/execute",{query:{f:"json",serviceName:l}}),u=[];let h=null;if(c&&c.data&&c.data.results&&c.data.results.length){const e=c.data.results;for(const t of e)if("supportedTravelModes"===t.paramName){if(t.value&&t.value.features)for(const{attributes:e}of t.value.features)if(e){const t=JSON.parse(e.TravelMode);u.push(t)}}else"defaultTravelMode"===t.paramName&&(h=t.value)}return{supportedTravelModes:u,defaultTravelMode:h}}(e),{defaultTravelMode:a,supportedTravelModes:o}=await r;return t.defaultTravelMode=a,t.supportedTravelModes=o,t}const T=e=>{let t=class extends e{async getServiceDescription(e){return this._serviceDescriptionPromise||(this._serviceDescriptionPromise=this._fetchServiceDescription(e)),this._serviceDescriptionPromise}async _fetchServiceDescription(e){if(!this.url||!this.parsedUrl)throw new n.s("network-service:missing-url","Url to Network service is missing");const t=this.url,{data:r}=await Object(n.C)(t,{query:{f:"json",token:e}});r.supportedTravelModes||(r.supportedTravelModes=[]);for(let e=0;e<r.supportedTravelModes.length;e++)r.supportedTravelModes[e].id||(r.supportedTravelModes[e].id=r.supportedTravelModes[e].itemId);const s=r.currentVersion>=10.4?async function(e,t){try{const{data:{supportedTravelModes:r,defaultTravelMode:i}}=await Object(n.C)(e+("/"===e[e.length-1]?"":"/")+"retrieveTravelModes",{query:{f:"json",token:t}});return{supportedTravelModes:r,defaultTravelMode:i}}catch(e){throw new n.s("network-service:retrieveTravelModes","Could not get to the NAServer's retrieveTravelModes.",{error:e})}}(t,e):async function(e,t){const{data:r}=await Object(n.C)(e.substring(0,e.indexOf("/rest/")+6)+"info",{query:{f:"json",token:t}});if(!r||!r.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};e=r.owningSystemUrl;const{data:s}=await Object(n.C)(e+("/"===e[e.length-1]?"":"/")+"sharing/rest/portals/self",{query:{f:"json",token:t}}),a=Object(i.m)("helperServices.routingUtilities.url",s);if(!a)return{supportedTravelModes:[],defaultTravelMode:null};const o=Object(n.U)(e),l=/\/solveClosestFacility$/.test(o.path)?"Route":/\/solveClosestFacility$/.test(o.path)?"ClosestFacility":"ServiceAreas",c=await Object(n.C)(a+("/"===a[a.length-1]?"":"/")+"GetTravelModes/execute",{query:{f:"json",serviceName:l,token:t}}),u=[];let h=null;if(c&&c.data&&c.data.results&&c.data.results.length){const e=c.data.results;for(const t of e)if("supportedTravelModes"===t.paramName){if(t.value&&t.value.features)for(const{attributes:e}of t.value.features)if(e){const t=JSON.parse(e.TravelMode);u.push(t)}}else"defaultTravelMode"===t.paramName&&(h=t.value)}return{supportedTravelModes:u,defaultTravelMode:h}}(t,e),{defaultTravelMode:a,supportedTravelModes:o}=await s;return r.defaultTravelMode=a,r.supportedTravelModes=o,r}_isInputGeometryZAware(e,t){for(let r=0;r<t.length;r++){const i=e[t[r]];if(i&&i.length)for(const e of i)if(Object(n.P)(e)&&e.hasZ)return!0}return!1}_dropZValuesOffInputGeometry(e,t){for(let r=0;r<t.length;r++){const i=e[t[r]];if(i&&i.length)for(const e of i)e.z=void 0}console.log("The remote Network Analysis service is powered by a network dataset which is not Z-aware.\nZ-coordinates of the input geometry are ignored.")}};return t=Object(n.e)([Object(n.i)("esri.tasks.mixins.NAServiceDescription")],t),t};let j=class extends(T(s.c)){};j=Object(n.e)([Object(n.i)("esri.tasks.mixins.NAServiceDescription")],j)},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=(r(1),r(361)),s=r(351);const a=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new s.a({layer:this}):null}};return Object(i.e)([Object(i.y)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(i.e)([Object(i.y)()],t.prototype,"minScale",void 0),Object(i.e)([Object(i.a1)("service","minScale")],t.prototype,"readMinScale",null),Object(i.e)([Object(i.y)()],t.prototype,"maxScale",void 0),Object(i.e)([Object(i.a1)("service","maxScale")],t.prototype,"readMaxScale",null),Object(i.e)([Object(i.y)({type:i.A})],t.prototype,"spatialReference",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],t.prototype,"supportsBlankTile",null),Object(i.e)([Object(i.y)(n.b)],t.prototype,"tileInfo",void 0),Object(i.e)([Object(i.y)()],t.prototype,"tilemapCache",void 0),Object(i.e)([Object(i.a1)("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),Object(i.e)([Object(i.y)()],t.prototype,"version",void 0),t=Object(i.e)([Object(i.i)("esri.layers.mixins.ArcGISCachedService")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return o}));r(87);var i=r(0),n=r(322),s=r(314);const a=0,o=1,l=2;class c{constructor(e,t){this.width=e,this.height=t;const r=Math.ceil(e/1),i=Math.ceil(t/1);this._cols=r,this._rows=i,this._cells=n.b.create(r*i)}insertMetrics(e){const t=this._hasCollision(e);return t===a&&this._markMetrics(e),t}getCellId(e,t){return e+t*this._cols}has(e){return this._cells.has(e)}hasRange(e,t){return this._cells.hasRange(e,t)}set(e){this._cells.set(e)}setRange(e,t){this._cells.setRange(e,t)}_hasCollision(e){const t=e.id;let r=0,i=0;e.save();do{const t=e.boundsCount;r+=t;for(let r=0;r<t;r++){const t=e.boundsComputedAnchorX(r),n=e.boundsComputedAnchorY(r),s=e.boundsWidth(r)+2,a=e.boundsHeight(r)+2;switch(this._collide(t,n,s,a)){case l:return l;case o:i++}}}while(e.peekId()===t&&e.next());return e.restore(),r===i?o:a}_collide(e,t,r,n){const s=e-r/2,c=e+r/2,u=t-n/2,h=t+n/2;if(c<0||h<0||s>this.width||u>this.height)return o;const d=Object(i.D)(Math.floor(s/1),0,this._cols),f=Object(i.D)(Math.floor(u/1),0,this._rows),p=Object(i.D)(Math.ceil(c/1),0,this._cols),y=Object(i.D)(Math.ceil(h/1),0,this._rows);for(let e=f;e<=y;e++)for(let t=d;t<=p;t++){const r=this.getCellId(t,e);if(this.has(r))return l}return a}_mark(e,t,r,n){const s=e-r/2,a=e+r/2,o=t-n/2,l=t+n/2,c=Object(i.D)(Math.floor(s/1),0,this._cols),u=Object(i.D)(Math.floor(o/1),0,this._rows),h=Object(i.D)(Math.ceil(a/1),0,this._cols),d=Object(i.D)(Math.ceil(l/1),0,this._rows);for(let e=u;e<=d;e++)for(let t=c;t<=h;t++){const r=this.getCellId(t,e);this.set(r)}return!1}_markMetrics(e){const t=e.id;do{const t=e.boundsCount;for(let r=0;r<t;r++){const t=e.boundsComputedAnchorX(r),i=e.boundsComputedAnchorY(r),n=e.boundsWidth(r)+2,s=e.boundsHeight(r)+2;this._mark(t,i,n,s)}}while(e.peekId()===t&&e.next())}}class u{constructor(e,t=2){this._bucketSize=e,this._rowsLength=s.B/e,this._colsLength=s.B/e,this._elementsPerBucket=t,this._grid=this._initGrid()}checkOverlap(e,t){const r=Math.floor(e/this._bucketSize),i=Math.floor(t/this._bucketSize);return r<0||r>=this._rowsLength||i<0||i>=this._colsLength||this._grid[i*this._colsLength+r]>=this._elementsPerBucket}markUsed(e,t){const r=Math.floor(e/this._bucketSize),i=Math.floor(t/this._bucketSize);this._grid[i*this._colsLength+r]+=1}reset(){this._grid=this._initGrid()}_initGrid(){return new Uint8Array(this._rowsLength*this._colsLength)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return z})),r.d(t,"b",(function(){return Be})),r.d(t,"c",(function(){return k})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return Ne})),r.d(t,"f",(function(){return Pe})),r.d(t,"g",(function(){return P})),r.d(t,"h",(function(){return V})),r.d(t,"i",(function(){return U})),r.d(t,"j",(function(){return C})),r.d(t,"k",(function(){return L})),r.d(t,"l",(function(){return D}));r(163);var i=r(323),n=r(0),s=r(350),a=r(67),o=r(314);class l{constructor(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24}static i8816to32(e,t,r){return 255&e|(255&t)<<8|r<<16}}class c{constructor(e){this._color=Object(i.a)(),this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._locations||this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,r,i){const n=this.getUniforms();for(const s in n){const a=n[s];switch(a.type){case"float":e.setUniform1f(a.name,a.getValue(r,t,i));break;case"vec2":e.setUniform2fv(a.name,a.getValue(r,t,i));break;case"vec4":{const n=a.getValue(r,t,i),s=n[3];this._color[0]=s*n[0],this._color[1]=s*n[1],this._color[2]=s*n[2],this._color[3]=s,e.setUniform4fv(a.name,this._color)}}}}encodeAttributes(e,t,r){const i=this.attributesInfo(),n=this.getEncodingInfos(),s=[];for(const o of Object.keys(n)){var a;const l=n[o],{type:c,precisionFactor:u,isLayout:h}=i[o],d=h?r.getLayoutProperty(o):r.getPaintProperty(o),f=null==(a=d.interpolator)?void 0:a.getInterpolationRange(t);let p=0;for(const r of l){r.dataIndex>=s.length&&s.push(0);const i=d.getValue(f?f[p]:t,e);switch(c){case 0:s[r.dataIndex]|=this._encodeByte(i*(u||1),8*r.offset);break;case 1:s[r.dataIndex]|=this._encodeByte(i*(u||1)+128,8*r.offset);break;case 2:s[r.dataIndex]=this._encodeColor(i);break;default:throw new Error("Unsupported encoding type")}++p}}return s}getAtributeState(e){let t=0;const r=3+2*e;return t|=this._bit(r),t|=this._bit(r+1)<<1,t}_buildAttributesInfo(){const e=[],t={},r={};let i=-1;const n=this.attributesInfo(),s=this.attributes();let a=-1;for(const o of s){++a;const s=this.getAtributeState(a);if(0===s)continue;const l=n[o],u=[];t[o]=u;const h=l.type;for(let t=0;t<s;++t){const{dataType:t,bytesPerElement:n,count:s,normalized:a}=c._encodingInfo[h],o=t<<2|s;let l=r[o];l&&4!==l.offset||(++i,r[o]=l={dataIndex:i,offset:0},e.push({location:-1,name:"a_data_"+i,count:4/n,type:t,normalized:a})),u.push({dataIndex:l.dataIndex,offset:l.offset}),l.offset+=n*s}}this._buildVertexBufferLayout(e);const o={};let l=0;const u=this._layoutInfo.geometry;for(const e of u)o[e.name]=l++;const h=this._layoutInfo.opacity;if(h)for(const e of h)o[e.name]=l++;this._buildShaderInfo(e,t),this._propertyEncodingInfo=t,this._locations=o}_buildVertexBufferLayout(e){const t={},r=this.geometryInfo();let i=r[0].stride;if(0===e.length)t.geometry=r;else{const n=[];let s=i;i+=4*e.length;for(const e of r){const t={...e};t.stride=i,n.push(t)}for(const t of e)n.push({name:t.name,count:t.count,type:t.type,offset:s,stride:i,normalized:t.normalized||!1,divisor:0}),s+=u(t.type)*t.count;t.geometry=n}this.opacityInfo()&&(t.opacity=this.opacityInfo()),this._layoutInfo=t,this._stride=i}_buildShaderInfo(e,t){let r="\n",i="\n";const n=[];for(const t of e)r+=`attribute ${this._getType(t.count)} ${t.name};\n`;const s=this.attributes(),a=this.attributesInfo();let o=-1;for(const e of s){++o;const{name:s,type:l,precisionFactor:u,isLayout:h}=a[e],d=u&&1!==u?" * "+1/u:"",{bytesPerElement:f,count:p}=c._encodingInfo[l],y=e=>{const t=2===l?"":`[${e.offset/f}]`;return`a_data_${e.dataIndex}${t}`};switch(this.getAtributeState(o)){case 0:{const t=this._getType(p),a=`u_${s}`;n.push({name:a,type:t,getValue:(t,r)=>h?t.getLayoutValue(e,r):t.getPaintValue(e,r)}),r+=`uniform ${t} ${a};\n`,i+=`${t} ${s} = ${a};\n`}break;case 1:{const r=y(t[e][0]);i+=`${this._getType(p)} ${s} = ${r}${d};\n`}break;case 2:{const a=`u_t_${s}`;n.push({name:a,type:"float",getValue:(t,r,i)=>(h?t.getLayoutProperty(e):t.getPaintProperty(e)).interpolator.interpolationUniformValue(i,r)}),r+=`uniform float ${a};\n`;const o=y(t[e][0]),l=y(t[e][1]);i+=`${this._getType(p)} ${s} = mix(${o}${d}, ${l}${d}, ${a});\n`}}}this._shaderHeader=r,this._shaderMain=i,this._uniforms=n}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const t=255*e[3];return l.i8888to32(e[0]*t,e[1]*t,e[2]*t,t)}_encodeByte(e,t){return(255&e)<<t}}c._encodingInfo=[{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:4,normalized:!0}];const u=e=>{switch(e){case 5126:case 5124:case 5125:return 4;case 5122:case 5123:return 2;case 5120:case 5121:return 1}};class h extends c{constructor(e){super(e)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES=[],h.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}],h.ATTRIBUTES_INFO={};class d extends c{constructor(e){super(e)}geometryInfo(){return d.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return d.ATTRIBUTES}attributesInfo(){return d.ATTRIBUTES_INFO}}d.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],d.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],d.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:0},"circle-color":{name:"color",type:2},"circle-opacity":{name:"opacity",type:0,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:0,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:2},"circle-stroke-opacity":{name:"stroke_opacity",type:0,precisionFactor:100},"circle-blur":{name:"blur",type:0,precisionFactor:32}};class f extends c{constructor(e){super(e)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES=["fill-color","fill-opacity"],f.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],f.ATTRIBUTES_INFO={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};class p extends c{constructor(e,t){super(e),this.usefillColor=t}geometryInfo(){return p.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this.usefillColor?p.ATTRIBUTES_FILL:p.ATTRIBUTES_OUTLINE}attributesInfo(){return this.usefillColor?p.ATTRIBUTES_INFO_FILL:p.ATTRIBUTES_INFO_OUTLINE}}p.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],p.ATTRIBUTES_FILL=["fill-color","fill-opacity"],p.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}],p.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}},p.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};class y extends c{constructor(e){super(e)}geometryInfo(){return y.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return y.ATTRIBUTES}attributesInfo(){return y.ATTRIBUTES_INFO}}y.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width"],y.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}],y.ATTRIBUTES_INFO={"line-width":{name:"width",type:0,precisionFactor:2},"line-gap-width":{name:"gap_width",type:0,precisionFactor:2},"line-offset":{name:"offset",type:1,precisionFactor:2},"line-color":{name:"color",type:2},"line-opacity":{name:"opacity",type:0,precisionFactor:100},"line-blur":{name:"blur",type:0,precisionFactor:4}};const g=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],m=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}];class b extends c{constructor(e){super(e)}geometryInfo(){return g}opacityInfo(){return m}attributes(){return b.ATTRIBUTES}attributesInfo(){return b.ATTRIBUTES_INFO}}b.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],b.ATTRIBUTES_INFO={"icon-color":{name:"color",type:2},"icon-opacity":{name:"opacity",type:0,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:2},"icon-halo-width":{name:"halo_width",type:0,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"icon-size":{name:"size",type:0,precisionFactor:32,isLayout:!0}};class _ extends c{constructor(e){super(e)}geometryInfo(){return g}opacityInfo(){return m}attributes(){return _.ATTRIBUTES}attributesInfo(){return _.ATTRIBUTES_INFO}}_.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],_.ATTRIBUTES_INFO={"text-color":{name:"color",type:2},"text-opacity":{name:"opacity",type:0,precisionFactor:100},"text-halo-color":{name:"halo_color",type:2},"text-halo-width":{name:"halo_width",type:0,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"text-size":{name:"size",type:0,isLayout:!0}};const x={kind:"null"},v={kind:"number"},w={kind:"string"},O={kind:"boolean"},I={kind:"color"},S={kind:"object"},T={kind:"value"};function j(e,t){return{kind:"array",itemType:e,n:t}}const E=[x,v,w,O,I,S,j(T)];function A(e){if("array"===e.kind){const t=A(e.itemType);return"number"==typeof e.n?`array<${t}, ${e.n}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}function M(e){if(null===e)return x;if("string"==typeof e)return w;if("boolean"==typeof e)return O;if("number"==typeof e)return v;if(e instanceof n.j)return I;if(Array.isArray(e)){let t;for(const r of e){const e=M(r);if(t){if(t!==e){t=T;break}}else t=e}return j(t||T,e.length)}return"object"==typeof e?S:T}function R(e,t){if("array"===t.kind)return"array"===e.kind&&(0===e.n&&"value"===e.itemType.kind||R(e.itemType,t.itemType))&&("number"!=typeof t.n||t.n===e.n);if("value"===t.kind)for(const t of E)if(R(e,t))return!0;return t.kind===e.kind}function F(e){if(null===e)return"";const t=typeof e;return"string"===t?e:"number"===t||"boolean"===t?String(e):e instanceof n.j?e.toString():JSON.stringify(e)}const C=Number.POSITIVE_INFINITY,D=Math.PI,L=2*D,N=128/D,P=D/180,B=1/Math.LN2;function k(e,t){return(e%=t)>=0?e:e+t}function U(e){return k(e*N,256)}function z(e){return Math.log(e)*B}function V(e,t,r){return e*(1-r)+t*r}class G{constructor(e){this.parent=e,this.vars={}}add(e,t){this.vars[e]=t}get(e){return this.vars[e]?this.vars[e]:this.parent?this.parent.get(e):null}}class q{constructor(){this.type=T}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new q}evaluate(e,t){return e.id||null}}class H{constructor(){this.type=w}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new H}evaluate(e,t){switch(e.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}}}class W{constructor(){this.type=S}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new W}evaluate(e,t){return e.values}}class Z{constructor(){this.type=v}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new Z}evaluate(e,t){return t}}class X{constructor(e,t,r){this.lhs=e,this.rhs=t,this.compare=r,this.type=O}static parse(e,t,r){if(3!==e.length&&4!==e.length)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(4===e.length)throw new Error(`"${e[0]}" collator not supported`);return new X(Se(e[1],t),Se(e[2],t),r)}evaluate(e,t){return this.compare(this.lhs.evaluate(e,t),this.rhs.evaluate(e,t))}}class J{constructor(e){this.arg=e,this.type=O}static parse(e,t){if(2!==e.length)throw new Error('"!" expects 1 argument');return new J(Se(e[1],t))}evaluate(e,t){return!this.arg.evaluate(e,t)}}class Y{constructor(e){this.args=e,this.type=O}static parse(e,t){const r=[];for(let i=1;i<e.length;i++)r.push(Se(e[i],t));return new Y(r)}evaluate(e,t){for(const r of this.args)if(!r.evaluate(e,t))return!1;return!0}}class Q{constructor(e){this.args=e,this.type=O}static parse(e,t){const r=[];for(let i=1;i<e.length;i++)r.push(Se(e[i],t));return new Q(r)}evaluate(e,t){for(const r of this.args)if(r.evaluate(e,t))return!0;return!1}}class K{constructor(e){this.args=e,this.type=O}static parse(e,t){const r=[];for(let i=1;i<e.length;i++)r.push(Se(e[i],t));return new K(r)}evaluate(e,t){for(const r of this.args)if(r.evaluate(e,t))return!1;return!0}}class ${constructor(e,t,r){this.type=e,this.args=t,this.fallback=r}static parse(e,t,r){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let i;const n=[];for(let s=1;s<e.length-1;s+=2){const a=Se(e[s],t),o=Se(e[s+1],t,r);i||(i=o.type),n.push({condition:a,output:o})}const s=Se(e[e.length-1],t,r);return i||(i=s.type),new $(i,n,s)}evaluate(e,t){for(const r of this.args)if(r.condition.evaluate(e,t))return r.output.evaluate(e,t);return this.fallback.evaluate(e,t)}}class ee{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let r;const i=[];for(let n=1;n<e.length;n++){const s=Se(e[n],t);r||(r=s.type),i.push(s)}return new ee(r,i)}evaluate(e,t){for(const r of this.args){const i=r.evaluate(e,t);if(null!==i)return i}return null}}class te{constructor(e,t,r,i,n){this.type=e,this.input=t,this.labels=r,this.outputs=i,this.fallback=n}static parse(e,t){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let r;const i=Se(e[1],t),n=[],s={};let a;for(let i=2;i<e.length-1;i+=2){let o=e[i];Array.isArray(o)||(o=[o]);for(const e of o){const t=typeof e;if("string"!==t&&"number"!==t)throw new Error('"match" requires string or number literal as labels');if(a){if(t!==a)throw new Error('"match" requires labels to have the same type')}else a=t;s[e]=n.length}const l=Se(e[i+1],t);r||(r=l.type),n.push(l)}return new te(r,i,s,n,Se(e[e.length-1],t))}evaluate(e,t){const r=this.input.evaluate(e,t);return(this.outputs[this.labels[r]]||this.fallback).evaluate(e,t)}}class re{constructor(e,t,r,i,n){this.operator=e,this.type=t,this.interpolation=r,this.input=i,this.stops=n}static parse(e,t,r){const i=e[0];if(e.length<5)throw new Error(`"${i}" expects at least 4 arguments`);const n=e[1];if(!Array.isArray(n)||0===n.length)throw new Error(`"${n}" is not a valid interpolation`);switch(n[0]){case"linear":if(1!==n.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==n.length||"number"!=typeof n[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==n.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let e=1;e<5;e++){const t=n[e];if("number"!=typeof t||t<0||t>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${n[0]}"`)}if(e.length%2!=1)throw new Error(`"${i}" expects an even number of arguments`);const s=Se(e[2],t,v);let a;"interpolate-hcl"===i||"interpolate-lab"===i?a=I:r&&"value"!==r.kind&&(a=r);const o=[];for(let r=3;r<e.length;r+=2){const n=e[r];if("number"!=typeof n)throw new Error(`"${i}" requires stop inputs as literal numbers`);if(o.length&&o[o.length-1][0]>=n)throw new Error(`"${i}" requires strictly ascending stop inputs`);const s=Se(e[r+1],t,a);a||(a=s.type),o.push([n,s])}if(a&&a!==I&&a!==v&&("array"!==a.kind||a.itemType!==v))throw new Error(`"${i}" cannot interpolate type ${A(a)}`);return new re(i,a,n,s,o)}evaluate(e,t){const r=this.stops;if(1===r.length)return r[0][1].evaluate(e,t);const i=this.input.evaluate(e,t);if(i<=r[0][0])return r[0][1].evaluate(e,t);if(i>=r[r.length-1][0])return r[r.length-1][1].evaluate(e,t);let a=0;for(;++a<r.length&&!(i<r[a][0]););const o=r[a-1][0],l=r[a][0],c=re.interpolationRatio(this.interpolation,i,o,l),u=r[a-1][1].evaluate(e,t),h=r[a][1].evaluate(e,t);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(u)&&Array.isArray(h))return u.map(((e,t)=>V(e,h[t],c)));if("color"===this.type.kind&&u instanceof n.j&&h instanceof n.j){const e=new n.j(u),t=new n.j(h);return new n.j([V(e.r,t.r,c),V(e.g,t.g,c),V(e.b,t.b,c),V(e.a,t.a,c)])}if("number"===this.type.kind&&"number"==typeof u&&"number"==typeof h)return V(u,h,c);throw new Error(`"${this.operator}" cannot interpolate type ${A(this.type)}`)}if("interpolate-hcl"===this.operator){const e=Object(s.b)(u),t=Object(s.b)(h),r=t.h-e.h,i=Object(s.a)({h:e.h+c*(r>180||r<-180?r-360*Math.round(r/360):r),c:V(e.c,t.c,c),l:V(e.l,t.l,c)});return new n.j({a:V(u.a,h.a,c),...i})}if("interpolate-lab"===this.operator){const e=Object(s.d)(u),t=Object(s.d)(h),r=Object(s.a)({l:V(e.l,t.l,c),a:V(e.a,t.a,c),b:V(e.b,t.b,c)});return new n.j({a:V(u.a,h.a,c),...r})}throw new Error(`Unexpected operator "${this.operator}"`)}interpolationUniformValue(e,t){const r=this.stops;if(1===r.length)return 0;if(e>=r[r.length-1][0])return 0;let i=0;for(;++i<r.length&&!(e<r[i][0]););const n=r[i-1][0],s=r[i][0];return re.interpolationRatio(this.interpolation,t,n,s)}getInterpolationRange(e){const t=this.stops;if(1===t.length){const e=t[0][0];return[e,e]}const r=t[t.length-1][0];if(e>=r)return[r,r];let i=0;for(;++i<t.length&&!(e<t[i][0]););return[t[i-1][0],t[i][0]]}static interpolationRatio(e,t,r,i){let n=0;return"linear"===e[0]?n=re.exponentialInterpolationRatio(t,1,r,i):"exponential"===e[0]?n=re.exponentialInterpolationRatio(t,e[1],r,i):"cubic-bezier"===e[0]&&(n=Object(a.a)(e[1],e[2],e[3],e[4])(re.exponentialInterpolationRatio(t,1,r,i),1e-5)),n<0?n=0:n>1&&(n=1),n}static exponentialInterpolationRatio(e,t,r,i){const n=i-r;if(0===n)return 0;const s=e-r;return 1===t?s/n:(t**s-1)/(t**n-1)}}class ie{constructor(e,t,r){this.type=e,this.input=t,this.stops=r}static parse(e,t){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const r=Se(e[1],t,v);let i;const n=[];n.push([-1/0,Se(e[2],t)]);for(let r=3;r<e.length;r+=2){const s=e[r];if("number"!=typeof s)throw new Error('"step" requires stop inputs as literal numbers');if(n.length&&n[n.length-1][0]>=s)throw new Error('"step" requires strictly ascending stop inputs');const a=Se(e[r+1],t);i||(i=a.type),n.push([s,a])}return new ie(i,r,n)}evaluate(e,t){const r=this.stops;if(1===r.length)return r[0][1].evaluate(e,t);const i=this.input.evaluate(e,t);let n=0;for(;++n<r.length&&!(i<r[n][0]););return this.stops[n-1][1].evaluate(e,t)}}class ne{constructor(e,t){this.type=e,this.output=t}static parse(e,t,r){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const i=new G(t);for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)throw new Error(`"let" requires a string to define variable names - found ${n}`);i.add(n,Se(e[r+1],t))}const n=Se(e[e.length-1],i,r);return new ne(n.type,n)}evaluate(e,t){return this.output.evaluate(e,t)}}class se{constructor(e,t){this.type=e,this.output=t}static parse(e,t,r){if(2!==e.length||"string"!=typeof e[1])throw new Error('"var" requires just one literal string argument');const i=t.get(e[1]);if(!i)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new se(r||T,i)}evaluate(e,t){return this.output.evaluate(e,t)}}class ae{constructor(e,t,r){this.type=e,this.index=t,this.array=r}static parse(e,t){if(3!==e.length)throw new Error('"at" expects 2 arguments');const r=Se(e[1],t,v),i=Se(e[2],t);return new ae(i.type.itemType,r,i)}evaluate(e,t){const r=this.index.evaluate(e,t),i=this.array.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"at" index out of bounds');if(r!==Math.floor(r))throw new Error('"at" index must be an integer');return i[r]}}class oe{constructor(e,t){this.key=e,this.obj=t,this.type=T}static parse(e,t){let r,i;switch(e.length){case 2:return r=Se(e[1],t),new oe(r);case 3:return r=Se(e[1],t),i=Se(e[2],t),new oe(r,i);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,t){const r=this.key.evaluate(e,t);return this.obj?this.obj.evaluate(e,t)[r]:e.values[r]}}class le{constructor(e,t){this.key=e,this.obj=t,this.type=O}static parse(e,t){let r,i;switch(e.length){case 2:return r=Se(e[1],t),new le(r);case 3:return r=Se(e[1],t),i=Se(e[2],t),new le(r,i);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,t){const r=this.key.evaluate(e,t);return this.obj?r in this.obj.evaluate(e,t):void 0!==e.values[r]}}class ce{constructor(e,t){this.key=e,this.vals=t,this.type=O}static parse(e,t){if(3!==e.length)throw new Error('"in" expects 2 arguments');return new ce(Se(e[1],t),Se(e[2],t))}evaluate(e,t){const r=this.key.evaluate(e,t);return-1!==this.vals.evaluate(e,t).indexOf(r)}}class ue{constructor(e,t,r){this.item=e,this.array=t,this.from=r,this.type=v}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const r=Se(e[1],t),i=Se(e[2],t);if(4===e.length){const n=Se(e[3],t,v);return new ue(r,i,n)}return new ue(r,i)}evaluate(e,t){const r=this.item.evaluate(e,t),i=this.array.evaluate(e,t);if(this.from){const n=this.from.evaluate(e,t);if(n!==Math.floor(n))throw new Error('"index-of" index must be an integer');return i.indexOf(r,n)}return i.indexOf(r)}}class he{constructor(e){this.arg=e,this.type=v}static parse(e,t){if(2!==e.length)throw new Error('"length" expects 2 arguments');const r=Se(e[1],t);return new he(r)}evaluate(e,t){const r=this.arg.evaluate(e,t);if("string"==typeof r)return r.length;if(Array.isArray(r))return r.length;throw new Error('"length" expects string or array')}}class de{constructor(e,t,r,i){this.type=e,this.array=t,this.from=r,this.to=i}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const r=Se(e[1],t),i=Se(e[2],t,v);if(i.type!==v)throw new Error('"slice" index must return a number');if(4===e.length){const n=Se(e[3],t,v);if(n.type!==v)throw new Error('"slice" index must return a number');return new de(r.type,r,i,n)}return new de(r.type,r,i)}evaluate(e,t){const r=this.array.evaluate(e,t);if(!Array.isArray(r)&&"string"!=typeof r)throw new Error('"slice" input must be an array or a string');const i=this.from.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"slice" index out of bounds');if(i!==Math.floor(i))throw new Error('"slice" index must be an integer');if(this.to){const n=this.to.evaluate(e,t);if(n<0||n>=r.length)throw new Error('"slice" index out of bounds');if(n!==Math.floor(n))throw new Error('"slice" index must be an integer');return r.slice(i,n)}return r.slice(i)}}class fe{constructor(){this.type=O}static parse(e){if(1!==e.length)throw new Error('"has-id" expects no arguments');return new fe}evaluate(e,t){return void 0!==e.id}}class pe{constructor(e,t){this.args=e,this.calculate=t,this.type=v}static parse(e,t,r){const i=e.slice(1).map((e=>Se(e,t)));return new pe(i,r)}evaluate(e,t){let r;return this.args&&(r=this.args.map((r=>r.evaluate(e,t)))),this.calculate(r)}}class ye{constructor(e,t){this.args=e,this.calculate=t,this.type=v}static parse(e,t){const r=e.slice(1).map((e=>Se(e,t)));return new ye(r,ye.ops[e[0]])}evaluate(e,t){let r;return this.args&&(r=this.args.map((r=>r.evaluate(e,t)))),this.calculate(r)}}ye.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])};class ge{constructor(e){this.args=e,this.type=w}static parse(e,t){return new ge(e.slice(1).map((e=>Se(e,t))))}evaluate(e,t){return this.args.map((r=>r.evaluate(e,t))).join("")}}class me{constructor(e,t){this.arg=e,this.calculate=t,this.type=w}static parse(e,t){if(2!==e.length)throw new Error(`${e[0]} expects 1 argument`);const r=Se(e[1],t);return new me(r,me.ops[e[0]])}evaluate(e,t){return this.calculate(this.arg.evaluate(e,t))}}me.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()};class be{constructor(e){this.args=e,this.type=I}static parse(e,t){if(4!==e.length)throw new Error('"rgb" expects 3 arguments');const r=e.slice(1).map((e=>Se(e,t)));return new be(r)}evaluate(e,t){const r=this._validate(this.args[0].evaluate(e,t)),i=this._validate(this.args[1].evaluate(e,t)),s=this._validate(this.args[2].evaluate(e,t));return new n.j({r:r,g:i,b:s})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class _e{constructor(e){this.args=e,this.type=I}static parse(e,t){if(5!==e.length)throw new Error('"rgba" expects 4 arguments');const r=e.slice(1).map((e=>Se(e,t)));return new _e(r)}evaluate(e,t){const r=this._validate(this.args[0].evaluate(e,t)),i=this._validate(this.args[1].evaluate(e,t)),s=this._validate(this.args[2].evaluate(e,t)),a=this._validateAlpha(this.args[3].evaluate(e,t));return new n.j({r:r,g:i,b:s,a:a})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if("number"!=typeof e||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class xe{constructor(e){this.color=e,this.type=j(v,4)}static parse(e,t){if(2!==e.length)throw new Error('"to-rgba" expects 1 argument');const r=Se(e[1],t);return new xe(r)}evaluate(e,t){return new n.j(this.color.evaluate(e,t)).toRgba()}}class ve{constructor(e,t){this.type=e,this.args=t}static parse(e,t){const r=e[0];if(e.length<2)throw new Error(`${r} expects at least one argument`);let i,n=1;if("array"===r){if(e.length>2){switch(e[1]){case"string":i=w;break;case"number":i=v;break;case"boolean":i=O;break;default:throw new Error('"array" type argument must be string, number or boolean')}n++}else i=T;let t;if(e.length>3){if(t=e[2],null!==t&&("number"!=typeof t||t<0||t!==Math.floor(t)))throw new Error('"array" length argument must be a positive integer literal');n++}i=j(i,t)}else switch(r){case"string":i=w;break;case"number":i=v;break;case"boolean":i=O;break;case"object":i=S}const s=[];for(;n<e.length;n++){const r=Se(e[n],t);s.push(r)}return new ve(i,s)}evaluate(e,t){let r;for(const i of this.args){const n=i.evaluate(e,t);if(r=M(n),R(r,this.type))return n}throw new Error(`Expected ${A(this.type)} but got ${A(r)}`)}}class we{constructor(e,t){this.type=e,this.args=t}static parse(e,t){const r=e[0],i=we.types[r];if(i===O||i===w){if(2!==e.length)throw new Error(`${r} expects one argument`)}else if(e.length<2)throw new Error(`${r} expects at least one argument`);const n=[];for(let r=1;r<e.length;r++){const i=Se(e[r],t);n.push(i)}return new we(i,n)}evaluate(e,t){if(this.type===O)return Boolean(this.args[0].evaluate(e,t));if(this.type===w)return F(this.args[0].evaluate(e,t));if(this.type===v){for(const r of this.args){const i=Number(r.evaluate(e,t));if(!isNaN(i))return i}return null}if(this.type===I){for(const r of this.args)try{const i=we.toColor(r.evaluate(e,t));if(i instanceof n.j)return i}catch{}return null}}static toBoolean(e){return Boolean(e)}static toString(e){return F(e)}static toNumber(e){const t=Number(e);if(isNaN(t))throw new Error(`"${e}" is not a number`);return t}static toColor(e){if(e instanceof n.j)return e;if("string"==typeof e){const t=n.j.fromString(e);if(t)return t;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return n.j.fromArray(e);throw new Error(`"${e}" is not a color`)}}we.types={"to-boolean":O,"to-color":I,"to-number":v,"to-string":w};class Oe{constructor(e){this.val=e,this.type=M(e)}static parse(e){if(2!==e.length)throw new Error('"literal" expects 1 argument');return new Oe(e[1])}evaluate(e,t){return this.val}}class Ie{constructor(e){this.arg=e,this.type=w}static parse(e,t){if(2!==e.length)throw new Error('"typeof" expects 1 argument');return new Ie(Se(e[1],t))}evaluate(e,t){return A(M(this.arg.evaluate(e,t)))}}function Se(e,t,r){const i=typeof e;if("string"===i||"boolean"===i||"number"===i||null===e){if(r)switch(r.kind){case"string":"string"!==i&&(e=we.toString(e));break;case"number":"number"!==i&&(e=we.toNumber(e));break;case"color":e=we.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");const n=e[0];if("string"!=typeof n)throw new Error("First element of expression must be a string");const s=Te[n];if(void 0===s)throw new Error(`Invalid expression operator "${n}"`);if(!s)throw new Error(`Unimplemented expression operator "${n}"`);return s.parse(e,t,r)}const Te={array:ve,boolean:ve,collator:null,format:null,image:null,literal:Oe,number:ve,"number-format":null,object:ve,string:ve,"to-boolean":we,"to-color":we,"to-number":we,"to-string":we,typeof:Ie,accumulated:null,"feature-state":null,"geometry-type":H,id:q,"line-progress":null,properties:W,at:ae,get:oe,has:le,in:ce,"index-of":ue,length:he,slice:de,"!":J,"!=":class extends X{static parse(e,t){return X.parse(e,t,((e,t)=>e!==t))}},"<":class extends X{static parse(e,t){return X.parse(e,t,((e,t)=>e<t))}},"<=":class extends X{static parse(e,t){return X.parse(e,t,((e,t)=>e<=t))}},"==":class extends X{static parse(e,t){return X.parse(e,t,((e,t)=>e===t))}},">":class extends X{static parse(e,t){return X.parse(e,t,((e,t)=>e>t))}},">=":class extends X{static parse(e,t){return X.parse(e,t,((e,t)=>e>=t))}},all:Y,any:Q,case:$,coalesce:ee,match:te,within:null,interpolate:re,"interpolate-hcl":re,"interpolate-lab":re,step:ie,let:ne,var:se,concat:ge,downcase:me,"is-supported-script":null,"resolved-locale":null,upcase:me,rgb:be,rgba:_e,"to-rgba":xe,"-":class extends pe{static parse(e,t){switch(e.length){case 2:return pe.parse(e,t,(e=>-e[0]));case 3:return pe.parse(e,t,(e=>e[0]-e[1]));default:throw new Error('"-" expects 1 or 2 arguments')}}},"*":class extends pe{static parse(e,t){return pe.parse(e,t,(e=>{let t=1;for(const r of e)t*=r;return t}))}},"/":class extends pe{static parse(e,t){if(3===e.length)return pe.parse(e,t,(e=>e[0]/e[1]));throw new Error('"/" expects 2 arguments')}},"%":class extends pe{static parse(e,t){if(3===e.length)return pe.parse(e,t,(e=>e[0]%e[1]));throw new Error('"%" expects 2 arguments')}},"^":class extends pe{static parse(e,t){if(3===e.length)return pe.parse(e,t,(e=>e[0]**e[1]));throw new Error('"^" expects 1 or 2 arguments')}},"+":class extends pe{static parse(e,t){return pe.parse(e,t,(e=>{let t=0;for(const r of e)t+=r;return t}))}},abs:ye,acos:ye,asin:ye,atan:ye,ceil:ye,cos:ye,e:ye,floor:ye,ln:ye,ln2:ye,log10:ye,log2:ye,max:ye,min:ye,pi:ye,round:ye,sin:ye,sqrt:ye,tan:ye,zoom:Z,"heatmap-density":null,"has-id":fe,none:K};class je{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(e){return console.log(e.message),!0}}static createFilter(e){if(!e)return null;this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{const t=Se(e,null,O);return new je(t)}catch(e){return console.log(e.message),null}}static isLegacyFilter(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":return!0;case"any":case"all":for(let t=1;t<e.length;t++)if(!this.isLegacyFilter(e[1]))return!1;return!0;case"none":return!0;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);case"!has":return!0;default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;const t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return je.convertComparison("==",e[1],e[2]);case"!=":return je.negate(je.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return je.convertComparison(t,e[1],e[2]);case"in":return je.convertIn(e[1],e.slice(2));case"!in":return je.negate(je.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return je.convertCombining(t,e.slice(1));case"has":return je.convertHas(e[1]);case"!has":return je.negate(je.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,t,r){switch(t){case"$type":return[e,["geometry-type"],r];case"$id":return[e,["id"],r];default:return[e,["get",t],r]}}static convertIn(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}class Ee{}Ee.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},Ee.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},Ee.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Ee.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}},Ee.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},Ee.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Ee.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},Ee.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}},Ee.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},Ee.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Ee.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};class Ae{constructor(e,t){let r;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":r=!0;break;case"array":r="number"===e.value;break;default:r=!1}if(null==t&&(t=e.default),Array.isArray(t)&&t.length>0&&Te[t[0]]){const r={number:v,color:I,string:w,boolean:O,enum:w};try{const i=Se(t,null,"array"===e.type?j(r[e.value]||T,e.length):r[e.type]);this.getValue=this._buildExpression(i,e),this.isDataDriven=!0,i instanceof re&&i.input instanceof Z&&(this.interpolator=i)}catch(t){console.log(t.message),this.getValue=this._buildSimple(e.default)}return}r&&"interval"===t.type&&(r=!1);const i=t&&t.stops&&t.stops.length>0;if(i)for(const r of t.stops)r[1]=this._validate(r[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(void 0!==t.default&&(t.default=this._validate(t.default,e)),i)switch(t.type){case"identity":this.getValue=this._buildIdentity(t,e);break;case"categorical":this.getValue=this._buildCategorical(t,e);break;default:this.getValue=r?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else i?this.getValue=r?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}_validate(e,t){if("number"===t.type){if(e<t.minimum)return t.minimum;if(e>t.maximum)return t.maximum}else"color"===t.type?e=Ae._parseColor(e):"enum"===t.type?"string"==typeof e&&(e=t.values.indexOf(e)):"array"===t.type&&"enum"===t.value?e=e.map((r=>"string"==typeof e?t.values.indexOf(r):r)):"string"===t.type&&(e=F(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,t){return(r,i)=>{try{const n=e.evaluate(i,r);return void 0===n?t.default:this._validate(n,t)}catch(e){return console.log(e.message),t.default}}}_buildIdentity(e,t){return(r,i)=>{let n;return i&&(n=i.values[e.property]),void 0!==n?this._validate(n,t):void 0!==e.default?e.default:t.default}}_buildCategorical(e,t){return(r,i)=>{let n;return i&&(n=i.values[e.property]),n=this._categorical(n,e.stops),void 0!==n?n:void 0!==e.default?e.default:t.default}}_buildInterval(e,t){return(r,i)=>{let n;return i&&(n=i.values[e.property]),"number"==typeof n?this._interval(n,e.stops):void 0!==e.default?e.default:t.default}}_buildInterpolate(e,t){return(r,i)=>{let n;return i&&(n=i.values[e.property]),"number"==typeof n?this._interpolate(n,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){const r=t.length;for(let i=0;i<r;i++)if(t[i][0]===e)return t[i][1]}_interval(e,t){const r=t.length;let i=0;for(let n=0;n<r&&t[n][0]<=e;n++)i=n;return t[i][1]}_interpolate(e,t,r){let i,n;const s=t.length;for(let r=0;r<s;r++){const s=t[r];if(!(s[0]<=e)){n=s;break}i=s}if(i&&n){const t=n[0]-i[0],s=e-i[0],a=1===r?s/t:(r**s-1)/(r**t-1);if(Array.isArray(i[1])){const e=i[1],t=n[1],r=[];for(let i=0;i<e.length;i++)r.push(V(e[i],t[i],a));return r}return V(i[1],n[1],a)}return i?i[1]:n?n[1]:void 0}static _isEmpty(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(e){return Array.isArray(e)?e:("string"==typeof e&&(e=new n.j(e)),e instanceof n.j?this._isEmpty(e)?void 0:n.j.toUnitRGBA(e):e)}}class Me{constructor(e,t,r,i){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=r,this.uid=i,e){case 0:this._layoutDefinition=Ee.backgroundLayoutDefinition,this._paintDefinition=Ee.backgroundPaintDefinition;break;case 1:this._layoutDefinition=Ee.fillLayoutDefinition,this._paintDefinition=Ee.fillPaintDefinition;break;case 2:this._layoutDefinition=Ee.lineLayoutDefinition,this._paintDefinition=Ee.linePaintDefinition;break;case 3:this._layoutDefinition=Ee.symbolLayoutDefinition,this._paintDefinition=Ee.symbolPaintDefinition;break;case 4:this._layoutDefinition=Ee.circleLayoutDefinition,this._paintDefinition=Ee.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=je.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,r){let i;const n=this._layoutProperties[e];return n&&(i=n.getValue(t,r)),void 0===i&&(i=this._layoutDefinition[e].default),i}getPaintValue(e,t,r){let i;const n=this._paintProperties[e];return n&&(i=n.getValue(t,r)),void 0===i&&(i=this._paintDefinition[e].default),i}isPainterDataDriven(){const e=this._paintProperties;if(e)for(const t in e)if(e[t].isDataDriven)return!0;return!1}_parseLayout(e){const t={};for(const r in e){const i=this._layoutDefinition[r];i&&(t[r]=new Ae(i,e[r]))}return t}_parsePaint(e){const t={};for(const r in e){const i=this._paintDefinition[r];i&&(t[r]=new Ae(i,e[r]))}return t}computeAttributesKey(e,t){let r=0,i=0;for(const e of t){const t="icon-size"===e||"text-size"===e?this.getLayoutProperty(e):this.getPaintProperty(e);i|=(null!=t&&t.interpolator?2:null!=t&&t.isDataDriven?1:0)<<r,r+=2}return i<<3|e}}class Re extends Me{constructor(e,t,r,i){super(e,t,r,i),this.backgroundMaterial=new h(this.computeAttributesKey(0,h.ATTRIBUTES))}}class Fe extends Me{constructor(e,t,r,i){super(e,t,r,i);const n=this.getPaintProperty("fill-color"),s=this.getPaintProperty("fill-opacity"),a=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=null==n?void 0:n.isDataDriven,this.hasDataDrivenOpacity=null==s?void 0:s.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||(null==a?void 0:a.isDataDriven);const o=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!o,this.hasDataDrivenOutlineColor=null==o?void 0:o.isDataDriven,this.hasDataDrivenOutline=o?o.isDataDriven:!!n&&n.isDataDriven,this.hasDataDrivenOutline=(o?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new f(this.computeAttributesKey(1,f.ATTRIBUTES)),this.outlineMaterial=new p(this.computeAttributesKey(2,this.outlineUsesFillColor?p.ATTRIBUTES_FILL:p.ATTRIBUTES_OUTLINE),this.outlineUsesFillColor)}}class Ce extends Me{constructor(e,t,r,i){var n,s,a,l,c,u,h;super(e,t,r,i),this.lineMaterial=new y(this.computeAttributesKey(3,y.ATTRIBUTES)),this.hasDataDrivenLine=(null==(n=this.getPaintProperty("line-blur"))?void 0:n.isDataDriven)||(null==(s=this.getPaintProperty("line-color"))?void 0:s.isDataDriven)||(null==(a=this.getPaintProperty("line-gap-width"))?void 0:a.isDataDriven)||(null==(l=this.getPaintProperty("line-offset"))?void 0:l.isDataDriven)||(null==(c=this.getPaintProperty("line-opacity"))?void 0:c.isDataDriven)||(null==(u=this.getPaintProperty("line-pattern"))?void 0:u.isDataDriven)||(null==(h=this.getPaintProperty("line-width"))?void 0:h.isDataDriven);let d=t.paint["line-width"];d||(d=Ee.linePaintDefinition["line-width"].default);const f=this.getPaintProperty("line-width");this.isThinLine=!(null!=f&&f.isDataDriven)&&"number"==typeof d&&d<o.p}}class De extends Me{constructor(e,t,r,i){var n,s,a,o,l,c,u,h,d,f,p,y;super(e,t,r,i),this.iconMaterial=new b(this.computeAttributesKey(4,b.ATTRIBUTES)),this.textMaterial=new _(this.computeAttributesKey(6,_.ATTRIBUTES)),this.hasDataDrivenIcon=(null==(n=this.getPaintProperty("icon-color"))?void 0:n.isDataDriven)||(null==(s=this.getPaintProperty("icon-halo-blur"))?void 0:s.isDataDriven)||(null==(a=this.getPaintProperty("icon-halo-color"))?void 0:a.isDataDriven)||(null==(o=this.getPaintProperty("icon-halo-width"))?void 0:o.isDataDriven)||(null==(l=this.getPaintProperty("icon-opacity"))?void 0:l.isDataDriven)||(null==(c=this.getLayoutProperty("icon-size"))?void 0:c.isDataDriven),this.hasDataDrivenText=(null==(u=this.getPaintProperty("text-color"))?void 0:u.isDataDriven)||(null==(h=this.getPaintProperty("text-halo-blur"))?void 0:h.isDataDriven)||(null==(d=this.getPaintProperty("text-halo-color"))?void 0:d.isDataDriven)||(null==(f=this.getPaintProperty("text-halo-width"))?void 0:f.isDataDriven)||(null==(p=this.getPaintProperty("text-opacity"))?void 0:p.isDataDriven)||(null==(y=this.getLayoutProperty("text-size"))?void 0:y.isDataDriven)}}class Le extends Me{constructor(e,t,r,i){super(e,t,r,i),this.circleMaterial=new d(this.computeAttributesKey(5,d.ATTRIBUTES))}}class Ne{constructor(e,t,r){var i,n,s,a,o;let l;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t),this.keepUpright=e.getLayoutValue("icon-keep-upright",t),this.optional=e.getLayoutValue("icon-optional",t),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),l=e.getLayoutProperty("icon-anchor"),null!=(i=l)&&i.isDataDriven?this._anchorProp=l:this.anchor=e.getLayoutValue("icon-anchor",t),l=e.getLayoutProperty("icon-offset"),null!=(n=l)&&n.isDataDriven?this._offsetProp=l:this.offset=e.getLayoutValue("icon-offset",t),l=e.getLayoutProperty("icon-padding"),null!=(s=l)&&s.isDataDriven?this._paddingProp=l:this.padding=e.getLayoutValue("icon-padding",t),l=e.getLayoutProperty("icon-rotate"),null!=(a=l)&&a.isDataDriven?this._rotateProp=l:this.rotate=e.getLayoutValue("icon-rotate",t),l=e.getLayoutProperty("icon-size"),null!=(o=l)&&o.isDataDriven?this._sizeProp=l:this.size=e.getLayoutValue("icon-size",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}}class Pe{constructor(e,t,r){var i,n,s,a,o,l,c,u,h,d,f;let p;this.allowOverlap=e.getLayoutValue("text-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t),this.keepUpright=e.getLayoutValue("text-keep-upright",t),this.optional=e.getLayoutValue("text-optional",t),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),p=e.getLayoutProperty("text-anchor"),null!=(i=p)&&i.isDataDriven?this._anchorProp=p:this.anchor=e.getLayoutValue("text-anchor",t),p=e.getLayoutProperty("text-justify"),null!=(n=p)&&n.isDataDriven?this._justifyProp=p:this.justify=e.getLayoutValue("text-justify",t),p=e.getLayoutProperty("text-letter-spacing"),null!=(s=p)&&s.isDataDriven?this._letterSpacingProp=p:this.letterSpacing=e.getLayoutValue("text-letter-spacing",t),p=e.getLayoutProperty("text-line-height"),null!=(a=p)&&a.isDataDriven?this._lineHeightProp=p:this.lineHeight=e.getLayoutValue("text-line-height",t),p=e.getLayoutProperty("text-max-angle"),null!=(o=p)&&o.isDataDriven?this._maxAngleProp=p:this.maxAngle=e.getLayoutValue("text-max-angle",t),p=e.getLayoutProperty("text-max-width"),null!=(l=p)&&l.isDataDriven?this._maxWidthProp=p:this.maxWidth=e.getLayoutValue("text-max-width",t),p=e.getLayoutProperty("text-offset"),null!=(c=p)&&c.isDataDriven?this._offsetProp=p:this.offset=e.getLayoutValue("text-offset",t),p=e.getLayoutProperty("text-padding"),null!=(u=p)&&u.isDataDriven?this._paddingProp=p:this.padding=e.getLayoutValue("text-padding",t),p=e.getLayoutProperty("text-rotate"),null!=(h=p)&&h.isDataDriven?this._rotateProp=p:this.rotate=e.getLayoutValue("text-rotate",t),p=e.getLayoutProperty("text-size"),null!=(d=p)&&d.isDataDriven?this._sizeProp=p:this.size=e.getLayoutValue("text-size",t),p=e.getLayoutProperty("text-writing-mode"),null!=(f=p)&&f.isDataDriven?this._writingModeProp=p:this.writingMode=e.getLayoutValue("text-writing-mode",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}}class Be{constructor(e,t){if(this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,e.layers||(e.layers=[]),this.version=parseFloat(e.version),this.sprite=t?t.spriteUrl:e.sprite,this.glyphs=t?t.glyphsUrl:e.glyphs,this.layers=e.layers.map(((e,t,r)=>this._create(e,t,r))),this.layers){let e;for(let t=0;t<this.layers.length;t++)e=this.layers[t],this._layerByName[e.id.toLowerCase()]=e,this._uidToLayer.set(e.uid,e),0===e.type&&this.backgroundBucketIds.push(e.id)}this._identifyRefLayers()}isPainterDataDriven(e){const t=this._layerByName[e.toLowerCase()];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){const t=this._uidToLayer.get(e);return null!=t?t:null}getStyleLayerIndex(e){const t=this._layerByName[e.toLowerCase()];return t?this.layers.indexOf(t):-1}setStyleLayer(e,t){if(!e||!e.id)return;t&&t>=this.layers.length&&(t=this.layers.length-1);let r,i=!0;const n=this._layerByName[e.id.toLowerCase()];if(n){const s=this.layers.indexOf(n);t||(t=s),t===s?(i=!1,r=Be._recreateLayer(e,n),this.layers[t]=r):(this.layers.splice(s,1),r=this._create(e,t,this.layers),this.layers.splice(t,0,r))}else r=this._create(e,t,this.layers),!t||t>=this.layers.length?this.layers.push(r):this.layers.splice(t,0,r);this._layerByName[e.id.toLowerCase()]=r,this._uidToLayer.set(r.uid,r),i&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const t=this._layerByName[e.toLowerCase()];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){const t=this._layerByName[e.toLowerCase()];if(t){delete this._layerByName[e.toLowerCase()],this._uidToLayer.delete(t.uid);const r=this.layers.indexOf(t);this.layers.splice(r,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e.toLowerCase()]}getLayoutProperties(e){const t=this._layerByName[e.toLowerCase()];return t?t.layout:null}getPaintProperties(e){const t=this._layerByName[e.toLowerCase()];return t?t.paint:null}setPaintProperties(e,t){const r=this._layerByName[e.toLowerCase()];if(!r)return"";const i={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:t},n=Be._recreateLayer(i,r),s=this.layers.indexOf(r);return this.layers[s]=n,this._layerByName[r.id.toLowerCase()]=n,this._uidToLayer.set(r.uid,n),r.id}setLayoutProperties(e,t){const r=this._layerByName[e.toLowerCase()];if(!r)return"";const i={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:t,paint:r.paint},n=Be._recreateLayer(i,r),s=this.layers.indexOf(r);return this.layers[s]=n,this._layerByName[r.id.toLowerCase()]=n,this._uidToLayer.set(r.uid,n),r.id}setStyleLayerVisibility(e,t){const r=this._layerByName[e.toLowerCase()];if(!r)return;const i=r.layout||{};i.visibility=t;const n={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:i,paint:r.paint},s=Be._recreateLayer(n,r),a=this.layers.indexOf(r);this.layers[a]=s,this._layerByName[r.id.toLowerCase()]=s,this._uidToLayer.set(r.uid,s)}getStyleLayerVisibility(e){var t;const r=this._layerByName[e.toLowerCase()];if(!r)return"none";const i=r.layout;return null!=(t=null==i?void 0:i.visibility)?t:"visible"}_recomputeZValues(){const e=this.layers,t=1/(e.length+1);for(let r=0;r<e.length;r++)e[r].z=1-(1+r)*t}_identifyRefLayers(){const e=[],t=[];let r=0;for(const i of this.layers){if(1===i.type){const t=i;let n=i.source+"|"+i.sourceLayer;n+="|"+JSON.stringify(i.layout&&i.layout.visibility),n+="|"+JSON.stringify(i.minzoom),n+="|"+JSON.stringify(i.maxzoom),n+="|"+JSON.stringify(i.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(n+="|"+JSON.stringify(r)),e.push({key:n,layer:i})}if(2===i.type){const e=i;let n=i.source+"|"+i.sourceLayer;n+="|"+JSON.stringify(i.layout&&i.layout.visibility),n+="|"+JSON.stringify(i.minzoom),n+="|"+JSON.stringify(i.maxzoom),n+="|"+JSON.stringify(i.filter),n+="|"+JSON.stringify(i.layout&&i.layout["line-cap"]),n+="|"+JSON.stringify(i.layout&&i.layout["line-join"]),e.hasDataDrivenLine&&(n+="|"+JSON.stringify(r)),t.push({key:n,layer:i})}++r}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){let t,r;e.sort(((e,t)=>e.key<t.key?-1:e.key>t.key?1:0));const i=e.length;for(let n=0;n<i;n++){const s=e[n];if(s.key===t)s.layer.refLayerId=r;else if(t=s.key,r=s.layer.id,1===s.layer.type&&!s.layer.getPaintProperty("fill-outline-color"))for(let a=n+1;a<i;a++){const i=e[a];if(i.key!==t)break;if(i.layer.getPaintProperty("fill-outline-color")){e[n]=i,e[a]=s,r=i.layer.id;break}}}}_create(e,t,r){const i=1-(1+t)*(1/(r.length+1)),n=this._runningId++;switch(e.type){case"background":return new Re(0,e,i,n);case"fill":return new Fe(1,e,i,n);case"line":return new Ce(2,e,i,n);case"symbol":return new De(3,e,i,n);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new Le(4,e,i,n)}throw new Error("Unknown vector tile layer")}static _recreateLayer(e,t){switch(e.type){case"background":return new Re(0,e,t.z,t.uid);case"fill":return new Fe(1,e,t.z,t.uid);case"line":return new Ce(2,e,t.z,t.uid);case"symbol":return new De(3,e,t.z,t.uid);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new Le(4,e,t.z,t.uid)}}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i={}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return c}));var i=r(0);r(1);let n=class extends i.a{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};Object(i.e)([Object(i.y)({type:Number})],n.prototype,"nodesPerPage",void 0),Object(i.e)([Object(i.y)({type:Number})],n.prototype,"rootIndex",void 0),Object(i.e)([Object(i.y)({type:String})],n.prototype,"lodSelectionMetricType",void 0),n=Object(i.e)([Object(i.i)("esri.layer.support.I3SNodePageDefinition")],n);let s=class extends i.a{constructor(){super(...arguments),this.factor=1}};Object(i.e)([Object(i.y)({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],s.prototype,"id",void 0),Object(i.e)([Object(i.y)({type:Number})],s.prototype,"factor",void 0),s=Object(i.e)([Object(i.i)("esri.layer.support.I3SMaterialTexture")],s);let a=class extends i.a{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};Object(i.e)([Object(i.y)({type:[Number]})],a.prototype,"baseColorFactor",void 0),Object(i.e)([Object(i.y)({type:s})],a.prototype,"baseColorTexture",void 0),Object(i.e)([Object(i.y)({type:s})],a.prototype,"metallicRoughnessTexture",void 0),Object(i.e)([Object(i.y)({type:Number})],a.prototype,"metallicFactor",void 0),Object(i.e)([Object(i.y)({type:Number})],a.prototype,"roughnessFactor",void 0),a=Object(i.e)([Object(i.i)("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a);let o=class extends i.a{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};Object(i.e)([Object(i.r)({opaque:"opaque",mask:"mask",blend:"blend"})],o.prototype,"alphaMode",void 0),Object(i.e)([Object(i.y)({type:Number})],o.prototype,"alphaCutoff",void 0),Object(i.e)([Object(i.y)({type:Boolean})],o.prototype,"doubleSided",void 0),Object(i.e)([Object(i.r)({none:"none",back:"back",front:"front"})],o.prototype,"cullFace",void 0),Object(i.e)([Object(i.y)({type:s})],o.prototype,"normalTexture",void 0),Object(i.e)([Object(i.y)({type:s})],o.prototype,"occlusionTexture",void 0),Object(i.e)([Object(i.y)({type:s})],o.prototype,"emissiveTexture",void 0),Object(i.e)([Object(i.y)({type:[Number]})],o.prototype,"emissiveFactor",void 0),Object(i.e)([Object(i.y)({type:a})],o.prototype,"pbrMetallicRoughness",void 0),o=Object(i.e)([Object(i.i)("esri.layer.support.I3SMaterialDefinition")],o);let l=class extends i.a{};Object(i.e)([Object(i.y)({type:String,json:{read:{source:["name","index"],reader:(e,t)=>null!=e?e:`${t.index}`}}})],l.prototype,"name",void 0),Object(i.e)([Object(i.r)({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",basis:"basis"})],l.prototype,"format",void 0),l=Object(i.e)([Object(i.i)("esri.layer.support.I3STextureFormat")],l);let c=class extends i.a{constructor(){super(...arguments),this.atlas=!1}};Object(i.e)([Object(i.y)({type:[l]})],c.prototype,"formats",void 0),Object(i.e)([Object(i.y)({type:Boolean})],c.prototype,"atlas",void 0),c=Object(i.e)([Object(i.i)("esri.layer.support.I3STextureSetDefinition")],c);let u=class extends i.a{};Object(i.e)([Object(i.r)({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],u.prototype,"type",void 0),Object(i.e)([Object(i.y)({type:Number})],u.prototype,"component",void 0),u=Object(i.e)([Object(i.i)("esri.layer.support.I3SGeometryAttribute")],u);let h=class extends i.a{};Object(i.e)([Object(i.r)({draco:"draco"})],h.prototype,"encoding",void 0),Object(i.e)([Object(i.y)({type:[String]})],h.prototype,"attributes",void 0),h=Object(i.e)([Object(i.i)("esri.layer.support.I3SGeometryCompressedAttributes")],h);let d=class extends i.a{constructor(){super(...arguments),this.offset=0}};Object(i.e)([Object(i.y)({type:Number})],d.prototype,"offset",void 0),Object(i.e)([Object(i.y)({type:u})],d.prototype,"position",void 0),Object(i.e)([Object(i.y)({type:u})],d.prototype,"normal",void 0),Object(i.e)([Object(i.y)({type:u})],d.prototype,"uv0",void 0),Object(i.e)([Object(i.y)({type:u})],d.prototype,"color",void 0),Object(i.e)([Object(i.y)({type:u})],d.prototype,"uvRegion",void 0),Object(i.e)([Object(i.y)({type:u})],d.prototype,"featureId",void 0),Object(i.e)([Object(i.y)({type:u})],d.prototype,"faceRange",void 0),Object(i.e)([Object(i.y)({type:h})],d.prototype,"compressedAttributes",void 0),d=Object(i.e)([Object(i.i)("esri.layer.support.I3SGeometryBuffer")],d);let f=class extends i.a{};Object(i.e)([Object(i.r)({triangle:"triangle"})],f.prototype,"topology",void 0),Object(i.e)([Object(i.y)()],f.prototype,"geometryBuffers",void 0),f=Object(i.e)([Object(i.i)("esri.layer.support.I3SGeometryDefinition")],f)},function(e,t,r){"use strict";r.r(t),r.d(t,"W",(function(){return b})),r.d(t,"a",(function(){return y})),r.d(t,"x",(function(){return m}));r(25);var i,n=r(0),s=r(1),a=r(47),o=r(103),l=r(23),c=r(108),u=r(105),h=r(110),d=r(107),f=r(73);let p=i=class extends n.a{constructor(e){super(e)}clone(){return new i({customLayerParameters:Object(s.o)(this.customLayerParameters),customParameters:Object(s.o)(this.customParameters),layerIdentifier:this.layerIdentifier,tileMatrixSet:this.tileMatrixSet,url:this.url})}};Object(n.e)([Object(n.y)({json:{type:Object,write:!0}})],p.prototype,"customLayerParameters",void 0),Object(n.e)([Object(n.y)({json:{type:Object,write:!0}})],p.prototype,"customParameters",void 0),Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],p.prototype,"layerIdentifier",void 0),Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],p.prototype,"tileMatrixSet",void 0),Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],p.prototype,"url",void 0),p=i=Object(n.e)([Object(n.i)("esri.layer.support.WMTSLayerInfo")],p);var y=p;let g=class extends(Object(c.a)(Object(h.a)(Object(d.a)(Object(l.i)(Object(u.a)(Object(o.b)(a.a))))))){constructor(...e){super(...e),this.copyright="",this.fullExtent=new n.M(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,n.A.WebMercator),this.legendEnabled=!1,this.isReference=null,this.popupEnabled=!1,this.spatialReference=n.A.WebMercator,this.subDomains=null,this.tileInfo=new f.b({size:[256,256],dpi:96,format:"png8",compressionQuality:0,origin:new n._({x:-20037508.342787,y:20037508.342787,spatialReference:n.A.WebMercator}),spatialReference:n.A.WebMercator,lods:[new f.a({level:0,scale:591657527.591555,resolution:156543.033928}),new f.a({level:1,scale:295828763.795777,resolution:78271.5169639999}),new f.a({level:2,scale:147914381.897889,resolution:39135.7584820001}),new f.a({level:3,scale:73957190.948944,resolution:19567.8792409999}),new f.a({level:4,scale:36978595.474472,resolution:9783.93962049996}),new f.a({level:5,scale:18489297.737236,resolution:4891.96981024998}),new f.a({level:6,scale:9244648.868618,resolution:2445.98490512499}),new f.a({level:7,scale:4622324.434309,resolution:1222.99245256249}),new f.a({level:8,scale:2311162.217155,resolution:611.49622628138}),new f.a({level:9,scale:1155581.108577,resolution:305.748113140558}),new f.a({level:10,scale:577790.554289,resolution:152.874056570411}),new f.a({level:11,scale:288895.277144,resolution:76.4370282850732}),new f.a({level:12,scale:144447.638572,resolution:38.2185141425366}),new f.a({level:13,scale:72223.819286,resolution:19.1092570712683}),new f.a({level:14,scale:36111.909643,resolution:9.55462853563415}),new f.a({level:15,scale:18055.954822,resolution:4.77731426794937}),new f.a({level:16,scale:9027.977411,resolution:2.38865713397468}),new f.a({level:17,scale:4513.988705,resolution:1.19432856685505}),new f.a({level:18,scale:2256.994353,resolution:.597164283559817}),new f.a({level:19,scale:1128.497176,resolution:.298582141647617})]}),this.type="web-tile",this.urlTemplate=null,this.wmtsInfo=null}normalizeCtorArgs(e,t){return"string"==typeof e?{urlTemplate:e,...t}:e}load(e){const t=this.loadFromPortal({supportedTypes:["WMTS"]},e).then((()=>{let e="";if(this.urlTemplate)if(this.spatialReference.equals(this.tileInfo.spatialReference)){const t=new n.b_(this.urlTemplate);this.subDomains&&this.subDomains.length>0||-1===t.authority.indexOf("{subDomain}")||(e="is missing 'subDomains' property")}else e="spatialReference must match tileInfo.spatialReference";else e="is missing the required 'urlTemplate' property value";if(e)throw new n.s("web-tile-layer:load",`WebTileLayer (title: '${this.title}', id: '${this.id}') ${e}`)}));return this.addResolvingPromise(t),Promise.resolve(this)}get levelValues(){const e=[];if(!this.tileInfo)return null;for(const t of this.tileInfo.lods)e[t.level]=t.levelValue||t.level;return e}readSpatialReference(e,t){return e||t.fullExtent&&t.fullExtent.spatialReference&&n.A.fromJSON(t.fullExtent.spatialReference)}get tileServers(){if(!this.urlTemplate)return null;const e=[],{urlTemplate:t,subDomains:r}=this,i=new n.b_(t),s=i.scheme?i.scheme+"://":"//",a=s+i.authority+"/";if(-1===i.authority.indexOf("{subDomain}"))e.push(a);else if(r&&r.length>0&&i.authority.split(".").length>1)for(const t of r)e.push(s+i.authority.replace(/\{subDomain\}/gi,t)+"/");return e.map((e=>("/"!==e.charAt(e.length-1)&&(e+="/"),e)))}get urlPath(){if(!this.urlTemplate)return null;const e=this.urlTemplate,t=new n.b_(e),r=(t.scheme?t.scheme+"://":"//")+t.authority+"/";return e.substring(r.length)}readUrlTemplate(e,t){return e||t.templateUrl}writeUrlTemplate(e,t){e&&Object(n.cU)(e)&&(e="https:"+e),e&&(e=e.replace(/\{z\}/gi,"{level}").replace(/\{x\}/gi,"{col}").replace(/\{y\}/gi,"{row}"),e=Object(n.aR)(e)),t.templateUrl=e}fetchTile(e,t,r,i={}){const{signal:s,timestamp:a}=i,o=this.getTileUrl(e,t,r),l={responseType:"image",signal:s};return null!=a&&(l.query={_ts:i.timestamp}),Object(n.C)(o,l).then((e=>e.data))}getTileUrl(e,t,r){const i=this.levelValues[e];return this.tileServers[t%this.tileServers.length]+Object(n.G)(this.urlPath,{level:i,z:i,col:r,x:r,row:t,y:t})}};Object(n.e)([Object(n.y)({type:String,value:"",json:{write:!0}})],g.prototype,"copyright",void 0),Object(n.e)([Object(n.y)({type:n.M,json:{write:!0}})],g.prototype,"fullExtent",void 0),Object(n.e)([Object(n.y)({readOnly:!0,json:{read:!1,write:!1}})],g.prototype,"legendEnabled",void 0),Object(n.e)([Object(n.y)({type:["show","hide"]})],g.prototype,"listMode",void 0),Object(n.e)([Object(n.y)()],g.prototype,"levelValues",null),Object(n.e)([Object(n.y)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],g.prototype,"isReference",void 0),Object(n.e)([Object(n.y)({type:["WebTiledLayer"],value:"WebTiledLayer"})],g.prototype,"operationalLayerType",void 0),Object(n.e)([Object(n.y)({readOnly:!0,json:{read:!1,write:!1}})],g.prototype,"popupEnabled",void 0),Object(n.e)([Object(n.y)({type:n.A})],g.prototype,"spatialReference",void 0),Object(n.e)([Object(n.a1)("spatialReference",["spatialReference","fullExtent.spatialReference"])],g.prototype,"readSpatialReference",null),Object(n.e)([Object(n.y)({type:[String],json:{write:!0}})],g.prototype,"subDomains",void 0),Object(n.e)([Object(n.y)({type:f.b,json:{write:!0}})],g.prototype,"tileInfo",void 0),Object(n.e)([Object(n.y)({readOnly:!0})],g.prototype,"tileServers",null),Object(n.e)([Object(n.y)({json:{read:!1}})],g.prototype,"type",void 0),Object(n.e)([Object(n.y)()],g.prototype,"urlPath",null),Object(n.e)([Object(n.y)({type:String,json:{origins:{"portal-item":{read:{source:"url"}}}}})],g.prototype,"urlTemplate",void 0),Object(n.e)([Object(n.a1)("urlTemplate",["urlTemplate","templateUrl"])],g.prototype,"readUrlTemplate",null),Object(n.e)([Object(n.o)("urlTemplate",{templateUrl:{type:String}})],g.prototype,"writeUrlTemplate",null),Object(n.e)([Object(n.y)({type:y,json:{write:!0}})],g.prototype,"wmtsInfo",void 0),g=Object(n.e)([Object(n.i)("esri.layers.WebTileLayer")],g);var m=g,b=Object.freeze({__proto__:null,default:m})},function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return U})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return z})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return y})),r.d(t,"j",(function(){return F})),r.d(t,"k",(function(){return u})),r.d(t,"l",(function(){return f})),r.d(t,"m",(function(){return C})),r.d(t,"n",(function(){return d})),r.d(t,"o",(function(){return c})),r.d(t,"p",(function(){return g})),r.d(t,"q",(function(){return k})),r.d(t,"r",(function(){return T}));r(25),r(18);var i=r(0),n=r(166),s=r(369),a=r(221),o=r(104);class l{constructor(){this._databaseTypeMetaData={},this._layerInfo={}}clearDatabaseType(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}getDatabaseType(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}setDatabaseType(e,t){this._databaseTypeMetaData[e]=t}getLayerInfo(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}setLayerInfo(e,t){this._layerInfo[e]=t}clearLayerInfo(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}l.applicationCache=null;class c{constructor(e,t,r,i){this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=i}}function u(e,t){return p(e.parseTree,t,e.parameters)}function h(e,t,r){return p(e,t,r)}function d(e,t,r,i){return a.WhereClause.create(p(e.parseTree,n.a4.Standardised,e.parameters,t,r),i)}function f(e,t,r="AND"){return a.WhereClause.create("(("+u(e,n.a4.Standardised)+")"+r+"("+u(t,n.a4.Standardised)+"))",e.fieldsIndex)}function p(e,t,r,i=null,n=null){let s,a,o,l;switch(e.type){case"interval":return T(p(e.value,t,r,i,n),e.qualifier,e.op);case"case_expression":{let s=" CASE ";"simple"===e.format&&(s+=p(e.operand,t,r,i,n));for(let a=0;a<e.clauses.length;a++)s+=" WHEN "+p(e.clauses[a].operand,t,r,i,n)+" THEN "+p(e.clauses[a].value,t,r,i,n);return null!==e.else&&(s+=" ELSE "+p(e.else,t,r,i,n)),s+=" END ",s}case"param":{const i=r[e.value.toLowerCase()];if("string"==typeof i)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(i instanceof Date)return g(i,t);if(i instanceof Array){const e=[];for(let r=0;r<i.length;r++)"string"==typeof i[r]?e.push("'"+i[r].toString().replace(/'/g,"''")+"'"):i[r]instanceof Date?e.push(g(i[r],t)):e.push(i[r].toString());return e}return i.toString()}case"expr_list":a=[];for(const s of e.value)a.push(p(s,t,r,i,n));return a;case"unary_expr":return" ( NOT "+p(e.expr,t,r,i,n)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+p(e.left,t,r,i,n)+" AND "+p(e.right,t,r,i,n)+") ";case"OR":return" ("+p(e.left,t,r,i,n)+" OR "+p(e.right,t,r,i,n)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+p(e.left,t,r,i,n)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+p(e.left,t,r,i,n)+" IS NOT NULL )";case"IN":return s=[],"expr_list"===e.right.type?(s=p(e.right,t,r,i,n)," ("+p(e.left,t,r,i,n)+" IN ("+s.join(",")+")) "):(l=p(e.right,t,r,i,n),l instanceof Array?" ("+p(e.left,t,r,i,n)+" IN ("+l.join(",")+")) ":" ("+p(e.left,t,r,i,n)+" IN ("+l+")) ");case"NOT IN":return s=[],"expr_list"===e.right.type?(s=p(e.right,t,r,i,n)," ("+p(e.left,t,r,i,n)+" NOT IN ("+s.join(",")+")) "):(l=p(e.right,t,r,i,n),l instanceof Array?" ("+p(e.left,t,r,i,n)+" NOT IN ("+l.join(",")+")) ":" ("+p(e.left,t,r,i,n)+" NOT IN ("+l+")) ");case"BETWEEN":return o=p(e.right,t,r,i,n)," ("+p(e.left,t,r,i,n)+" BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"NOTBETWEEN":return o=p(e.right,t,r,i,n)," ("+p(e.left,t,r,i,n)+" NOT BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"LIKE":return""!==e.escape?" ("+p(e.left,t,r,i,n)+" LIKE "+p(e.right,t,r,i,n)+" ESCAPE '"+e.escape+"') ":" ("+p(e.left,t,r,i,n)+" LIKE "+p(e.right,t,r,i,n)+") ";case"NOT LIKE":return""!==e.escape?" ("+p(e.left,t,r,i,n)+" NOT LIKE "+p(e.right,t,r,i,n)+" ESCAPE '"+e.escape+"') ":" ("+p(e.left,t,r,i,n)+" NOT LIKE "+p(e.right,t,r,i,n)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+p(e.left,t,r,i,n)+" "+e.operator+" "+p(e.right,t,r,i,n)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return g(e.value,t);case"number":return e.value.toString();case"current_time":return m("date"===e.mode,t);case"column_ref":return i&&i.toLowerCase()===e.column.toLowerCase()?"("+n+")":e.column;case"function":{const s=p(e.args,t,r,i,n);return y(e.name,s,t)}}throw new Error("Unsupported sql syntax "+e.type)}function y(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case n.a4.Standardised:case n.a4.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case n.a4.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case n.a4.SqlServer:return"LEN("+t[0]+")";case n.a4.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");{let e="CONCAT(";for(let r=0;r<t.length;r++)0!==r&&(e+=","),e+=t[r];return e+=")",e}case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":{let e="";switch(r){case n.a4.Oracle:return e="SUBSTR("+t[0]+","+t[1],3===t.length&&(e+=","+t[2]),e+=")",e;case n.a4.SqlServer:return e=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")",e;default:return e="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(e+=" FOR "+t[2]),e+=")",e}}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function g(e,t){const r=n.a8.Moment(e),i=0===r.minute()&&0===r.hour()&&0===r.second()&&0===r.millisecond();switch(t){case n.a4.FILEGDB:case n.a4.Standardised:case n.a4.StandardisedNoInterval:return i?"date '"+r.format("YYYY-MM-DD")+"'":"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'";case n.a4.Oracle:return i?"TO_DATE('"+r.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+r.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case n.a4.SqlServer:return"'"+r.format(i?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case n.a4.PGDB:return"#"+r.format(i?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case n.a4.Postgres:return"TIMESTAMP '"+r.format(i?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'"}}function m(e,t){switch(t){case n.a4.FILEGDB:case n.a4.Standardised:case n.a4.StandardisedNoInterval:case n.a4.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case n.a4.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case n.a4.PGDB:case n.a4.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function b(e,t,r={}){const i={},n={},s={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"};for(const e of t){const t=s[e.type];i[e.name.toLowerCase()]=void 0===t?"":t}for(const e in r){const t=s[r[e]];n[e.toLowerCase()]=void 0===t?"":t}switch(_(i,e.parseTree,e.parameters,n)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""}function _(e,t,r,i){let n;switch(t.type){case"interval":return"integer";case"case_expression":{const n=[];if("simple"===t.format){for(let s=0;s<t.clauses.length;s++)n.push(_(e,t.clauses[s].value,r,i));null!==t.else&&n.push(_(e,t.else,r,i))}else{for(let s=0;s<t.clauses.length;s++)n.push(_(e,t.else,r,i));null!==t.else&&n.push(_(e,t.else,r,i))}return v(n)}case"param":{const e=i[t.value.toLowerCase()];if(void 0===e&&r){const e=r[t.value.toLowerCase()];if(void 0===e)return"";if(null===e)return"";if("string"==typeof e||e instanceof String)return"string";if("boolean"==typeof e)return"boolean";if(e instanceof Date)return"date";if("number"==typeof e)return e%1==0?"integer":"double"}return void 0===e?"":e}case"expr_list":{const n=[];for(const s of t.value)n.push(_(e,s,r,i));return n}case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return v([_(e,t.left,r,i),_(e,t.right,r,i)]);default:throw new Error("Not Supported Operator "+t.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":{const r=e[t.column.toLowerCase()];return void 0===r?"":r}case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return n=_(e,t.args,r,i),n instanceof Array?n.length>0?n[0]:"":n;case"sign":return n=_(e,t.args,r,i),n instanceof Array&&(n=v(n)),"integer"===n||"double"===n?n:"double";case"ceiling":case"floor":case"abs":{const n=_(e,t.args,r,i);return n instanceof Array?v(n):n}case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return n=_(e,t.args,r,i),n instanceof Array?n.length>0?n[0]:"":n}return""}throw new Error("Unsupported sql syntax "+t.type)}const x={boolean:1,string:2,integer:3,double:4,date:5};function v(e){if(e){let t="";for(const r of e)""!==r&&(t=""===t||x[t]<x[r]?r:t);return t}return""}function w(e,t){return I(e.parseTree,t)}function O(e){return"column_ref"===e.parseTree.type}function I(e,t){if(null==e)return!1;switch(e.type){case"when_clause":return I(e.operand,t)||I(e.value,t);case"case_expression":for(const r of e.clauses)if(I(r,t))return!0;return!("simple"!==e.format||!I(e.operand,t))||!(null===e.else||!I(e.else,t));case"param":return!1;case"expr_list":for(const r of e.value)if(I(r,t))return!0;return!1;case"unary_expr":return I(e.expr,t);case"binary_expr":return I(e.left,t)||I(e.right,t);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return t.toLowerCase()===e.column.toLowerCase();case"function":return I(e.args,t)}return!1}function S(e){let t="";return t+=e.period.toUpperCase(),t}function T(e,t,r){let i="";return i="interval-period"===t.type?S(t):S(t.start)+" TO "+S(t.end),"INTERVAL "+r+" "+e+" "+i}class j{constructor(e,t){this._lastId=-1,this._progress=t,this._parent=e}reset(){this._lastId=-1}nextBatch(e){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((t=>this.nextBatch(e)),(t=>this.nextBatch(e)));const t={returnpromise:null,hasset:!1},r=[];return t.returnpromise=Object(i.cH)(((i,n)=>{this._parent._getSet(this._progress).then((s=>{let a=s._known.length-1;if("GETPAGES"===s._known[s._known.length-1]&&(a-=1),this._lastId+e>a&&s._known.length>0&&"GETPAGES"===s._known[s._known.length-1])this._parent._expandPagedSet(s,this._parent._maxQueryRate(),0,0,this._progress).then((r=>{t.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(i,n)}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,n(e)}));else{if(a>=this._lastId+e||0===s._candidates.length){for(let t=0;t<e;t++){const e=t+this._lastId+1;if(e>=s._known.length)break;r[t]=s._known[e]}return this._lastId+=r.length,0===r.length&&(t.hasset=!0,this._parent._mainSetInUse=null,i([])),void this._parent._getFeatureBatch(r,this._progress).then((e=>{t.hasset=!0,this._parent._mainSetInUse=null,i(e)}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,n(e)}))}this._parent._refineSetBlock(s,this._parent._maxProcessingRate(),this._progress).then((()=>{t.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(i,n)}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,n(e)}))}}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,n(e)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}next(){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((e=>this.next()),(e=>this.next()));const e={returnpromise:null,hasset:!1};return e.returnpromise=Object(i.cH)(((t,r)=>{this._parent._getSet(this._progress).then((i=>{this._lastId<i._known.length-1?"GETPAGES"===i._known[this._lastId+1]?this._parent._expandPagedSet(i,this._parent._maxQueryRate(),0,0,this._progress).then((t=>(e.hasset=!0,this._parent._mainSetInUse=null,this.next()))).then(t,r):(this._lastId+=1,this._parent._getFeature(i,i._known[this._lastId],this._progress).then((r=>{e.hasset=!0,this._parent._mainSetInUse=null,t(r)}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)}))):i._candidates.length>0?this._parent._refineSetBlock(i,this._parent._maxProcessingRate(),this._progress).then((()=>{e.hasset=!0,this._parent._mainSetInUse=null,this.next().then(t,r)}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)})):(e.hasset=!0,this._parent._mainSetInUse=null,t(null))}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)}))})),!1===e.hasset&&(this._parent._mainSetInUse=e.returnpromise,e.hasset=!0),e.returnpromise}count(){return-1!==this._parent._totalCount?Object(i.cI)(this._parent._totalCount):this._parent._getSet(this._progress).then((e=>this._refineAllSets(e))).then((e=>(this._parent._totalCount=e._known.length,Object(i.cI)(this._parent._totalCount))))}_refineAllSets(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then((t=>this._refineAllSets(e))).then((e=>Object(i.cI)(e))):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then((t=>this._refineAllSets(e))).then((e=>Object(i.cI)(e))):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then((e=>e._candidates.length>0?this._refineAllSets(e):Object(i.cI)(e))):Object(i.cI)(e)}}function E(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}function A(e){const t=E(e);let r=0;for(let i=0;i<e.length;i++)r+=(t-e[i])**2;return r/e.length}function M(e){const t=E(e);let r=0;for(let i=0;i<e.length;i++)r+=(t-e[i])**2;return r/(e.length-1)}function R(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t}function F(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function C(e,t,r=1e3){switch(e.toLowerCase()){case"distinct":return function(e,t){const r=[],i={},s=[];for(let a=0;a<e.length;a++){if(void 0!==e[a]&&null!==e[a]){const t=e[a];if(Object(n.a9)(t)||Object(n.aa)(t))void 0===i[t]&&(r.push(t),i[t]=1);else{let e=!1;for(let r=0;r<s.length;r++)!0===Object(n.ab)(s[r],t)&&(e=!0);!1===e&&(s.push(t),r.push(t))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return E(t);case"min":return Math.min.apply(Math,t);case"sum":return R(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(A(t));case"var":case"variance":return A(t);case"count":return t.length}return 0}function D(e,t,r){let i="";return!1===O(t)&&(i=b(t,e.fields,null)),L(e,t,r,!0).then((e=>{if(0===e.length)return null;const t=E(e);return null===t?t:"integer"===i?function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(t):t}))}function L(e,t,r,n=!1){try{const s=e.iterator(r);return Object(i.cH)(((e,r)=>{N(s,[],t,n,e,r)}))}catch(e){return Object(i.af)(e)}}function N(e,t,r,i,s,a){Object(n.a2)(e.next().then((n=>{try{if(null!==n){const o=r.calculateValue(n);return null===o?!1===i&&(t[t.length]=o):t[t.length]=o,N(e,t,r,i,s,a)}s(t)}catch(e){a(e)}}),a))}function P(e,t,r=1e3,n=null){return function(e,t,r,n){try{return B(e.iterator(n),{},[],t,r)}catch(e){return Object(i.af)(e)}}(e,t,r,n)}function B(e,t,r,i,n){return e.next().then((s=>{if(null!==s){const a=i.calculateValue(s);return null!=a&&void 0===t[a]&&(r.push(a),t[a]=1),r.length>=n&&-1!==n?r:B(e,t,r,i,n)}return r}))}class k{constructor(e){this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=n.a4.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache),e&&e.interceptor&&(this.featureSetQueryInterceptor=e.interceptor)}optimisePagingFeatureQueries(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}_hasMemorySource(){return!0}prop(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}end(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}_ensureLoaded(){return this.load()}load(){return null===this._loadPromise&&(this._loadPromise=Object(i.cH)(((e,t)=>{if(!0===this._parent.loaded)return this._initialiseFeatureSet(),void e(this);this._parent.load().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}}),t)}))),this._loadPromise}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new i.A({wkid:4326}),this.geometryType=n.a0.point)}getField(e,t){let r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((t=>(t&&t.name.toLowerCase()===e&&(r=t),!!r)))),r}getFieldsIndex(){return null===this._fieldsIndex&&(this._fieldsIndex=new o.a(this.fields)),this._fieldsIndex}_maxProcessingRate(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}_maxQueryRate(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}_checkCancelled(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")}nativeCapabilities(){return this._parent.nativeCapabilities()}_canDoAggregates(e,t,r,n,s){return null===this._parent?Object(i.cI)(!1):this._parent._canDoAggregates(e,t,r,n,s)}_getAggregatePagesDataSourceDefinition(e,t,r,n,s,a,o){return null===this._parent?Object(i.af)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,s,a,o)}_getAgregagtePhysicalPage(e,t,r){return null===this._parent?Object(i.af)(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)}databaseType(){if(this._databaseType===n.a4.NotEvaluated){if(null!==l.applicationCache){const e=l.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==e)return e}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;const e=[{thetype:n.a4.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:n.a4.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:n.a4.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}];let t=Object(i.cH)(((t,r)=>{this._getDatabaseTypeImpl(e,0).then((e=>{this._databaseType=e,t(this._databaseType)}),(e=>{r(e)}))}));return null!==l.applicationCache&&(l.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),t),t=t.catch((e=>{throw l.applicationCache.clearDatabaseType(this._cacheableFeatureSetSourceKey()),e}))),this._databaseTypeProbed=t,this._databaseTypeProbed}return Object(i.cI)(this._databaseType)}_cacheableFeatureSetSourceKey(){return"MUSTBESET"}_getDatabaseTypeImpl(e,t){return t>=e.length?Object(i.cI)(n.a4.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((r=>!0===r?e[t].thetype:this._getDatabaseTypeImpl(e,t+1)))}_runDatabaseProbe(e){return null!==this._parent?this._parent._runDatabaseProbe(e):Object(i.af)(new Error("Not Implemented"))}isTable(){return this._parent.isTable()}_featureFromCache(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}_isInFeatureSet(e){return n.a1.Unknown}_getSet(e){throw new Error("Not implemented in abstract class")}_getFeature(e,t,r){try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?Object(i.cI)(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then((()=>(this._checkCancelled(r),void 0!==this._featureFromCache(t)?this._featureFromCache(t):Object(i.af)(new Error("Feature Not Found")))))}catch(e){return Object(i.af)(e)}}_getFeatureBatch(e,t){try{this._checkCancelled(t);const r=new c([],e,!1,null),i=[];return this._getFeatures(r,-1,e.length,t).then((()=>{this._checkCancelled(t);for(const t of e)void 0!==this._featureFromCache(t)&&i.push(this._featureFromCache(t));return i}))}catch(e){return Object(i.af)(e)}}_getFeatures(e,t,r,n){return Object(i.cI)("success")}_getFilteredSet(e,t,r,i,n){throw new Error("Not implemented in abstract class")}_refineSetBlock(e,t,r){try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then((()=>this._refineSetBlock(e,t,r)));this._checkCancelled(r);const n=e._candidates.length;this._refineKnowns(e,t);let s=n-e._candidates.length;return 0===e._candidates.length||s>=t?Object(i.cI)(e):this._refineIfParentKnown(e,t-s,r).then((()=>{if(this._checkCancelled(r),this._refineKnowns(e,t-s),s=n-e._candidates.length,s<t&&e._candidates.length>0){const i=t-s,n=this._prepareFetchAndRefineSet(e._candidates);return this._fetchAndRefineFeatures(n,n.length>i?i:e._candidates.length,r).then((()=>(this._checkCancelled(r),this._refineKnowns(e,t-s),e)))}return e}))}catch(e){return Object(i.af)(e)}}_fetchAndRefineFeatures(e,t,r){return null}_prepareFetchAndRefineSet(e){const t=[];for(let r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t}_isPhysicalFeature(e){return null===this._parent||this._parent._isPhysicalFeature(e)}_refineKnowns(e,t){let r=0,i=null;const s=[];t=this._maxQueryRate();for(let a=0;a<e._candidates.length&&"GETPAGES"!==e._candidates[a];a++){let o=!1;const l=this._candidateIdTransform(e._candidates[a]);l!==e._candidates[a]&&(o=!0);const c=this._isInFeatureSet(l);if(c===n.a1.InFeatureSet)!0===o?e._known.indexOf(l)<0&&(e._known.push(l),r+=1):(e._known.push(e._candidates[a]),r+=1),null===i?i={start:a,end:a}:i.end===a-1?i.end=a:(s.push(i),i={start:a,end:a});else if(c===n.a1.NotInFeatureSet)null===i?i={start:a,end:a}:i.end===a-1?i.end=a:(s.push(i),i={start:a,end:a}),r+=1;else if(c===n.a1.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==i&&s.push(i);for(let t=s.length-1;t>=0;t--)e._candidates.splice(s[t].start,s[t].end-s[t].start+1)}_refineIfParentKnown(e,t,r){const i=new c([],[],e._ordered,null);return i._candidates=e._candidates.slice(0),this._parent._refineSetBlock(i,t,r)}_candidateIdTransform(e){return this._parent._candidateIdTransform(e)}_checkIfNeedToExpandKnownPage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let i=e._lastFetchedIndex;i<e._known.length;i++){if("GETPAGES"===e._known[i])return!0;if(void 0===this._featureCache[e._known[i]]&&(r+=1,r>=t))break}return!1}_checkIfNeedToExpandCandidatePage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let i=0;i<e._candidates.length;i++){if("GETPAGES"===e._candidates[i])return!0;if(r+=1,r>=t)break}return!1}_expandPagedSet(e,t,r,n,s){return null===this._parent?Object(i.af)(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,s)}_expandPagedSetFeatureSet(e,t,r,n,s){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n?Object(i.cI)("finished"):this._getPage(e,n,s).then((i=>r+i<t?this._expandPagedSet(e,t,r+i,0,s):"success"))}_getPage(e,t,r){const n=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){n.length=n.length-1;let t=0;for(let r=0;r<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+r>=e.pagesDefinition.internal.set.length);r++)n[n.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+r],t++;e.pagesDefinition.resultOffset+=t;let r=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(r=!0),!1===r&&n.push("GETPAGES"),Object(i.cI)(t)}return this._getPhysicalPage(e,t,r).then((()=>this._getPage(e,t,r)))}_getPhysicalPage(e,t,r){return null}_clonePageDefinition(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}_first(e){return this.iterator(e).next()}first(e){return this._first(e)}calculateStatistic(e,t,r,i){return this._ensureLoaded().then((()=>this._stat(e,t,"",null,null,r,i).then((n=>!1===n.calculated?this._manualStat(e,t,r,i).then((e=>e.result)):n.result))))}_manualStat(e,t,r,n){switch(e.toLowerCase()){case"count":return function(e,t){try{return e.iterator(t).count()}catch(e){return Object(i.af)(e)}}(this,n).then((e=>({calculated:!0,result:e})));case"distinct":return P(this,t,r).then((e=>({calculated:!0,result:e})));case"avg":case"mean":return D(this,t,n).then((e=>({calculated:!0,result:e})));case"stdev":return function(e,t,r){return L(e,t,r,!0).then((e=>0===e.length?null:Math.sqrt(M(e))))}(this,t,n).then((e=>({calculated:!0,result:e})));case"variance":return function(e,t,r){return L(e,t,r,!0).then((e=>0===e.length?null:M(e)))}(this,t,n).then((e=>({calculated:!0,result:e})));case"sum":return function(e,t,r){return L(e,t,r,!0).then((e=>0===e.length?null:R(e)))}(this,t,n).then((e=>({calculated:!0,result:e})));case"min":return function(e,t,r){return L(e,t,r,!0).then((e=>0===e.length?null:Math.min.apply(Math,e)))}(this,t,n).then((e=>({calculated:!0,result:e})));case"max":return function(e,t,r){return L(e,t,r,!0).then((e=>0===e.length?null:Math.max.apply(Math,e)))}(this,t,n).then((e=>({calculated:!0,result:e})));default:return Object(i.cI)({calculated:!0,result:0})}}_stat(e,t,r,i,n,s,a){return this._parent._stat(e,t,r,i,n,s,a).then((o=>!1===o.calculated?null===n&&""===r&&null===i?this._manualStat(e,t,s,a):{calculated:!1}:o))}_unionAllGeomSelf(e){const t=this.iterator(this._defaultTracker(e)),r=[];return Object(i.cH)(((e,i)=>{this._unionShapeInBatches(r,t,e,i)}))}_unionAllGeom(e){return Object(i.cH)(((t,r)=>{const i=this.iterator(this._defaultTracker(e));this._unionShapeInBatches([],i,t,r)}))}_unionShapeInBatches(e,t,r,i){t.next().then((n=>{try{null!==n&&null!==n.geometry&&e.push(n.geometry),e.length>30||null===n&&e.length>1?Object(s.u)(e).then((s=>{try{null===n?r(s):(e=[s],this._unionShapeInBatches(e,t,r,i))}catch(e){i(e)}}),i):null===n?1===e.length?r(e[0]):r(null):this._unionShapeInBatches(e,t,r,i)}catch(e){i(e)}}),i)}iterator(e){return new j(this,e)}intersection(e,t=!1){return k._featuresetFunctions.intersection.bind(this)(e,t)}difference(e,t=!1,r=!0){return k._featuresetFunctions.difference.bind(this)(e,t,r)}symmetricDifference(e,t=!1,r=!0){return k._featuresetFunctions.symmetricDifference.bind(this)(e,t,r)}morphShape(e,t,r="unknown",i=null){return k._featuresetFunctions.morphShape.bind(this)(e,t,r,i)}morphShapeAndAttributes(e,t,r="unknown"){return k._featuresetFunctions.morphShapeAndAttributes.bind(this)(e,t,r)}union(e,t=!1){return k._featuresetFunctions.union.bind(this)(e,t)}intersects(e){return k._featuresetFunctions.intersects.bind(this)(e)}envelopeIntersects(e){return k._featuresetFunctions.envelopeIntersects.bind(this)(e)}contains(e){return k._featuresetFunctions.contains.bind(this)(e)}overlaps(e){return k._featuresetFunctions.overlaps.bind(this)(e)}relate(e,t){return k._featuresetFunctions.relate.bind(this)(e,t)}within(e){return k._featuresetFunctions.within.bind(this)(e)}touches(e){return k._featuresetFunctions.touches.bind(this)(e)}top(e){return k._featuresetFunctions.top.bind(this)(e)}crosses(e){return k._featuresetFunctions.crosses.bind(this)(e)}buffer(e,t,r,i=!0){return k._featuresetFunctions.buffer.bind(this)(e,t,r,i)}filter(e,t=null){return k._featuresetFunctions.filter.bind(this)(e,t)}orderBy(e){return k._featuresetFunctions.orderBy.bind(this)(e)}dissolve(e,t){return k._featuresetFunctions.dissolve.bind(this)(e,t)}groupby(e,t){return k._featuresetFunctions.groupby.bind(this)(e,t)}reduce(e,t=null,r){return Object(i.cH)(((i,n)=>{this._reduceImpl(this.iterator(this._defaultTracker(r)),e,t,0,i,n,0)}))}_reduceImpl(e,t,r,n,s,a,o){try{if(++o>1e3)return void setTimeout((()=>{o=0,this._reduceImpl(e,t,r,n,s,a,o)}));e.next().then((l=>{try{if(null===l)s(r);else{const c=t(r,l,n,this);Object(i.S)(c)?c.then((r=>{this._reduceImpl(e,t,r,n+1,s,a,o)}),a):this._reduceImpl(e,t,c,n+1,s,a,o)}}catch(e){a(e)}}),a)}catch(e){a(e)}}removeField(e){return k._featuresetFunctions.removeField.bind(this)(e)}addField(e,t,r=null){return k._featuresetFunctions.addField.bind(this)(e,t,r)}sumArea(e,t=!1,r){const i=Object(n.ac)(e);return this.reduce(((e,r)=>null===r.geometry?0:t?Object(s.g)(r.geometry,i).then((t=>e+t)):Object(s.o)(r.geometry,i).then((t=>e+t))),0,r)}sumLength(e,t=!1,r){const i=Object(n.ad)(e);return this.reduce(((e,r)=>null===r.geometry?0:t?Object(s.h)(r.geometry,i).then((t=>e+t)):Object(s.c)(r.geometry,i).then((t=>e+t))),0,r)}_substituteVars(e,t){if(null!==t){const r={};for(const e in t)r[e.toLowerCase()]=t[e];e.parameters=r}}distinct(e,t=1e3,r=null,i){return this.load().then((()=>{const n=a.WhereClause.create(e,this.getFieldsIndex());return this._substituteVars(n,r),this.calculateStatistic("distinct",n,t,this._defaultTracker(i))}))}min(e,t=null,r){return this.load().then((()=>{const i=a.WhereClause.create(e,this.getFieldsIndex());return this._substituteVars(i,t),this.calculateStatistic("min",i,-1,this._defaultTracker(r))}))}max(e,t=null,r){return this.load().then((()=>{const i=a.WhereClause.create(e,this.getFieldsIndex());return this._substituteVars(i,t),this.calculateStatistic("max",i,-1,this._defaultTracker(r))}))}avg(e,t=null,r){return this.load().then((()=>{const i=a.WhereClause.create(e,this.getFieldsIndex());return this._substituteVars(i,t),this.calculateStatistic("avg",i,-1,this._defaultTracker(r))}))}sum(e,t=null,r){return this.load().then((()=>{const i=a.WhereClause.create(e,this.getFieldsIndex());return this._substituteVars(i,t),this.calculateStatistic("sum",i,-1,this._defaultTracker(r))}))}stdev(e,t=null,r){return this.load().then((()=>{const i=a.WhereClause.create(e,this.getFieldsIndex());return this._substituteVars(i,t),this.calculateStatistic("stdev",i,-1,this._defaultTracker(r))}))}variance(e,t=null,r){return this.load().then((()=>{const i=a.WhereClause.create(e,this.getFieldsIndex());return this._substituteVars(i,t),this.calculateStatistic("variance",i,-1,this._defaultTracker(r))}))}count(e){return this.load().then((()=>this.calculateStatistic("count",a.WhereClause.create("1",this.getFieldsIndex()),-1,this._defaultTracker(e))))}_defaultTracker(e){return e||{aborted:!1}}forEach(e,t){return Object(i.cH)(((r,i)=>{this._forEachImpl(this.iterator(this._defaultTracker(t)),e,this,r,i,0)}))}_forEachImpl(e,t,r,n,s,a){try{if(++a>1e3)return void setTimeout((()=>{a=0,this._forEachImpl(e,t,r,n,s,a)}),0);e.next().then((o=>{try{if(null===o)n(r);else{const l=t(o);null==l?this._forEachImpl(e,t,r,n,s,a):Object(i.S)(l)?l.then((()=>{try{this._forEachImpl(e,t,r,n,s,a)}catch(e){s(e)}}),s):this._forEachImpl(e,t,r,n,s,a)}}catch(e){s(e)}}),s)}catch(e){s(e)}}convertToJSON(e){const t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}};for(let e=0;e<this.fields.length;e++)t.layerDefinition.fields.push(Object(n.ae)(this.fields[e]));return this.reduce(((e,r)=>{const i={geometry:r.geometry&&r.geometry.toJSON(),attributes:{}};for(const e in r.attributes)i.attributes[e]=r.attributes[e];return t.featureSet.features.push(i),1}),0,e).then((()=>t))}castToText(){return"object, FeatureSet"}queryAttachments(e,t,r,i){return this._parent.queryAttachments(e,t,r,i)}serviceUrl(){return this._parent.serviceUrl()}subtypes(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((e=>({name:e.name,code:e.id}))):[]}:null}relationshipMetaData(){return this._parent.relationshipMetaData()}get gdbVersion(){return this._parent?this._parent.gdbVersion:""}schema(){const e=[];for(const t of this.fields)e.push(Object(n.ae)(t));return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===n.af[this.geometryType]?"":n.af[this.geometryType],fields:e}}convertToText(e,t){return"schema"===e?this._ensureLoaded().then((()=>JSON.stringify(this.schema()))):"featureset"===e?this._ensureLoaded().then((()=>{const e=[];return this.reduce(((t,r)=>{const i={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==i.geometry&&i.geometry.spatialReference&&delete i.geometry.spatialReference,e.push(i),1}),0,t).then((()=>{const t=this.schema();return t.features=e,t.spatialReference=this.spatialReference.toJSON(),JSON.stringify(t)}))})):Object(i.cI)(this.castToText())}getFeatureByObjectId(e,t){return this._parent.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._parent.getOwningSystemUrl()}getIdentityUser(){return this._parent.getIdentityUser()}}k._featuresetFunctions={};class U extends k{constructor(e){super(e),this.declaredClass="esri.layers.featureset.sources.Empty",this._maxProcessing=1e3,this._wset=new c([],[],!1,null),this._parent=e.parentfeatureset,this._databaseType=n.a4.Standardised}_getSet(){return Object(i.cI)(this._wset)}optimisePagingFeatureQueries(){}_isInFeatureSet(){return n.a1.NotInFeatureSet}_getFeature(){return Object(i.af)(new Error("No Feature Found in EmptySet"))}queryAttachments(){return Object(i.cI)([])}_getFeatures(){return Object(i.cI)("success")}_featureFromCache(){return null}_fetchAndRefineFeatures(){return Object(i.af)(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(){return Object(i.cI)(new c([],[],!1,null))}_stat(e,t,r,i,n,s,a){return this._manualStat(e,t,s,a)}_canDoAggregates(){return Object(i.cI)(!1)}}class z extends k{constructor(e){super(e),this._relation="",this._relationGeom=null,this._relationString="",this.declaredClass="esri.arcade.featureset.actions.SpatialFilter",this._relationString=e.relationString,this._parent=e.parentfeatureset,this._maxProcessing=40,this._relation=e.relation,this._relationGeom=e.relationGeom}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,null,null,e))).then((t=>(this._checkCancelled(e),this._wset=new c(t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset))):Object(i.cI)(this._wset)}_isInFeatureSet(e){let t=this._parent._isInFeatureSet(e);return t===n.a1.NotInFeatureSet?t:(t=this._idstates[e],void 0===t?n.a1.Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,i){return this._parent._getFeatures(e,t,r,i)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeSpatialRelationTest(e){if(null===e.geometry)return Object(i.cI)(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":{const t=Object(n.ag)(this._relationGeom),r=Object(n.ag)(e.geometry);return Object(s.r)(t,r)}case"esriSpatialRelIntersects":return Object(s.r)(this._relationGeom,e.geometry);case"esriSpatialRelContains":return Object(s.x)(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return Object(s.i)(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return Object(s.B)(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return Object(s.a)(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return Object(s.A)(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return Object(s.s)(this._relationGeom,e.geometry,this._relationString)}}_fetchAndRefineFeatures(e,t,r){const s=new c([],e,!1,null),a=Math.min(t,e.length);return this._parent._getFeatures(s,-1,a,r).then((()=>{this._checkCancelled(r);const t=[];for(let r=0;r<a;r++){const i=this._parent._featureFromCache(e[r]);t.push(this.executeSpatialRelationTest(i))}return Object(i.cD)(t)})).then((r=>{for(let i=0;i<t;i++)!0===r[i]?this._idstates[e[i]]=n.a1.InFeatureSet:this._idstates[e[i]]=n.a1.NotInFeatureSet;return"success"}))}_getFilteredSet(e,t,r,i,n){return this._ensureLoaded().then((()=>this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,r,i,n))).then((e=>{let r;return this._checkCancelled(n),r=null!==t?new c(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):new c(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),r}))}_stat(e,t,r,n,s,a,o){return""!==r?Object(i.cI)({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,s,a,o).then((i=>!1===i.calculated?null===s&&""===r&&null===n?this._manualStat(e,t,a,o):{calculated:!1}:i))}_canDoAggregates(e,t,r,n,s){return""!==r||null!==n||null===this._parent?Object(i.cI)(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,s)}_getAggregatePagesDataSourceDefinition(e,t,r,n,s,a,o){return null===this._parent?Object(i.af)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,s,a,o)}static registerAction(){k._featuresetFunctions.intersects=function(e){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},k._featuresetFunctions.envelopeIntersects=function(e){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},k._featuresetFunctions.contains=function(e){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},k._featuresetFunctions.overlaps=function(e){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},k._featuresetFunctions.within=function(e){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},k._featuresetFunctions.touches=function(e){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},k._featuresetFunctions.crosses=function(e){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},k._featuresetFunctions.relate=function(e,t){return null==e?new U({parentfeatureset:this}):new z({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}}},,function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(0),n=(r(1),r(372));const s=e=>{let t=class extends e{attach(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`),this._bitmapView=new n.a(this._tileInfoView),this.container.addChild(this._bitmapView)}detach(){this.container.removeChild(this._bitmapView),this._bitmapView.removeAllChildren()}};return t=Object(i.e)([Object(i.i)("esri.views.2d.layers.BitmapTileLayerView2D")],t),t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return l})),r.d(t,"g",(function(){return c})),r.d(t,"h",(function(){return d}));var i=r(0),n=r(375);const s=new Map,a=new class{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){const e=i.get(r);return e.refCount--,e.refCount<=0&&(i.delete(r),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){const e=i.get(r);return e.ts=Date.now(),e.refCount++,i.delete(r),i.set(r,e),e.block}return null}putBlock(e,t,r,i=null){const n=this._cachedBlocks,s=e+"/"+t;if(n.has(s)){const e=n.get(s);e.ts=Date.now(),e.refCount++}else n.set(s,{block:r,ts:Date.now(),refCount:1,controller:i});this.trim(),this.updateTimer()}deleteBlock(e,t){const r=this._cachedBlocks,i=e+"/"+t;r.has(i)&&r.delete(i)}updateMaxSize(e){this._size=e,this.trim()}empty(){this._cachedBlocks.clear(),this.clearTimer()}getCurrentSize(){return this._cachedBlocks.size}updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const t=Array.from(e),r=Date.now();for(let i=0;i<t.length&&t[i][1].ts<=r-this._duration;i++)e.delete(t[i][0]);0===e.size&&this.clearTimer()}),this._interval)}trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let r=0;r<t.length-this._size;r++)e.delete(t[r][0])}clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function o(e,t){return null==t?e:`${e}?sliceId=${t}`}function l(e,t){const r={extent:null,rasterInfo:t,cache:new Map};if(s.has(e)){const t=s.get(e);return t.push(r),t.length-1}return s.set(e,[r]),0}function c(e,t){if(s.has(e)){const r=s.get(e);r[t]=null,r.some((e=>null!=e))||s.delete(e)}}function u(e,t,r){if(!s.has(e))return null==t?a.decreaseRefCount(e,r):0;const i=s.get(e);if(null==i[t])return a.decreaseRefCount(e,r);const n=i[t].cache;if(n.has(r)){const e=n.get(r);if(e.refCount--,0===e.refCount){n.delete(r);for(let e=0;e<i.length;e++)i[e]&&i[e].cache.has(r)&&i[e].cache.delete(r);e.controller&&e.controller.abort()}return e.refCount}return 0}function h(e,t,r){if(!s.has(e))return null==t?a.getBlock(e,r):null;const i=s.get(e);if(null==i[t]){for(let e=0;e<i.length;e++)if(i[e]&&i[e].cache.has(r)){const t=i[e].cache.get(r);return t.refCount++,t.block}return a.getBlock(e,r)}const n=i[t].cache;if(n.has(r)){const e=n.get(r);return e.refCount++,e.block}for(let e=0;e<i.length;e++)if(e!==t&&i[e]&&i[e]&&i[e].cache.has(r)){const t=i[e].cache.get(r);return t.refCount++,n.set(r,t),t.block}return null}function d(e,t,r,i,n=null){if(!s.has(e))return void(null==t&&a.putBlock(e,r,i,n));const o=s.get(e);if(null==o[t])return void a.putBlock(e,r,i,n);const l={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:n};i.then((()=>l.isResolved=!0)).catch((()=>l.isRejected=!0)),o[t].cache.set(r,l)}function f(e,t,r){if(!s.has(e))return void(null==t&&a.deleteBlock(e,r));const i=s.get(e);null!=i[t]?i[t].cache.delete(r):a.deleteBlock(e,r)}function p(e,t){if(!s.has(e))return null;const r=s.get(e);return null==r[t]?null:r[t]}function y(e,t,r,s,a,o,l=null){const c=p(e,t),u=c.extent,{cache:h,rasterInfo:d}=c;if(u&&u.xmin===r.xmin&&u.xmax===r.xmax&&u.ymin===r.ymin&&u.ymax===r.ymax)return;const f=r.clone().normalize(),{spatialReference:y,transform:g}=d,m=new Set;for(let e=0;e<f.length;e++){const t=f[e];if(t.xmax-t.xmin<=s||t.ymax-t.ymin<=s)continue;let r=Object(n.e)(t,y,l);Object(i.P)(g)&&(r=g.inverseTransform(r));const c=new i._({x:s,y:s,spatialReference:t.spatialReference});if(null==a&&!(a=Object(n.a)(c,y,t,l)))return;const{pyramidLevel:u,pyramidResolution:h,excessiveReading:p}=Object(n.g)(a,d,o||"closest");if(p)return;const{storageInfo:b}=d,{origin:_}=b,x={x:Math.max(0,Math.floor((r.xmin-_.x)/h.x)),y:Math.max(0,Math.floor((_.y-r.ymax)/h.y))},v=Math.ceil((r.xmax-r.xmin)/h.x-.1),w=Math.ceil((r.ymax-r.ymin)/h.y-.1),O=u>0?b.pyramidBlockWidth:b.blockWidth,I=u>0?b.pyramidBlockHeight:b.blockHeight,S=1,T=Math.max(0,Math.floor(x.x/O)-S),j=Math.max(0,Math.floor(x.y/I)-S),E=Math.floor((x.x+v-1)/O)+S,A=Math.floor((x.y+w-1)/I)+S;for(let e=j;e<=A;e++)for(let t=T;t<=E;t++)m.add(`${u}/${e}/${t}`)}h.forEach(((e,t)=>{if(!m.has(t)){const e=h.get(t);(null==e||e.isResolved||e.isRejected)&&h.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return y}));var i=r(1),n=r(0),s=r(3),a=r(49),o=r(53),l=r(336);const c={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function u(e){const t=e.folders||[],r=t.slice(),n=new Map,s=new Map,a=new Map,o=new Map,l=new Map,u={esriGeometryPoint:s,esriGeometryPolyline:a,esriGeometryPolygon:o};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{const t=Object(i.o)(e);t.featureSet.features=[];const r=e.featureSet.geometryType;n.set(r,t);const l=e.layerDefinition.objectIdField;"esriGeometryPoint"===r?f(s,l,e.featureSet.features):"esriGeometryPolyline"===r?f(a,l,e.featureSet.features):"esriGeometryPolygon"===r&&f(o,l,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{l.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((i=>{const n=function(e,t,r){const i=function(e,t){let r;return t.some((t=>t.id===e&&(r=t,!0))),r}(e,r);return i&&(i.parentFolderId=t,i.networkLink=i),i}(i,t.id,e.networkLinks);n&&r.push(n)}))})),r.forEach((e=>{e.featureInfos&&(e.points=Object(i.o)(n.get("esriGeometryPoint")),e.polylines=Object(i.o)(n.get("esriGeometryPolyline")),e.polygons=Object(i.o)(n.get("esriGeometryPolygon")),e.mapImages=[],e.featureInfos.map((t=>{switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const r=u[t.type].get(t.id);r&&e[c[t.type]].featureSet.features.push(r);break}case"GroundOverlay":{const r=l.get(t.id);r&&e.mapImages.push(r);break}}})),e.fullExtent=y([e]))}));const h=y(r);return{folders:t,sublayers:r,extent:h}}function h(e,t,r,s){const a=n.bX&&n.bX.findCredential(e);e=Object(n.cs)(e,{token:a&&a.token});const o=i.l.kmlServiceUrl;return Object(n.C)(o,{query:{url:e,model:"simple",folders:"",refresh:0!==r||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:s})}function d(e,t,r=null,i=[]){const n=[],s={},a=t.sublayers,o=t.folders.map((e=>e.id));return a.forEach((t=>{const a=new e;if(r?a.read(t,r):a.read(t),i.length&&o.indexOf(a.id)>-1&&(a.visible=-1!==i.indexOf(a.id)),s[t.id]=a,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=s[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(a)}else n.unshift(a)})),n}function f(e,t,r){r.forEach((r=>{e.set(r.attributes[t],r)}))}async function p(e){const t=o.default.fromJSON(e.featureSet).features,r=e.layerDefinition,i=Object(a.c)(r.drawingInfo.renderer),n=s.a.fromJSON(e.popupInfo),l=[];for(const e of t){const t=await i.getSymbolAsync(e);e.symbol=t,e.popupTemplate=n,e.visible=!0,l.push(e)}return l}function y(e){const t=Object(l.f)(),r=Object(l.f)(l.c);for(const i of e){if(i.polygons&&i.polygons.featureSet&&i.polygons.featureSet.features)for(const e of i.polygons.featureSet.features)Object(n.ct)(t,e.geometry),Object(l.g)(r,t);if(i.polylines&&i.polylines.featureSet&&i.polylines.featureSet.features)for(const e of i.polylines.featureSet.features)Object(n.ct)(t,e.geometry),Object(l.g)(r,t);if(i.points&&i.points.featureSet&&i.points.featureSet.features)for(const e of i.points.featureSet.features)Object(n.ct)(t,e.geometry),Object(l.g)(r,t);if(i.mapImages)for(const e of i.mapImages)Object(n.ct)(t,e.extent),Object(l.g)(r,t)}return Object(l.i)(r,l.c)?null:{xmin:r[0],ymin:r[1],zmin:r[2],xmax:r[3],ymax:r[4],zmax:r[5],spatialReference:n.A.WGS84}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(0),n=(r(1),r(23)),s=r(40),a=r(366);const o={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let l=class extends(Object(s.a)(i.u)){constructor(e){super(e),this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&Object(a.c)(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(o[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,t)=>(e[t.id]=t.definitionExpression,e)),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,r=t=>{const i=this.scale,n=0===i,s=0===t.minScale||i<=t.minScale,a=0===t.maxScale||i>=t.maxScale;t.visible&&(n||s&&a)&&(t.sublayers?t.sublayers.forEach(r):e.unshift(t))};t&&t.forEach(r);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some(((t,r)=>e[r]!==t))?e:i}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"dynamicLayers",null),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"hasDynamicLayers",null),Object(i.e)([Object(i.y)()],l.prototype,"layer",null),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"layers",null),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"layerDefs",null),Object(i.e)([Object(i.y)({type:Number})],l.prototype,"scale",void 0),Object(i.e)([Object(i.y)(n.n)],l.prototype,"timeExtent",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"version",null),Object(i.e)([Object(i.y)({readOnly:!0})],l.prototype,"visibleSublayers",null),l=Object(i.e)([Object(i.i)("esri.layers.mixins.ExportImageParameters")],l)},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=r(351),s=r(54);class a{constructor(e){if(e instanceof n.a)this._tilemapCache=e;else{if(!e||!("index"in e))throw new Error("Invalid tilemap!");this._tilemap=e.index}}dataKey(e,t){if(this._tilemapCache){const{level:r,row:n,col:a}=e,o=new s.a(e);return this._tilemapCache.fetchAvailabilityUpsample(r,n,a,o,t).then((()=>(o.world=e.world,o))).catch((e=>{if(Object(i.B)(e))throw e;return null}))}return this._getIndexedDataKey(e)}forEach(e,t,r,i,n){this._callback=n,this._maxLevel=t+e,this._forEach(this._tilemap,t,r,i)}_forEach(e,t,r,i){0!==e&&(this._callback(t,r,i),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*r,2*i),this._forEach(e[1],t+1,2*r,2*i+1),this._forEach(e[2],t+1,2*r+1,2*i),this._forEach(e[3],t+1,2*r+1,2*i+1)))}_getIndexedDataKey(e){const t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return Promise.resolve(null);let r=e;for(;0!==r.level;)r=new s.a(r.level-1,r.row>>1,r.col>>1,r.world),t.push(r);let i,n,a=this._tilemap,o=t.pop();if(1===a)return Promise.resolve(o);for(;t.length;)if(i=t.pop(),n=(1&i.col)+((1&i.row)<<1),a){if(0===a[n]){o=null;break}if(1===a[n]){o=i;break}o=i,a=a[n]}return Promise.resolve(o)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=(r(1),r(40));const s={visible:"visibleSublayers"};let a=class extends(Object(n.a)(i.u)){constructor(e){super(e),this.scale=0}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.sublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("wms-sublayer-update",(e=>this.notifyChange(s[e.propertyName])))],"layer"))}get layers(){const{visibleSublayers:e}=this;return e.filter((e=>e.name)).map((e=>e.name)).join(",")}get version(){this.commitProperty("layers");const e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}get visibleSublayers(){const{layer:e,scale:t}=this,r=null==e?void 0:e.sublayers,i=[],n=e=>{const{minScale:r,maxScale:s,sublayers:a,visible:o}=e;o&&(0===t||(0===r||t<=r)&&(0===s||t>=s))&&(a?a.forEach(n):i.unshift(e))};return null==r||r.forEach(n),i}toJSON(){const{layer:e,layers:t}=this,{imageFormat:r,imageTransparency:i,version:n}=e;return{format:r,request:"GetMap",service:"WMS",styles:"",transparent:i,version:n,layers:t}}};Object(i.e)([Object(i.y)()],a.prototype,"layer",null),Object(i.e)([Object(i.y)({readOnly:!0})],a.prototype,"layers",null),Object(i.e)([Object(i.y)({type:Number})],a.prototype,"scale",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],a.prototype,"version",null),Object(i.e)([Object(i.y)({readOnly:!0})],a.prototype,"visibleSublayers",null),a=Object(i.e)([Object(i.i)("esri.layers.support.ExportWMSImageParameters")],a)},function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return v}));var i=r(0),n=r(17);function s(e){const t=[];return e.forEach((e=>t.push(e))),t}const a={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*o(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*l(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function c(e){for(;;){const{value:t,done:r}=e.next();if(r)return!1;if(t.length>2)return!0}}function u(e){let t=0;for(let r=0;r<e.length;r++){const i=e[r],n=e[(r+1)%e.length];t+=i[0]*n[1]-n[0]*i[1]}return t<=0}function h(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function d(e,t,r){switch(t.type){case"LineString":return function(e,t,r){return y(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const i of t.coordinates)y(e,i,r);return e}(e,t,r);case"MultiPoint":return function(e,t,r){return y(e,t.coordinates,r),e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const i of t.coordinates){f(e,i[0],r);for(let t=1;t<i.length;t++)p(e,i[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return m(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const i=t.coordinates;f(e,i[0],r);for(let t=1;t<i.length;t++)p(e,i[t],r);return e}(e,t,r)}}function f(e,t,r){const i=h(t);!function(e){return!u(e)}(i)?y(e,i,r):g(e,i,r)}function p(e,t,r){const i=h(t);!function(e){return u(e)}(i)?y(e,i,r):g(e,i,r)}function y(e,t,r){for(const i of t)m(e,i,r);e.lengths.push(t.length)}function g(e,t,r){for(let i=t.length-1;i>=0;i--)m(e,t[i],r);e.lengths.push(t.length)}function m(e,t,r){const[i,n,s]=t;e.coords.push(i,n),r.hasZ&&e.coords.push(s||0)}function b(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function _(e){if(!e)throw new i.s("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new i.s("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const r="string"==typeof t?t:"name"===t.type?t.properties.name:null,n=new RegExp(".*(CRS84H?|4326)$","i");if(!r||!n.test(r))throw new i.s("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function x(e,t={}){const r=o(e),i=[],n=new Set,u=new Set;let h,d=!1,f=Number.NEGATIVE_INFINITY,p=null,y=!1,{geometryType:g=null}=t,m=!1;for(;;){const{value:e,done:t}=r.next();if(t){const e=p&&1===p.length&&p[0]||null;if(e)for(const t of i)t.name===e&&(t.type="esriFieldTypeOID");return{fields:i,geometryType:g,hasZ:d,maxObjectId:Math.max(0,f),objectIdFieldName:e,objectIdFieldType:h,unknownFields:s(u)}}const{geometry:o,properties:_,id:x}=e;if((!o||(g||(g=a[o.type]),a[o.type]===g))&&(d||(d=c(l(o))),y||(y=null!=x,y&&(h=typeof x,"number"===h&&(p=Object.keys(_).filter((e=>_[e]===x))))),y&&"number"===h&&null!=x&&(f=Math.max(f,x),p.length>1?p=p.filter((e=>_[e]===x)):1===p.length&&(p=_[p[0]]===x?p:[])),!m&&_)){let e=!0;for(const t in _){if(n.has(t))continue;const r=_[t];if(null==r){e=!1,u.add(t);continue}const s=b(r);"unknown"!==s?(u.delete(t),n.add(t),i.push({name:t,alias:t,type:s})):u.add(t)}m=e}}}function v(e,t){return function(e){const t=[];for(;;){const{value:r,done:i}=e.next();if(i)return t;t.push(r)}}(function*(e,t={}){const{geometryType:r,objectIdFieldName:i}=t;for(;;){const{value:s,done:o}=e.next();if(o)return;const{geometry:l,properties:c,id:u}=s;if(l&&a[l.type]!==r)continue;const h=c||{};i&&null!=u&&!h[i]&&(h[i]=u);const f=new n.c(l?d(new n.a,l,t):null,h);yield f}}(o(e),t))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return y}));var i=r(0),n=r(6);class s{constructor(){this.code=null,this.description=null}}class a{constructor(e){this.error=new s,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function o(e){return new a(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new l(e)}const u=new Set;function h(e,t,r,i,s=!1,a){u.clear();for(const t in i){const l=e.get(t);if(!l)continue;const c=i[t],h=d(l,c);if(h!==c&&a&&a.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:l,originalValue:c,sanitizedValue:h}}),u.add(l.name),l&&(s||l.editable)){const e=Object(n.z)(l,h);if(e)return o(Object(n.A)(e,l,h));r[l.name]=h}}for(const e of t)if(!u.has(e.name))return o(`missing required field "${e.name}"`);return null}function d(e,t){let r=t;return"string"==typeof t&&Object(n.j)(e)?r=parseFloat(t):null!=t&&Object(n.a)(e)&&"string"!=typeof t&&(r=String(t)),Object(n.v)(r)}let f;function p(e,t){if(!e||!Object(i.an)(t))return e;if("rings"in e||"paths"in e){if(!f)throw new TypeError("geometry engine not loaded");return f.simplify(t,e)}return e}async function y(e,t){!Object(i.an)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return f||(f=await Promise.all([r.e(5),r.e(0),r.e(9)]).then(r.bind(null,391)),f)}()}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const i=1;function n(e,t){let r=0;for(const n of t){var i;const t=null==(i=n.attributes)?void 0:i[e];"number"==typeof t&&isFinite(t)&&(r=Math.max(r,t))}return r}},function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return m}));var i=r(1),n=r(0),s=r(355),a=r(336),o=r(339),l=r(6),c=r(109),u=r(322);const h=r.e(167).then(r.bind(null,517));class d{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}invalidate(){this._bitsets.computed.clear()}async updateSchema(e,t){const r=Object(c.b)(this._schema,t);if(this._schema=t,!t||Object(n.J)(r)||!Object(c.a)(r,"attributes"))return;Object(i.a)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",r),this._bitsets.computed.clear(),e.targets[t.name]=!0;const s=t.attributes,a=[],o=[];for(const e in s){const t=s[e];switch(t.type){case"field":break;case"expression":a.push(this._createArcadeComputedField(t));break;case"label-expression":a.push(this._createLabelArcadeComputedField(t));break;case"statistic":o.push(t)}}this._computedFields=await Promise.all(a),this._canCacheExpressionValue=!this._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),this._statisticFields=o}setComputedAttributes(e,t,r,i){const n=this._bitsets.computed;if(!this._canCacheExpressionValue||!n.has(r)){n.set(r);for(const n of this._computedFields){const s=this._evaluateField(t,n,i);switch(n.resultType){case"numeric":e.setComputedNumericAtIndex(r,n.fieldIndex,s);break;case"string":e.setComputedStringAtIndex(r,n.fieldIndex,s)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fieldsIndex;return{...e,expression:await Object(l.t)(e.valueExpression,t,r)}}async _createLabelArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fields,{createLabelFunction:i}=await h,n=await i(e.label,r,t);return{...e,builder:n}}_evaluateField(e,t,r){switch(t.type){case"label-expression":{const r=e.readArcadeFeature();return t.builder.evaluate(r)||""}case"expression":{const{expression:i}=t;return function(e,t,r){e.referencesGeometry();const i=t.readArcadeFeature();try{return e.evaluate({...r,$feature:i})}catch(e){return n.n.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}(i,e,{$view:{scale:r}})}}}}class f extends u.a{constructor(e,t){super(u.a.createInstance()),this._currentIndex=-1,this._reader=e,this._indices=t}static from(e,t){return new f(e.copy(),t)}get hasNext(){return this._currentIndex+1<this._indices.length}getApproximateSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const e=new f(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e}next(){for(;this._nextIndex()&&!this._reader._passesFilter()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}setArcadeSpatialReference(e){this._reader.setArcadeSpatialReference(e)}attachStorage(e){this._reader.attachStorage(e)}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}getStorage(){return this._reader.getStorage()}getComputedNumeric(e){return this._reader.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this._reader.setComputedNumericAtIndex(t,0)}getComputedString(e){return this._reader.getComputedStringAtIndex(0)}setComputedString(e,t){return this._reader.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._reader.getComputedNumericAtIndex(e)}setComputedNumericAtIndex(e,t){this._reader.setComputedNumericAtIndex(e,t)}getComputedStringAtIndex(e){return this._reader.getComputedStringAtIndex(e)}setComputedStringAtIndex(e,t){return this._reader.setComputedStringAtIndex(e,t)}transform(e,t,r,i){const n=this.copy();return n._reader=this._reader.transform(e,t,r,i),n}extent(e,t,r,i){const n=this.copy();return n._reader=this._reader.extent(e,t,r,i),n}hasFilter(){return this._reader.hasFilter()}readAttribute(e,t=!1){return this._reader.readAttribute(e,t)}readAttributes(){return this._reader.readAttributes()}joinAttributes(e){return this._reader.joinAttributes(e)}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this.readAttribute(e,!0)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(){return this._reader.castToText()}getQuantizationTransform(){return this._reader.getQuantizationTransform()}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}getGroupId(){return this._reader.getGroupId()}setGroupId(e){return this._reader.setGroupId(e)}getXHydrate(){return this._reader.getXHydrate()}getYHydrate(){return this._reader.getYHydrate()}getX(){return this._reader.getX()}getY(){return this._reader.getY()}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readLegacyFeature(){return this._reader.readLegacyFeature()}readOptimizedFeature(){return this._reader.readOptimizedFeature()}readLegacyPointGeometry(){return this._reader.readLegacyPointGeometry()}readLegacyGeometry(){return this._reader.readLegacyGeometry()}readLegacyCentroid(){return this._reader.readLegacyCentroid()}readGeometryArea(){return this._reader.readGeometryArea()}readUnquantizedGeometry(){return this._reader.readUnquantizedGeometry()}readHydratedGeometry(){return this._reader.readHydratedGeometry()}readGeometry(){return this._reader.readGeometry()}readCentroid(){return this._reader.readCentroid()}_passesFilter(){return this._reader._passesFilter()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}}function p(e,t){return e<<16|t}function y(e){return(4294901760&e)>>>16}function g(e){return 65535&e}const m={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class b extends d{constructor(e,t,r){super(e,t),this.featureAdapter=m,this.events=new n.m,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._indexSearchCache=new s.a(50),this._index=Object(o.d)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)}))),this._storage=t,this.mode=r}get storage(){return this._storage}get storeStatistics(){return{featureCount:0,vertexCount:0}}hasInstance(e){return this._featureSetsByInstance.has(e)}onTileData(e,t){if(Object(n.J)(t.addOrUpdate))return t;if(t.addOrUpdate.attachStorage(this._storage),"snapshot"===this.mode){const r=t.addOrUpdate.getCursor();for(;r.next();){const t=r.getDisplayId();this.setComputedAttributes(this._storage,r,t,e.scale)}return t}this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate);const r=t.addOrUpdate.getCursor();for(;r.next();)this._insertFeature(r,e.scale);return this._spatialIndexInvalid=!0,this.events.emit("changed"),t}search(e){this._rebuildIndex();const t=e.id,r=this._indexSearchCache.find((e=>e.tileId===t));if(Object(n.P)(r))return r.readers;const i=new Map,s=this._searchIndex(e.bounds),a=[];for(const e of s){const t=this._storage.getInstanceId(e),r=y(t),n=g(t);i.has(r)||i.set(r,[]),i.get(r).push(n)}return i.forEach(((e,t)=>{const r=this._featureSetsByInstance.get(t);a.push(f.from(r,e))})),this._indexSearchCache.enqueue({tileId:t,readers:a}),a}insert(e){const t=e.getCursor(),r=this._storage;for(;t.next();){var i;const e=p(t.instance,t.getIndex()),n=t.getObjectId(),s=null!=(i=this._objectIdToDisplayId.get(n))?i:this._storage.createDisplayId();t.setDisplayId(s),r.setInstanceId(s,e),this._objectIdToDisplayId.set(n,s)}this._featureSetsByInstance.set(e.instance,e),this._spatialIndexInvalid=!0}remove(e){const t=this._objectIdToDisplayId.get(e);if(!t)return;const r=this._storage.getInstanceId(t),i=g(r),n=y(r),s=this._featureSetsByInstance.get(n);this._objectIdToDisplayId.delete(e),this._storage.releaseDisplayId(t),s.removeAtIndex(i),s.isEmpty&&this._featureSetsByInstance.delete(n),this._spatialIndexInvalid=!0}forEach(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),i=this._lookupFeature(r);e(i)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),i=y(r),n=g(r),s=this._getFeatureSet(i);s.setIndex(n),e(s)}))}forEachInBounds(e,t){const r=this._searchIndex(e);for(const e of r){const r=this.lookupFeatureByDisplayId(e,this._storage);t(Object(n.Y)(r))}}forEachBounds(e,t,r){this._rebuildIndex();const i=[0,0,0,0];for(const n of e){if(!n.readGeometry())continue;const e=n.getDisplayId();i[0]=this._storage.getXMin(e),i[1]=this._storage.getYMin(e),i[2]=this._storage.getXMax(e),i[3]=this._storage.getYMax(e),t(Object(a.e)(r,i))}}sweepFeatures(e,t,r){this._spatialIndexInvalid=!0,this._objectIdToDisplayId.forEach(((i,n)=>{e.has(i)||(t.releaseDisplayId(i),r&&r.unsetAttributeData(i),this._objectIdToDisplayId.delete(n))})),this.events.emit("changed")}sweepFeatureSets(e){this._spatialIndexInvalid=!0,this._featureSetsByInstance.forEach(((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)}))}lookupObjectId(e,t){const r=this.lookupFeatureByDisplayId(e,t);return Object(n.J)(r)?null:r.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const r=t.getInstanceId(e);return this._lookupFeature(r)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),r=y(t),i=g(t),n=this._getFeatureSet(r);return n?(n.setIndex(i),n):null}_insertFeature(e,t){const r=this._storage,i=e.getObjectId(),n=p(e.instance,e.getIndex());r.getInstanceId(e.getDisplayId());let s=this._objectIdToDisplayId.get(i);s||(s=r.createDisplayId(),this._objectIdToDisplayId.set(i,s),this._spatialIndexInvalid=!0),e.setDisplayId(s),r.setInstanceId(s,n),this.setComputedAttributes(r,e,s,t)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;const e=[];"snapshot"===this.mode?this._featureSetsByInstance.forEach((t=>{const r=t.getCursor();for(;r.next();){const t=r.getDisplayId();this._storage.setBounds(t,r)&&e.push(t)}})):this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)})),this._index.clear(),this._index.load(e),this._indexSearchCache.clear(),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=y(e),r=g(e),i=this._getFeatureSet(t);if(!i)return null;const n=i.getCursor();return n.setIndex(r),n}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return L})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return M})),r.d(t,"d",(function(){return v}));var i,n=r(0),s=r(1),a=r(62);let o=i=class extends n.a{constructor(){super(...arguments),this.field=null,this.minValue=0,this.maxValue=255}clone(){return new i({field:this.field,minValue:this.minValue,maxValue:this.maxValue})}};Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],o.prototype,"field",void 0),Object(n.e)([Object(n.y)({type:Number,nonNullable:!0,json:{write:!0}})],o.prototype,"minValue",void 0),Object(n.e)([Object(n.y)({type:Number,nonNullable:!0,json:{write:!0}})],o.prototype,"maxValue",void 0),o=i=Object(n.e)([Object(n.i)("esri.renderers.support.pointCloud.ColorModulation")],o);var l=o;const c=new n.aM({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});let u=class extends n.a{};Object(n.e)([Object(n.y)({type:c.apiValues,readOnly:!0,nonNullable:!0,json:{type:c.jsonValues,read:!1,write:c.write}})],u.prototype,"type",void 0),u=Object(n.e)([Object(n.i)("esri.renderers.support.pointCloud.PointSizeAlgorithm")],u);var h,d=u;let f=h=class extends d{constructor(){super(...arguments),this.type="fixed-size",this.size=0,this.useRealWorldSymbolSizes=null}clone(){return new h({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})}};Object(n.e)([Object(n.r)({pointCloudFixedSizeAlgorithm:"fixed-size"})],f.prototype,"type",void 0),Object(n.e)([Object(n.y)({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"size",void 0),Object(n.e)([Object(n.y)({type:Boolean,json:{write:!0}})],f.prototype,"useRealWorldSymbolSizes",void 0),f=h=Object(n.e)([Object(n.i)("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],f);var p,y=f;let g=p=class extends d{constructor(){super(...arguments),this.type="splat",this.scaleFactor=1}clone(){return new p({scaleFactor:this.scaleFactor})}};Object(n.e)([Object(n.r)({pointCloudSplatAlgorithm:"splat"})],g.prototype,"type",void 0),Object(n.e)([Object(n.y)({type:Number,value:1,nonNullable:!0,json:{write:!0}})],g.prototype,"scaleFactor",void 0),g=p=Object(n.e)([Object(n.i)("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],g);const m={key:"type",base:d,typeMap:{"fixed-size":y,splat:g}},b=Object(n.aL)()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});let _=class extends n.a{constructor(e){super(e),this.type=void 0,this.pointSizeAlgorithm=null,this.colorModulation=null,this.pointsPerInch=10}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}cloneProperties(){return{pointSizeAlgorithm:Object(s.o)(this.pointSizeAlgorithm),colorModulation:Object(s.o)(this.colorModulation),pointsPerInch:Object(s.o)(this.pointsPerInch)}}};Object(n.e)([Object(n.y)({type:b.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],_.prototype,"type",void 0),Object(n.e)([Object(n.y)({types:m,json:{write:!0}})],_.prototype,"pointSizeAlgorithm",void 0),Object(n.e)([Object(n.y)({type:l,json:{write:!0}})],_.prototype,"colorModulation",void 0),Object(n.e)([Object(n.y)({json:{write:!0},nonNullable:!0,type:Number})],_.prototype,"pointsPerInch",void 0),_=Object(n.e)([Object(n.i)("esri.renderers.PointCloudRenderer")],_),(_||(_={})).fieldTransformTypeKebabDict=new n.aM({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});var x,v=_;let w=x=class extends n.a{constructor(){super(...arguments),this.description=null,this.label=null,this.minValue=0,this.maxValue=0,this.color=null}clone(){return new x({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:Object(s.o)(this.color)})}};Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],w.prototype,"description",void 0),Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],w.prototype,"label",void 0),Object(n.e)([Object(n.y)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],w.prototype,"minValue",void 0),Object(n.e)([Object(n.y)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],w.prototype,"maxValue",void 0),Object(n.e)([Object(n.y)({type:n.j,json:{type:[n.N],write:!0}})],w.prototype,"color",void 0),w=x=Object(n.e)([Object(n.i)("esri.renderers.support.pointCloud.ColorClassBreakInfo")],w);var O,I=w;let S=O=class extends v{constructor(e){super(e),this.type="point-cloud-class-breaks",this.field=null,this.legendOptions=null,this.fieldTransformType=null,this.colorClassBreakInfos=null}clone(){return new O({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:Object(s.o)(this.colorClassBreakInfos),legendOptions:Object(s.o)(this.legendOptions)})}};Object(n.e)([Object(n.r)({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],S.prototype,"type",void 0),Object(n.e)([Object(n.y)({json:{write:!0},type:String})],S.prototype,"field",void 0),Object(n.e)([Object(n.y)({type:a.a,json:{write:!0}})],S.prototype,"legendOptions",void 0),Object(n.e)([Object(n.y)({type:v.fieldTransformTypeKebabDict.apiValues,json:{type:v.fieldTransformTypeKebabDict.jsonValues,read:v.fieldTransformTypeKebabDict.read,write:v.fieldTransformTypeKebabDict.write}})],S.prototype,"fieldTransformType",void 0),Object(n.e)([Object(n.y)({type:[I],json:{write:!0}})],S.prototype,"colorClassBreakInfos",void 0),S=O=Object(n.e)([Object(n.i)("esri.renderers.PointCloudClassBreaksRenderer")],S);var T,j=S;let E=T=class extends v{constructor(e){super(e),this.type="point-cloud-stretch",this.field=null,this.legendOptions=null,this.fieldTransformType=null,this.stops=null}clone(){return new T({...this.cloneProperties(),field:Object(s.o)(this.field),fieldTransformType:Object(s.o)(this.fieldTransformType),stops:Object(s.o)(this.stops),legendOptions:Object(s.o)(this.legendOptions)})}};Object(n.e)([Object(n.r)({pointCloudStretchRenderer:"point-cloud-stretch"})],E.prototype,"type",void 0),Object(n.e)([Object(n.y)({json:{write:!0},type:String})],E.prototype,"field",void 0),Object(n.e)([Object(n.y)({type:a.a,json:{write:!0}})],E.prototype,"legendOptions",void 0),Object(n.e)([Object(n.y)({type:v.fieldTransformTypeKebabDict.apiValues,json:{type:v.fieldTransformTypeKebabDict.jsonValues,read:v.fieldTransformTypeKebabDict.read,write:v.fieldTransformTypeKebabDict.write}})],E.prototype,"fieldTransformType",void 0),Object(n.e)([Object(n.y)({type:[a.b],json:{write:!0}})],E.prototype,"stops",void 0),E=T=Object(n.e)([Object(n.i)("esri.renderers.PointCloudStretchRenderer")],E);var A,M=E;let R=A=class extends n.a{constructor(){super(...arguments),this.description=null,this.label=null,this.values=null,this.color=null}clone(){return new A({description:this.description,label:this.label,values:Object(s.o)(this.values),color:Object(s.o)(this.color)})}};Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],R.prototype,"description",void 0),Object(n.e)([Object(n.y)({type:String,json:{write:!0}})],R.prototype,"label",void 0),Object(n.e)([Object(n.y)({type:[String],json:{write:!0}})],R.prototype,"values",void 0),Object(n.e)([Object(n.y)({type:n.j,json:{type:[n.N],write:!0}})],R.prototype,"color",void 0),R=A=Object(n.e)([Object(n.i)("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],R);var F,C=R;let D=F=class extends v{constructor(e){super(e),this.type="point-cloud-unique-value",this.field=null,this.fieldTransformType=null,this.colorUniqueValueInfos=null,this.legendOptions=null}clone(){return new F({...this.cloneProperties(),field:Object(s.o)(this.field),fieldTransformType:Object(s.o)(this.fieldTransformType),colorUniqueValueInfos:Object(s.o)(this.colorUniqueValueInfos),legendOptions:Object(s.o)(this.legendOptions)})}};Object(n.e)([Object(n.r)({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],D.prototype,"type",void 0),Object(n.e)([Object(n.y)({json:{write:!0},type:String})],D.prototype,"field",void 0),Object(n.e)([Object(n.y)({type:v.fieldTransformTypeKebabDict.apiValues,json:{type:v.fieldTransformTypeKebabDict.jsonValues,read:v.fieldTransformTypeKebabDict.read,write:v.fieldTransformTypeKebabDict.write}})],D.prototype,"fieldTransformType",void 0),Object(n.e)([Object(n.y)({type:[C],json:{write:!0}})],D.prototype,"colorUniqueValueInfos",void 0),Object(n.e)([Object(n.y)({type:a.a,json:{write:!0}})],D.prototype,"legendOptions",void 0),D=F=Object(n.e)([Object(n.i)("esri.renderers.PointCloudUniqueValueRenderer")],D);var L=D},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(0);function n(e){return{origin:"portal-item",url:Object(i.U)(e.itemUrl),portal:e.portal||i.aT.getDefault(),portalItem:e,readResourcePaths:[]}}},function(e,t){},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));r(25);var i=r(0),n=r(115);const s={attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsStatistics:!1,tileMaxRecordCount:0}};class a{constructor(e,t,r){this.parsedUrl=e,this.portalItem=t,this.signal=r,this.rootDocument=null;const i=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);i&&(this.urlParts={root:i[1],layerId:parseInt(i[2],10)})}async fetch(){var e;if(!this.urlParts)return null;const t=null!=(e=this.portalItem)?e:await this.portalItemFromServiceItemId();if(Object(i.J)(t))return this.loadFromUrl();const r=await this.findAndLoadRelatedPortalItem(t);return Object(i.J)(r)?null:this.loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){var e;if(!this.urlParts)return null;const t=null!=(e=this.portalItem)?e:await this.portalItemFromServiceItemId();return Object(i.J)(t)?null:this.findAndLoadRelatedPortalItem(t)}async fetchRootDocument(){if(Object(i.P)(this.rootDocument))return this.rootDocument;if(Object(i.J)(this.urlParts))return this.rootDocument={},{};const e={query:{f:"json"},responseType:"json",signal:this.signal},t=`${this.urlParts.root}/SceneServer`;try{const r=await Object(i.C)(t,e);this.rootDocument=r.data}catch{this.rootDocument={}}return this.rootDocument}async fetchServiceOwningPortalUrl(){var e;const t=null==(e=i.bX)?void 0:e.findServerInfo(this.parsedUrl.path);if(null!=t&&t.owningSystemUrl)return t.owningSystemUrl;const r=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const e=(await Object(i.C)(r,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(e)return e}catch(e){Object(i.bR)(e)}return null}async findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find((e=>"Feature Service"===e.type))||null}catch(e){return Object(i.bR)(e),null}}async loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const t=await this.findMatchingAssociatedSublayerUrl(e.url);return new n.k({url:t,portalItem:e}).load({signal:this.signal})}async loadFromUrl(){const e=await this.findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new n.k({url:e}).load({signal:this.signal})}async findMatchingAssociatedSublayerUrl(e){const t=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),r={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},n=this.urlParts.layerId,s=this.fetchRootDocument(),a=Object(i.C)(t,r),[o,l]=await Promise.all([a,s]),c=l&&l.layers,u=o.data&&o.data.layers;if(!Array.isArray(u))throw new Error("expected layers array");if(Array.isArray(c)){for(let e=0;e<Math.min(c.length,u.length);e++)if(c[e].id===n)return`${t}/${u[e].id}`}else if(n<u.length)return`${t}/${u[n].id}`;throw new Error("could not find matching associated sublayer")}async portalItemFromServiceItemId(){const e=(await this.fetchRootDocument()).serviceItemId;if(!e)return null;const t=new i.bK({id:e}),r=await this.fetchServiceOwningPortalUrl();Object(i.P)(r)&&(t.portal=new i.aT({url:r}));try{return t.load({signal:this.signal})}catch(e){return Object(i.bR)(e),null}}}},,function(e,t,r){"use strict";r.d(t,"a",(function(){return le})),r.d(t,"b",(function(){return ee})),r.d(t,"c",(function(){return te})),r.d(t,"d",(function(){return V})),r.d(t,"e",(function(){return G})),r.d(t,"f",(function(){return N})),r.d(t,"g",(function(){return P})),r.d(t,"h",(function(){return K})),r.d(t,"i",(function(){return $})),r.d(t,"j",(function(){return I})),r.d(t,"k",(function(){return k}));r(18);var i=r(0),n=r(1),s=r(349),a=r(72),o=(r(10),r(21)),l=r(380),c=r(4),u=r(20),h=r(85),d=r(106),f=r(374),p=r(66),y=r(51);let g=class extends i.a{constructor(){super(...arguments),this.value=null,this.label=null,this.color=null}};Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],g.prototype,"value",void 0),Object(i.e)([Object(i.y)({type:String,json:{write:!0}})],g.prototype,"label",void 0),Object(i.e)([Object(i.y)({type:i.j,json:{type:[i.N],write:!0}})],g.prototype,"color",void 0),g=Object(i.e)([Object(i.i)("esri.renderers.support.ColormapInfo")],g);var m,b=g;let _=m=class extends i.a{constructor(e){super(e),this.colormapInfos=null,this.type="raster-colormap"}static createFromColormap(e,t){if(!e)return null;function r(e){return t?t[e]||"":String(e[0])}const i=5===e[0].length,n=e.sort((e=>e[0][0]-e[1][0])),s=i?n.map((e=>b.fromJSON({value:e[0],color:e.slice(1,5),label:r(e[0])}))):n.map((e=>b.fromJSON({value:e[0],color:e.slice(1,4).concat([255]),label:r(e[0])})));return new m({colormapInfos:s})}static createFromColorramp(e){const t=Object(l.h)(e,256);return m.createFromColormap(t)}clone(){return new m({colormapInfos:this.colormapInfos.map((e=>e.toJSON()))})}extractColormap(){return this.colormapInfos.map((e=>[e.value,e.color.r,e.color.g,e.color.b,e.color.a>1?e.color.a:255*e.color.a&255])).sort(((e,t)=>e[0]-t[0]))}};Object(i.e)([Object(i.y)({type:[b],json:{write:!0}})],_.prototype,"colormapInfos",void 0),Object(i.e)([Object(i.r)({rasterColormap:"raster-colormap"})],_.prototype,"type",void 0),_=m=Object(i.e)([Object(i.i)("esri.renderers.RasterColormapRenderer")],_);var x,v=_;let w=x=class extends i.a{constructor(e){super(e),this.altitude=45,this.azimuth=315,this.colorRamp=null,this.hillshadeType="multi-directional",this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.scalingType="none",this.type="raster-shaded-relief",this.zFactor=1}readColorRamp(e){return Object(o.m)(e)}clone(){return new x({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,scalingType:this.scalingType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,colorRamp:Object(n.o)(this.colorRamp)})}};Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],w.prototype,"altitude",void 0),Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],w.prototype,"azimuth",void 0),Object(i.e)([Object(i.y)({types:o.d,json:{write:!0}})],w.prototype,"colorRamp",void 0),Object(i.e)([Object(i.a1)("colorRamp")],w.prototype,"readColorRamp",null),Object(i.e)([Object(i.y)({type:["traditional","multi-directional"],json:{write:!0}})],w.prototype,"hillshadeType",void 0),Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],w.prototype,"pixelSizePower",void 0),Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],w.prototype,"pixelSizeFactor",void 0),Object(i.e)([Object(i.y)({type:["none","adjusted"],json:{write:!0}})],w.prototype,"scalingType",void 0),Object(i.e)([Object(i.r)({rasterShadedRelief:"raster-shaded-relief"})],w.prototype,"type",void 0),Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],w.prototype,"zFactor",void 0),w=x=Object(i.e)([Object(i.i)("esri.renderers.RasterShadedReliefRenderer")],w);var O=w;const I=new i.aM({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),S={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"};var T;let j=T=class extends i.a{constructor(e){super(e),this.colorRamp=null,this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.maxPercent=null,this.minPercent=null,this.numberOfStandardDeviations=null,this.outputMax=null,this.outputMin=null,this.sigmoidStrengthLevel=null,this.statistics=[],this.histograms=null,this.useGamma=!1,this.stretchType="none",this.type="raster-stretch"}readColorRamp(e){if(e)return Object(o.m)(e)}writeStatistics(e,t,r){var i;null!=(i=e)&&i.length&&(Array.isArray(e[0])||(e=e.map((e=>[e.min,e.max,e.avg,e.stddev]))),t[r]=e)}readStretchType(e,t){let r=t.stretchType;return"number"==typeof r&&(r=S[r]),I.read(r)}clone(){return new T({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:Object(n.o)(this.statistics),gamma:Object(n.o)(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,colorRamp:Object(n.o)(this.colorRamp),histograms:Object(n.o)(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})}};Object(i.e)([Object(i.y)({types:o.d,json:{write:!0}})],j.prototype,"colorRamp",void 0),Object(i.e)([Object(i.a1)("colorRamp")],j.prototype,"readColorRamp",null),Object(i.e)([Object(i.y)({type:Boolean,json:{write:!0}})],j.prototype,"computeGamma",void 0),Object(i.e)([Object(i.y)({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],j.prototype,"dynamicRangeAdjustment",void 0),Object(i.e)([Object(i.y)({type:[Number],json:{write:!0}})],j.prototype,"gamma",void 0),Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],j.prototype,"maxPercent",void 0),Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],j.prototype,"minPercent",void 0),Object(i.e)([Object(i.y)({type:i.N,json:{write:!0}})],j.prototype,"numberOfStandardDeviations",void 0),Object(i.e)([Object(i.y)({type:Number,json:{read:{source:"max"},write:{target:"max"}}})],j.prototype,"outputMax",void 0),Object(i.e)([Object(i.y)({type:Number,json:{read:{source:"min"},write:{target:"min"}}})],j.prototype,"outputMin",void 0),Object(i.e)([Object(i.y)({type:Number,json:{write:!0}})],j.prototype,"sigmoidStrengthLevel",void 0),Object(i.e)([Object(i.y)({json:{type:[[Number]],write:!0}})],j.prototype,"statistics",void 0),Object(i.e)([Object(i.y)()],j.prototype,"histograms",void 0),Object(i.e)([Object(i.o)("statistics")],j.prototype,"writeStatistics",null),Object(i.e)([Object(i.y)({type:Boolean,json:{write:!0}})],j.prototype,"useGamma",void 0),Object(i.e)([Object(i.y)({type:I.apiValues,json:{type:I.jsonValues,write:I.write}})],j.prototype,"stretchType",void 0),Object(i.e)([Object(i.a1)("stretchType",["stretchType"])],j.prototype,"readStretchType",null),Object(i.e)([Object(i.r)({rasterStretch:"raster-stretch"})],j.prototype,"type",void 0),j=T=Object(i.e)([Object(i.i)("esri.renderers.RasterStretchRenderer")],j);var E,A=j;const M=new Set(["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"]),R=new i.aM({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),F=new i.aM({beaufort_ft:"beaufort-ft",beaufort_km:"beaufort-km",beaufort_kn:"beaufort-kn",beaufort_m:"beaufort-m",beaufort_mi:"beaufort-mi",classified_arrow:"classified-arrow",ocean_current_kn:"ocean-current-kn",ocean_current_m:"ocean-current-m",simple_scalar:"simple-scalar",single_arrow:"single-arrow",wind_speed:"wind-barb"}),C=new i.aM({flow_from:"flow-from",flow_to:"flow-to"});let D=E=class extends(Object(o.l)(i.a)){constructor(e){super(e),this.attributeField="Magnitude",this.flowRepresentation="flow-from",this.rotationType="arithmetic",this.style="single-arrow",this.symbolTileSize=50,this.type="vector-field"}readInputUnit(e,t){return M.has(e)?R.fromJSON(e):null}readOutputUnit(e,t){return M.has(e)?R.fromJSON(e):null}get styleRenderer(){const e=this.style,t=this.attributeField,r=this._createStyleRenderer(e);return r.field=t,r}get sizeVariables(){const e=[];if(this.visualVariables)for(const t of this.visualVariables)"size"===t.type&&e.push(t);if(0===e.length){const t=new o.j({minSize:.2*this.symbolTileSize,maxSize:.8*this.symbolTileSize});this.visualVariables?this.visualVariables.push(t):this._set("visualVariables",[t]),e.push(t)}return e}get rotationVariables(){const e=[];if(this.visualVariables)for(const t of this.visualVariables)"rotation"===t.type&&e.push(t);if(0===e.length){const t=new o.e({field:"Direction",rotationType:this.rotationType});this.visualVariables?this.visualVariables.push(t):this._set("visualVariables",[t]),e.push(t)}return e}clone(){return new E({attributeField:this.attributeField,flowRepresentation:this.flowRepresentation,rotationType:this.rotationType,style:this.style,visualVariables:Object(n.o)(this.visualVariables),inputUnit:this.inputUnit,outputUnit:this.outputUnit})}async getGraphicsFromPixelData(e,t=!1){const r=[],n=Object(f.a)(this.inputUnit,this.outputUnit),s=t?Object(f.c)(e.pixelBlock,"vector-uv",this.rotationType,n):Object(f.b)(e.pixelBlock,"vector-magdir",n),a=e.extent,o=s.mask&&s.mask.length>0;let l,c=0;const h=(a.xmax-a.xmin)/s.width,p=(a.ymax-a.ymin)/s.height;for(let e=0;e<s.height;e++)for(let t=0;t<s.width;t++,c++)if(l=[a.xmin+t*h+h/2,a.ymax-e*p-p/2],(!o||s.mask[c])&&l&&2===l.length){const e={Magnitude:s.pixels[0][c],Direction:s.pixels[1][c]};let t=new i._({x:l[0],y:l[1],spatialReference:a.spatialReference});t=(await Object(d.a)(t))[0];const n=new u.a({geometry:{type:"point",x:t.x,y:t.y,spatialReference:a.spatialReference},attributes:e});n.symbol=this._getVisualVariablesAppliedSymbol(n),r.push(n)}return r}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getClassBreakInfos(){var e;return null==(e=this.styleRenderer)?void 0:e.classBreakInfos}getDefaultSymbol(){var e;return null==(e=this.styleRenderer)?void 0:e.defaultSymbol}_getDefaultSymbol(e){return new c.F({path:"M14,32 14,18 9,23 16,3 22,23 17,18 17,32 z",outline:new c.m({width:0}),size:20,color:e||new i.j([0,92,230])})}_getVisualVariablesAppliedSymbol(e){if(!e)return;let t=this.styleRenderer&&this.styleRenderer.getSymbol(e);t=t.clone();const r=this.sizeVariables,i=this.rotationVariables;if(r&&r.length&&this.sizeVariables.forEach((r=>Object(p.a)(t,Object(h.getAllSizes)([r],e)))),i&&i.length){const r=e.attributes.Direction;e.attributes.Direction="flow-from"===this.flowRepresentation?r:r+180,this.rotationVariables.forEach((r=>Object(p.b)(t,Object(h.getRotationAngle)(r,e),r.axis)))}return t}_createStyleRenderer(e){let t={defaultSymbol:this._getDefaultSymbol(),classBreakInfos:[]};switch(e){case"single-arrow":t=this._createSingleArrowRenderer();break;case"beaufort-kn":t=this._createBeaufortKnotsRenderer();break;case"beaufort-m":t=this._createBeaufortMeterRenderer();break;case"beaufort-ft":t=this._createBeaufortFeetRenderer();break;case"beaufort-mi":t=this._createBeaufortMilesRenderer();break;case"beaufort-km":t=this._createBeaufortKilometersRenderer();break;case"ocean-current-m":t=this._createCurrentMeterRenderer();break;case"ocean-current-kn":t=this._createCurrentKnotsRenderer();break;case"simple-scalar":t=this._createSimpleScalarRenderer();break;case"wind-barb":t=this._createWindBarbsRenderer();break;case"classified-arrow":t=this._createClassifiedArrowRenderer()}return new o.a(t)}_createSingleArrowRenderer(){return{defaultSymbol:this._getDefaultSymbol()}}_createBeaufortKnotsRenderer(){return{defaultSymbol:this._getDefaultSymbol(new i.j([214,47,39])),classBreakInfos:this._getClassBreaks([0,1,3,6,10,16,21,27,33,40,47,55,63],[[40,146,199],[89,162,186],[129,179,171],[160,194,155],[191,212,138],[218,230,119],[250,250,100],[252,213,83],[252,179,102],[250,141,52],[247,110,42],[240,71,29]])}}_createBeaufortMeterRenderer(){return{defaultSymbol:this._getDefaultSymbol(new i.j([214,47,39])),classBreakInfos:this._getClassBreaks([0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7],[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createBeaufortFeetRenderer(){const e=this._getDefaultSymbol(new i.j([214,47,39]));let t=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];return t=t.map((e=>3.28084*e)),{defaultSymbol:e,classBreakInfos:this._getClassBreaks(t,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createBeaufortMilesRenderer(){const e=this._getDefaultSymbol(new i.j([214,47,39]));let t=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];return t=t.map((e=>2.23694*e)),{defaultSymbol:e,classBreakInfos:this._getClassBreaks(t,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createBeaufortKilometersRenderer(){const e=this._getDefaultSymbol(new i.j([214,47,39]));let t=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];return t=t.map((e=>3.6*e)),{defaultSymbol:e,classBreakInfos:this._getClassBreaks(t,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createCurrentMeterRenderer(){return{defaultSymbol:this._getDefaultSymbol(new i.j([177,177,177])),classBreakInfos:this._getClassBreaks([0,.5,1,1.5,2],[[78,26,153],[179,27,26],[202,128,26],[177,177,177]])}}_createCurrentKnotsRenderer(){return{defaultSymbol:this._getDefaultSymbol(new i.j([177,177,177])),classBreakInfos:this._getClassBreaks([0,.25,.5,1,1.5,2,2.5,3,3.5,4],[[0,0,0],[0,37,100],[78,26,153],[151,0,100],[179,27,26],[177,78,26],[202,128,26],[177,179,52],[177,177,177]])}}_createClassifiedArrowRenderer(){var e;const t=this._getDefaultSymbol(new i.j([56,168,0]));let r=[0,1e-6,3.5,7,10.5,14];if(null!=(e=this.sizeVariables)&&e.length){const e=this.sizeVariables[0].minDataValue,t=this.sizeVariables[0].maxDataValue;if(e&&t){const i=(t-e)/5;r=Array.from(Array(6).keys()).map((t=>e+i*t))}}return{defaultSymbol:t,classBreakInfos:this._getClassBreaks(r,[[56,168,0],[139,309,0],[255,255,0],[255,128,0],[255,0,0]])}}_createSimpleScalarRenderer(){return{defaultSymbol:c.r.fromJSON({imageData:"iVBORw0KGgoAAAANSUhEUgAAACsAAAArCAQAAABLVLlLAAAABGdBTUEAAYagMeiWXwAAAAJiS0dEAACqjSMyAAAACXBIWXMAAABIAAAASABGyWs+AAAC3ElEQVRIx9XXvW4cVRQH8N982btpsIREJECyiCXsxX4DKh6AliqGKCBBE2SlwlHgAbBD/AKmyEYUeQ1KahPZSZQvBCkQLTHZ7KGY8Xodz4w3a1NwbzVzz/znfJ//zbStVC5q3icKak9GAs2QIdDx3PtW/S011NW3p+M5Eomh11ipTIKe6+4LQzHaQ+G+63pIZNJJQXMpljwTwj1brpgx5w1zZlyx5Z4QnllEIm2xeeSUHBf0hV0bejo1Uh09G3aFvgXk7cCJFBc9EdaRVuHJJaOdKyTV2TVhYLMduNR0Q9gxL5GaaTDw8GzejrDRBpxWoGsySRW0dttKuattwNkIlFw2YXgzOdYq4Ox49PlM+JrKd5OusjTWhBuVxUfMX/KXXZ3WEmkuqa67wspR4BTbwtKr/5u4fFgStse/T7EifFPnnYl9zPq4vmUOPrRndgoHjDti1gOPqlyXoifcRNGQzUd31lDyfHmob1Gp35vSr+P6vilcQ5Egtyd8YF/ySg9NhPM+9M/IOaHwp5+PSZayXTvCogEUwlatC3J8LLwYtcWB8EuDXQVuCkV5/B4eNHb7wGBs87LBDS+xjdVSn09wq1G8dFM+9tSUhIGneLvUdniKxKpTYljCpu3j7rVWlHj/P23v4NPGUEyeCQnexe9lJjzEQqMjJs+EzNAX6B98dBZVRmroJx95x/A/6gln18EyfCUsl+qdXb/tjvfbw+mwforpUOBz4XLVoBwAn3aWnfeH246NyBXhrq7TTN5lNSP9RkU+puUJm3W2Tsdq0nZWM07srk7MwQrZSRysjjGWBLRJNsNbfj2JMR4AbxpU1XLAb9Mxfpsq5EjMuuiR8L0JiHOOBX3hiUvOmavN0nMueSzcceFk0BK4pMqLo7vDD1Z0qrtDx7Itt4Xwm9UqbMmk8S0Dtuzb2pvOU99Z1nLTOfleNmvfZfP2pYZmPfajwosKdDBNpacNpVGGsWX9CyDI8Xq/Sj6QAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE0LTExLTEwVDAzOjE3OjU4LTA1OjAwF+tHyQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMFQwMzoxNzo1OC0wNTowMGa2/3UAAAAASUVORK5CYII=",height:20,width:20,type:"esriPMS",angle:0})}}_createWindBarbsRenderer(){const e=Array.from(Array(31).keys()).map((e=>5*e)),t=[{range:"0-5",path:"M20 20 M5 20 A15 15 0 1 0 35 20 A15 15 0 1 0 5 20 M20 20 M10 20 A10 10 0 1 0 30 20 A10 10 0 1 0 10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTIwIDIwIE01IDIwIEExNSAxNSAwIDEgMCAzNSAyMCBBMTUgMTUgMCAxIDAgNSAyMCBNMjAgMjAgTTEwIDIwIEExMCAxMCAwIDEgMCAzMCAyMCBBMTAgMTAgMCAxIDAgMTAgMjAiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"5-10",path:"M25 0 L25 40 M25 35 L17.5 37.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNyA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTTI1IDM1IEwxNy41IDM3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"10-15",path:"M25 0 L25 40 L10 45 L25 40",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNyA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"15-20",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L17.5 37.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjEyIDAgMTUgNDUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxNy41IDM3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"20-25",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNiA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCBNMjUgMzUgTDEwIDQwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"25-30",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L17.5 32.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNiA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCBNMjUgMzUgTDEwIDQwIEwyNSAzNSBNMjUgMzAgTDE3LjUgMzIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"30-35",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"35-40",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxNy41IDI3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"40-45",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"45-50",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxNy41IDIyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"50-55",path:"M25 0 L25 40 L10 40 L25 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"55-60",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L17.5 32.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxNy41IDMyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"60-65",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"65-70",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxNy41IDI3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"70-75",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"75-80",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxNy41IDIyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"80-85",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"85-90",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L17.5 17.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxNy41IDE3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"90-95",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxMCAyMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"95-100",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20 L25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxMCAyMCBMMjUgMTUgTTI1IDEwIEwxNy41IDEyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"100-105",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"105-110",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDE3LjUgMjcuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"110-115",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"115-120",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDE3LjUgMjIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"120-125",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"125-130",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L17.5 17.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDE3LjUgMTcuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"130-135",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"135-140",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDE3LjUgMTIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"140-145",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDEwIDE1IiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"145-150",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDEwIDE1IE0yNSAxMCBNMjUgNSBMMTcuNSA3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="}],r=c.r.fromJSON({imageData:"iVBORw0KGgoAAAANSUhEUgAAACgAAAApCAQAAADtq6NDAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEY0lEQVRIx5XXWWxWRRQH8N+d+31tUdGAVjGglYJABFEBY91jfDAg7piYaFTccA++uMQEFRcSXlATtxiXqMQt4G4iisYl0ai4sIQYtVFZ1KIFKdTS0l4f7vRCS5fPebozc+bM/2z/Mzcx0AgSiUxXnKfIdMn875FIhX53U2n/B/s+kKM4UINTjTBZImixxnrv+9a2iL6zEoUBXcoudrWj/OtHm3wt02lfU9Qao9OnHvIhgmww84MEl1qnxfNmGrqHxAizLdPpC6chGcAxKGGcL+30gOERf1BSpUqVslQSV8d5ReZFe8VQ9avufJn31cWwlJV7iafKStGOE/1qvfH9qUxxu8ydUdmuSKbGO8YUdT2inKLG69pM70tliktl5qIkCAJGmusDG7Vqsc0WjZa4UBlBiA5YZIcjYzB7qDtH5kaUJFLs7RGZTZ42W4PRRmtwvbdt1+wGiaS4drEtDttdZYIDNVuAclR3vA3+dI3qHqmVSy7U6Tv1MScCPvPR7nIpFlsdCy3FdTLPGhK92e2CUITjMJ9ocwKxnsZqc3O3JwMma3d6UVLnyVxB4aXemZqvPqLdpJhW3KVVbY4yYImPo6M5Urv50fj+0z/FG9YaEiENs8UtMfXUaTeTePNHlhXfA1UU+2lyD1Il3Gtt9+adfpNG7dNlpg2U/T3KYLZ2dUWFdTgp3/rQ4sK973qnInV5TIf40x3dhvrJPBiqyWUo4wAtLqhQYS71qK+QKOFRywmGK/kpikzV6WMKhh58vGWs4TIJNjiEYLIuP8Tt4/zmLyqk+AyrJSbF+Qq1DgqRUPMxyl+9q3IQhX/rMCJ6tEunriDs1oSyQZKlr9AkhT2ZIARbJfaJS1vtVbHB+Rgi0RK/y1q1BWsEEyLoz40xtGKcARPVWB1BTPO7f4LNtpkUl1aoMbViLyZo0GRjPD3BxnxjqXeLYlvhqYrzMMG3HoyJXa3JjfnGlbYYFlP7Jh3qKsKY4hQ7TY0nG+xwRL61n63mxHtqNHosigyMLmClNwvuecFnOZB88nNBDzNkzhxEZaKMBVoKapggMzvHHXBEpNSSFAvtcFRsVn0bW8LlMmcXs+c0Kne3gRR32+zg4uXwjC6zit6Wt4a8LXVfcp/MtQXHn2ynGbuCmb8GvvFeJLEE82ReU9/n6+dkq2x3buG9Wn94smcgAw631RPR7BTH+kbmHReZoEpOdEe7zWqZl40s0JWs9Hmv7hjBHqPDwsjGKVJnWWqjbdZp1KhJi0aPmxYZsIRhlttgeF+Jlke41QcOQKoqilSb6HJzSvNG3G/UoWnxwsmt+sVaYwd63dRbqdnMyCPVeyRPvpYgdavM22oGKoMUVRbJfOWMwidJ8Zzb1UvmWK/VVUXzHaTjjrVYh1897HT7xxYEVUaa5SWb/WO+YUWa9SrwvigzM8YlzlYv2GSdVCYxxlBtVnnFq5olwp5/BEk/OLsf5LUmG2+inRJdVvjZ97ZH9/zP34ug1O91pf4p+D+JYBpvrKxfbwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNC0xMS0xMFQwMzoxMjowOS0wNTowMB9ViV0AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTBUMDM6MTI6MDktMDU6MDBuCDHhAAAAAElFTkSuQmCC",height:20,width:20,type:"esriPMS",angle:0}),i=e.map(((i,n)=>{let s;if(n!==e.length-1)if(0===n)s={minValue:i,maxValue:e[n+1],symbol:r};else{const r=c.r.fromJSON({type:"esriPMS",imageData:t[n].imageData,contentType:"image/svg+xml",height:32,width:32,angle:0});s={minValue:i,maxValue:e[n+1],symbol:r}}return new o.n(s)}));return{defaultSymbol:r,classBreakInfos:i}}_getClassBreaks(e,t){return t.map(((t,r)=>new o.n({minValue:e[r],maxValue:e[r+1],symbol:this._getDefaultSymbol(new i.j(t))})))}};Object(i.e)([Object(i.y)({type:String,json:{write:!0}})],D.prototype,"attributeField",void 0),Object(i.e)([Object(i.y)({type:C.apiValues,json:{type:C.jsonValues,read:{reader:C.read},write:{writer:C.write}}})],D.prototype,"flowRepresentation",void 0),Object(i.e)([Object(i.y)({type:["geographic","arithmetic"],json:{write:!0}})],D.prototype,"rotationType",void 0),Object(i.e)([Object(i.y)({type:F.apiValues,json:{type:F.jsonValues,read:{reader:F.read},write:{writer:F.write}}})],D.prototype,"style",void 0),Object(i.e)([Object(i.y)({json:{write:!0}})],D.prototype,"symbolTileSize",void 0),Object(i.e)([Object(i.y)({type:R.apiValues,json:{type:R.jsonValues,write:{writer:R.write}}})],D.prototype,"inputUnit",void 0),Object(i.e)([Object(i.a1)("inputUnit")],D.prototype,"readInputUnit",null),Object(i.e)([Object(i.y)({type:R.apiValues,json:{type:R.jsonValues,read:{reader:R.read},write:{writer:R.write}}})],D.prototype,"outputUnit",void 0),Object(i.e)([Object(i.a1)("outputUnit")],D.prototype,"readOutputUnit",null),Object(i.e)([Object(i.r)({vectorField:"vector-field"})],D.prototype,"type",void 0),Object(i.e)([Object(i.y)({type:o.a})],D.prototype,"styleRenderer",null),Object(i.e)([Object(i.y)({type:o.j})],D.prototype,"sizeVariables",null),Object(i.e)([Object(i.y)({type:o.e})],D.prototype,"rotationVariables",null),D=E=Object(i.e)([Object(i.i)("esri.renderers.VectorFieldRenderer")],D);var L=D;const N={key:"type",base:null,typeMap:{"unique-value":o.b,"class-breaks":o.a,"raster-colormap":v,"raster-stretch":A,"vector-field":L,"raster-shaded-relief":O}},P={...N,typeMap:{...N.typeMap}};delete P.typeMap["vector-field"];const B={uniqueValue:o.b,classBreaks:o.a,rasterStretch:A,rasterColormap:v,vectorField:L,rasterShadedRelief:O};function k(e,t){if(!e)return null;if("classBreaks"===e.type&&e.classificationMethod){const t=e.authoringInfo||{classificationMethod:""};t.classificationMethod=e.classificationMethod,e.authoringInfo=t}const r=(n=e)&&B[n.type]||null;var n;if(r){const i=new r;return i.read(e,t),i}return t&&t.messages&&e&&t.messages.push(new i.aU("renderer:unsupported","Renderers of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:t})),null}var U;let z=U=class extends i.a{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new U({variableName:this.variableName,dimensionName:this.dimensionName,values:Object(n.o)(this.values),isSlice:this.isSlice})}};Object(i.e)([Object(i.y)({type:String,json:{write:!0}})],z.prototype,"variableName",void 0),Object(i.e)([Object(i.y)({type:String,json:{write:!0}})],z.prototype,"dimensionName",void 0),Object(i.e)([Object(i.y)({type:i.cN.array(i.cN.oneOf([i.cN.native(Number),i.cN.array(i.cN.native(Number))])),json:{write:!0}})],z.prototype,"values",void 0),Object(i.e)([Object(i.y)({type:Boolean,json:{write:!0}})],z.prototype,"isSlice",void 0),z=U=Object(i.e)([Object(i.i)("esri.layers.support.DimensionalDefinition")],z);var V=z;class G{constructor(){this._workerThread=null,this._destroyed=!1}async initialize(){const e=await Object(a.d)("RasterWorker");this._destroyed?e.close():this._workerThread=e}destroy(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)}async decode(e,t){if(!this._workerThread)throw new i.s("raster-jobhandler:no-connection","no available worker connection");const r=await this._workerThread.invoke("decode",e,t);return r?new s.p(r):null}async symbolize(e,t){if(!this._workerThread)throw new i.s("raster-jobhandler:no-connection","no available worker connection");const r={extent:e.extent&&e.extent.toJSON(),pixelBlock:e.pixelBlock.toJSON(),simpleStretchParams:e.simpleStretchParams,bandIds:e.bandIds},n=await this._workerThread.invoke("symbolize",r,t);return n?new s.p(n):null}async updateSymbolizer(e,t){var r;if(!this._workerThread)throw new i.s("raster-jobhandler:no-connection","no available worker connection");const n=null==e||null==(r=e.rendererJSON)?void 0:r.histograms;await Promise.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:n},t))}async stretch(e,t){if(!this._workerThread)throw new i.s("raster-jobhandler:no-connection","no available worker connection");if(null==e||!e.pixelBlock)return null;const r={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},n=await this._workerThread.invoke("stretch",r,t);return n?new s.p(n):null}async split(e,t){if(!this._workerThread)throw new i.s("raster-jobhandler:no-connection","no available worker connection");if(null==e||!e.pixelBlock)return null;const r={srcPixelBlock:e.pixelBlock.toJSON(),tileSize:e.tileSize,maximumPyramidLevel:e.maximumPyramidLevel},n=await this._workerThread.invoke("split",r,t);return n&&n.forEach(((e,t)=>{n.set(t,e?s.p.fromJSON(e):null)})),Promise.resolve(n)}async estimateStatisticsHistograms(e,t){if(!this._workerThread)throw new i.s("raster-jobhandler:no-connection","no available worker connection");if(null==e||!e.pixelBlock)return null;const r={srcPixelBlock:e.pixelBlock.toJSON()},n=await this._workerThread.invoke("estimateStatisticsHistograms",r,t);return Promise.resolve(n)}async mosaicAndTransform(e,t){var r;if(!this._workerThread)throw new i.s("raster-jobhandler:no-connection","no available worker connection");if(null==e||null==(r=e.srcPixelBlocks)||!r.length)return null;const n={...e,srcPixelBlocks:e.srcPixelBlocks.map((e=>e?e.toJSON():null))},a=await this._workerThread.invoke("mosaicAndTransform",n,t);return a?new s.p(a):null}}const q=new i.aM({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});let H=class extends i.a{constructor(){super(...arguments),this.baseSymbol=null,this.colorRamp=null,this.type=null}};Object(i.e)([Object(i.y)({type:c.u,json:{write:!0}})],H.prototype,"baseSymbol",void 0),Object(i.e)([Object(i.y)({types:o.d,json:{read:{reader:o.m},write:!0}})],H.prototype,"colorRamp",void 0),Object(i.e)([Object(i.y)({json:{read:q.read,write:q.write}})],H.prototype,"type",void 0),H=Object(i.e)([Object(i.i)("esri.tasks.support.ClassificationDefinition")],H);var W=H;const Z=new i.aM({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),X=new i.aM({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let J=class extends W{constructor(){super(...arguments),this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null,this.type="class-breaks-definition"}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};Object(i.e)([Object(i.y)({json:{write:!0}})],J.prototype,"breakCount",void 0),Object(i.e)([Object(i.y)({json:{write:!0}})],J.prototype,"classificationField",void 0),Object(i.e)([Object(i.y)({type:String,json:{read:Z.read,write:Z.write}})],J.prototype,"classificationMethod",void 0),Object(i.e)([Object(i.y)({json:{write:!0}})],J.prototype,"normalizationField",void 0),Object(i.e)([Object(i.y)({json:{read:X.read,write:X.write}})],J.prototype,"normalizationType",void 0),Object(i.e)([Object(i.y)({value:null,json:{write:!0}})],J.prototype,"standardDeviationInterval",null),Object(i.e)([Object(i.y)({value:null,json:{write:!0}})],J.prototype,"definedInterval",null),Object(i.e)([Object(i.y)()],J.prototype,"type",void 0),J=Object(i.e)([Object(i.i)("esri.tasks.support.ClassBreaksDefinition")],J);const Y=o.f.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),Q=o.f.fromJSON(l.i[0]);function K(e,t){const{attributeTable:r,colormap:n,dataType:s}=e;if("vector-uv"===s||"vector-magdir"===s){const t=ae(e)?new L:null;if(Object(i.P)(t))return t}if(Object(i.P)(n)){const t=function(e){if(!se(e))return null;let t;const{attributeTable:r,colormap:n}=e;if(Object(i.P)(r)){const e=ie(r,"value"),i=re(r);"string"===i.type&&(t={},r.features.forEach((r=>{const n=r.attributes;t[n[e.name]]=i?n[i.name]:n[e.name]})))}return v.createFromColormap(Object(i.Y)(n),t)}(e);if(Object(i.P)(t))return t}if(Object(i.P)(r)){const t=function(e,t,r,n){if(!ne(e,t))return null;const{attributeTable:s,statistics:a}=e,c=re(s,t),u=ie(s,"red"),h=ie(s,"green"),d=ie(s,"blue"),f=new o.h,p=[],y=new Set,g=!!(u&&h&&d);if(Object(i.P)(s))s.features.forEach((e=>{const t=e.attributes[c.name];y.has(e.attributes[c.name])||null==t||(y.add(t),p.push(new o.g({value:e.attributes[c.name],label:e.attributes[c.name]+"",symbol:{type:"simple-fill",style:"solid",outline:null,color:new i.j(g?[e.attributes[u.name],e.attributes[h.name],e.attributes[d.name],1]:[0,0,0,0])}})))}));else if(null!=a&&a[0])for(let e=a[0].min;e<=a[0].max;e++)p.push(new o.g({value:e,label:e.toString(),symbol:{type:"simple-fill",style:"solid",outline:null,color:new i.j([0,0,0,0])}}));if(p.sort(((e,t)=>e.value&&"string"==typeof e.value.valueOf()?0:e.value>t.value?1:-1)),!g){const e=Object(l.h)(Q,p.length);p.forEach(((t,r)=>t.symbol.color=new i.j(e[r].slice(1,4)))),f.colorRamp=Q}if(r||n){const e=r||Object(l.h)(n,p.length).map((e=>e.slice(1)));p.forEach(((t,r)=>t.symbol.color=new i.j(e[r]))),f.colorRamp=n}return new o.b({field:c.name,uniqueValueInfos:p,authoringInfo:f})}(e);if(Object(i.P)(t))return t}return function(e,t){var r,n,s,a;e=function(e,t){if(null==t)return e;let r=Object(i.Y)(e.statistics),n=Object(i.Y)(e.histograms);const{multidimensionalInfo:s}=e;if(t&&Object(i.P)(s)){const{statistics:e,histograms:i}=s.variables.find((e=>e.name===t));null!=e&&e.length&&(r=e),null!=i&&i.length&&(n=i)}return l.k.fromJSON({...e.toJSON(),statistics:r,histograms:n})}(e,null==t?void 0:t.variableName);const{bandCount:o}=e;let{bandIds:c,stretchType:u}=t||{};null!=(r=c)&&r.some((e=>e>=o))&&(c=null);let h=Object(i.Y)(e.statistics),d=Object(i.Y)(e.histograms);var f;o>1?(c=null!=(f=c)&&f.length?c:te(e),h=null==h?null:c.map((e=>h[e])),d=null==d?null:c.map((e=>d[e]))):c=[0],null==u&&(u=function(e){let t="percent-clip";const{pixelType:r,dataType:n,histograms:s,statistics:a}=e;return"u8"!==r||"processed"!==n&&Object(i.P)(s)&&Object(i.P)(a)?"u8"===r||"elevation"===n||"scientific"===n?t="min-max":Object(i.P)(s)?t="percent-clip":Object(i.P)(a)&&(t="min-max",t="min-max"):t="none",t}(e));let p=!1;switch(u){case"none":p=!1;break;case"percent-clip":p=!(null!=(n=d)&&n.length);break;default:p=!(null!=(s=h)&&s.length)}const y=1===(null==(a=c)?void 0:a.length)&&"scientific"===e.dataType?Y:null,g=new A({stretchType:u,dynamicRangeAdjustment:p,colorRamp:y,outputMin:0,outputMax:255,gamma:1===c.length?[1]:[1,1,1],useGamma:!1});return"percent-clip"===u?g.maxPercent=g.minPercent=.25:"standard-deviation"===u&&(g.numberOfStandardDeviations=2),p||("percent-clip"===u?g.histograms=d:"min-max"!==u&&"standard-deviation"!==u||(g.statistics=h)),g}(e,t)}function $(e){const t=["raster-stretch"];return se(e)&&t.push("raster-colormap"),ne(e)&&t.push("unique-value"),function(e){const{attributeTable:t,bandCount:r}=e;return 1===r&&(Object(i.P)(t)||Object(i.P)(e.histograms))}(e)&&t.push("class-breaks"),function(e){return"elevation"===e.dataType}(e)&&t.push("raster-shaded-relief"),ae(e)&&t.push("vector-field"),t}function ee(e,t,r){const i=["nearest","bilinear","cubic","majority"].find((e=>e===(null==r?void 0:r.toLowerCase())));return"Map"===t?null!=i?i:"bilinear":"thematic"===e.dataType||e.attributeTable||e.colormap?"nearest"===i||"majority"===i?i:"nearest":null!=i?i:"bilinear"}function te(e){const t=e.bandCount;if(1===t)return null;if(2===t)return[0];const r=e.keyProperties&&e.keyProperties.BandProperties;let i;if(r&&r.length===t){const{red:e,green:t,blue:n,nir:s}=function(e){const t={};for(let i=0;i<e.length;i++){var r;const n=e[i],s=null==(r=n.BandName)?void 0:r.toLowerCase();if("red"===s)t.red=i;else if("green"===s)t.green=i;else if("blue"===s)t.blue=i;else if("nearinfrared"===s||"nearinfrared_1"===s||"nir"===s)t.nir=i;else if(n.WavelengthMax&&n.WavelengthMin){const e=n.WavelengthMin,r=n.WavelengthMax;null==t.blue&&e>=410&&e<=480&&r>=480&&r<=540?t.blue=i:null==t.green&&e>=490&&e<=560&&r>=560&&r<=610?t.green=i:null==t.red&&e>=595&&e<=670&&r>=660&&r<=730?t.red=i:null==t.nir&&e>=700&&e<=860&&r>=800&&r<=950&&(t.nir=i)}}return t}(r);null!=e&&null!=t&&null!=n?i=[e,t,n]:null!=s&&null!=e&&null!=t&&(i=[s,e,t])}return!i&&t>=3&&(i=[0,1,2]),i}function re(e,t){let r;return Object(i.P)(e)?(r=t?e.fields.find((e=>t.toLowerCase()===e.name.toLowerCase())):e.fields.find((e=>"string"===e.type&&e.name.toLowerCase().indexOf("class")>-1)),r||(r=e.fields.find((e=>"string"===e.type)),r||(r=ie(e,"value")))):r=new y.a({name:"value"}),r}function ie(e,t){return Object(i.P)(e)?e.fields.find((e=>e.name.toLowerCase()===t)):null}function ne(e,t){const{attributeTable:r,bandCount:n}=e;return!(Object(i.P)(r)||!function(e){var t,r,i;return["u8","s8"].indexOf(e.pixelType)>-1&&null!=(null==(t=e.statistics)||null==(r=t[0])?void 0:r.min)&&null!=(null==(i=e.statistics[0])?void 0:i.max)&&1===e.bandCount}(e))||!(!Object(i.P)(r)||n>1)&&(!t||null!=r.fields.find((e=>e.name.toLowerCase()===t.toLowerCase())))}function se(e){const{bandCount:t,colormap:r}=e;return Object(i.P)(r)&&r.length&&1===t}function ae(e){const{dataType:t}=e;return"vector-uv"===t||"vector-magdir"===t}function oe(e){var t;return{color:null==(t=e.symbolLayers[0].material)?void 0:t.color,type:"esriSFS",style:"esriSFSSolid"}}function le(e){if("uniqueValue"===e.type){var t;const r=e.uniqueValueInfos,i=r[0].symbol;return null!=i&&null!=(t=i.symbolLayers)&&t.length&&(e.uniqueValueInfos=r.map((e=>({value:e.value,label:e.label,symbol:e.symbol?oe(e.symbol):null})))),e}if("classBreaks"===e.type){var r;const t=e.classBreakInfos,i=t[0].symbol;return null!=i&&null!=(r=i.symbolLayers)&&r.length&&(e.classBreakInfos=t.map((e=>({classMinValue:e.classMinValue,classMaxValue:e.classMaxValue,label:e.label,symbol:e.symbol?oe(e.symbol):null})))),e}return e}},,function(e,t,r){"use strict";r.d(t,"a",(function(){return F})),r.d(t,"b",(function(){return N})),r.d(t,"c",(function(){return v}));r(18);var i=r(0),n=r(1),s=r(359),a=r(23),o=r(43),l=r(6),c=r(3),u=r(4),h=r(103),d=(r(21),r(49)),f=r(51),p=r(104),y=r(64),g=r(58),m=r(14),b=r(114),_=r(40),x=r(366);const v=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=null}readCapabilities(e,t){const r=t.capabilities&&t.capabilities.split(",").map((e=>e.toLowerCase().trim()));if(!r)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const i=this.type,n=-1!==r.indexOf("query"),a=-1!==r.indexOf("map"),o=!!t.exportTilesAllowed,l=-1!==r.indexOf("tilemap"),c="tile"!==i&&!!t.supportsDynamicLayers,u="tile"!==i&&(!t.tileInfo||c),h="tile"!==i&&(!t.tileInfo||c),d="tile"!==i,f=!!t.cimVersion&&s.a.parse(t.cimVersion).since(1,4);return{operations:{supportsQuery:n,supportsExportMap:a,supportsExportTiles:o,supportsTileMap:l},exportMap:a?{supportsArcadeExpressionForLabeling:f,supportsSublayersChanges:d,supportsDynamicLayers:c,supportsSublayerVisibility:u,supportsSublayerDefinitionExpression:h}:null,exportTiles:o?{maxExportTilesCount:+t.maxExportTilesCount}:null}}readVersion(e,t){let r=t.currentVersion;return r||(r=t.hasOwnProperty("capabilities")||t.hasOwnProperty("tables")?10:t.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),r}async fetchSublayerInfo(e,t){return await this.fetchAllLayersAndTables(t),this._allLayersAndTablesMap.get(e)}async fetchAllLayersAndTables(e){await this.load(e),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=Object(i.C)(Object(i.U)(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then((e=>{this._allLayersAndTablesMap=new Map;for(const t of e.data.layers)this._allLayersAndTablesMap.set(t.id,t);return{result:e.data}}),(e=>({error:e}))));const t=await this._allLayersAndTablesPromise;if(Object(i.h)(e),"result"in t)return t.result;throw t.error}};return Object(i.e)([Object(i.y)({readOnly:!0})],t.prototype,"capabilities",void 0),Object(i.e)([Object(i.a1)("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],t.prototype,"readCapabilities",null),Object(i.e)([Object(i.y)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(i.e)([Object(i.y)({type:i.M})],t.prototype,"fullExtent",void 0),Object(i.e)([Object(i.y)(a.c)],t.prototype,"id",void 0),Object(i.e)([Object(i.y)({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),Object(i.e)([Object(i.y)(a.d)],t.prototype,"popupEnabled",void 0),Object(i.e)([Object(i.y)({type:i.A})],t.prototype,"spatialReference",void 0),Object(i.e)([Object(i.y)()],t.prototype,"version",void 0),Object(i.e)([Object(i.a1)("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],t.prototype,"readVersion",null),t=Object(i.e)([Object(i.i)("esri.layers.mixins.ArcGISMapService")],t),t};var w;function O(e){return e&&"esriSMS"===e.type}function I(e,t,r){var n;return{ignoreOrigin:!0,enabled:!!r&&"map-image"===(null==(n=r.layer)?void 0:n.type)&&(r.writeSublayerStructure||this.originIdOf(t)>=Object(i.bE)(r.origin))}}function S(e,t,r){var i;return{enabled:!!r&&"tile"===(null==(i=r.layer)?void 0:i.type)&&this._isOverridden(t)}}function T(e,t,r){return{ignoreOrigin:!0,enabled:r&&r.writeSublayerStructure||!1}}function j(e,t,r){return{ignoreOrigin:!0,enabled:!!r&&(r.writeSublayerStructure||this.originIdOf(t)>=Object(i.bE)(r.origin))}}const E=i.n.getLogger("esri.layers.support.Sublayer");let A=0;const M=new Set;M.add("layer"),M.add("parent"),M.add("loaded"),M.add("loadStatus"),M.add("loadError"),M.add("loadWarnings");let R=w=class extends(Object(_.a)(Object(h.b)(Object(i.z)(i.k)))){constructor(e){super(e),this.capabilities=void 0,this.fields=null,this.fullExtent=null,this.globalIdField=null,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.sourceJSON=null,this.title=null,this.typeIdField=null,this.types=null}async load(e){return this.addResolvingPromise((async()=>{var t;if(!this.layer&&!this.url)throw new i.s("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let r=null;if(!this.layer||this.originIdOf("url")>2||"data-layer"===(null==(t=this.source)?void 0:t.type))r=(await Object(i.C)(this.url,{responseType:"json",query:{f:"json"},...e})).data;else{var n;let t=this.id;"map-layer"===(null==(n=this.source)?void 0:n.type)&&(t=this.source.mapLayerId),r=await this.layer.fetchSublayerInfo(t,e)}r&&(this.sourceJSON=r,this.read({layerDefinition:r},{origin:"service"}))})()),this}readCapabilities(e,t){const r=(e=(t=t.layerDefinition||t).capabilities||e)?e.toLowerCase().split(",").map((e=>e.trim())):[];return{exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:-1!==r.indexOf("query")}}}set definitionExpression(e){this._setAndNotifyLayer("definitionExpression",e)}get fieldsIndex(){return new p.a(this.fields||[])}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeGlobalID"===e.type)return e.name}get id(){const e=this._get("id");return null==e?A++:e}set id(e){this._get("id")!==e&&(!1!==this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._set("id",e):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}set labelingInfo(e){this._setAndNotifyLayer("labelingInfo",e)}writeLabelingInfo(e,t,r,i){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map((e=>e.write({},i)))}})}set labelsVisible(e){this._setAndNotifyLayer("labelsVisible",e)}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach((t=>t.layer=e))}set listMode(e){this._set("listMode",e)}set minScale(e){this._setAndNotifyLayer("minScale",e)}readMinScale(e,t){return t.minScale||t.layerDefinition&&t.layerDefinition.minScale||0}set maxScale(e){this._setAndNotifyLayer("maxScale",e)}readMaxScale(e,t){return t.maxScale||t.layerDefinition&&t.layerDefinition.maxScale||0}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeOID"===e.type)return e.name}set opacity(e){this._setAndNotifyLayer("opacity",e)}readOpacity(e,t){const r=t.layerDefinition;return 1-.01*(null!=r.transparency?r.transparency:r.drawingInfo.transparency)}writeOpacity(e,t,r,i){t.layerDefinition={drawingInfo:{transparency:100-100*e}}}writeParent(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=Object(i.cT)(this.parent.id):t.parentLayerId=-1}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){if(e)for(const t of e.getSymbols())if(Object(u.h)(t)){E.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",e)}get source(){return this._get("source")||new m.d({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer("source",e)}set sublayers(e){this._handleSublayersChange(e,this._get("sublayers")),this._set("sublayers",e)}castSublayers(e){return Object(i.l)(i.L.ofType(w),e)}writeSublayers(e,t,r){this.get("sublayers.length")&&(t[r]=this.sublayers.map((e=>e.id)).toArray().reverse())}readTypeIdField(e,t){const r=(t=t.layerDefinition||t).typeIdField;if(r){const e=Object(l.g)(t.fields,r);if(e)return e.name}return null}get url(){var e,t;const r=null!=(e=null==(t=this.layer)?void 0:t.parsedUrl)?e:this._lastParsedUrl,n=this.source;if(!r)return null;if(this._lastParsedUrl=r,"map-layer"===(null==n?void 0:n.type))return`${r.path}/${n.mapLayerId}`;const s={layer:JSON.stringify({source:this.source})};return`${r.path}/dynamicLayer?${Object(i.bU)(s)}`}set url(e){e?this._override("url",e):this._clearOverride("url")}set visible(e){this._setAndNotifyLayer("visible",e)}writeVisible(e,t,r,i){t[r]=this.getAtOrigin("defaultVisibility","service")||e}clone(){const{store:e}=Object(i.bB)(this),t=new w;return Object(i.bB)(t).store=e.clone(M),this.commitProperty("url"),t._lastParsedUrl=this._lastParsedUrl,t}createPopupTemplate(e){return Object(b.a)(this,e)}createQuery(){return new m.b({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){var e,t;if(this.hasOwnProperty("sublayers"))return null;const i=null==(e=this.layer)?void 0:e.parsedUrl,s=new((await Promise.resolve().then(r.bind(null,115)).then((function(e){return e.F}))).default)({url:i.path});return i&&this.source&&("map-layer"===this.source.type?s.layerId=this.source.mapLayerId:s.dynamicDataSource=this.source),null!=this.layer.refreshInterval&&(s.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(s.definitionExpression=this.definitionExpression),this.originIdOf("labelingInfo")>2&&(s.labelingInfo=Object(n.o)(this.labelingInfo)),this.originIdOf("labelsVisible")>0&&(s.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>0&&(s.legendEnabled=this.legendEnabled),this.originIdOf("visible")>0&&(s.visible=this.visible),this.originIdOf("minScale")>0&&(s.minScale=this.minScale),this.originIdOf("maxScale")>0&&(s.maxScale=this.maxScale),this.originIdOf("opacity")>0&&(s.opacity=this.opacity),this.originIdOf("popupTemplate")>0&&(s.popupTemplate=Object(n.o)(this.popupTemplate)),this.originIdOf("renderer")>2&&(s.renderer=Object(n.o)(this.renderer)),"data-layer"===(null==(t=this.source)?void 0:t.type)&&(s.dynamicDataSource=this.source.clone()),this.originIdOf("title")>0&&(s.title=this.title),"map-image"===this.layer.type&&this.layer.originIdOf("customParameters")>0&&(s.customParameters=this.layer.customParameters),"tile"===this.layer.type&&this.layer.originIdOf("customParameters")>0&&(s.customParameters=this.layer.customParameters),s}getFeatureType(e){const{typeIdField:t,types:r}=this;if(!t||!e)return null;const i=e.attributes?e.attributes[t]:void 0;if(null==i)return null;let n=null;return r.some((e=>{const{id:t}=e;return null!=t&&(t.toString()===i.toString()&&(n=e),!!n)})),n}getFieldDomain(e,t){const r=t&&t.feature,i=this.getFeatureType(r);if(i){const t=i.domains&&i.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}queryFeatures(e=this.createQuery(),t){return this.load().then((()=>{if(!this.get("capabilities.operations.supportsQuery"))throw new i.s("Sublayer.queryFeatures","this layer doesn't support queries.");return Promise.all([Promise.resolve().then(r.bind(null,44)).then((function(e){return e.q})),Promise.resolve().then(r.bind(null,53))])})).then((([{executeQuery:r},{default:i}])=>r(this.url,m.b.from(e),this.layer?this.layer.spatialReference:null,{...t,query:{...this.layer.customParameters}}).then((e=>i.fromJSON(e.data))))).then((e=>(e&&e.features&&e.features.forEach((e=>{e.sourceLayer=this})),e)))}toExportImageJSON(){var e;const t={id:this.id,source:(null==(e=this.source)?void 0:e.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(t.definitionExpression=this.definitionExpression);const r=["renderer","labelingInfo","opacity","labelsVisible"].reduce(((e,t)=>(e[t]=this.originIdOf(t),e)),{});if(Object.keys(r).some((e=>r[e]>2))){const e=t.drawingInfo={};r.renderer>2&&(e.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>2&&(e.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>2&&(e.labelingInfo=this.labelingInfo?this.labelingInfo.map((e=>e.write({},{origin:"service",layer:this.layer}))):null,e.showLabels=!0),r.opacity>2&&(e.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(e.renderer)}return t}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,(e=>{e.color||"esriSMSX"!==e.style&&"esriSMSCross"!==e.style||(e.outline&&e.outline.color?e.color=e.outline.color:e.color=[0,0,0,0])}))}_forEachSimpleMarkerSymbols(e,t){if(e){const r="uniqueValueInfos"in e?e.uniqueValueInfos:"classBreakInfos"in e?e.classBreakInfos:[];for(const e of r)O(e.symbol)&&t(e.symbol);"symbol"in e&&O(e.symbol)&&t(e.symbol),"defaultSymbol"in e&&O(e.defaultSymbol)&&t(e.defaultSymbol)}}_setAndNotifyLayer(e,t){const r=this.layer,n=this._get(e);let s,a;switch(e){case"definitionExpression":s="supportsSublayerDefinitionExpression";case"minScale":case"maxScale":case"visible":s="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":s="supportsDynamicLayers",a="supportsModification"}const o=Object(i.bB)(this).getDefaultOrigin();if("service"!==o){if(s&&!1===this.get(`layer.capabilities.exportMap.${s}`))return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${s}'`);if(a&&!1===this.get(`capabilities.exportMap.${a}`))return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${a}'`)}"source"!==e||"not-loaded"===this.loadStatus?(this._set(e,t),"service"!==o&&n!==t&&r&&r.emit&&r.emit("sublayer-update",{propertyName:e,target:this})):this._logLockedError(e,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null,e.layer=null})),this.handles.removeAll()),e&&(e.forEach((e=>{e.parent=this,e.layer=this.layer})),this.handles.add([e.on("after-add",(({item:e})=>{e.parent=this,e.layer=this.layer})),e.on("after-remove",(({item:e})=>{e.parent=null,e.layer=null})),e.on("before-changes",(e=>{const t=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==t||t||(E.error(new i.s("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),e.preventDefault())}))]))}_logLockedError(e,t){E.error(new i.s("sublayer:locked",`Property '${e}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:t,sublayer:this,layer:this.layer}))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}};R.test={isMapImageLayerOverridePolicy:e=>e===T||e===I,isTileImageLayerOverridePolicy:e=>e===S},Object(i.e)([Object(i.y)({readOnly:!0})],R.prototype,"capabilities",void 0),Object(i.e)([Object(i.a1)("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],R.prototype,"readCapabilities",null),Object(i.e)([Object(i.y)({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:I}}})],R.prototype,"definitionExpression",null),Object(i.e)([Object(i.y)({type:[f.a],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],R.prototype,"fields",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],R.prototype,"fieldsIndex",null),Object(i.e)([Object(i.y)({type:i.M,json:{read:{source:"layerDefinition.extent"}}})],R.prototype,"fullExtent",void 0),Object(i.e)([Object(i.y)({type:String})],R.prototype,"globalIdField",void 0),Object(i.e)([Object(i.a1)("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],R.prototype,"readGlobalIdFieldFromService",null),Object(i.e)([Object(i.y)({type:i.N,json:{write:{ignoreOrigin:!0}}})],R.prototype,"id",null),Object(i.e)([Object(i.y)({value:null,type:[y.a],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:T}}})],R.prototype,"labelingInfo",null),Object(i.e)([Object(i.o)("labelingInfo")],R.prototype,"writeLabelingInfo",null),Object(i.e)([Object(i.y)({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:T}}})],R.prototype,"labelsVisible",null),Object(i.e)([Object(i.y)({value:null})],R.prototype,"layer",null),Object(i.e)([Object(i.y)({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:j}}})],R.prototype,"legendEnabled",void 0),Object(i.e)([Object(i.y)({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],R.prototype,"listMode",null),Object(i.e)([Object(i.y)({type:Number,value:0,json:{write:{overridePolicy:T}}})],R.prototype,"minScale",null),Object(i.e)([Object(i.a1)("minScale",["minScale","layerDefinition.minScale"])],R.prototype,"readMinScale",null),Object(i.e)([Object(i.y)({type:Number,value:0,json:{write:{overridePolicy:T}}})],R.prototype,"maxScale",null),Object(i.e)([Object(i.a1)("maxScale",["maxScale","layerDefinition.maxScale"])],R.prototype,"readMaxScale",null),Object(i.e)([Object(i.y)({type:String})],R.prototype,"objectIdField",void 0),Object(i.e)([Object(i.a1)("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],R.prototype,"readObjectIdFieldFromService",null),Object(i.e)([Object(i.y)({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:T}}})],R.prototype,"opacity",null),Object(i.e)([Object(i.a1)("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],R.prototype,"readOpacity",null),Object(i.e)([Object(i.o)("opacity")],R.prototype,"writeOpacity",null),Object(i.e)([Object(i.y)({json:{type:i.N,write:{target:"parentLayerId",allowNull:!0,overridePolicy:T}}})],R.prototype,"parent",void 0),Object(i.e)([Object(i.o)("parent")],R.prototype,"writeParent",null),Object(i.e)([Object(i.y)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy:j,writer(e,t,r){t[r]=!e}}}})],R.prototype,"popupEnabled",void 0),Object(i.e)([Object(i.y)({type:c.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:j}}})],R.prototype,"popupTemplate",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],R.prototype,"defaultPopupTemplate",null),Object(i.e)([Object(i.y)({types:d.a,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:T},origins:{"web-scene":{types:d.n,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:T}}}}})],R.prototype,"renderer",null),Object(i.e)([Object(i.y)({types:{key:"type",base:null,typeMap:{"data-layer":m.a,"map-layer":m.d}},cast(e){if(e){if("mapLayerId"in e)return Object(i.bv)(m.d,e);if("dataSource"in e)return Object(i.bv)(m.a,e)}return e},json:{name:"layerDefinition.source",write:{overridePolicy:T}}})],R.prototype,"source",null),Object(i.e)([Object(i.y)()],R.prototype,"sourceJSON",void 0),Object(i.e)([Object(i.y)({value:null,json:{type:[i.N],write:{target:"subLayerIds",allowNull:!0,overridePolicy:T}}})],R.prototype,"sublayers",null),Object(i.e)([Object(i.v)("sublayers")],R.prototype,"castSublayers",null),Object(i.e)([Object(i.o)("sublayers")],R.prototype,"writeSublayers",null),Object(i.e)([Object(i.y)({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:j}}})],R.prototype,"title",void 0),Object(i.e)([Object(i.y)({type:String})],R.prototype,"typeIdField",void 0),Object(i.e)([Object(i.a1)("typeIdField",["layerDefinition.typeIdField"])],R.prototype,"readTypeIdField",null),Object(i.e)([Object(i.y)({type:[g.a],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],R.prototype,"types",void 0),Object(i.e)([Object(i.y)({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:S}}})],R.prototype,"url",null),Object(i.e)([Object(i.y)({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:T}}})],R.prototype,"visible",null),Object(i.e)([Object(i.o)("visible")],R.prototype,"writeVisible",null),R=w=Object(i.e)([Object(i.i)("esri.layers.support.Sublayer")],R);var F=R;const C=i.n.getLogger("esri.layers.TileLayer");const D=i.L.ofType(F);function L(e,t){e&&e.forEach((e=>{t(e),e.sublayers&&e.sublayers.length&&L(e.sublayers,t)}))}const N=e=>{let t=class extends e{constructor(...e){super(...e),this.allSublayers=new o.a({root:this,rootCollectionNames:["sublayers"],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{}},this.watch("sublayers",((e,t)=>this._handleSublayersChange(e,t)),!0)}readSublayers(e,t){if(!t||!e)return;const{sublayersSourceJSON:r}=this,n=Object(i.bE)(t.origin);if(n<2)return;if(r[n]={context:t,visibleLayers:e.visibleLayers||r[n].visibleLayers,layers:e.layers||r[n].layers},n>2)return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:s,origin:a}=this.createSublayersForOrigin("web-document"),o=Object(i.bB)(this);o.setDefaultOrigin(a),this._set("sublayers",new D(s)),o.setDefaultOrigin("user")}findSublayerById(e){return this.allSublayers.find((t=>t.id===e))}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(e){const t=Object(i.bE)("web-document"===e?"web-map":e);let r=2,n=this.sublayersSourceJSON[2].layers,s=this.sublayersSourceJSON[2].context,a=null;const o=[3,4,5].filter((e=>e<=t));for(const e of o){const t=this.sublayersSourceJSON[e];Object(x.b)(t.layers)&&(r=e,n=t.layers,s=t.context,t.visibleLayers&&(a={visibleLayers:t.visibleLayers,context:t.context}))}const l=[3,4,5].filter((e=>e>r&&e<=t));let c=null;for(const e of l){const{layers:t,visibleLayers:r,context:i}=this.sublayersSourceJSON[e];t&&(c={layers:t,context:i}),r&&(a={visibleLayers:r,context:i})}const u=function(e,t){const r=[],i={};return e?(e.forEach((e=>{const n=new F;if(n.read(e,t),i[n.id]=n,null!=e.parentLayerId&&-1!==e.parentLayerId){const t=i[e.parentLayerId];t.sublayers||(t.sublayers=[]),t.sublayers.unshift(n)}else r.unshift(n)})),r):r}(n,s),h=new Map,d=new Set;if(c)for(const e of c.layers)h.set(e.id,e);if(a)for(const e of a.visibleLayers)d.add(e);return L(u,(e=>{c&&e.read(h.get(e.id),c.context),a&&e.read({defaultVisibility:d.has(e.id)},a.context)})),{origin:Object(i.bD)(r),sublayers:new D({items:u})}}read(e,t){super.read(e,t),this.readSublayers(e,t)}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null,e.layer=null})),this.handles.remove("sublayers-owner")),e&&(e.forEach((e=>{e.parent=this,e.layer=this})),this.handles.add([e.on("after-add",(({item:e})=>{e.parent=this,e.layer=this})),e.on("after-remove",(({item:e})=>{e.parent=null,e.layer=null}))],"sublayers-owner"),"tile"===this.type&&this.handles.add(e.on("before-changes",(e=>{C.error(new i.s("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),e.preventDefault()})),"sublayers-owner"))}};return Object(i.e)([Object(i.y)({readOnly:!0})],t.prototype,"allSublayers",void 0),Object(i.e)([Object(i.y)({readOnly:!0,type:i.L.ofType(F)})],t.prototype,"serviceSublayers",void 0),Object(i.e)([Object(i.y)({value:null,type:D,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0),Object(i.e)([Object(i.y)({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0),t=Object(i.e)([Object(i.i)("esri.layers.mixins.SublayersOwner")],t),t}},function(e,t,r){"use strict";r.r(t),r.d(t,"registerFunctions",(function(){return c}));r(18);var i=r(0),n=r(9),s=r(166),a=r(369);r(1),r(24),r(347),r(51),r(6),r(82),r(83),r(17),r(322),r(324),r(72),r(5);function o(e){return 0===i.aF.indexOf("4.")?i.au.fromExtent(e):new i.au({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function l(e){if(Object(s.J)(e,2,2),e[0]instanceof i.ao&&e[1]instanceof i.ao);else if(e[0]instanceof i.ao&&null===e[1]);else if(e[1]instanceof i.ao&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new Error("Illegal Argument")}function c(e){"async"===e.mode&&(e.functions.disjoint=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null===r[0]||null===r[1]||Object(a.l)(r[0],r[1])}))},e.functions.intersects=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null!==r[0]&&null!==r[1]&&Object(a.r)(r[0],r[1])}))},e.functions.touches=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null!==r[0]&&null!==r[1]&&Object(a.a)(r[0],r[1])}))},e.functions.crosses=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null!==r[0]&&null!==r[1]&&Object(a.A)(r[0],r[1])}))},e.functions.within=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null!==r[0]&&null!==r[1]&&Object(a.B)(r[0],r[1])}))},e.functions.contains=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null!==r[0]&&null!==r[1]&&Object(a.x)(r[0],r[1])}))},e.functions.overlaps=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null!==r[0]&&null!==r[1]&&Object(a.i)(r[0],r[1])}))},e.functions.equals=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return Object(s.J)(r,2,2),r[0]===r[1]||(r[0]instanceof i.ao&&r[1]instanceof i.ao?Object(a.q)(r[0],r[1]):!(!Object(s.P)(r[0])||!Object(s.P)(r[1]))&&r[0].getTime()===r[1].getTime())}))},e.functions.relate=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,3,3),r[0]instanceof i.ao&&r[1]instanceof i.ao)return Object(a.s)(r[0],r[1],Object(s.K)(r[2]));if(r[0]instanceof i.ao&&null===r[1])return!1;if(r[1]instanceof i.ao&&null===r[0])return!1;if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")}))},e.functions.intersection=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null===r[0]||null===r[1]?null:Object(a.t)(r[0],r[1])}))},e.functions.union=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){const o=[];if(0===(n=Object(s.G)(n)).length)throw new Error("Function called with wrong number of Parameters");if(1===n.length)if(Object(s.Z)(n[0])){const e=Object(s.G)(n[0]);for(let t=0;t<e.length;t++)if(null!==e[t]){if(!(e[t]instanceof i.ao))throw new Error("Illegal Argument");o.push(e[t])}}else{if(!Object(s.E)(n[0])){if(n[0]instanceof i.ao)return Object(s.x)(Object(s.H)(n[0]),t.spatialReference);if(null===n[0])return null;throw new Error("Illegal Argument")}{const e=Object(s.G)(n[0].toArray());for(let t=0;t<e.length;t++)if(null!==e[t]){if(!(e[t]instanceof i.ao))throw new Error("Illegal Argument");o.push(e[t])}}}else for(let e=0;e<n.length;e++)if(null!==n[e]){if(!(n[e]instanceof i.ao))throw new Error("Illegal Argument");o.push(n[e])}return 0===o.length?null:Object(a.u)(o)}))},e.functions.difference=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null!==r[0]&&null===r[1]?Object(s.H)(r[0]):null===r[0]?null:Object(a.k)(r[0],r[1])}))},e.functions.symmetricdifference=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return l(r=Object(s.G)(r)),null===r[0]&&null===r[1]?null:null===r[0]?Object(s.H)(r[1]):null===r[1]?Object(s.H)(r[0]):Object(a.b)(r[0],r[1])}))},e.functions.clip=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,2),!(r[1]instanceof i.M)&&null!==r[1])throw new Error("Illegal Argument");if(null===r[0])return null;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");return null===r[1]?null:Object(a.v)(r[0],r[1])}))},e.functions.cut=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,2),!(r[1]instanceof i.aJ)&&null!==r[1])throw new Error("Illegal Argument");if(null===r[0])return[];if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");return null===r[1]?[Object(s.H)(r[0])]:Object(a.C)(r[0],r[1])}))},e.functions.area=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if(Object(s.J)(n,1,2),null===(n=Object(s.G)(n))[0])return 0;if(Object(s.l)(n[0]))return n[0].sumArea(Object(s.L)(Object(s.M)(n[1],-1)),!1,t.abortSignal).then((e=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(Object(s.Z)(n[0])||Object(s.E)(n[0])){const e=Object(s.Q)(n[0],t.spatialReference);return null===e?0:Object(a.o)(e,Object(s.L)(Object(s.M)(n[1],-1)))}if(!(n[0]instanceof i.ao))throw new Error("Illegal Argument");return Object(a.o)(n[0],Object(s.L)(Object(s.M)(n[1],-1)))}))},e.functions.areageodetic=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if(Object(s.J)(n,1,2),null===(n=Object(s.G)(n))[0])return 0;if(Object(s.l)(n[0]))return n[0].sumArea(Object(s.L)(Object(s.M)(n[1],-1)),!0,t.abortSignal).then((e=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(Object(s.Z)(n[0])||Object(s.E)(n[0])){const e=Object(s.Q)(n[0],t.spatialReference);return null===e?0:Object(a.g)(e,Object(s.L)(Object(s.M)(n[1],-1)))}if(!(n[0]instanceof i.ao))throw new Error("Illegal Argument");return Object(a.g)(n[0],Object(s.L)(Object(s.M)(n[1],-1)))}))},e.functions.length=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if(Object(s.J)(n,1,2),null===(n=Object(s.G)(n))[0])return 0;if(Object(s.l)(n[0]))return n[0].sumLength(Object(s.R)(Object(s.M)(n[1],-1)),!1,t.abortSignal).then((e=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(Object(s.Z)(n[0])||Object(s.E)(n[0])){const e=Object(s.U)(n[0],t.spatialReference);return null===e?0:Object(a.c)(e,Object(s.R)(Object(s.M)(n[1],-1)))}if(!(n[0]instanceof i.ao))throw new Error("Illegal Argument");return Object(a.c)(n[0],Object(s.R)(Object(s.M)(n[1],-1)))}))},e.functions.lengthgeodetic=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if(Object(s.J)(n,1,2),null===(n=Object(s.G)(n))[0])return 0;if(Object(s.l)(n[0]))return n[0].sumLength(Object(s.R)(Object(s.M)(n[1],-1)),!0,t.abortSignal).then((e=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(Object(s.Z)(n[0])||Object(s.E)(n[0])){const e=Object(s.U)(n[0],t.spatialReference);return null===e?0:Object(a.h)(e,Object(s.R)(Object(s.M)(n[1],-1)))}if(!(n[0]instanceof i.ao))throw new Error("Illegal Argument");return Object(a.h)(n[0],Object(s.R)(Object(s.M)(n[1],-1)))}))},e.functions.distance=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){n=Object(s.G)(n),Object(s.J)(n,2,3);let o=n[0];(Object(s.Z)(n[0])||Object(s.E)(n[0]))&&(o=Object(s.V)(n[0],t.spatialReference));let l=n[1];if((Object(s.Z)(n[1])||Object(s.E)(n[1]))&&(l=Object(s.V)(n[1],t.spatialReference)),!(o instanceof i.ao))throw new Error("Illegal Argument");if(!(l instanceof i.ao))throw new Error("Illegal Argument");return Object(a.w)(o,l,Object(s.R)(Object(s.M)(n[2],-1)))}))},e.functions.distancegeodetic=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){r=Object(s.G)(r),Object(s.J)(r,2,3);const n=r[0],o=r[1];if(!(n instanceof i._))throw new Error("Illegal Argument");if(!(o instanceof i._))throw new Error("Illegal Argument");const l=new i.aJ({paths:[],spatialReference:n.spatialReference});return l.addPath([n,o]),Object(a.h)(l,Object(s.R)(Object(s.M)(r[2],-1)))}))},e.functions.densify=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,3),null===r[0])return null;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");const n=Object(s.X)(r[1]);if(isNaN(n))throw new Error("Illegal Argument");if(n<=0)throw new Error("Illegal Argument");return r[0]instanceof i.au||r[0]instanceof i.aJ?Object(a.j)(r[0],n,Object(s.R)(Object(s.M)(r[2],-1))):r[0]instanceof i.M?Object(a.j)(o(r[0]),n,Object(s.R)(Object(s.M)(r[2],-1))):r[0]}))},e.functions.densifygeodetic=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,3),null===r[0])return null;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");const n=Object(s.X)(r[1]);if(isNaN(n))throw new Error("Illegal Argument");if(n<=0)throw new Error("Illegal Argument");return r[0]instanceof i.au||r[0]instanceof i.aJ?Object(a.m)(r[0],n,Object(s.R)(Object(s.M)(r[2],-1))):r[0]instanceof i.M?Object(a.m)(o(r[0]),n,Object(s.R)(Object(s.M)(r[2],-1))):r[0]}))},e.functions.generalize=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,4),null===r[0])return null;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");const n=Object(s.X)(r[1]);if(isNaN(n))throw new Error("Illegal Argument");return Object(a.d)(r[0],n,Object(s.W)(Object(s.M)(r[2],!0)),Object(s.R)(Object(s.M)(r[3],-1)))}))},e.functions.buffer=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,3),null===r[0])return null;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");const n=Object(s.X)(r[1]);if(isNaN(n))throw new Error("Illegal Argument");return 0===n?Object(s.H)(r[0]):Object(a.n)(r[0],n,Object(s.R)(Object(s.M)(r[2],-1)))}))},e.functions.buffergeodetic=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,3),null===r[0])return null;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");const n=Object(s.X)(r[1]);if(isNaN(n))throw new Error("Illegal Argument");return 0===n?Object(s.H)(r[0]):Object(a.p)(r[0],n,Object(s.R)(Object(s.M)(r[2],-1)))}))},e.functions.offset=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,2,6),null===r[0])return null;if(!(r[0]instanceof i.au||r[0]instanceof i.aJ))throw new Error("Illegal Argument");const n=Object(s.X)(r[1]);if(isNaN(n))throw new Error("Illegal Argument");const o=Object(s.X)(Object(s.M)(r[4],10));if(isNaN(o))throw new Error("Illegal Argument");const l=Object(s.X)(Object(s.M)(r[5],0));if(isNaN(l))throw new Error("Illegal Argument");return Object(a.e)(r[0],n,Object(s.R)(Object(s.M)(r[2],-1)),Object(s.K)(Object(s.M)(r[3],"round")).toLowerCase(),o,l)}))},e.functions.rotate=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){r=Object(s.G)(r),Object(s.J)(r,2,3);let n=r[0];if(null===n)return null;if(!(n instanceof i.ao))throw new Error("Illegal Argument");n instanceof i.M&&(n=i.au.fromExtent(n));const o=Object(s.X)(r[1]);if(isNaN(o))throw new Error("Illegal Argument");const l=Object(s.M)(r[2],null);if(null===l)return Object(a.y)(n,o);if(l instanceof i._)return Object(a.y)(n,o,l);throw new Error("Illegal Argument")}))},e.functions.centroid=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if(n=Object(s.G)(n),Object(s.J)(n,1,1),null===n[0])return null;let a=n[0];if((Object(s.Z)(n[0])||Object(s.E)(n[0]))&&(a=Object(s.V)(n[0],t.spatialReference)),null===a)return null;if(!(a instanceof i.ao))throw new Error("Illegal Argument");return a instanceof i._?Object(s.x)(Object(s.H)(n[0]),t.spatialReference):a instanceof i.au?a.centroid:a instanceof i.aJ?Object(s.Y)(a):a instanceof i.aK?Object(s.$)(a):a instanceof i.M?a.center:null}))},e.functions.multiparttosinglepart=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,o){o=Object(s.G)(o),Object(s.J)(o,1,1);const l=[];if(null===o[0])return null;if(!(o[0]instanceof i.ao))throw new Error("Illegal Argument");return o[0]instanceof i._||o[0]instanceof i.M?[Object(s.x)(Object(s.H)(o[0]),t.spatialReference)]:Object(a.f)(o[0]).then((e=>{if(e instanceof i.au){const t=[],r=[];for(let i=0;i<e.rings.length;i++)if(e.isClockwise(e.rings[i])){const r=Object(n.e)({rings:[e.rings[i]],hasZ:!0===e.hasZ,hazM:!0===e.hasM,spatialReference:e.spatialReference.toJSON()});t.push(r)}else r.push({ring:e.rings[i],pt:e.getPoint(i,0)});for(let e=0;e<r.length;e++)for(let i=0;i<t.length;i++)if(t[i].contains(r[e].pt)){t[i].addRing(r[e].ring);break}return t}if(e instanceof i.aJ){const t=[];for(let r=0;r<e.paths.length;r++){const i=Object(n.e)({paths:[e.paths[r]],hasZ:!0===e.hasZ,hazM:!0===e.hasM,spatialReference:e.spatialReference.toJSON()});t.push(i)}return t}if(o[0]instanceof i.aK){const e=Object(s.x)(Object(s.H)(o[0]),t.spatialReference);for(let t=0;t<e.points.length;t++)l.push(e.getPoint(t));return l}return null}))}))},e.functions.issimple=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,1,1),null===r[0])return!0;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");return Object(a.z)(r[0])}))},e.functions.simplify=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if(r=Object(s.G)(r),Object(s.J)(r,1,1),null===r[0])return null;if(!(r[0]instanceof i.ao))throw new Error("Illegal Argument");return Object(a.f)(r[0])}))})}},function(e,t,r){"use strict";r.r(t),r.d(t,"A",(function(){return z})),r.d(t,"C",(function(){return A})),r.d(t,"D",(function(){return X})),r.d(t,"E",(function(){return R})),r.d(t,"T",(function(){return U})),r.d(t,"_",(function(){return w})),r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return Z})),r.d(t,"c",(function(){return L})),r.d(t,"d",(function(){return M})),r.d(t,"e",(function(){return I})),r.d(t,"f",(function(){return Y})),r.d(t,"j",(function(){return q})),r.d(t,"k",(function(){return G})),r.d(t,"q",(function(){return J})),r.d(t,"r",(function(){return v})),r.d(t,"v",(function(){return E})),r.d(t,"w",(function(){return j})),r.d(t,"y",(function(){return P}));r(25),r(18);var i=r(0),n=r(166),s=r(390),a=r(221),o=r(20),l=r(51),c=r(104),u=r(333),h=r(115),d=r(9),f=r(83),p=r(53),y=r(14),g=r(119),m=r(44),b=r(89),_=r(58),x=r(27);class v{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}featureSetByName(e,t=!0,r=["*"]){return void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])}featureSetById(e,t=!0,r=["*"]){return void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])}castToText(){return"object, FeatureSetCollection"}resolvePromise(e){return Object(i.cI)(e)}}class w extends s.q{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=e.parentfeatureset,e.whereclause instanceof a.WhereClause?(this._whereclause=e.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=e.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new i.A({wkid:4326}),this.geometryType=n.a0.point)}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getFilteredSet("",null,this._whereclause,null,e))).then((t=>(this._checkCancelled(e),null!==this._whereClauseFunction?this._wset=new s.o(t._candidates.slice(0).concat(t._known.slice(0)),[],t._ordered,this._clonePageDefinition(t.pagesDefinition)):this._wset=new s.o(t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset))):Object(i.cI)(this._wset)}_isInFeatureSet(e){let t=this._parent._isInFeatureSet(e);return t===n.a1.NotInFeatureSet?t:(t=this._idstates[e],void 0===t?n.a1.Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,i){return this._parent._getFeatures(e,t,r,i)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeWhereClause(e){return this._whereclause.testFeature(e)}executeWhereClauseDeferred(e){if(null!==this._whereClauseFunction)try{const t=this._whereClauseFunction(e);return Object(i.S)(t)?t:Object(i.cI)(t)}catch(e){return Object(i.af)(e)}return Object(i.cI)(this.executeWhereClause(e))}_fetchAndRefineFeatures(e,t,r){const a=new s.o([],e,!1,null),o=Math.min(t,e.length);return this._parent._getFeatures(a,-1,o,r).then((()=>{if(this._checkCancelled(r),null==this._whereClauseFunction){for(let t=0;t<o;t++){const r=this._parent._featureFromCache(e[t]);!0===this.executeWhereClause(r)?this._idstates[e[t]]=n.a1.InFeatureSet:this._idstates[e[t]]=n.a1.NotInFeatureSet}return"success"}const s=[];for(let t=0;t<o;t++){const r=this._parent._featureFromCache(e[t]);s.push(this.executeWhereClauseDeferred(r))}return Object(i.cD)(s).then((r=>{for(let i=0;i<t;i++)!0===r[i]?this._idstates[e[i]]=n.a1.InFeatureSet:this._idstates[e[i]]=n.a1.NotInFeatureSet;return"success"}))}))}_getFilteredSet(e,t,r,i,n){return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=Object(s.l)(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,i,n))).then((e=>{let t;return this._checkCancelled(n),t=null!==this._whereClauseFunction?new s.o(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):new s.o(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),t}))}_stat(e,t,r,n,a,o,l){if(null!==this._whereClauseFunction)return null===a&&""===r&&null===n?this._manualStat(e,t,o,l):Object(i.cI)({calculated:!1});let c=this._whereclause;return null!==a&&null!==this._whereclause&&(c=Object(s.l)(this._whereclause,a)),this._parent._stat(e,t,r,n,c,o,l).then((i=>!1===i.calculated?null===a&&""===r&&null===n?this._manualStat(e,t,o,l):{calculated:!1}:i))}_canDoAggregates(e,t,r,n,a){return null!==this._whereClauseFunction?Object(i.cI)(!1):(null!==a?null!==this._whereclause&&(a=Object(s.l)(this._whereclause,a)):a=this._whereclause,null===this._parent?Object(i.cI)(!1):this._parent._canDoAggregates(e,t,r,n,a))}_getAggregatePagesDataSourceDefinition(e,t,r,n,a,o,l){return null===this._parent?Object(i.af)(new Error("Should never be called")):(null!==a?null!==this._whereclause&&(a=Object(s.l)(this._whereclause,a)):a=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,o,l))}static registerAction(){s.q._featuresetFunctions.filter=function(e){if("function"==typeof e)return new w({parentfeatureset:this,whereclause:e});let t=null;return e instanceof a.WhereClause&&(t=e),new w({parentfeatureset:this,whereclause:t})}}}function O(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}class I{constructor(e){const t=e.split(",");this._fields=[],this._directions=[];for(let e=0;e<t.length;e++){const r=t[e].match(/\S+/g);this._fields.push(r[0]),2===r.length?"asc"===r[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let e="";for(let t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}order(e){e.sort(((e,t)=>{for(let r=0;r<this._fields.length;r++){const i=this.featureValue(e.feature,this._fields[r],r),n=this.featureValue(t.feature,this._fields[r],r);let s=0;if(s=1===this._directions[r]?O(i,n):-1*O(i,n),0!==s)return s}return 0}))}scanForField(e){for(let t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}replaceFields(e){let t="";for(let r=0;r<this._fields.length;r++){0!==r&&(t+=",");let i=this._fields[r];for(const t of e)if(i.toLowerCase()===t.field.toLowerCase()){i=t.newfield;break}t+=i,1===this._directions[r]?t+=" ASC":t+=" DESC"}return new I(t)}featureValue(e,t,r){const i=e.attributes[t];if(void 0!==i)return i;for(const i in e.attributes)if(t.toLowerCase()===i.toLowerCase())return this._fields[r]=i,e.attributes[i];return null}}class S extends s.q{constructor(e){super(e),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=e.orderbyclause,this._parent=e.parentfeatureset}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,this._orderbyclause,e))).then((t=>(this._checkCancelled(e),this._wset=t,this._wset))):Object(i.cI)(this._wset)}manualOrderSet(e,t){return this.getIdColumnDictionary(e,[],-1,t).then((e=>{this._orderbyclause.order(e);const t=new s.o([],[],!0,null);for(let r=0;r<e.length;r++)t._known.push(e[r].id);return t}))}getIdColumnDictionary(e,t,r,s){if(r<e._known.length-1){const i=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return Object(n.a2)(this._parent._expandPagedSet(e,i,0,0,s)).then((()=>this.getIdColumnDictionary(e,t,r,s)));let a=r+1;const o=[];for(;a<e._known.length&&"GETPAGES"!==e._known[a];)o.push(e._known[a]),a++;return r+=o.length,Object(n.a2)(this._parent._getFeatureBatch(o,s)).then((i=>{this._checkCancelled(s);for(const e of i)t.push({id:e.attributes[this.objectIdField],feature:e});return this.getIdColumnDictionary(e,t,r,s)}))}return e._candidates.length>0?Object(n.a2)(this._refineSetBlock(e,this._maxProcessingRate(),s)).then((()=>(this._checkCancelled(s),this.getIdColumnDictionary(e,t,r,s)))):Object(i.cI)(t)}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,i){return this._parent._getFeatures(e,t,r,i)}_featureFromCache(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}_fetchAndRefineFeatures(){return Object(i.af)(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(e,t,r,i,n){return this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,null===i?this._orderbyclause:i,n))).then((e=>{this._checkCancelled(n);const i=new s.o(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition));let a=!0;return e._candidates.length>0&&(a=!1),!1===i._ordered?this.manualOrderSet(i,n).then((e=>(!1===a&&(null===t&&null===r||(e=new s.o(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e))):i}))}static registerAction(){s.q._featuresetFunctions.orderBy=function(e){return""===e?this:new S({parentfeatureset:this,orderbyclause:new I(e)})}}}class T{constructor(){this.sqlRewritable=!1}postInitialization(e,t){}}class j extends T{constructor(e){super(),this.field=e,this.sqlRewritable=!0}extractValue(e){return e.attributes[this.field.name]}rewriteSql(e){return{rewritten:this.sqlRewritable,where:e}}}class E extends T{constructor(e,t,r){super(),this.originalField=e,this.sqlRewritable=!0,this.field=Object(n.a3)(e),this.field.name=t,this.field.alias=r}rewriteSql(e,t){return{rewritten:this.sqlRewritable,where:Object(s.n)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}extractValue(e){return e.attributes[this.originalField.name]}}class A extends T{constructor(e,t,r){super(),this.field=e,this.codefield=t,this.lkp=r,this.reverseLkp={};for(const e in r)this.reverseLkp[r[e]]=e;this.sqlRewritable=!0}rewriteSql(e,t){const r=this.evaluateNodeToWhereClause(e.parseTree,n.a4.Standardised,this.field.name,this.codefield instanceof a.WhereClause?Object(s.k)(this.codefield,n.a4.Standardised):this.codefield,e.parameters);return r.indexOf(A.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:a.WhereClause.create(r,t._parent.getFieldsIndex())}}evaluateNodeToWhereClause(e,t,r=null,i=null,n){let a,o,l,c;switch(e.type){case"interval":return Object(s.r)(this.evaluateNodeToWhereClause(e.value,t,r,i,n),e.qualifier,e.op);case"case_expression":{let i=" CASE ";"simple"===e.format&&(i+=this.evaluateNodeToWhereClause(e.operand,t,r,A.BADNESS,n));for(let s=0;s<e.clauses.length;s++)i+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[s].operand,t,r,A.BADNESS,n)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[s].value,t,r,A.BADNESS,n);return null!==e.else&&(i+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,r,A.BADNESS,n)),i+=" END ",i}case"param":{const r=n[e.value.toLowerCase()];if("string"==typeof r)return"'"+n[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(r instanceof Date)return Object(s.p)(r,t);if(r instanceof Array){const e=[];for(let i=0;i<r.length;i++)"string"==typeof r[i]?e.push("'"+r[i].toString().replace(/'/g,"''")+"'"):r[i]instanceof Date?e.push(Object(s.p)(r[i],t)):e.push(r[i].toString());return e}return r.toString()}case"expr_list":o=[];for(const s of e.value)o.push(this.evaluateNodeToWhereClause(s,t,r,i,n));return o;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,r,A.BADNESS,n)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" AND "+this.evaluateNodeToWhereClause(e.right,t,r,i,n)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" OR "+this.evaluateNodeToWhereClause(e.right,t,r,i,n)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" IS NOT NULL )";case"IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let a=!0;for(const t of e.right.value){if("string"!==t.type){a=!1;break}if(void 0===this.lkp[t.value]){a=!1;break}s.push(this.lkp[t.value].toString())}if(a)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" IN ("+s.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,r,i,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" IN ("+a.join(",")+")) "}return c=this.evaluateNodeToWhereClause(e.right,t,r,i,n),c instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" IN ("+c.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" IN ("+c+")) ";case"NOT IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let a=!0;for(const t of e.right.value){if("string"!==t.type){a=!1;break}if(void 0===this.lkp[t.value]){a=!1;break}s.push(this.lkp[t.value].toString())}if(a)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" NOT IN ("+s.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,r,i,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" NOT IN ("+a.join(",")+")) "}return c=this.evaluateNodeToWhereClause(e.right,t,r,i,n),c instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" NOT IN ("+c.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,i,n)+" NOT IN ("+c+")) ";case"BETWEEN":return l=this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"NOTBETWEEN":return l=this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" NOT BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+i+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+i+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,A.BADNESS,n)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,A.BADNESS,n)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return Object(s.p)(e.value,t);case"number":return e.value.toString();case"current_time":return Object(s.h)("date"===e.mode,t);case"column_ref":return r&&r.toLowerCase()===e.column.toLowerCase()?"("+i+")":e.column;case"function":{const i=this.evaluateNodeToWhereClause(e.args,t,r,A.BADNESS,n);return Object(s.i)(e.name,i,t)}}throw new Error("Unsupported sql syntax "+e.type)}extractValue(e){return this.codefield instanceof a.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}A.BADNESS="_!!!_BAD_LKP_!!!!";class M extends T{constructor(e,t){super(),this.field=e,this.sql=t}rewriteSql(e,t){return{rewritten:!0,where:Object(s.n)(e,this.field.name,Object(s.k)(this.sql,n.a4.Standardised),t.getFieldsIndex())}}extractValue(e){return this.sql.calculateValueCompiled(e)}}class R extends s.q{constructor(e){super(e),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=null,this._extraFilter=null,this._extraFilter=e.extraFilter,this._parent=e.parentfeatureset,this._maxProcessing=30,this.adaptedFields=e.adaptedFields}static findField(e,t){for(const r of e)if(r.name.toLowerCase()===t.toString().toLowerCase())return r;return null}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new i.A({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=n.a0.point,this.typeIdField="",this.types=null),this.fields=[];for(const e of this.adaptedFields)e.postInitialization(this,this._parent),this.fields.push(e.field)}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._extraFilter?this._getFilteredSet("",null,null,null,e):this._parent._getSet(e))).then((t=>(this._checkCancelled(e),this._wset=new s.o(t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset))):Object(i.cI)(this._wset)}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,a){const l=[];-1!==t&&void 0===this._featureCache[t]&&l.push(t);const c=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,c))return this._expandPagedSet(e,c,0,0,a).then((()=>this._getFeatures(e,t,r,a)));let u=0;for(let i=e._lastFetchedIndex;i<e._known.length&&(u++,u<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&l.push(e._known[i]),l.length>=c-1)));i++);if(0===l.length)return Object(i.cI)("success");e=new s.o([],l,e._ordered,null);const h=Math.min(l.length,r);return this._parent._getFeatures(e,-1,h,a).then((()=>{this._checkCancelled(a);const e=[];for(let t=0;t<h;t++){const r=this._parent._featureFromCache(l[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:l[t]})}for(const t of e){const e=[];for(const r of this.adaptedFields)e[r.field.name]=r.extractValue(t);this._featureCache[t.id]=new o.a({attributes:e,geometry:Object(n.H)(t.geometry)})}return"success"}))}_fetchAndRefineFeatures(){return Object(i.af)(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(e,t,r,i,n){let a=!1;const o=this.reformulateWithoutAdaptions(r);a=o.cannot,r=o.where;let l=!1;if(null!==i){l=!0;const e=[];for(const t of this.adaptedFields)if(!(t instanceof j)&&!0===i.scanForField(t.field.name)){if(!(t instanceof E)){i=null,l=!1;break}e.push({field:t.field.name,newfield:t.originalField.name})}i&&e.length>0&&(i=i.replaceFields(e))}return null!==r?null!==this._extraFilter&&(r=Object(s.l)(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,i,n))).then((e=>{let t;return this._checkCancelled(n),t=!0===a?new s.o(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new s.o(e._candidates.slice(0),e._known.slice(0),!0===l&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),t}))}reformulateWithoutAdaptions(e){const t={cannot:!1,where:e};if(null!==e)for(const r of this.adaptedFields)if(!0===Object(s.g)(e,r.field.name)){const i=r.rewriteSql(e,this);if(!0!==i.rewritten){t.cannot=!0,t.where=null;break}t.where=i.where}return t}_stat(e,t,r,n,a,o,l){let c=!1,u=this.reformulateWithoutAdaptions(t);return c=u.cannot,t=u.where,u=this.reformulateWithoutAdaptions(a),c=c||u.cannot,null!==(a=u.where)?null!==this._extraFilter&&(a=Object(s.l)(this._extraFilter,a)):a=this._extraFilter,!0===c?null===a&&""===r&&null===n?this._manualStat(e,t,o,l):Object(i.cI)({calculated:!1}):this._parent._stat(e,t,r,n,a,o,l).then((i=>!1===i.calculated?null===a&&""===r&&null===n?this._manualStat(e,t,o,l):{calculated:!1}:i))}_canDoAggregates(e,t,r,n,a){if(null===this._parent)return Object(i.cI)(!1);for(let t=0;t<e.length;t++)for(const r of this.adaptedFields)if(e[t].toLowerCase()===r.field.name.toLowerCase()&&!(r instanceof j))return Object(i.cI)(!1);const o=[];for(let e=0;e<t.length;e++){const r=t[e];if(null!==r.workingexpr){const e=this.reformulateWithoutAdaptions(r.workingexpr);if(e.cannot)return Object(i.cI)(!1);const t=r.clone();t.workingexpr=e.where,o.push(t)}else o.push(r)}const l=this.reformulateWithoutAdaptions(a);return l.cannot?Object(i.cI)(!1):(null!==(a=l.where)?null!==this._extraFilter&&(a=Object(s.l)(this._extraFilter,a)):a=this._extraFilter,this._parent._canDoAggregates(e,o,r,n,a))}_getAggregatePagesDataSourceDefinition(e,t,r,n,a,o,l){if(null===this._parent)return Object(i.af)(new Error("Should never be called"));const c=[];for(let e=0;e<t.length;e++){const r=t[e];if(null!==r.workingexpr){const e=this.reformulateWithoutAdaptions(r.workingexpr);if(e.cannot)return Object(i.af)(new Error("Should never be called"));const t=r.clone();t.workingexpr=e.where,c.push(t)}else c.push(r)}const u=this.reformulateWithoutAdaptions(a);return u.cannot?Object(i.af)(new Error("Should never be called")):(null!==(a=u.where)?null!==this._extraFilter&&(a=Object(s.l)(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,c,r,n,a,o,l))}}class F{clone(){const e=new F;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r){const i=new F;i.field=e;const o=a.WhereClause.create(t,r),l=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");const t=a.WhereClause.create(Object(s.b)(e.parseTree.args.value[0],n.a4.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(o);if(null===l)throw new Error("Invalid Statistic Function");const c=l.name.toUpperCase().trim();if("MIN"===c){if(i.typeofstat="MIN",i.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===c){if(i.typeofstat="MAX",i.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===c)i.typeofstat="COUNT",i.workingexpr=l.expr;else if("STDEV"===c){if(i.typeofstat="STDDEV",i.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===c){if(i.typeofstat="SUM",i.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===c){if(i.typeofstat="AVG",i.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===c){if(i.typeofstat="AVG",i.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==c)throw new Error("Invalid Statistic Function");if(i.typeofstat="VAR",i.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}return i}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}}}function C(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class D extends s.q{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){return null===this._wset?this._getFilteredSet("",null,null,null,e).then((e=>(this._wset=e,this._wset))):Object(i.cI)(this._wset)}_isInFeatureSet(){return n.a1.InFeatureSet}nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const o=this._parent?this._parent.getFieldsIndex():new c.a([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let e=!1;for(let t=0;t<this._config.groupbyfields.length;t++)if(this._config.groupbyfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}if(!1===e)for(let t=0;t<this._config.statsfields.length;t++)if(this._config.statsfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}!1===e?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const e of this._config.statsfields){const t=new F;t.field=e.name,t.tofieldname=e.name,t.workingexpr=e.expression instanceof a.WhereClause?e.expression:a.WhereClause.create(e.expression,o),t.typeofstat=C(e.statistic),this._decodedStatsfield.push(t)}this._decodedGroupbyfield=[];for(const e of this._config.groupbyfields){const t={name:e.name,singlefield:null,tofieldname:e.name,expression:e.expression instanceof a.WhereClause?e.expression:a.WhereClause.create(e.expression,o)};this._decodedGroupbyfield.push(t)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const t of this._parent.fields)e[t.name.toUpperCase()]=1;this.types=null}else this.geometryType=n.a0.point,this.typeIdField="",this.types=null,this.spatialReference=new i.A({wkid:4326});this.fields=[];const u=new F;u.field=this.nextUniqueName(e),u.tofieldname=this.objectIdField,u.workingexpr=a.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),u.typeofstat="MIN",this._decodedStatsfield.push(u);for(const t of this._decodedGroupbyfield){const r=new l.a;if(t.name=this.nextUniqueName(e),r.name=t.tofieldname,r.alias=r.name,Object(s.a)(t.expression)){const e=this._parent.getField(Object(s.k)(t.expression,n.a4.Standardised));if(!e)throw new Error("Field is not present for Aggregation");t.name=e.name,t.singlefield=e.name,this.phsyicalgroupbyfields.push(e.name),r.type=e.type}else{r.type=this.convertToEsriFieldType(Object(s.e)(t.expression,this._parent.fields));const e=new l.a;e.name=t.name,e.alias=e.name,this.phsyicalgroupbyfields.push(t.name),this._adaptedFields.push(new M(e,t.expression)),this._candosimplegroupby=!1}this.fields.push(r)}if(this._adaptedFields.length>0)for(const e of this._parent.fields)this._adaptedFields.push(new j(e));for(let t=0;t<this._decodedStatsfield.length;t++){const r=new l.a;let i=null;const a=this._decodedStatsfield[t];a.field=this.nextUniqueName(e),a.tofieldname===this.objectIdField&&(this._internalObjectIdField=a.field),r.name=a.tofieldname,r.alias=r.name;const o=null!==a.workingexpr&&Object(s.a)(a.workingexpr)?Object(s.k)(a.workingexpr,n.a4.Standardised):"";switch(this._decodedStatsfield[t].typeofstat){case"SUM":if(""!==o){if(i=this._parent.getField(o),!i)throw new Error("Field is not present for Aggregation");r.type=i.type}else r.type="double";break;case"MIN":case"MAX":if(""!==o){if(i=this._parent.getField(o),!i)throw new Error("Field is not present for Aggregation");r.type=i.type}else r.type="double";break;case"COUNT":r.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==o&&(i=this._parent.getField(o),!i))throw new Error("Field is not present for Aggregation");r.type="double"}this.fields.push(r)}}_canDoAggregates(){return Object(i.cI)(!1)}_getFeatures(e,t,r,n){-1!==t&&this._featureCache[t];const s=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,s)?this._expandPagedSet(e,s,0,0,n).then((()=>this._getFeatures(e,t,r,n))):Object(i.cI)("success")}_getFilteredSet(e,t,r,n,a){if(""!==e)return Object(i.cI)(new s.o([],[],!0,null));let o=null;const l={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then((()=>{if(null!==r)for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===Object(s.g)(r,this._decodedStatsfield[e].tofieldname)){l.nowhereclause=!0,r=null;break}if(null!==n){l.ordered=!0;for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===n.scanForField(this._decodedStatsfield[e].tofieldname)){n=null,l.ordered=!1;break}if(null!==n)for(const e of this._decodedGroupbyfield)if(null===e.singlefield&&!0===n.scanForField(e.tofieldname)){n=null,l.ordered=!1;break}}return!1===this._candosimplegroupby?Object(i.cI)(!1):this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null)})).then((e=>{if(e){let e=null;r&&(e=this._reformulateWhereClauseWithoutGroupByFields(r));let t=null;return n&&(t=this._reformulateOrderClauseWithoutGroupByFields(n)),this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,e,t,this._internalObjectIdField).then((e=>(this._checkCancelled(a),o=!0===l.nowhereclause?new s.o(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new s.o(e._candidates.slice(0),e._known.slice(0),!0===l.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),o)))}let t=this._parent;if(this._adaptedFields.length>0&&(t=new R({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===l.nowhereclause)o=new s.o(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new S({parentfeatureset:t,orderbyclause:new I(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}});else{let e=t;if(null!==r){let t=null;r&&(t=this._reformulateWhereClauseWithoutGroupByFields(r)),e=new w({parentfeatureset:e,whereclause:t})}o=new s.o(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new S({parentfeatureset:e,orderbyclause:new I(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})}return o}))}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=Object(s.n)(e,t.tofieldname,Object(s.k)(t.workingexpr,n.a4.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=Object(s.n)(e,t.tofieldname,Object(s.k)(t.expression,n.a4.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const e of this._decodedGroupbyfield)e.tofieldname!==e.name&&t.push({field:e.tofieldname,newfield:e.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,r){try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery))return this._expandPagedSet(e,this._maxQuery,0,0,r).then((()=>this._refineSetBlock(e,t,r)));this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,Object(i.cI)(e)}catch(e){return Object(i.af)(e)}}_expandPagedSet(e,t,r,i,n){return this._expandPagedSetFeatureSet(e,t,r,i,n)}_getPhysicalPage(e,t,r){return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?Object(i.cH)(((t,i)=>{this._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]).then((e=>{t(e)}),i)})):this._getAgregagtePhysicalPage(e,t,r).then((e=>{for(const t of e){const e={geometry:t.geometry,attributes:{}};for(const r of this._decodedGroupbyfield)e.attributes[r.tofieldname]=t.attributes[r.name];for(const r of this._decodedStatsfield)e.attributes[r.tofieldname]=t.attributes[r.field];this._featureCache[e.attributes[this.objectIdField]]=new o.a(e)}return e.length}))}_sequentialGetPhysicalItem(e,t,r,n){return Object(i.cH)(((i,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):this._nextAggregateItem(e,t,r,n,(s=>{null===s?i(n.length):(t-=1,i(this._sequentialGetPhysicalItem(e,t,r,n)))}),s)}))}_nextAggregateItem(e,t,r,i,s,a){try{Object(n.a2)(e.pagesDefinition.internal.iterator.next()).then((n=>{if(null===n)if(null!==e.pagesDefinition.internal.workingItem){const t=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);i.push(t),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,s(null)}else e.pagesDefinition.internal.fullyResolved=!0,s(null);else{const o=this._generateAggregateHash(n);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[n],id:o};else{if(o!==e.pagesDefinition.internal.workingItem.id){const r=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return i.push(r),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(r.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[n],id:o},void s(r)}e.pagesDefinition.internal.workingItem.features.push(n)}this._nextAggregateItem(e,t,r,i,s,a)}}),a)}catch(e){a(e)}}_calculateFieldStat(e,t,r){const i=[];for(let r=0;r<e.features.length;r++)if(null!==t.workingexpr){const n=t.workingexpr.calculateValue(e.features[r]);null!==n&&i.push(n)}else i.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=Object(s.m)("min",i,-1);break;case"MAX":r.attributes[t.tofieldname]=Object(s.m)("max",i,-1);break;case"SUM":r.attributes[t.tofieldname]=Object(s.m)("sum",i,-1);break;case"COUNT":r.attributes[t.tofieldname]=i.length;break;case"VAR":r.attributes[t.tofieldname]=Object(s.m)("var",i,-1);break;case"STDDEV":r.attributes[t.tofieldname]=Object(s.m)("stddev",i,-1);break;case"AVG":r.attributes[t.tofieldname]=Object(s.m)("avg",i,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const r of this._decodedGroupbyfield){const i=r.singlefield?e.features[0].attributes[r.singlefield]:r.expression.calculateValue(e.features[0]);t.attributes[r.tofieldname]=i}for(const r of this._decodedStatsfield)this._calculateFieldStat(e,r,t);const r=[];for(let i=0;i<this._decodedStatsfield.length;i++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[i],t));return this._featureCache[t.attributes[this.objectIdField]]=new o.a({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const i=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==i?":":":"+i.toString()}return Object(u.b)(t,u.a.String)}_stat(){return Object(i.cI)({calculated:!1})}getFeatureByObjectId(){return Object(i.cI)(null)}static registerAction(){s.q._featuresetFunctions.groupby=function(e,t){return new D({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}class L extends s.q{constructor(e){super(e),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=e.topnum,this._parent=e.parentfeatureset}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getSet(e))).then((e=>(this._wset=new s.o(e._candidates.slice(0),e._known.slice(0),!1,this._clonePageDefinition(e.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset))):Object(i.cI)(this._wset)}_setKnownLength(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}_isInFeatureSet(e){const t=this._parent._isInFeatureSet(e);if(t===n.a1.NotInFeatureSet)return t;const r=this._idstates[e];return r===n.a1.InFeatureSet||r===n.a1.NotInFeatureSet?r:t===n.a1.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=n.a1.InFeatureSet,this._countedin++,n.a1.InFeatureSet):(this._idstates[e]=n.a1.NotInFeatureSet,n.a1.NotInFeatureSet):n.a1.Unknown}_expandPagedSet(e,t,r,n,s){if(null===this._parent)return Object(i.af)(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){let t=e._known.length;return t>0&&"GETPAGES"===e._known[t-1]&&(e._known.length=t-1),t=e._candidates.length,t>0&&"GETPAGES"===e._candidates[t-1]&&(e._candidates.length=t-1),Object(i.cI)("success")}return this._parent._expandPagedSet(e,t,r,n,s).then((t=>(this._setKnownLength(e)>this._topnum&&(e._known.length=this._topnum),this._setKnownLength(e)>=this._topnum&&(e._candidates.length=0),t)))}_getFeatures(e,t,r,n){const a=[],o=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,o))return this._expandPagedSet(e,o,0,0,n).then((()=>this._getFeatures(e,t,r,n)));-1!==t&&void 0===this._featureCache[t]&&a.push(t);let l=0;for(let i=e._lastFetchedIndex;i<e._known.length&&(l++,l<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&a.push(e._known[i]),a.length>o-1)));i++);if(0===a.length)return Object(i.cI)("success");const c=new s.o([],a,!1,null),u=Math.min(a.length,r);return this._parent._getFeatures(c,-1,u,n).then((()=>{for(let e=0;e<u;e++){const t=this._parent._featureFromCache(a[e]);void 0!==t&&(this._featureCache[a[e]]=t)}return"success"}))}_getFilteredSet(e,t,r,i,n){return this._ensureLoaded().then((()=>this._getSet(n))).then((e=>new s.o(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,this._clonePageDefinition(e.pagesDefinition))))}_refineKnowns(e,t){let r=0,i=null;const s=[];for(let a=0;a<e._candidates.length;a++){const o=this._isInFeatureSet(e._candidates[a]);if(o===n.a1.InFeatureSet){if(e._known.push(e._candidates[a]),r+=1,null===i?i={start:a,end:a}:i.end===a-1?i.end=a:(s.push(i),i={start:a,end:a}),e._known.length>=this._topnum)break}else if(o===n.a1.NotInFeatureSet)null===i?i={start:a,end:a}:i.end===a-1?i.end=a:(s.push(i),i={start:a,end:a}),r+=1;else if(o===n.a1.Unknown)break;if(r>=t)break}null!==i&&s.push(i);for(let t=s.length-1;t>=0;t--)e._candidates.splice(s[t].start,s[t].end-s[t].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}_stat(){return Object(i.cI)({calculated:!1})}_canDoAggregates(){return Object(i.cI)(!1)}static registerAction(){s.q._featuresetFunctions.top=function(e){return new L({parentfeatureset:this,topnum:e})}}}class N extends s.q{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return n.a5}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}convertQueryToLruCacheKey(e){const t=Object(n.a6)(e.toJSON());return Object(u.b)(t,u.a.String)}load(){return null===this._loadPromise&&(this._loadPromise=Object(i.cH)(((e,t)=>{try{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}}),t),this._layer.load()}catch(e){t(e)}}))),this._loadPromise}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=n.a4.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=n.a4.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=n.a4.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=n.a4.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}_isInFeatureSet(){return n.a1.InFeatureSet}_refineSetBlock(e){return Object(i.cI)(e)}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):Object(i.cI)(this._wset)}_runDatabaseProbe(e){return Object(i.cH)(((t,r)=>{try{this._ensureLoaded().then((()=>{try{const i=new y.b;i.where=e.replace("OBJECTID",this._layer.objectIdField),this._layer.queryObjectIds(i).then((()=>{t(!0)}),(()=>{try{t(!1)}catch(e){r(e)}}))}catch(e){r(e)}}))}catch(e){r(e)}}))}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}queryPBF(e){return e.quantizationParameters={mode:"edit"},Object(m.c)(this._layer.parsedUrl,e,new g.c({})).then((e=>p.default.fromJSON(Object(f.t)(e.data)).unquantize()))}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){const r=new b.c({url:this._layer.parsedUrl.path}),i="execute"===t&&this.pbfSupportedForQuery(e);let n=null;if(this.recentlyUsedQueries){const s=this.convertQueryToLruCacheKey(e);n=this.recentlyUsedQueries.getFromCache(s),null===n&&(n=!0!==i?r[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,n),n=n.catch((e=>{throw this.recentlyUsedQueries.removeFromCache(s),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===n&&(n=!0!==i?r[t](e):this.queryPBF(e)),n}_getFilteredSet(e,t,r,i,n){return this.databaseType().then((a=>{if(this.isTable()&&t&&null!==e&&""!==e)return new s.o([],[],!0,null);if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,r,i,n);let o="",l=!1;null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=i.constructClause(),l=!0);const c=new y.b;return c.where=null===r?null===t?"1=1":"":Object(s.k)(r,a),this._requestStandardised&&(c.sqlFormat="standard"),c.spatialRelationship=this._makeRelationshipEnum(e),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==o?o.split(","):null,c.geometry=null===t?null:t,c.relationParameter=this._makeRelationshipParam(e),this.executeQuery(c,"executeForIds").then((e=>(null===e&&(e=[]),this._checkCancelled(n),new s.o([],e,l,null))))}))}_expandPagedSet(e,t,r,i,n){return this._expandPagedSetFeatureSet(e,t,r,i,n)}_getFilteredSetUsingPaging(e,t,r,n,a){try{let i="",o=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(i=n.constructClause(),o=!0),this.databaseType().then((n=>{let l=null===r?null===t?"1=1":"":Object(s.k)(r,n);this._layer.definitionExpression&&(l=""!==l?"(("+this._layer.definitionExpression+") AND ("+l+"))":this._layer.definitionExpression);let c=this._maxQueryRate();const u=this._layer.capabilities.query.maxRecordCount;void 0!==u&&u<c&&(c=u);let h=null;if(!0===this._pageJustIds)h=new s.o([],["GETPAGES"],o,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:c,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:i,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let r=!0;!0===this._removeGeometry&&(r=!1);const n=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]);h=new s.o([],["GETPAGES"],o,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:n.join(","),resultRecordCount:c,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:i,returnGeometry:r,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return this._expandPagedSet(h,c,0,1,a).then((()=>h))}))}catch(e){return Object(i.af)(e)}}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){try{const t=e.pagesDefinition.internal.lastRetrieved,i=t,n=e.pagesDefinition.internal.lastPage,s=new y.b;return this._requestStandardised&&(s.sqlFormat="standard"),s.spatialRelationship=e.pagesDefinition.spatialRel,s.relationParameter=e.pagesDefinition.relationParam,s.outFields=e.pagesDefinition.outFields.split(","),s.num=e.pagesDefinition.resultRecordCount,s.start=e.pagesDefinition.internal.lastPage,s.geometry=e.pagesDefinition.geometry,s.where=e.pagesDefinition.where,s.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,s.returnGeometry=e.pagesDefinition.returnGeometry,s.outSpatialReference=this.spatialReference,this.executeQuery(s,"execute").then((s=>{if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==n)return"done";for(let t=0;t<s.features.length;t++)e.pagesDefinition.internal.set[i+t]=s.features[t].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(let e=0;e<s.features.length;e++)this._featureCache[s.features[e].attributes[this._layer.objectIdField]]=s.features[e];return(void 0===s.exceededTransferLimit&&s.features.length!==e.pagesDefinition.resultRecordCount||!1===s.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+s.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}))}catch(e){return Object(i.af)(e)}}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let r=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,n){const s=[];try{if(-1!==t&&void 0===this._featureCache[t]&&s.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then((()=>this._getFeatures(e,t,r,n)));let a=0;for(let i=e._lastFetchedIndex;i<e._known.length;i++){if(e._lastFetchedIndex+=1,a++,void 0===this._featureCache[e._known[i]]){let r=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const t=this._layer._mode;if(void 0!==t._featureMap[e._known[i]]){const n=t._featureMap[e._known[i]];null!==n&&(r=!0,this._featureCache[e._known[i]]=n)}}if(!1===r&&(e._known[i]!==t&&s.push(e._known[i]),s.length>=this._maxProcessingRate()-1))break}if(a>=r&&0===s.length)break}if(0===s.length)return Object(i.cI)("success");try{const e=new y.b;return this._requestStandardised&&(e.sqlFormat="standard"),e.objectIds=s,e.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),e.returnGeometry=!0,!0===this._removeGeometry&&(e.returnGeometry=!1),e.outSpatialReference=this.spatialReference,this.executeQuery(e,"execute").then((e=>{if(this._checkCancelled(n),void 0!==e.error)return Object(i.af)(new Error(e.error));for(let t=0;t<e.features.length;t++)this._featureCache[e.features[t].attributes[this._layer.objectIdField]]=e.features[t];return"success"}))}catch(e){return Object(i.af)(e)}}catch(e){return Object(i.af)(e)}}_getDistinctPages(e,t,r,n,a,o,l,c,u){return this._ensureLoaded().then((()=>this.databaseType())).then((h=>{let d=r.parseTree.column;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name.toLowerCase()===d.toLowerCase()){d=this._layer.fields[e].name;break}const f=new y.b;this._requestStandardised&&(f.sqlFormat="standard");let p=null===o?null===a?"1=1":"":Object(s.k)(o,h);return this._layer.definitionExpression&&(p=""!==p?"(("+this._layer.definitionExpression+") AND ("+p+"))":this._layer.definitionExpression),f.where=p,f.spatialRelationship=this._makeRelationshipEnum(n),f.relationParameter=this._makeRelationshipParam(n),f.geometry=null===a?null:a,f.returnDistinctValues=!0,f.returnGeometry=!1,f.outFields=[d],this.executeQuery(f,"execute").then((s=>{if(this._checkCancelled(u),!s.hasOwnProperty("features"))return Object(i.af)(new Error("Unnexected Result querying statistics from layer"));let h=!1;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name===d){"date"===this._layer.fields[e].type&&(h=!0);break}for(let e=0;e<s.features.length;e++){if(h){const t=s.features[e].attributes[d];null!==t?c.push(new Date(t)):c.push(t)}else c.push(s.features[e].attributes[d]);if(c.length>=l)break}return 0===s.features.length?c:s.features.length===this._layer.capabilities.query.maxRecordCount&&c.length<l?this._getDistinctPages(e+s.features.length,t,r,n,a,o,l,c,u).then((e=>({calculated:!0,result:e}))):c}))}))}_distinctStat(e,t,r,i,n,s,a){return this._getDistinctPages(0,e,t,r,i,n,s,[],a).then((e=>({calculated:!0,result:e})))}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}_countstat(e,t,r,i){return this.databaseType().then((e=>{const n=new y.b;if(this._requestStandardised&&(n.sqlFormat="standard"),this.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let a=null===i?null===r?"1=1":"":Object(s.k)(i,e);return this._layer.definitionExpression&&(a=""!==a?"(("+this._layer.definitionExpression+") AND ("+a+"))":this._layer.definitionExpression),n.where=a,n.where=a,n.spatialRelationship=this._makeRelationshipEnum(t),n.relationParameter=this._makeRelationshipParam(t),n.geometry=null===r?null:r,n.returnGeometry=!1,this.executeQuery(n,"executeForCount").then((e=>({calculated:!0,result:e})))}))}_stats(e,t,r,n,a,o,l){return this._ensureLoaded().then((()=>{const c=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,h=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;return"count"===e?h?this._countstat(e,r,n,a):{calculated:!1}:!1===u||!1===Object(s.a)(t)&&!1===c||!1===t.isStandardized?""!==r||null!==a?{calculated:!1}:this._manualStat(e,t,o,l):"distinct"===e?!1===h?""!==r||null!==a?{calculated:!1}:this._manualStat(e,t,o,l):this._distinctStat(e,t,r,n,a,o,l):this.databaseType().then((o=>{if(this.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};const l=new y.b;this._requestStandardised&&(l.sqlFormat="standard");let c=null===a?null===n?"1=1":"":Object(s.k)(a,o);this._layer.definitionExpression&&(c=""!==c?"(("+this._layer.definitionExpression+") AND ("+c+"))":this._layer.definitionExpression),l.where=c,l.spatialRelationship=this._makeRelationshipEnum(r),l.relationParameter=this._makeRelationshipParam(r),l.geometry=null===n?null:n;const u=new y.e;u.statisticType=Object(s.j)(e),u.onStatisticField=Object(s.k)(t,o),u.outStatisticFieldName="ARCADE_STAT_RESULT",l.returnGeometry=!1;let h="ARCADE_STAT_RESULT";return l.outStatistics=[u],this.executeQuery(l,"execute").then((e=>{if(!e.hasOwnProperty("features")||0===e.features.length)return Object(i.af)(new Error("Unnexected Result querying statistics from layer"));let t=!1;for(let r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){h=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){let t=e.features[0].attributes[h];return null!==t&&(t=new Date(e.features[0].attributes[h])),{calculated:!0,result:t}}return{calculated:!0,result:e.features[0].attributes[h]}}))}))}))}_stat(e,t,r,i,n,s,a){return this._stats(e,t,r,i,n,s,a)}_canDoAggregates(e,t){return this._ensureLoaded().then((()=>{let e=!1;const r=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression;if(void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(let i=0;i<t.length-1;i++)null!==t[i].workingexpr&&(!1===t[i].workingexpr.isStandardized||!1===Object(s.a)(t[i].workingexpr)&&!1===r)&&(e=!1);return!1!==e}))}_makeRelationshipEnum(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,r,i,n,a,o){return this._ensureLoaded().then((()=>this.databaseType())).then((l=>{let c="",u=!1,h=!1;null!==a&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(c=a.constructClause(),h=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(h=!1,u=!0,c=this._layer.objectIdField);const d=[];for(let e=0;e<t.length;e++){const r=new y.e;r.onStatisticField=null!==t[e].workingexpr?Object(s.k)(t[e].workingexpr,l):"",r.outStatisticFieldName=t[e].field,r.statisticType=t[e].toStatisticsName(),d.push(r)}""===c&&(c=e.join(","));let f=this._maxQueryRate();const p=this._layer.capabilities.query.maxRecordCount;void 0!==p&&p<f&&(f=p);let g=null===n?null===i?"1=1":"":Object(s.k)(n,l);return this._layer.definitionExpression&&(g=""!==g?"(("+this._layer.definitionExpression+") AND ("+g+"))":this._layer.definitionExpression),new s.o([],["GETPAGES"],h,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(r),relationParam:this._makeRelationshipParam(r),outFields:["*"],useOIDpagination:u,generatedOid:o,resultRecordCount:f,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:d,geometry:null===i?null:i,where:g,orderByFields:c,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))}_getAgregagtePhysicalPage(e,t,r){try{let t=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(t=""!==t?"("+t+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const n=e.pagesDefinition.internal.lastRetrieved,s=n,a=e.pagesDefinition.internal.lastPage,l=new y.b;return this._requestStandardised&&(l.sqlFormat="standard"),l.where=t,l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields,l.outStatistics=e.pagesDefinition.outStatistics,l.geometry=e.pagesDefinition.geometry,l.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastPage,l.returnGeometry=e.pagesDefinition.returnGeometry,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&l.geometry&&l.spatialRelationship?Object(i.cI)([]):this.executeQuery(l,"execute").then((t=>{if(this._checkCancelled(r),!t.hasOwnProperty("features"))return Object(i.af)(new Error("Unnexected Result querying aggregates from layer"));const l=[];if(e.pagesDefinition.internal.lastPage!==a)return[];for(let r=0;r<t.features.length;r++)e.pagesDefinition.internal.set[s+r]=t.features[r].attributes[e.pagesDefinition.generatedOid];for(let e=0;e<t.features.length;e++)l.push(new o.a({attributes:t.features[e].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=n+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,l}))}catch(e){return Object(i.af)(e)}}static create(e,t,r,i,n){const s=new h.k({url:e,outFields:null===t?["*"]:t});return new N({layer:s,spatialReference:r,lrucache:i,interceptor:n})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return Object(n.a7)(this._layer.parsedUrl.path)}queryAttachments(e,t,r,s){if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){const i={objectIds:[e]};return(t&&t>0||r&&r>0)&&(i.size=[t&&t>0?t:0,r&&r>0?r:t+1]),s&&s.length>0&&(i.attachmentTypes=s),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:i,method:"attachments"}),this._layer.queryAttachments(i).then((t=>{const r=[];return t&&t[e]&&t[e].forEach((t=>{const i=this._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new n.n(t.id,t.name,t.contentType,t.size,i))})),r}))}return Object(i.cI)([])}queryRelatedFeatures(e){const t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:t,method:"relatedrecords",url:this._layer.parsedUrl.path+"/queryRelatedRecords"}),Object(i.C)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then((e=>{if(e.data){const t={},r=e.data;if(r&&r.relatedRecordGroups){const e=r.spatialReference;for(const i of r.relatedRecordGroups){const n=i.objectId,s=[];for(const t of i.relatedRecords){t.geometry&&(t.geometry.spatialReference=e);const r=new o.a({geometry:t.geometry?Object(d.e)(t.geometry):null,attributes:t.attributes});s.push(r)}t[n]={features:s,exceededTransferLimit:!0===r.exceededTransferLimit}}}return t}return Object(i.af)("Invalid Request")}))}getFeatureByObjectId(e,t){const r=new b.c({url:this._layer.parsedUrl.path}),i=new y.b;return i.outFields=t,i.returnGeometry=!1,i.outSpatialReference=this.spatialReference,i.where=this.objectIdField+"="+e.toString(),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:i,method:"execute"}),r.execute(i).then((e=>1===e.features.length?e.features[0]:null))}getIdentityUser(){return this.load().then((()=>{var e;const t=null==(e=i.bX)?void 0:e.findCredential(this._layer.url);return t?t.userId:null}))}getOwningSystemUrl(){return this.load().then((()=>{var e;const t=null==(e=i.bX)?void 0:e.findServerInfo(this._layer.url);if(t)return Object(i.cI)(t.owningSystemUrl);let r=this._layer.url;const n=r.toLowerCase().indexOf("/rest/services");return r=n>-1?r.substring(0,n):r,r?(r+="/rest/info",Object(i.cH)(((e,t)=>{Object(i.C)(r,{query:{f:"json"}}).then((t=>{let r="";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)}),(t=>{e("")}))}))):Object(i.cI)("")}))}}class P extends s.q{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,!0===e.isTable&&(this._forceIsTable=!0),void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return n.a5}end(){return this._layer}optimisePagingFeatureQueries(){}load(){return null===this._loadPromise&&(this._loadPromise=Object(i.cH)(((e,t)=>{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}}),t),this._layer.load()}))),this._loadPromise}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=n.a4.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return n.a1.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):Object(i.cI)(this._wset)}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new o.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,a,o){let l="",c=!1;if(null!==a&&(l=a.constructClause(),c=!0),this.isTable()&&t&&null!==e&&""!==e){const e=new s.o([],[],!0,null);return Object(i.cI)(e)}const u=new y.b;return u.where=null===r?null===t?"1=1":"":Object(s.k)(r,n.a4.Standardised),u.spatialRelationship=this._makeRelationshipEnum(e),u.outSpatialReference=this.spatialReference,u.orderByFields=""!==l?l.split(","):null,u.geometry=null===t?null:t,u.returnGeometry=!0,u.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(u).then((e=>{if(null===e)return new s.o([],[],c,null);this._checkCancelled(o);const t=[];return e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)})),new s.o([],t,c,null)}))}_makeRelationshipEnum(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}_queryAllFeatures(){if(this._wset)return Object(i.cI)(this._wset);const e=new y.b;return e.where="1=1",this._ensureLoaded().then((()=>{if(this._layer.source&&this._layer.source.items){const e=[];return this._layer.source.items.forEach((t=>{const r=t.attributes[this._layer.objectIdField];e.push(r),this._featureCache[r]=this._changeFeature(t)})),this._wset=new s.o([],e,!1,null),this._wset}return this._layer.queryFeatures(e).then((e=>{const t=[];return e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)})),this._wset=new s.o([],t,!1,null),this._wset}))}))}_getFeatures(e,t,r){const n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);for(let i=e._lastFetchedIndex;i<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&n.push(e._known[i]),n.length>r)));i++);return 0===n.length?Object(i.cI)("success"):Object(i.af)(new Error("Unaccounted for Features. Not in Feature Collection"))}_refineSetBlock(e){return Object(i.cI)(e)}_stat(){return Object(i.cI)({calculated:!1})}_canDoAggregates(){return Object(i.cI)(!1)}relationshipMetaData(){return[]}static _cloneAttr(e){const t={};for(const r in e)t[r]=e[r];return t}nativeCapabilities(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(e,t){let r=e.layerDefinition.objectIdField;const n=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",s=[];if(e.layerDefinition.types)for(const t of e.layerDefinition.types)s.push(_.a.fromJSON(t));let a=e.layerDefinition.geometryType;void 0===a&&(a=e.featureSet.geometryType||"");let o=e.featureSet.features;const c=t.toJSON();if(""===r||void 0===r){let t=!1;for(const i of e.layerDefinition.fields)if("oid"===i.type||"esriFieldTypeOID"===i.type){r=i.name,t=!0;break}if(!1===t){let t="FID",i=!0,n=0;for(;i;){let r=!0;for(const i of e.layerDefinition.fields)if(i.name===t){r=!1;break}!0===r?i=!1:(n++,t="FID"+n.toString())}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:t,alias:t});const s=[];for(let r=0;r<o.length;r++)s.push({geometry:e.featureSet.features[r].geometry,attributes:e.featureSet.features[r].attributes?this._cloneAttr(e.featureSet.features[r].attributes):{}}),s[r].attributes[t]=r;o=s,r=t}}const u=[];for(const t of e.layerDefinition.fields)t instanceof l.a?u.push(t):u.push(l.a.fromJSON(t));let d=a;switch(d){case"esriGeometryPoint":d="point";break;case"esriGeometryPolyline":d="polyline";break;case"esriGeometryPolygon":d="polygon";break;case"esriGeometryExtent":d="extent";break;case"esriGeometryMultipoint":d="multipoint"}for(const e of o)e.geometry&&e.geometry instanceof i.ao==0&&(e.geometry.type=d,void 0===e.geometry.spatialReference&&(e.geometry.spatialReference=c));const f={outFields:["*"],source:o,fields:u,types:s,typeIdField:n,objectIdField:r,spatialReference:t};f.geometryType=d||"point";const p=new h.k(f);return new P({layer:p,spatialReference:t,isTable:null===d||""===d})}queryAttachments(){return Object(i.cI)([])}getFeatureByObjectId(e){const t=new y.b;return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then((e=>1===e.features.length?e.features[0]:null))}getOwningSystemUrl(){return Object(i.cI)("")}getIdentityUser(){return Object(i.cI)("")}}class B extends s.q{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,this.relatedLayer=null,this.relationship=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return n.a5}end(){return this._layer}optimisePagingFeatureQueries(){}load(){return null===this._loadPromise&&(this._loadPromise=Object(i.cH)(((e,t)=>{Object(i.cD)([this._layer.load(),this.relatedLayer.load()]).then((()=>{this._initialiseFeatureSet(),e(this)}),t)}))),this._loadPromise}nativeCapabilities(){return this.relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}databaseType(){return this.relatedLayer.databaseType().then((()=>(this._databaseType=this.relatedLayer._databaseType,this._databaseType)))}isTable(){return this.relatedLayer.isTable()}_isInFeatureSet(){return n.a1.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):Object(i.cI)(this._wset)}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new o.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,i,n){return this.databaseType().then((()=>{if(this.isTable()&&t&&null!==e&&""!==e)return new s.o([],[],!0,null);const a=this._layer.nativeCapabilities();if(!1===a.canQueryRelated)return new s.o([],[],!0,null);if(a.capabilities.queryRelated&&a.capabilities.queryRelated.supportsPagination)return this._getFilteredSetUsingPaging(e,t,r,i,n);let o="",l=!1;null!==i&&a.capabilities&&a.capabilities.queryRelated&&!0===a.capabilities.queryRelated.supportsOrderBy&&(o=i.constructClause(),l=!0);const c=new x.a;c.objectIds=[this._findObjectId];const u=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((e=>e.name)):["*"]);c.outFields=u,c.relationshipId=this.relationship.id,c.where="1=1";let h=!0;return!0===this._removeGeometry&&(h=!1),c.returnGeometry=h,this._requestStandardised&&(c.sqlFormat="standard"),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==o?o.split(","):null,a.source.queryRelatedFeatures(c).then((i=>{this._checkCancelled(n);const a=i[this._findObjectId]?i[this._findObjectId].features:[],o=[];for(let e=0;e<a.length;e++)this._featureCache[a[e].attributes[this._layer.objectIdField]]=a[e],o.push(a[e].attributes[this._layer.objectIdField]);const c=t&&null!==e&&""!==e,u=null!=r;return new s.o(c||u?o:[],c||u?[]:o,l,null)}))}))}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let r=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,r,n,a){try{let i="",o=!1;const l=this._layer.nativeCapabilities();return null!==n&&l&&l.capabilities.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(i=n.constructClause(),o=!0),this.databaseType().then((()=>{let n=this._maxQueryRate();const c=l.capabilities.query.maxRecordCount;void 0!==c&&c<n&&(n=c);const u=t&&null!==e&&""!==e,h=null!=r;let d=null,f=!0;!0===this._removeGeometry&&(f=!1);const p=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((e=>e.name)):["*"]);return d=new s.o(u||h?["GETPAGES"]:[],u||h?[]:["GETPAGES"],o,{outFields:p.join(","),resultRecordCount:n,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:i,returnGeometry:f,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),this._expandPagedSet(d,n,0,0,a).then((()=>d))}))}catch(e){return Object(i.af)(e)}}_expandPagedSet(e,t,r,i,n){return this._expandPagedSetFeatureSet(e,t,r,i,n)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){try{const t=e.pagesDefinition.internal.lastRetrieved,i=t,n=e.pagesDefinition.internal.lastPage,s=this._layer.nativeCapabilities(),a=new x.a;return!0===this._requestStandardised&&(a.sqlFormat="standard"),a.relationshipId=this.relationship.id,a.objectIds=e.pagesDefinition.objectIds,a.resultOffset=e.pagesDefinition.internal.lastPage,a.resultRecordCount=e.pagesDefinition.resultRecordCount,a.outFields=e.pagesDefinition.outFields.split(","),a.where=e.pagesDefinition.where,a.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,a.returnGeometry=e.pagesDefinition.returnGeometry,a.outSpatialReference=this.spatialReference,s.source.queryRelatedFeatures(a).then((s=>{if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==n)return 0;const a=s[this._findObjectId]?s[this._findObjectId].features:[];for(let t=0;t<a.length;t++)e.pagesDefinition.internal.set[i+t]=a[t].attributes[this._layer.objectIdField];for(let e=0;e<a.length;e++)this._featureCache[a[e].attributes[this._layer.objectIdField]]=a[e];const o=!s[this._findObjectId]||!1===s[this._findObjectId].exceededTransferLimit;return a.length!==e.pagesDefinition.resultRecordCount&&o&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+a.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,a.length}))}catch(e){return Object(i.af)(e)}}_getFeatures(e,t,r,n){const s=[];-1!==t&&void 0===this._featureCache[t]&&s.push(t);const a=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,a))return this._expandPagedSet(e,a,0,0,n).then((()=>this._getFeatures(e,t,r,n)));let o=0;for(let i=e._lastFetchedIndex;i<e._known.length&&(o++,o<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[i]&&void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&s.push(e._known[i]),s.length>r)))&&!(o>=r&&0===s.length);i++);return 0===s.length?Object(i.cI)("success"):Object(i.af)(new Error("Unaccounted for Features. Not in Feature Collection"))}_refineSetBlock(e,t,r){return Object(i.cI)(e)}_stat(e,t,r,n,s,a,o){return Object(i.cI)({calculated:!1})}get gdbVersion(){return this.relatedLayer.gdbVersion}_canDoAggregates(e,t,r,n,s){return Object(i.cI)(!1)}relationshipMetaData(){return this.relatedLayer.relationshipMetaData()}serviceUrl(){return this.relatedLayer.serviceUrl()}queryAttachments(e,t,r,i){return this.relatedLayer.queryAttachments(e,t,r,i)}getFeatureByObjectId(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this.relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this.relatedLayer.getIdentityUser()}}function k(e,t){if(s.c.applicationCache){const r=s.c.applicationCache.getLayerInfo(e);if(r)return r.then((r=>Object(i.cI)(new h.k({url:e,outFields:t,sourceJSON:r}))));const n=new h.k({url:e,outFields:t});let a=Object(i.cH)(((e,t)=>{n.load().then((()=>{e(n.sourceJSON)}),(e=>{t(e)}))}));return s.c.applicationCache&&(s.c.applicationCache.setLayerInfo(e,a),a=a.catch((t=>{throw s.c.applicationCache.clearLayerInfo(e),t}))),a.then((()=>Object(i.cI)(n)))}return Object(i.cI)(new h.k({url:e,outFields:t}))}function U(e,t,r,n,s,a=null){return k(e,["*"]).then((e=>Object(i.cI)(z(e,t,r,n,s,a))))}function z(e,t=null,r=null,i=!0,n=null,s=null){return!0===e._hasMemorySource()?new P({layer:e,spatialReference:t,outFields:r,includeGeometry:i,lrucache:n,interceptor:s}):new N({layer:e,spatialReference:t,outFields:r,includeGeometry:i,lrucache:n,interceptor:s})}function V(e){if(null!==s.c.applicationCache){const t=s.c.applicationCache.getLayerInfo(e);if(null!==t)return t}let t=Object(i.C)(e,{responseType:"json",query:{f:"json"}}).then((e=>{if(e.data){const t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),Object(i.cI)(t)}return Object(i.cI)({layers:[],tables:[]})}));return null!==s.c.applicationCache&&(s.c.applicationCache.setLayerInfo(e,t),t=t.catch((t=>{throw s.c.applicationCache.clearLayerInfo(e),t}))),t}function G(e,t){const r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return V(e).then((n=>{if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(const e of n.layers)r.layerNameLkp[e.id]=e.name;if(n.tables)for(const e of n.tables)r.layerNameLkp[e.id]=e.name;const o=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=o,function(e,t){const r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==s.c.applicationCache){const e=s.c.applicationCache.getLayerInfo(r);if(null!==e)return e}let n=Object(i.C)(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((e=>{if(e.data){const t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==s.c.applicationCache&&(s.c.applicationCache.setLayerInfo(r,n),n=n.catch((e=>{throw s.c.applicationCache.clearLayerInfo(r),e}))),n}(e,o).then((n=>{if(n){r.queryelem=n,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(const e of r.queryelem.dataElement.domainNetworks){for(const t of e.edgeSources?e.edgeSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}for(const t of e.junctionSources?e.junctionSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}}if(r.queryelem.dataElement.terminalConfigurations)for(const e of r.queryelem.dataElement.terminalConfigurations)for(const t of e.terminals)r.terminals.push({terminalId:t.terminalId,terminalName:t.terminalName});return function(e){if(null!==s.c.applicationCache){const t=s.c.applicationCache.getLayerInfo(e);if(null!==t)return t}let t=Object(i.C)(e,{responseType:"json",query:{f:"json"}}).then((e=>{if(e.data){const t=e.data;return Object(i.cI)(t)}return Object(i.cI)(null)}));return null!==s.c.applicationCache&&(s.c.applicationCache.setLayerInfo(e,t),t=t.catch((t=>{throw s.c.applicationCache.clearLayerInfo(e),t}))),t}(e+"/"+o).then((i=>{if(i.systemLayers&&void 0!==i.systemLayers.associationsTableId&&null!==i.systemLayers.associationsTableId){const n=[];return r.unVersion>=4&&(n.push("STATUS"),n.push("PERCENTALONG")),U(e+"/"+i.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...n],!1,null,null).then((e=>e.load())).then((e=>r.unVersion>=4?(e=e.filter(a.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e)).then((e=>({lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals})))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}function q(e,t,r,i=null,n=null,s=!0,a=null,o=null){let l=e.serviceUrl();return l?(l="/"===l.charAt(l.length-1)?l+t.relatedTableId.toString():l+"/"+t.relatedTableId.toString(),U(l,i,n,s,a,o).then((l=>new B({layer:e,relatedLayer:l,relationship:t,objectId:r,spatialReference:i,outFields:n,includeGeometry:s,lrucache:a,interceptor:o})))):null}w.registerAction(),D.registerAction(),S.registerAction(),s.f.registerAction(),L.registerAction();class H extends v{constructor(e,t=null,r=null,i=null){super(),this._map=e,this._overridespref=t,this.lrucache=r,this.interceptor=i,this._instantLayers=[]}makeAndAddFeatureSet(e,t=!0,r=null){const i=z(e,this._overridespref,null===r?["*"]:r,t,this.lrucache,this.interceptor);return this._instantLayers.push({featureset:i,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),i}featureSetByName(e,t=!0,r=null){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetByName(e,t,r)}catch(e){return Object(i.af)(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===n)return this.resolvePromise(this._instantLayers[r].featureset)}const s=this._map.layers.find((t=>t instanceof h.k&&t.title===e));if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,t,r));if(this._map.tables){const i=this._map.tables.find((t=>!!(t.title&&t.title===e||t.title&&t.title===e)));if(i){if(i instanceof h.k)return this.resolvePromise(this.makeAndAddFeatureSet(i,t,r));if(i._materializedTable);else{const e=i.outFields?i:{...i,outFields:["*"]};i._materializedTable=new h.k(e)}return i._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(i._materializedTable,t,r))))}}return this.resolvePromise(null)}featureSetById(e,t=!0,r=["*"]){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetById(e,t,r)}catch(e){return Object(i.af)(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===n)return this.resolvePromise(this._instantLayers[r].featureset)}const s=this._map.layers.find((t=>t instanceof h.k&&t.id===e));if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,t,r));if(this._map.tables){const i=this._map.tables.find((t=>t.id===e));if(i){if(i instanceof h.k)return this.resolvePromise(this.makeAndAddFeatureSet(i,t,r));if(i._materializedTable);else{const e={...i,outFields:["*"]};i._materializedTable=new h.k(e)}return i._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(i._materializedTable,t,r))))}}return this.resolvePromise(null)}}class W extends v{constructor(e,t=null,r=null,i=null){super(),this._url=e,this._overridespref=t,this.lrucache=r,this.interceptor=i,this.metadata=null,this._instantLayers=[]}get url(){return this._url}makeAndAddFeatureSet(e,t=!0,r=null){const i=z(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:i,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),i}_loadMetaData(){return V(this._url).then((e=>(this.metadata=e,e)))}load(){return this._loadMetaData()}clone(){return new W(this._url,this._overridespref,this.lrucache,this.interceptor)}featureSetByName(e,t=!0,r=null){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const i=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const n=this._instantLayers[r];if(n.opitem.title===e&&n.includeGeometry===t&&n.outFields===i)return this.resolvePromise(this._instantLayers[r].featureset)}return this._loadMetaData().then((i=>{let n=null;for(const t of i.layers?i.layers:[])t.name===e&&(n=t);if(!n)for(const t of i.tables?i.tables:[])t.name===e&&(n=t);return n?k(this._url+"/"+n.id,["*"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))}featureSetById(e,t=!0,r=["*"]){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const i=JSON.stringify(r);e=null!=e?e.toString():"";for(let r=0;r<this._instantLayers.length;r++){const n=this._instantLayers[r];if(n.opitem.id===e&&n.includeGeometry===t&&n.outFields===i)return this.resolvePromise(this._instantLayers[r].featureset)}return this._loadMetaData().then((i=>{let n=null;for(const t of i.layers?i.layers:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(n=t);if(!n)for(const t of i.tables?i.tables:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(n=t);return n?k(this._url+"/"+n.id,["*"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))}}function Z(e,t){return null===e?t:new i.aT({url:e.field("url")})}function X(e,t,r){return i.bX.findCredential(e.restUrl)?"loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===r?Object(i.cI)(e.user.sourceJSON):""===t?Object(i.C)(e.restUrl+"/community/self",{responseType:"json",query:{f:"json",...!1===r?{}:{returnUserLicenseTypeExtensions:!0}}}).then((e=>{if(e.data){const t=e.data;if(t&&t.username)return Object(i.cI)(t)}return Object(i.cI)(null)})):Object(i.C)(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}}).then((e=>{if(e.data){const t=e.data;return t.error?null:Object(i.cI)(t)}return Object(i.cI)(null)})):Object(i.cI)(null)}function J(e,t,r,a,o,l,c,u=null){if(s.c.applicationCache){const d=s.c.applicationCache.getLayerInfo(e+":"+l.url);if(d)return d.then((e=>{try{const s=new h.k({url:Object(n.a7)(e.url)+"/"+t,outFields:["*"]});return Object(i.cI)(z(s,r,a,o,c,u))}catch(e){return Object(i.af)(e)}}),(e=>Object(i.af)(e)))}return Object(i.cH)(((d,f)=>{const p=new i.bK({id:e,portal:l}).load();s.c.applicationCache&&s.c.applicationCache.setLayerInfo(e+":"+l.url,p),p.then((e=>{try{const i=new h.k({url:Object(n.a7)(e.url)+"/"+t,outFields:["*"]});d(z(i,r,a,o,c,u))}catch(e){f(e)}}),(t=>{s.c.applicationCache&&s.c.applicationCache.clearLayerInfo(e+":"+l.url),f(t)}))}))}var Y=Object.freeze({__proto__:null,constructAssociationMetaDataFeatureSetFromUrl:G,constructFeatureSet:z,constructFeatureSetFromPortalItem:J,constructFeatureSetFromRelationship:q,constructFeatureSetFromUrl:U,createFeatureSetCollectionFromMap:function(e,t,r=null,i=null){return new H(e,t,r,i)},createFeatureSetCollectionFromService:function(e,t,r=null,i=null){return new W(e,t,r,i)},getPortal:Z,initialiseMetaDataCache:function(){null===s.c.applicationCache&&(s.c.applicationCache=new s.c)},lookupUser:X})},,function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),n=(r(1),r(40));let s=class extends n.b{constructor(e){super(e),this.tiles=new Map}destroy(){this.tiles.clear(),this.layer=this.layerView=this.tileInfoView=this.tiles=null}get updating(){return this.isUpdating()}acquireTile(e){const t=this.createTile(e);return t.once("isReady",(()=>this.notifyChange("updating"))),this.tiles.set(e.id,t),t}forceAttributeTextureUpload(){}forEachTile(e){this.tiles.forEach(e)}releaseTile(e){this.tiles.delete(e.key.id),this.disposeTile(e)}isUpdating(){let e=!0;return this.tiles.forEach((t=>{e=e&&t.isReady})),!e}setHighlight(){}invalidateLabels(){}requestUpdate(){this.layerView.requestUpdate()}};Object(i.e)([Object(i.y)()],s.prototype,"layer",void 0),Object(i.e)([Object(i.y)()],s.prototype,"layerView",void 0),Object(i.e)([Object(i.y)()],s.prototype,"tileInfoView",void 0),Object(i.e)([Object(i.y)()],s.prototype,"updating",null),s=Object(i.e)([Object(i.i)("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],s);var a=s},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));r(76),r(167),r(163),r(87);var i=r(1),n=r(0);const s=(()=>{if(!("document"in i.e))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,r=>{t.clearRect(0,0,1,e.height);const i=t.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:t}of r.colorStops)i.addColorStop(Math.max(e,.001),`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`);return t.fillStyle=i,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function a(e,t,r,i){const{blurRadius:n,fieldOffset:s,field:a}=t,o=new Float64Array(r*i),l=function(e){const t=Math.round(3*e),r=2*e*e,i=new Float64Array(2*t+1);for(let n=0;n<=i.length;n++)i[n]=Math.exp(-((n-t)**2)/r)/Math.sqrt(2*Math.PI)*(e/2);return i}(n),c=Math.round(3*n);let u,h=Number.NEGATIVE_INFINITY;const d=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(a,s),f=new Set;for(const t of e){const e=t.getCursor();for(;e.next();){const t=e.getObjectId();if(f.has(t))continue;f.add(t);const n=e.readLegacyPointGeometry(),s=128;if(n.x<-s||n.x>=r+s||n.y<-s||n.y>i+s)continue;const a=+d(e),p=Math.round(n.x)-c,y=Math.round(n.y)-c,g=Math.max(0,p),m=Math.max(0,y),b=Math.min(i,Math.round(n.y)+c),_=Math.min(r,Math.round(n.x)+c);for(let e=m;e<b;e++){const t=l[e-y];for(let i=g;i<_;i++){const n=l[i-p];u=o[e*r+i]+=t*n*a,u>h&&(h=u)}}}}return{matrix:o.buffer,max:h}}function o(e,t,r,i,s,a){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);const o=e.getImageData(0,0,t,t);r&&i&&o.data.set(new Uint8ClampedArray(function(e,t,r,i,s){const a=new Uint32Array(e*e),o="buffer"in t?t:new Float64Array(t),l="buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),c=l.length/(s-i);for(let e=0;e<o.length;e++){const t=o[e],r=Math.floor((t-i)*c);a[e]=l[Object(n.D)(r,0,l.length-1)]}return a.buffer}(t,r,i,s,a))),e.putImageData(o,0,0)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r(18);var i=r(0),n=(r(1),r(40));let s=class extends n.b{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(i.e)([Object(i.y)({readOnly:!0})],s.prototype,"supportsTileUpdates",null),Object(i.e)([Object(i.y)({constructOnly:!0})],s.prototype,"remoteClient",void 0),Object(i.e)([Object(i.y)({constructOnly:!0})],s.prototype,"service",void 0),Object(i.e)([Object(i.y)()],s.prototype,"spatialReference",null),Object(i.e)([Object(i.y)({constructOnly:!0})],s.prototype,"tileInfo",void 0),Object(i.e)([Object(i.y)({constructOnly:!0})],s.prototype,"tileStore",void 0),s=Object(i.e)([Object(i.i)("esri.views.2d.layers.features.processors.BaseProcessor")],s);var a=s}])]);