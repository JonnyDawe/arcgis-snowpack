(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{138:function(e,t,i){"use strict";i.d(t,"a",(function(){return wa})),i.d(t,"b",(function(){return Ha})),i.d(t,"c",(function(){return Va})),i.d(t,"d",(function(){return Ra})),i.d(t,"e",(function(){return gd})),i.d(t,"f",(function(){return ha})),i.d(t,"g",(function(){return wl})),i.d(t,"h",(function(){return U})),i.d(t,"i",(function(){return q})),i.d(t,"j",(function(){return re})),i.d(t,"k",(function(){return $})),i.d(t,"l",(function(){return ul})),i.d(t,"m",(function(){return dr})),i.d(t,"n",(function(){return G})),i.d(t,"o",(function(){return pl})),i.d(t,"p",(function(){return ka})),i.d(t,"q",(function(){return ja})),i.d(t,"r",(function(){return tr})),i.d(t,"s",(function(){return Na})),i.d(t,"t",(function(){return Ea}));i(25),i(18),i(76),i(88);var n,s=i(0),o=i(1),r=i(20),a=i(43),l=i(5),c=i(72),h=i(2),d=i(40),u=i(3),p=i(15),b=i(75),m=i(10),g=i(27),f=i(89),y=i(6),v=i(14),_=i(115),w=i(4),O=i(47),j=i(66),M=i(35),I=i(9),C=i(123),x=i(73),P=(i(54),i(65)),T=i(16),k=i(57),E=i(90),A=i(32),F=i(8),S=i(11),V=i(7),D=i(19),L=i(67),R=i(86),N=i(122);let z=n=class extends s.a{constructor(e){super(e),this.color=new s.j([0,0,0,1])}clone(){return new n(Object(o.o)({color:this.color}))}};Object(s.e)([Object(s.y)({type:s.j,json:{write:!0}})],z.prototype,"color",void 0),z=n=Object(s.e)([Object(s.i)("esri.webmap.background.ColorBackground")],z);var B=z;function H(e,t){const{format:i,quality:n,rotation:o,disableDecorations:r}=e||{},a=Z(e,t.padding),l=function(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){null!=e.area.x&&(i.x=Math.floor(e.area.x)),null!=e.area.y&&(i.y=Math.floor(e.area.y));const n=null!=e.area.width?Math.floor(e.area.width):null,s=null!=e.area.height?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,null!=n&&null!=s)i.width=Math.min(i.width,n),i.height=Math.min(i.height,s);else if(null==n&&null!=s){const e=Math.min(i.width,n);i.height=e/i.width*i.height,i.width=e}else if(null!=n&&null==s){const e=Math.min(i.height,s);i.width=e/i.height*i.width,i.height=e}}return function(e,t){const i=Math.floor(Math.max(e.x,0)),n=Math.floor(Math.max(e.y,0)),s={x:i,y:n,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-n))},o=s.width/s.height,r=e.width/e.height;if(r===o)return s;if(r>o){const e=Math.floor(s.width/r),t=s.height-e;return{x:s.x,y:Math.floor(s.y+t/2),width:s.width,height:e}}const a=Math.floor(s.height*r),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}(function(e,t){if(!t||null==t.width||null==t.height)return e;const i=t.width/t.height,n=e.width/e.height;if(n===i)return e;if(n<i){const t=Math.floor(e.height*i);return e.x-=(t-e.width)/2,e.width=t,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}(i,e),t)}(e,{width:t.width-a.left-a.right,height:t.height-a.top-a.bottom}),{width:c,height:h}=function(e,t){if(!e)return t;const i=e.width,n=e.height;if(null!=i&&null!=n)return{width:Math.floor(i),height:Math.floor(n)};if(null==i&&null==n)return t;const s=t.width/t.height;return null==n?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(n*s),height:Math.floor(n)}}(e,l),d=function(e){switch(e){case"png":case"jpg":case"jpeg":return e;case null:case void 0:default:return Y}}(i),u=X[d];return{format:d,quality:Object(s.D)(null!=n?n:u,0,100),area:l,width:c,height:h,rotation:o,disableDecorations:!!r,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function U(e,t,i,n){n.premultipliedAlpha&&function(e){const t=e.data,i=t.length;for(let e=0;e<i;e+=4){const i=t[e+3];if(i>0){const n=i/255;t[e+0]=t[e+0]/n,t[e+1]=t[e+1]/n,t[e+2]=t[e+2]/n}}}(e),i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.putImageData(e,0,0),n.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(s);const o=s.getImageData(0,0,e.width,e.height),r=function(e,t){const i=J[t.format],n=t.quality/100;return e.toDataURL(i,n)}(i,t);return i.width=0,i.height=0,{dataUrl:r,data:o}}function G(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(K)try{return new ImageData(e,t)}catch(e){K=!1}return function(e,t,i){return i||(W||(W=document.createElement("canvas"),W.width=1,W.height=1),i=W),i.getContext("2d").createImageData(e,t)}(e,t,i)}function q(e,t,i,n=0,s=0,o=e.width-n,r=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:d}=t,u=o/c,p=r/h,b=Math.ceil(u/2),m=Math.ceil(p/2),g=e.width;for(let e=0;e<h;e++)for(let t=0;t<c;t++){const o=4*(t+(a?h-e-1:e)*c);let r=0,f=0,y=0,v=0,_=0,w=0;const O=(e+.5)*p;for(let o=Math.floor(e*p);o<(e+1)*p;o++){const e=Math.abs(O-(o+.5))/m,a=(t+.5)*u,c=e*e;for(let e=Math.floor(t*u);e<(t+1)*u;e++){const t=Math.abs(a-(e+.5))/b,h=Math.sqrt(c+t*t);if(h>=1)continue;let d=2*h*h*h-3*h*h+1;const u=4*(n+e+(s+o)*g);w+=d*l[u+3],f+=d,!i&&l[u+3]<255&&(d=d*l[u+3]/255),y+=d*l[u],v+=d*l[u+1],_+=d*l[u+2],r+=d}}d[o]=y/r,d[o+1]=v/r,d[o+2]=_/r,d[o+3]=w/f}return t}function $(e,t,i){if(!t)return e;const{framebufferWidth:n,framebufferHeight:s,pixelRatio:o,region:r}=e,a=Z(e,i),l=a.left+a.right,c=a.top+a.bottom,h=n-l,d=s-c,u=Math.min(8,Math.min((2048-l)/h,(2048-c)/d));return u<1.5?e:{...e,framebufferWidth:Math.round(h*u)+l,framebufferHeight:Math.round(d*u)+c,pixelRatio:o*u,resample:{region:{x:Math.round((r.x-a.left)*u)+a.left,y:Math.round((r.y-a.top)*u)+a.top,width:Math.round(r.width*u),height:Math.round(r.height*u)},width:n,height:s}}}let W=null,K=!0;function Z(e,t){return!t||e&&e.ignorePadding?Q:t}const J={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Y="png",X={png:100,jpg:98,jpeg:98},Q={top:0,right:0,bottom:0,left:0},ee={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,n=this.values;return t<=i.xsmall?n.xsmall:t<=i.small?n.small:t<=i.medium?n.medium:t<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,n=this.values;return t<=i.xsmall?n.xsmall:t<=i.small?n.small:t<=i.medium?n.medium:t<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],n=t[1],s=this.values;return n>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},te={xsmall:544,small:768,medium:992,large:1200};function ie(e,t){return t?ee[e].valueToClassName[t].split(" "):[]}const ne=e=>{let t=class extends e{constructor(...e){super(...e),this._breakpointsHandles=new s.w,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=te}initialize(){this._breakpointsHandles.add(Object(l.g)(this,["breakpoints","size"],this._updateClassNames))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)}set breakpoints(e){if(e===this._get("breakpoints"))return;const t=function(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){const e=JSON.stringify(te,null,2);console.warn("provided breakpoints are not valid, using defaults:"+e)}e=t?e:te,this._set("breakpoints",{...e})}_updateClassNames(){if(!this.container)return;const e=s.F.acquire(),t=s.F.acquire();let i,n=!1;for(i in ee){const s=this[i],o=ee[i].getValue({viewSize:this.size,breakpoints:this.breakpoints});s!==o&&(n=!0,this[i]=o,ie(i,s).forEach((e=>t.push(e))),ie(i,o).forEach((t=>e.push(t))))}n&&(this._applyClassNameChanges(e,t),s.F.release(e),s.F.release(t))}_applyClassNameChanges(e,t){const i=this.container;i&&(t.forEach((e=>i.classList.remove(e))),e.forEach((e=>i.classList.add(e))))}_removeActiveClassNames(){const e=this.container;if(!e)return;let t;for(t in ee)ie(t,this[t]).forEach((t=>e.classList.remove(t)))}};return Object(s.e)([Object(s.y)()],t.prototype,"breakpoints",null),Object(s.e)([Object(s.y)()],t.prototype,"orientation",void 0),Object(s.e)([Object(s.y)()],t.prototype,"widthBreakpoint",void 0),Object(s.e)([Object(s.y)()],t.prototype,"heightBreakpoint",void 0),t=Object(s.e)([Object(s.i)("esri.views.BreakpointsOwner")],t),t};let se=class extends s.u{constructor(){super(...arguments),this.items=new s.L,this._watchUpdatingTracking=new d.c,this._callbacks=new Map,this._projector=Object(h.h)(),this._hiddenProjector=Object(h.h)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(e=>{e.added.map((e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)})),e.removed.map((e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}))}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let n=null;const s=()=>(n=e.render(),n);i.append(t,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const e=n.domNode.getBoundingClientRect();o.left=e.left,o.top=e.top,o.right=e.right,o.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return o}overlaps(e,t){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};Object(s.e)([Object(s.y)({readOnly:!0})],se.prototype,"surface",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],se.prototype,"items",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],se.prototype,"needsRender",null),Object(s.e)([Object(s.y)({readOnly:!0})],se.prototype,"_watchUpdatingTracking",void 0),Object(s.e)([Object(s.y)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],se.prototype,"updating",void 0),se=Object(s.e)([Object(s.i)("esri.views.overlay.ViewOverlay")],se);var oe=se;function re(e,t,i,n){let s=null,o=1e3;"number"==typeof t?(o=t,n=i):(s=null!=t?t:null,o=i);let r,a=0;const l=()=>{a=0,e.apply(n,r)},c=(...e)=>{s&&s.apply(n,e),r=e,o?a||(a=setTimeout(l,o)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const ae=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>Object(b.a)(e)&&!e.destroyed?Object(h.i)("div",{key:e},e.render()):e instanceof HTMLElement?Object(h.i)("div",{key:e,bind:e,afterCreate:this._attachToNode}):Object(b.b)(e)?Object(h.i)("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=Object(s.e)([Object(s.i)("esri.widgets.Feature.ContentMixin")],t),t},le=["B","kB","MB","GB","TB"];const ce=s.n.getLogger("esri.widgets.Feature.support.featureUtils"),he=/href=(""|'')/gi,de=/(\{([^\{\r\n]+)\})/g,ue=/\'/g,pe=/^\s*expression\//i,be=/(\n)/gi,me=/[\u00A0-\u9999<>\&]/gim,ge=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,fe=/^(?:mailto:|tel:)/,ye="relationships/",ve=Object(s.O)("short-date-short-time");function _e(e){if(!Object(s.J)(e))return e.get("sourceLayer")||e.get("layer")}async function we(e,t){return"function"==typeof e?e.call(null,t):e}function Oe(e=""){if(e)return!fe.test(e.trim().toLowerCase())}function je(e,t){if(!function(e){return pe.test(e)}(t)||!e)return null;const i=t.replace(pe,"").toLowerCase();let n;return e.some((e=>e.name.toLowerCase()===i&&(n=e,!0))),n}function Me(e,t){const i=je(t,null==e?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function Ie(e,t){const i=Ce(t,e);return i?i.name:e}function Ce(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function xe(e){return`${e}`.trim()}function Pe({attributes:e,globalAttributes:t,layer:i,text:n,fieldInfoMap:s}){return n?Te({formattedAttributes:t,template:Ae(n,{...t,...e},i),fieldInfoMap:s}):""}function Te({formattedAttributes:e,template:t,fieldInfoMap:i}){return xe(function(e){return e.replace(he,"")}(Object(s.G)(Object(s.G)(t,(e=>function(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}(e,i))),e)))}function ke(e,t=!1){const i={...e};return Object.keys(i).forEach((e=>function(e,t,i=!1){const n=t[e];if("string"==typeof n){const s="%27",o=(i?encodeURIComponent(n):n).replace(ue,s);t[e]=o}}(e,i,t))),i}function Ee(e,t){return e.replace(de,((e,i,n)=>{const s=Ce(t,n);return s?`{${s.name}}`:i}))}function Ae(e,t,i){const n=Ee(e,i);return n?n.replace(ge,((e,i,n)=>function(e,t,i){const n=(t=xe(t))&&"{"!==t[0];return Object(s.G)(e,ke(i,n))}(e,i||n,t))):n}function Fe(e,t){const i=t.fieldInfos,n=t.fieldName,o=Se(i,n),r=null==o?void 0:o.clone(),a=t.preventPlacesFormatting,l=Ce(t.layer,n);if(r&&l&&"date"===l.type){const e=r.format||new u.k;e.dateFormat=e.dateFormat||"short-date-short-time",r.format=e}const c=r&&r.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,c))||null==e||null==c?e:a?Object(s.H)(e,{...Object(s.I)(c),minimumFractionDigits:0,maximumFractionDigits:20}):c.format(e)}function Se(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let n;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i||(n=e,0)))),n}function Ve(e){const t=[];if(!e)return t;const{fieldInfos:i,content:n}=e;return i&&t.push(...i),n&&Array.isArray(n)?(n.forEach((e=>{if("fields"===e.type){const i=e&&e.fieldInfos;i&&t.push(...i)}})),t):t}function De(e){return e.replace(me,(e=>`&#${e.charCodeAt(0)};`))}function Le(e){return"string"==typeof e?e.replace(be,'<br class="esri-text-new-line" />'):e}function Re(e){const{value:t,fieldName:i,fieldInfos:n,fieldInfoMap:o,layer:r,graphic:a}=e;if(null==t)return"";const l=function({fieldName:e,value:t,graphic:i,layer:n}){if(Be(e))return null;if(!n||"function"!=typeof n.getFieldDomain)return null;const s=n.getFieldDomain(e,{feature:i});return s&&"coded-value"===s.type?s.getName(t):null}({fieldName:i,value:t,graphic:a,layer:r});if(l)return l;const c=function({fieldName:e,graphic:t,layer:i}){if(Be(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:n}=i;if(!n||e!==n)return null;const s=i.getFeatureType(t);return s?s.name:null}({fieldName:i,graphic:a,layer:r});if(c)return c;if(o.get(i.toLowerCase()))return Fe(t,{fieldInfos:n,fieldName:i,layer:r});const h=r&&r.fieldsIndex;return h&&h.isDateField(i)?Object(s.K)(t,ve):Le(t)}function Ne({fieldInfos:e,attributes:t,layer:i,graphic:n,fieldInfoMap:s,relatedInfos:o}){const r={...t};return null==o||o.forEach((e=>function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((i=>He({attributes:e,graphic:i,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((i=>He({attributes:e,graphic:i,relatedInfo:t}))))}(r,e))),Object.keys(r).forEach((t=>{const o=r[t];r[t]=Re({fieldName:t,fieldInfos:e,fieldInfoMap:s,layer:i,value:o,graphic:n})})),r}async function ze({graphic:e,popupTemplate:t,layer:i,spatialReference:n},o){if(!i||!t)return;const{returnGeometry:r}=t;"function"==typeof i.load&&await i.load(o);const a=e.attributes[i.objectIdField];if(null==a)return;const l=[a],c=await t.getRequiredFields(i.fields),h=Object(y.m)(c,e),d=h?[]:c;if(h&&!r)return;const u=await async function(e,t){const{layer:i,graphic:n,outFields:o,objectIds:r,returnGeometry:a,spatialReference:l}=e,c=r[0];if("number"!=typeof c&&"string"!=typeof c){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:n,objectId:c,requiredFields:o},r=new s.s("layer-query-features-invalid-objectid",e,t);throw ce.warn(e,t),r}if("function"!=typeof i.queryFeatures){const e="The specified layer does not support the method 'queryFeatures'. The following fields will not be available.",t={layer:i,graphic:n,requiredFields:o},r=new s.s("layer-query-features-unsupported",e,t);throw ce.warn(e,t),r}const h=i.createQuery();return h.objectIds=r,h.outFields=o,h.returnGeometry=!!a,h.outSpatialReference=l,(await i.queryFeatures(h,t)).features[0]}({layer:i,graphic:e,outFields:d,objectIds:l,returnGeometry:r,spatialReference:n},o);u&&(u.geometry&&(e.geometry=u.geometry),u.attributes&&(e.attributes={...e.attributes,...u.attributes}))}function Be(e=""){return!!e&&-1!==e.indexOf(ye)}function He({attributes:e,graphic:t,relatedInfo:i}){e&&t&&i&&Object.keys(t.attributes).forEach((n=>{const s=function(e){return e?`${ye}${e.layerId}/${e.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:n});e[s]=t.attributes[n]}))}const Ue={editing:!1,operations:{add:!0,update:!0,delete:!0}},Ge=s.L.ofType(f.b);let qe=class extends d.b{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Ue},this.activeAttachmentInfo=null,this.attachmentInfos=new Ge,this.graphic=null,this.mode="view",this.handles.add([Object(l.g)(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...Ue,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new s.s("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),n=new g.b({objectIds:[i],returnMetadata:!0}),o=[],r=e.queryAttachments(n).then((e=>e[i]||o)).catch((()=>o));this._getAttachmentsPromise=r,this.notifyChange("state");const a=await r;return t.removeAll(),a.length&&t.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:n,abilities:o}=this;if(!e)throw new s.s("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!o.operations.add)throw new s.s("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new s.s("invalid-layer","addAttachment(): A valid layer is required.");const r=t.addAttachment(n,e).then((e=>this._queryAttachment(e.objectId))),a=await r;return i.add(a),a}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:n,abilities:o}=this;if(!e)throw new s.s("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!o.operations.delete)throw new s.s("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new s.s("invalid-layer","deleteAttachment(): A valid layer is required.");const r=t.deleteAttachments(n,[e.id]).then((()=>e)),a=await r;return i.remove(a),a}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:n,graphic:o,abilities:r}=this;if(!e)throw new s.s("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new s.s("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!r.operations.update)throw new s.s("invalid-abilities","updateAttachment(): Update abilities are required.");const a=n.findIndex((e=>e===t));if(!i||"function"!=typeof i.updateAttachment)throw new s.s("invalid-layer","updateAttachment(): A valid layer is required.");const l=i.updateAttachment(o,t.id,e).then((e=>this._queryAttachment(e.objectId))),c=await l;return n.splice(a,1,c),c}async _queryAttachment(e){if(!e)throw new s.s("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),n=new g.b({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(n).then((e=>e[i][0]))}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:n}=t;return n&&n[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=_e(e);this._attachmentLayer=t?"scene"===t.type&&Object(s.P)(t.associatedLayer)?t.associatedLayer:t:null}};Object(s.e)([Object(s.y)()],qe.prototype,"abilities",void 0),Object(s.e)([Object(s.v)("abilities")],qe.prototype,"castAbilities",null),Object(s.e)([Object(s.y)()],qe.prototype,"activeAttachmentInfo",void 0),Object(s.e)([Object(s.y)({readOnly:!0,type:Ge})],qe.prototype,"attachmentInfos",void 0),Object(s.e)([Object(s.y)({type:r.a})],qe.prototype,"graphic",void 0),Object(s.e)([Object(s.y)()],qe.prototype,"mode",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],qe.prototype,"state",null),Object(s.e)([Object(s.y)({readOnly:!0})],qe.prototype,"supportsResizeAttachments",null),qe=Object(s.e)([Object(s.i)("esri.widgets.Attachments.AttachmentsViewModel")],qe);var $e=qe;const We={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Ke="esri-attachments",Ze="esri-attachments__loader-container",Je="esri-attachments__loader",Ye="esri-attachments__container",Xe="esri-attachments__container--list",Qe="esri-attachments__container--preview",et="esri-attachments__actions",tt="esri-attachments__delete-button",it="esri-attachments__add-attachment-button",nt="esri-attachments__error-message",st="esri-attachments__items",ot="esri-attachments__item",rt="esri-attachments__item-button",at="esri-attachments__item-mask",lt="esri-attachments__item-mask--icon",ct="esri-attachments__image",ht="esri-attachments__image--resizable",dt="esri-attachments__label",ut="esri-attachments__filename",pt="esri-attachments__item-chevron-icon",bt="esri-attachments__item-link",mt="esri-attachments__item-link-overlay",gt="esri-attachments__item-link-overlay-icon",ft="esri-attachments__item-add-icon",yt="esri-attachments__form-node",vt="esri-attachments__file-fieldset",_t="esri-attachments__file-label",wt="esri-attachments__file-name",Ot="esri-attachments__file-input",jt="esri-attachments__metadata",Mt="esri-attachments__metadata-fieldset",It="esri-attachments__progress-bar",Ct="esri-widget",xt="esri-button",Pt="esri-button--disabled",Tt="esri-button--secondary",kt="esri-button--tertiary",Et="esri-button--third",At="esri-button--small",Ft="esri-button--half",St="esri-widget__content--empty",Vt="esri-icon-right",Dt="esri-icon-left",Lt="esri-icon-plus",Rt=window.CSS;let Nt=class extends h.a{constructor(e,t){super(e,t),this.abilities=null,this.displayType="list",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new $e,this.visibleElements={...We},this._supportsImageOrientation=Rt&&Rt.supports&&Rt.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(Object(l.d)(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),Object(l.g)(this,"viewModel.mode",(()=>this._modeChanged())))}castVisibleElements(e){return{...We,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new s.s("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new s.s("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new s.s("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return Object(h.i)("div",{class:this.classes(Ke,Ct)},e?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?Object(h.i)("div",{key:"error-message",class:nt},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return Object(h.i)("div",{class:Ze,key:"loader"},Object(h.i)("div",{class:Je}))}renderProgressBar(){return this.visibleElements.progressBar?Object(h.i)("div",{class:It,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,n=this.visibleElements.cancelAddButton?Object(h.i)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(xt,kt,At,Ft,e&&Pt)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?Object(h.i)("button",{type:"submit",disabled:i,class:this.classes(xt,Tt,At,Ft,{[Pt]:i})},this.messages.add):null,o=t?Object(h.i)("span",{key:"file-name",class:wt},t.name):null,r=Object(h.i)("form",{bind:this,afterCreate:h.j,afterRemoved:h.m,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Object(h.i)("fieldset",{class:vt},o,Object(h.i)("label",{class:this.classes(_t,xt,Tt)},t?this.messages.changeFile:this.messages.selectFile,Object(h.i)("input",{class:Ot,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,n);return Object(h.i)("div",{key:"add-form-container",class:yt},r)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:n,submitting:o}=this,{contentType:r,size:a,url:l}=e,{abilities:c}=i,d=o||!n,u=c.editing&&c.operations.delete&&t.deleteButton?Object(h.i)("button",{key:"delete-button",type:"button",disabled:o,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(xt,At,kt,tt,{[Pt]:o})},this.messages.delete):null,p=c.editing&&c.operations.update&&t.updateButton?Object(h.i)("button",{disabled:d,key:"update-button",type:"submit",class:this.classes(xt,At,Et,{[Pt]:d})},this.messages.update):null,b=this.visibleElements.cancelUpdateButton?Object(h.i)("button",{disabled:o,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(xt,At,kt,Et,{[Pt]:o})},this.messages.cancel):null,m=n?Object(h.i)("span",{key:"file-name",class:wt},n.name):null,g=c.editing&&c.operations.update?Object(h.i)("fieldset",{key:"file",class:vt},m,Object(h.i)("label",{class:this.classes(_t,xt,Tt)},this.messages.changeFile,Object(h.i)("input",{class:Ot,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,f=Object(h.i)("fieldset",{key:"size",class:Mt},Object(h.i)("label",null,function(e,t){let i=0===t?0:Math.floor(Math.log(t)/Math.log(1024));i=Object(s.D)(i,0,le.length-1);const n=Object(s.H)(t/1024**i,{maximumFractionDigits:2});return Object(s.G)(e.units.bytes[le[i]],{fileSize:n})}(this.messagesUnits,a))),y=Object(h.i)("fieldset",{key:"content-type",class:Mt},Object(h.i)("label",null,r)),v=Object(h.i)("form",{bind:this,afterCreate:h.j,afterRemoved:h.m,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Object(h.i)("div",{class:jt},f,y),g,Object(h.i)("div",{class:et},u,b,p));return Object(h.i)("div",{key:"edit-form-container",class:yt},Object(h.i)("a",{class:bt,href:l,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),Object(h.i)("div",{class:mt},Object(h.i)("span",{class:gt},Object(h.i)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Object(h.i)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Object(h.i)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),v)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:n,name:o,url:r}=e,a=i&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(n),l=this._getCSSTransform(e,a),c=l?{transform:l,"image-orientation":"none"}:{},d=-1===r.indexOf("?")?"?":"&",u=a?`${r}${d}w=${t}`:function(e){const t=Object(s.Q)("esri/themes/base/images/files/");return e?"text/plain"===e?`${t}text-32.svg`:"application/pdf"===e?`${t}pdf-32.svg`:"text/csv"===e?`${t}csv-32.svg`:"application/gpx+xml"===e?`${t}gpx-32.svg`:"application/x-dwf"===e?`${t}cad-32.svg`:"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?`${t}code-32.svg`:"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?`${t}zip-32.svg`:-1!==e.indexOf("image/")?`${t}image-32.svg`:-1!==e.indexOf("audio/")?`${t}sound-32.svg`:-1!==e.indexOf("video/")?`${t}video-32.svg`:-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?`${t}excel-32.svg`:-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?`${t}word-32.svg`:-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}(n),p={[lt]:!a},b={[ht]:i};return Object(h.i)("div",{class:this.classes(p,at)},Object(h.i)("img",{styles:c,alt:o,src:u,class:this.classes(b,ct)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:n}=i,{name:s,url:o}=e,r=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),a=n.editing?Object(h.i)("span",{"aria-hidden":"true",class:this.classes(pt,Object(h.e)()?Dt:Vt)}):null,l=[r,Object(h.i)("label",{class:dt},Object(h.i)("span",{class:ut},s||this.messages.noTitle),a)],c=n.editing?Object(h.i)("button",{key:"details-button",bind:this,class:rt,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):Object(h.i)("a",{key:"details-link",class:rt,href:o,target:"_blank"},l);return Object(h.i)("li",{class:ot,key:e},c)}renderAttachmentContainer(){const{displayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:n,abilities:s}=t,o=n&&n.length,r={[Xe]:"preview"!==e,[Qe]:"preview"===e},a=s.editing&&s.operations.add&&i.addButton?Object(h.i)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(xt,kt,it),type:"button"},Object(h.i)("span",{"aria-hidden":"true",class:this.classes(ft,Lt)}),this.messages.add):null,l=o?Object(h.i)("ul",{class:st},n.toArray().map((t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e})))):Object(h.i)("div",{class:St},this.messages.noAttachments);return Object(h.i)("div",{key:"attachments-container",class:this.classes(Ye,r)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};Object(s.e)([Object(u.l)("viewModel.abilities")],Nt.prototype,"abilities",void 0),Object(s.e)([Object(s.y)()],Nt.prototype,"displayType",void 0),Object(s.e)([Object(u.l)("viewModel.graphic")],Nt.prototype,"graphic",void 0),Object(s.e)([Object(s.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Nt.prototype,"label",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Attachments/t9n/Attachments")],Nt.prototype,"messages",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/core/t9n/Units")],Nt.prototype,"messagesUnits",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Nt.prototype,"selectedFile",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Nt.prototype,"submitting",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Nt.prototype,"error",void 0),Object(s.e)([Object(s.y)({type:$e})],Nt.prototype,"viewModel",void 0),Object(s.e)([Object(s.y)()],Nt.prototype,"visibleElements",void 0),Object(s.e)([Object(s.v)("visibleElements")],Nt.prototype,"castVisibleElements",null),Nt=Object(s.e)([Object(s.i)("esri.widgets.Attachments")],Nt);var zt=Nt;let Bt=class extends $e{constructor(e){super(e),this.description=null,this.title=null}};Object(s.e)([Object(s.y)()],Bt.prototype,"description",void 0),Object(s.e)([Object(s.y)()],Bt.prototype,"title",void 0),Bt=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Bt);var Ht=Bt;const Ut="esri-feature-element-info",Gt="esri-feature-element-info__title",qt="esri-feature-element-info__description";let $t=class extends h.a{constructor(e,t){super(e,t),this.description=null,this.title=null}render(){return Object(h.i)("div",{class:Ut},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?Object(h.i)("h2",{key:"title",class:Gt},e):null}renderDescription(){const{description:e}=this;return e?Object(h.i)("div",{key:"description",class:qt},e):null}};Object(s.e)([Object(s.y)()],$t.prototype,"description",void 0),Object(s.e)([Object(s.y)()],$t.prototype,"title",void 0),$t=Object(s.e)([Object(s.i)("esri.widgets.Feature.support.FeatureElementInfo")],$t);var Wt=$t;const Kt="esri-feature-attachments";let Zt=class extends h.a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new zt,this.description=null,this.displayType=null,this.graphic=null,this.title=null,this.viewModel=new Ht}initialize(){this._featureElementInfo=new Wt,Object(l.g)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())),Object(l.g)(this,"viewModel.graphic",(e=>this.attachmentsWidget.graphic=e))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return Object(h.i)("div",{class:Kt},null==(e=this._featureElementInfo)?void 0:e.render(),null==t?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}};Object(s.e)([Object(s.y)({readOnly:!0})],Zt.prototype,"attachmentsWidget",void 0),Object(s.e)([Object(u.l)("viewModel.description")],Zt.prototype,"description",void 0),Object(s.e)([Object(u.l)("attachmentsWidget.displayType")],Zt.prototype,"displayType",void 0),Object(s.e)([Object(u.l)("viewModel.graphic")],Zt.prototype,"graphic",void 0),Object(s.e)([Object(u.l)("viewModel.title")],Zt.prototype,"title",void 0),Object(s.e)([Object(s.y)({type:Ht})],Zt.prototype,"viewModel",void 0),Zt=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureAttachments")],Zt);var Jt=Zt;let Yt=class extends(Object(d.a)(s.u)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(Object(l.g)(this,"creator",(e=>{this._destroyContent(),this._createContent(e)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(we(i,{graphic:t}).catch((()=>null)),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=we(e,{graphic:t}).catch((()=>null));this._loadingPromise=i,this.notifyChange("state");const n=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",n))}};Object(s.e)([Object(s.y)({readOnly:!0})],Yt.prototype,"created",void 0),Object(s.e)([Object(s.y)()],Yt.prototype,"creator",void 0),Object(s.e)([Object(s.y)()],Yt.prototype,"destroyer",void 0),Object(s.e)([Object(s.y)({type:r.a})],Yt.prototype,"graphic",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Yt.prototype,"state",null),Yt=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Yt);var Xt=Yt;const Qt="esri-feature-content",ei="esri-feature-content__loader-container",ti="esri-feature-content__loader";let ii=class extends h.a{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{Oe(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}renderLoading(){return Object(h.i)("div",{class:ei,key:"loader"},Object(h.i)("div",{class:ti}))}renderCreated(){var e;const t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?Object(h.i)("div",{key:t,bind:t,afterCreate:this._attachToNode}):Object(b.a)(t)?Object(h.i)("div",{key:t},!t.destroyed&&t.render()):Object(h.i)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=null==(e=this.viewModel)?void 0:e.state;return Object(h.i)("div",{class:Qt},"loading"===t?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};Object(s.e)([Object(u.l)("viewModel.creator")],ii.prototype,"creator",void 0),Object(s.e)([Object(u.l)("viewModel.graphic")],ii.prototype,"graphic",void 0),Object(s.e)([Object(s.y)({type:Xt})],ii.prototype,"viewModel",void 0),ii=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureContent")],ii);var ni=ii;let si=class extends s.u{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return null==t||t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const n=t.clone();n.label=Me(n,e),i.push(n)})),i}};Object(s.e)([Object(s.y)()],si.prototype,"attributes",void 0),Object(s.e)([Object(s.y)({type:[u.j]})],si.prototype,"expressionInfos",void 0),Object(s.e)([Object(s.y)()],si.prototype,"description",void 0),Object(s.e)([Object(s.y)({type:[u.d]})],si.prototype,"fieldInfos",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],si.prototype,"formattedFieldInfos",null),Object(s.e)([Object(s.y)()],si.prototype,"title",void 0),si=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],si);var oi=si;const ri=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function ai(e,t){if("string"!=typeof t||!t)return t;const i=function(e){let t=null;return ri.some((i=>(i.pattern.test(e)&&(t=i),!!t))),t}(t);if(!i)return t;const n=t.match(i.pattern),o=n&&n[2],r=Object(s.G)(Object(s.G)(i.label,{messages:e,hierPart:o}),{appName:i.appName}),a=i.target?` target="${i.target}"`:"",l="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${a} href="$1"${l}>${r}</a>`)}const li="esri-feature-fields",ci="esri-feature-fields__field-header",hi="esri-feature-fields__field-data",di="esri-feature-fields__field-data--date",ui="esri-widget__table";let pi=class extends h.a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new oi,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Wt,Object(l.g)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,n=e.fieldName,s=e.label||n,o=i?null==i[n]?"":i[n]:"",r=!(!e.format||!e.format.dateFormat),a="number"!=typeof o||r?ai(this.messagesURIUtils,o):this._forceLTR(o),l={[di]:r};return Object(h.i)("tr",{key:`fields-element-info-row-${n}-${t}`},Object(h.i)("th",{key:`fields-element-info-row-header-${n}-${t}`,class:ci,innerHTML:s}),Object(h.i)("td",{key:`fields-element-info-row-data-${n}-${t}`,class:this.classes(hi,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e.length?Object(h.i)("table",{class:ui,summary:this.messages.fieldsSummary},Object(h.i)("tbody",null,e.map(((e,t)=>this.renderFieldInfo(e,t))))):null}render(){var e;return Object(h.i)("div",{class:li},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};Object(s.e)([Object(u.l)("viewModel.attributes")],pi.prototype,"attributes",void 0),Object(s.e)([Object(u.l)("viewModel.description")],pi.prototype,"description",void 0),Object(s.e)([Object(u.l)("viewModel.expressionInfos")],pi.prototype,"expressionInfos",void 0),Object(s.e)([Object(u.l)("viewModel.fieldInfos")],pi.prototype,"fieldInfos",void 0),Object(s.e)([Object(u.l)("viewModel.title")],pi.prototype,"title",void 0),Object(s.e)([Object(s.y)({type:oi})],pi.prototype,"viewModel",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Feature/t9n/Feature")],pi.prototype,"messages",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/support/t9n/uriUtils")],pi.prototype,"messagesURIUtils",void 0),pi=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureFields")],pi);var bi=pi;const mi=s.n.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),gi=new Map;function fi(e){if(!Be(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function yi(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:n}=t;return n.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(!i)return;const n=`${t.url}/${i.relatedTableId}`;return{url:n,queryTask:new f.c({url:n,sourceSpatialReference:t.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}async function vi(e,t,i,n){const o=i.layerId.toString(),{layerInfo:r,queryTask:a,relation:l,relatedFields:c,outStatistics:h}=t,d=function({originRelationship:e,relationships:t,layerId:i}){let n;return t&&t.some((t=>(`${t.relatedTableId}`===i&&t.id===e.id&&(n=t),!!n))),n}({originRelationship:l,relationships:r.relationships,layerId:o});if(d.relationshipTableId&&d.keyFieldInRelationshipTable){const t=(await function(e,t,i,n){const s=new g.a;return s.outFields=["*"],s.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,n)}(e,d,i,n))[e.attributes[i.objectIdField]];if(!t)return null;const o=t.features.map((e=>e.attributes[r.objectIdField]));if((null==h?void 0:h.length)>0&&r.supportsStatistics){const e=new v.b;e.where=function(e,t,i){let n=0;const s=[];for(;n<t.length;)s.push(`${e} IN (${t.slice(n,i+n)})`),n+=i;return s.join(" OR ")}(r.objectIdField,o,1e3),e.outFields=c,e.outStatistics=h;const i={features:Promise.resolve(t),statsFeatures:a.execute(e)};return Object(s.E)(i)}}const u=null==d?void 0:d.keyField;if(u){const i=Object(y.j)(Object(y.g)(r.fields,u)),o=function(e,t){const i=t.toLowerCase();for(const t in e)if(t.toLowerCase()===i)return e[t];return null}(e.attributes,l.keyField),c=i?`${u}=${o}`:`${u}='${o}'`,h=a.execute(new v.b({where:c,outFields:t.relatedFields}),n),d=t.outStatistics&&t.outStatistics.length>0&&r.supportsStatistics?a.execute(new v.b({where:c,outFields:t.relatedFields,outStatistics:t.outStatistics}),n):null,p={features:h};return d&&(p.statsFeatures=d),Object(s.E)(p)}return null}function _i({relatedInfos:e,layer:t},i){const n={};return e.forEach(((e,o)=>{const{relation:r}=e;if(!r){const e=new s.s("relation-required","A relation is required on a layer to retrieve related records.");throw mi.error(e),e}const{relatedTableId:a}=r;if("number"!=typeof a){const e=new s.s("A related table ID is required on a layer to retrieve related records.");throw mi.error(e),e}const l=`${t.url}/${a}`,c=gi.get(l),h=c||function(e,t){return Object(s.C)(e,{query:{f:"json"},signal:t&&t.signal})}(l,i);c||gi.set(l,h),n[o]=h})),Object(s.E)(n)}let wi=class extends s.u{constructor(e){super(e),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,fieldInfoMap:n,layer:s}=this;return null==t?void 0:t.map((t=>{if(!t)return null;if(t.title=Pe({attributes:e,fieldInfoMap:n,globalAttributes:i,layer:s,text:t.title}),t.caption=Pe({attributes:e,fieldInfoMap:n,globalAttributes:i,layer:s,text:t.caption}),t.altText=Pe({attributes:e,fieldInfoMap:n,globalAttributes:i,layer:s,text:t.altText}),"image"===t.type){const{value:e}=t;return this._setImageValue({value:e,formattedAttributes:i,layer:s}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){const{value:n}=t;return this._setChartValue({value:n,chartType:t.type,attributes:e,formattedAttributes:i,layer:s}),t}return null})).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:n,layer:s}=e,{linkURL:o,sourceURL:r}=i;if(r){const e=Ee(r,s);i.sourceURL=Te({formattedAttributes:n,template:e,fieldInfoMap:t})}if(o){const e=Ee(o,s);i.linkURL=Te({formattedAttributes:n,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:n,chartType:s,layer:o}=e,{popupTemplate:r,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=function(e,t){return e&&e.map((e=>Ie(e,t)))}(l,o),c&&(t.normalizeField=Ie(c,o)),!l.some((e=>!!(null!=n[e]||Be(e)&&a.size))))return;const h=null==r?void 0:r.fieldInfos;l.forEach((e=>{if(Be(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:e,formattedAttributes:n,chartType:s,value:t})]);const o=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:n,fieldName:e,fieldInfos:h});t.series.push(o)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:n,formattedAttributes:s,chartType:o,value:r}=e,a=[],l=fi(n),{layerId:c,fieldName:h}=l,d=null==(t=this.relatedInfos)?void 0:t.get(c.toString());if(!d)return a;const{relatedFeatures:u,relation:p}=d;if(!p||!u)return a;const{cardinality:b}=p;return u.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===h&&a.push(this._getChartOption({value:r,attributes:t,formattedAttributes:s,fieldName:n,chartType:o,relatedFieldName:e,fieldInfos:i}))}))})),"one-to-many"===b||"many-to-many"===b?a:[a[0]]}_getTooltip({label:e,value:t,chartType:i}){return"pie-chart"===i?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:i,attributes:n,formattedAttributes:s,fieldName:o,relatedFieldName:r,fieldInfos:a,chartType:l}=e,{layer:c}=this,{normalizeField:h,tooltipField:d}=i,p=h?Be(h)?n[fi(h).fieldName]:n[h]:null,b=r&&void 0!==n[r]?n[r]:void 0!==n[o]?n[o]:s[o],m=void 0===b?null:b&&p?b/p:b,g=new u.b({value:m});if(Be(o)){const e=fi(o),t=fi(d),i=t?t.fieldName:null,s=Fe(m,{fieldInfos:a,fieldName:r,layer:c,preventPlacesFormatting:!!p}),h=e?e.label||e.fieldName:r,u=i&&void 0!==n[i]?n[i]:h;return g.tooltip=this._getTooltip({label:u,value:s,chartType:l}),g}const f=Se(a,o),y=Ie(o,c),v=d&&void 0!==s[d]?s[d]:Me(f||new u.d({fieldName:y}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),_=s[y];return g.tooltip=this._getTooltip({label:v,value:_,chartType:l}),g}};Object(s.e)([Object(s.y)()],wi.prototype,"activeMediaInfoIndex",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],wi.prototype,"activeMediaInfo",null),Object(s.e)([Object(s.y)()],wi.prototype,"attributes",void 0),Object(s.e)([Object(s.y)()],wi.prototype,"description",void 0),Object(s.e)([Object(s.y)()],wi.prototype,"fieldInfoMap",void 0),Object(s.e)([Object(s.y)()],wi.prototype,"formattedAttributes",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],wi.prototype,"formattedMediaInfos",null),Object(s.e)([Object(s.y)()],wi.prototype,"layer",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],wi.prototype,"formattedMediaInfoCount",null),Object(s.e)([Object(s.y)()],wi.prototype,"mediaInfos",void 0),Object(s.e)([Object(s.y)()],wi.prototype,"popupTemplate",void 0),Object(s.e)([Object(s.y)()],wi.prototype,"relatedInfos",void 0),Object(s.e)([Object(s.y)()],wi.prototype,"title",void 0),wi=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],wi);var Oi=wi,ji=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Mi=[{name:"default",colors:[].concat(ji.slice(30,39),ji.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Ii="en-us",Ci=new Map([["ar",()=>Promise.all([i.e(0),i.e(96)]).then(i.bind(null,236)).then((function(e){return e.a}))],["bs-ba",()=>Promise.all([i.e(0),i.e(107)]).then(i.bind(null,237)).then((function(e){return e.b}))],["ca-es",()=>Promise.all([i.e(0),i.e(109)]).then(i.bind(null,238)).then((function(e){return e.c}))],["cs-cz",()=>Promise.all([i.e(0),i.e(111)]).then(i.bind(null,239)).then((function(e){return e.c}))],["da-dk",()=>Promise.all([i.e(0),i.e(113)]).then(i.bind(null,240)).then((function(e){return e.d}))],["de-de",()=>Promise.all([i.e(0),i.e(118)]).then(i.bind(null,241)).then((function(e){return e.d}))],["de-ch",()=>Promise.all([i.e(0),i.e(117)]).then(i.bind(null,242)).then((function(e){return e.d}))],["el-gr",()=>Promise.all([i.e(0),i.e(120)]).then(i.bind(null,243)).then((function(e){return e.e}))],["en-us",()=>Promise.all([i.e(0),i.e(130)]).then(i.bind(null,244)).then((function(e){return e.e}))],["en-ca",()=>Promise.all([i.e(0),i.e(129)]).then(i.bind(null,245)).then((function(e){return e.e}))],["es-es",()=>Promise.all([i.e(0),i.e(135)]).then(i.bind(null,246)).then((function(e){return e.e}))],["et-ee",()=>Promise.all([i.e(0),i.e(137)]).then(i.bind(null,247)).then((function(e){return e.e}))],["fi-fi",()=>Promise.all([i.e(0),i.e(143)]).then(i.bind(null,248)).then((function(e){return e.f}))],["fr-fr",()=>Promise.all([i.e(0),i.e(147)]).then(i.bind(null,249)).then((function(e){return e.f}))],["he-il",()=>Promise.all([i.e(0),i.e(152)]).then(i.bind(null,250)).then((function(e){return e.h}))],["hr-hr",()=>Promise.all([i.e(0),i.e(154)]).then(i.bind(null,251)).then((function(e){return e.h}))],["hu-hu",()=>Promise.all([i.e(0),i.e(156)]).then(i.bind(null,252)).then((function(e){return e.h}))],["id-id",()=>Promise.all([i.e(0),i.e(159)]).then(i.bind(null,253)).then((function(e){return e.i}))],["it-it",()=>Promise.all([i.e(0),i.e(162)]).then(i.bind(null,254)).then((function(e){return e.i}))],["ja-jp",()=>Promise.all([i.e(0),i.e(164)]).then(i.bind(null,255)).then((function(e){return e.j}))],["ko-kr",()=>Promise.all([i.e(0),i.e(166)]).then(i.bind(null,256)).then((function(e){return e.k}))],["lt-lt",()=>Promise.all([i.e(0),i.e(170)]).then(i.bind(null,257)).then((function(e){return e.l}))],["lv-lv",()=>Promise.all([i.e(0),i.e(172)]).then(i.bind(null,258)).then((function(e){return e.l}))],["nb-no",()=>Promise.all([i.e(0),i.e(175)]).then(i.bind(null,259)).then((function(e){return e.n}))],["nl-nl",()=>Promise.all([i.e(0),i.e(178)]).then(i.bind(null,260)).then((function(e){return e.n}))],["pl-pl",()=>Promise.all([i.e(0),i.e(182)]).then(i.bind(null,261)).then((function(e){return e.p}))],["pt-br",()=>Promise.all([i.e(0),i.e(185)]).then(i.bind(null,262)).then((function(e){return e.p}))],["pt-pt",()=>Promise.all([i.e(0),i.e(186)]).then(i.bind(null,263)).then((function(e){return e.p}))],["ro-ro",()=>Promise.all([i.e(0),i.e(189)]).then(i.bind(null,264)).then((function(e){return e.r}))],["ru-ru",()=>Promise.all([i.e(0),i.e(191)]).then(i.bind(null,265)).then((function(e){return e.r}))],["sk-sk",()=>Promise.all([i.e(0),i.e(193)]).then(i.bind(null,266)).then((function(e){return e.s}))],["sl-sl",()=>Promise.all([i.e(0),i.e(195)]).then(i.bind(null,267)).then((function(e){return e.s}))],["sr-rs",()=>Promise.all([i.e(0),i.e(198)]).then(i.bind(null,268)).then((function(e){return e.s}))],["sv-se",()=>Promise.all([i.e(0),i.e(200)]).then(i.bind(null,269)).then((function(e){return e.s}))],["th-th",()=>Promise.all([i.e(0),i.e(203)]).then(i.bind(null,270)).then((function(e){return e.t}))],["tr-tr",()=>Promise.all([i.e(0),i.e(205)]).then(i.bind(null,271)).then((function(e){return e.t}))],["uk-ua",()=>Promise.all([i.e(0),i.e(207)]).then(i.bind(null,272)).then((function(e){return e.u}))],["vi-vn",()=>Promise.all([i.e(0),i.e(209)]).then(i.bind(null,273)).then((function(e){return e.v}))],["zh-cn",()=>Promise.all([i.e(0),i.e(214)]).then(i.bind(null,274)).then((function(e){return e.z}))],["zh-hk",()=>Promise.all([i.e(0),i.e(20)]).then(i.bind(null,172)).then((function(e){return e.z}))],["zh-tw",()=>Promise.all([i.e(0),i.e(20)]).then(i.bind(null,172)).then((function(e){return e.z}))]]);function xi(e){return e?Ci.has(e.toLowerCase())?e.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const e of Ci.keys())if(e.startsWith(t)){i=e;break}return i}(e)||Ii:Ii}let Pi,Ti;const ki="esri-feature-media",Ei="esri-feature-media__container",Ai="esri-feature-media__item-container",Fi="esri-feature-media__item",Si="esri-feature-media__item-title",Vi="esri-feature-media__item-caption",Di="esri-feature-media__previous",Li="esri-feature-media__previous-icon",Ri="esri-feature-media__previous-icon--rtl",Ni="esri-feature-media__next",zi="esri-feature-media__next-icon",Bi="esri-feature-media__next-icon--rtl",Hi="esri-feature-media__chart",Ui="esri-feature-media__button",Gi="esri-feature-media__icon",qi="esri-icon-left-triangle-arrow",$i="esri-icon-right-triangle-arrow",Wi=.05,Ki=.95;let Zi=class extends h.a{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Oi,this.messages=null}initialize(){this._featureElementInfo=new Wt,this.own(Object(l.g)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),Object(l.g)(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return Object(h.i)("div",{bind:this,class:ki,onkeyup:this._handleMediaKeyup},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Object(h.i)("div",{key:"media-element-container",class:Ei},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:o,altText:r,title:a,type:l}=e,{sourceURL:c,linkURL:d}=s,u=Oe(d)?"_blank":"_self",p="_blank"===u?"noreferrer":"",b=o?t:null,m=b?b.timestamp:0,g=b?b.sourceURL:c,f=Object(h.i)("img",{alt:r||a,key:`media-${l}-${i}-${n}-${m}`,src:g});return(d?Object(h.i)("a",{title:a,href:d,rel:p,target:u},f):null)||f}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return Object(h.i)("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:Hi,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel,t=e.title?Object(h.i)("div",{key:"media-title",class:Si,innerHTML:e.title}):null,i=e.caption?Object(h.i)("div",{key:"media-caption",class:Vi,innerHTML:e.caption}):null;return Object(h.i)("div",{key:"media-container",class:Ai},Object(h.i)("div",{key:"media-item-container",class:Fi},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,n=t?this.classes(Ui,Di):this.classes(Ui,Ni),s=t?this.classes(Gi,Li,qi):this.classes(Gi,zi,$i),o=t?this.classes(Gi,Ri,$i):this.classes(Gi,Bi,qi),r=t?"media-previous":"media-next",a=t?this._previous:this._next;return Object(h.i)("button",{type:"button",key:r,title:i,"aria-label":i,tabIndex:0,class:n,bind:this,onclick:a},Object(h.i)("span",{"aria-hidden":"true",class:s}),Object(h.i)("span",{"aria-hidden":"true",class:o}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(e){const t=await async function(e=Object(s.R)()){if(e=xi(e),Pi&&e===Ti)return Pi;Pi=Promise.all([i.e(25),i.e(0)]).then(i.bind(null,275)).then((function(e){return e.i})),Ti=e;try{const[t,i]=await Promise.all([Pi,Ci.get(Ti)()]);Ti===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Pi=null,Ti=null,null}return Pi}(),{activeMediaInfo:n}=this.viewModel;this._renderChart({chartDiv:e,mediaInfo:n,chartsModule:t})}_handleMediaKeyup(e){const t=Object(s.T)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{chartsModule:t,chartDiv:i,mediaInfo:n}=e,{value:s,type:o}=n,{am4core:r}=t,a=function(e,t="default"){const i=Mi.find((e=>e.name===t));return i?i.colors.map((t=>e.color(t))):null}(r);Object(h.n)()&&r.useTheme(t.am4themes_dark),r.useTheme(t.am4themes_animated),r.useTheme((function(e){e instanceof r.ColorSet&&a&&(e.list=a)}));const l="pie-chart"===o?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",n.altText||n.title),l.data=s.series.map((e=>({tooltip:e.tooltip,value:e.value}))).filter((e=>"pie-chart"!==o||e.value>0))}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:n,am4charts:s}=i,o=n.create(t,s.PieChart);o.rtl=Object(h.e)();const r=o.series.push(new s.PieSeries);return r.labels.template.disabled=!0,r.ticks.template.disabled=!0,r.dataFields.value="value",r.dataFields.category="tooltip",this._customizeChartTooltip(r.tooltip,n),o}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:n}=t,{value:s}=n,{am4core:o,am4charts:r}=i,a=e.xAxes.push(new r.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,o),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new r.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=Wi,l.renderer.maxLabelPosition=Ki,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,o),c.wrap=!0;const h=e.series.push(new r.ColumnSeries);h.dataFields.valueY="value",h.dataFields.categoryX="tooltip",e.cursor=new r.XYCursor,s.series.length>15&&(e.scrollbarX=new o.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:n}=t,{value:s}=n,{am4core:o,am4charts:r}=i,a=e.yAxes.push(new r.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,o),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dx=a.tooltip.contentWidth}));const l=e.xAxes.push(new r.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=Wi,l.renderer.maxLabelPosition=Ki,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,o),c.wrap=!0;const h=e.series.push(new r.ColumnSeries);h.dataFields.valueX="value",h.dataFields.categoryY="tooltip",e.cursor=new r.XYCursor,s.series.length>15&&(e.scrollbarY=new o.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:n}=t,{value:s}=n,{am4core:o,am4charts:r}=i,a=e.xAxes.push(new r.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,o),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new r.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=Wi,l.renderer.maxLabelPosition=Ki,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,o),c.wrap=!0;const h=e.series.push(new r.LineSeries);h.dataFields.categoryX="tooltip",h.dataFields.valueY="value",e.cursor=new r.XYCursor,s.series.length>15&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:n}=e,{type:s}=n,{am4core:o,am4charts:r}=i,a=o.create(t,r.XYChart);return a.rtl=Object(h.e)(),"column-chart"===s&&this._createColumnChart(a,e),"bar-chart"===s&&this._createBarChart(a,e),"line-chart"===s&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const n=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),n);this._refreshTimer=s}_getImageSource(e,t){const i=-1!==e.indexOf("?")?"&":"?",[n,s=""]=e.split("#");return`${n}${i}timestamp=${t}${s?"#":""}${s}`}};Object(s.e)([Object(u.l)("viewModel.attributes")],Zi.prototype,"attributes",void 0),Object(s.e)([Object(u.l)("viewModel.activeMediaInfoIndex")],Zi.prototype,"activeMediaInfoIndex",void 0),Object(s.e)([Object(u.l)("viewModel.description")],Zi.prototype,"description",void 0),Object(s.e)([Object(u.l)("viewModel.fieldInfoMap")],Zi.prototype,"fieldInfoMap",void 0),Object(s.e)([Object(u.l)("viewModel.layer")],Zi.prototype,"layer",void 0),Object(s.e)([Object(u.l)("viewModel.mediaInfos")],Zi.prototype,"mediaInfos",void 0),Object(s.e)([Object(u.l)("viewModel.popupTemplate")],Zi.prototype,"popupTemplate",void 0),Object(s.e)([Object(u.l)("viewModel.relatedInfos")],Zi.prototype,"relatedInfos",void 0),Object(s.e)([Object(u.l)("viewModel.title")],Zi.prototype,"title",void 0),Object(s.e)([Object(s.y)({type:Oi})],Zi.prototype,"viewModel",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Feature/t9n/Feature")],Zi.prototype,"messages",void 0),Zi=Object(s.e)([Object(s.i)("esri.widgets.Feature.FeatureMedia")],Zi);var Ji=Zi;const Yi=["$datastore","$map","$layer","$aggregatedfeatures"],Xi=s.n.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function Qi({graphic:e,view:t}){const{isAggregate:i,layer:n}=e;if(!i||!n||"2d"!==(null==t?void 0:t.type))return[];const s=await t.whenLayerView(n);if(!s.createQuery||!s.queryFeatures)return[];const o=s.createQuery();o.aggregateIds=[e.getObjectId()];const{features:r}=await s.queryFeatures(o);return r}async function en({expressionAttributes:e,info:t,arcadeUtils:i,spatialReference:n,map:s,graphic:o,view:r}){const a=`expression/${t.name}`,l=i.createSyntaxTree(t.expression),c=Yi.filter((e=>i.hasVariable(l,e)));await i.loadScriptDependencies(l,!0,c);const h=i.getViewInfo({spatialReference:n}),d=i.createExecContext(o,h);d.useAsync=!0,function({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:n,viewInfo:s,map:o,graphic:r}){i.forEach((i=>{const a=i.toLowerCase(),l={map:o,spatialReference:s.sr};if("$map"===a&&(n.vars[a]=t.convertMapToFeatureSetCollection(l)),"$layer"===a&&(n.vars[a]=t.convertFeatureLayerToFeatureSet(r.sourceLayer,s.sr)),"$datastore"===a&&(n.vars[a]=t.convertServiceUrlToWorkspace(r.sourceLayer.url,s.sr)),"$aggregatedfeatures"===a){const i=r.layer,{fields:o,objectIdField:l,geometryType:c,spatialReference:h,displayField:d}=i,u=new _.k({fields:o,objectIdField:l,geometryType:c,spatialReference:h,displayField:d,..."feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null,source:e});n.vars[a]=t.convertFeatureLayerToFeatureSet(u,s.sr)}}))}({aggregatedFeatures:await Qi({graphic:o,view:r}),arcadeUtils:i,featureSetVars:c,context:d,viewInfo:h,map:s,graphic:o});const u=i.createFunction(l,d),p=await i.executeAsyncFunction(u,d).catch((e=>Xi.error("arcade-execution-error",{error:e,graphic:o,expressionInfo:t})));e[a]="string"==typeof p?Le(De(p)):Array.isArray(p)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?Le(De(e)):e}</li>`)).join("")}</ul>`}(p):p&&"esri.arcade.Dictionary"===p.declaredClass?function(e){return`<table class="esri-widget__table">${e.keys().map((t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof i?Le(De(i)):i}</td></tr>`})).join("")}</table>`}(p):p}async function tn({popupTemplate:e,spatialReference:t,graphic:n,map:o,view:r}){const a=e.expressionInfos,l=[],c={};if(!a||!a.length)return c;const h=await Promise.all([i.e(10),i.e(0),i.e(21)]).then(i.bind(null,166)).then((function(e){return e.aq}));for(const e of a)l.push(en({expressionAttributes:c,info:e,arcadeUtils:h,spatialReference:t,map:o,graphic:n,view:r}));return await Object(s.E)(l),c}const nn="esri.widgets.FeatureViewModel",sn=s.n.getLogger(nn);let on=class extends s.u{constructor(e){super(e),this._handles=new s.w,this._featureAbortController=null,this.graphicChangedThrottled=re(this.graphicChanged,1,this),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._handles.add(Object(l.g)(this,["graphic","_effectivePopupTemplate"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return Object(s.P)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(e,t){const i=new Map;return e&&e.forEach((e=>{const n=Ie(e.fieldName,t);e.fieldName=n,i.set(n.toLowerCase(),e)})),i}(Ve(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return _e(this.graphic)}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Oi&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Oi&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Oi&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._clear();const{graphic:e}=this;if(!e)return;const t=Object(s.V)();this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(t){sn.error("error","error loading popupTemplate for graphic",{error:t,graphic:e})}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.map(((e,t)=>"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):void 0)):"string"==typeof e?this._compileText(new u.c({text:e}),0).text:e}_destroyContentViewModels(){this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_compileAttachments(e,t){const{graphic:i}=this,{description:n,title:s}=e;return this.contentViewModels[t]=new Ht({graphic:i,...this._compileTitleAndDesc({title:s,description:n})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:n,destroyer:s}=e;return this.contentViewModels[t]=new Xt({graphic:i,creator:n,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:n,graphic:s,formattedAttributes:o}=this,{attributes:r}=s,a=o.global;return{title:Pe({attributes:r,fieldInfoMap:i,globalAttributes:a,layer:n,text:e}),description:Pe({attributes:r,fieldInfoMap:i,globalAttributes:a,layer:n,text:t})}}_compileFields(e,t){const{_effectivePopupTemplate:i,formattedAttributes:n}=this,s=e.clone(),o=(null==e?void 0:e.fieldInfos)||(null==i?void 0:i.fieldInfos),r=null==i?void 0:i.expressionInfos,a={...n.global,...n.content[t]},{description:l,title:c}=s,h=new oi({attributes:a,expressionInfos:r,fieldInfos:o,...this._compileTitleAndDesc({title:c,description:l})});return this.contentViewModels[t]=h,s.fieldInfos=h.formattedFieldInfos.slice(0),s}_compileMedia(e,t){const{graphic:i,_fieldInfoMap:n,_effectivePopupTemplate:s,relatedInfos:o,_sourceLayer:r}=this,{attributes:a}=i,l=this.formattedAttributes.global,c=e.clone(),{description:h,mediaInfos:d,title:u}=c,p=new Oi({activeMediaInfoIndex:c.activeMediaInfoIndex||0,attributes:a,layer:r,fieldInfoMap:n,formattedAttributes:l,mediaInfos:d,popupTemplate:s,relatedInfos:o,...this._compileTitleAndDesc({title:u,description:h})});return c.mediaInfos=p.formattedMediaInfos.slice(0),this.contentViewModels[t]=p,c}_compileText(e,t){const i=e.clone(),{graphic:n,_fieldInfoMap:s,_sourceLayer:o}=this;if(i&&i.text){const{attributes:e}=n,t=this.formattedAttributes.global;i.text=Pe({attributes:e,fieldInfoMap:s,globalAttributes:t,layer:o,text:i.text})}return this.contentViewModels[t]=new Xt({graphic:n,creator:i.text}),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:n}=e,o=null==t?void 0:t.editFieldsInfo;return n&&o?function(e,t){const{creatorField:i,creationDateField:n,editorField:o,editDateField:r}=e;if(!t)return;const a=t[r];if("number"==typeof a){const e=t[o];return{type:"edit",date:Object(s.K)(a,ve),user:e}}const l=t[n];if("number"==typeof l){const e=t[i];return{type:"create",date:Object(s.K)(l,ve),user:e}}return null}(o,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:n}=this,{attributes:s}=n;return Pe({attributes:s,fieldInfoMap:t,globalAttributes:this.formattedAttributes.global,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return we(null==e?void 0:e.title,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return we(null==e?void 0:e.content,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:n,_effectivePopupTemplate:o,spatialReference:r,map:a,view:l}=this,{content:{value:c},title:{value:h}}=await Object(s.E)({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!n)return;const{expressionAttributes:{value:d}}=await Object(s.E)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:tn({popupTemplate:this._effectivePopupTemplate,spatialReference:r,graphic:n,map:a,view:l}),queryUpdatedFeature:ze({graphic:n,popupTemplate:o,layer:i,spatialReference:r},e)});t===this._featureAbortController&&n&&(this._set("formattedAttributes",this._createFormattedAttributes(c,d)),this._set("title",this._compileTitle(h)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(c)||null))}_createFormattedAttributes(e,t){const{_effectivePopupTemplate:i,graphic:n,relatedInfos:s,_sourceLayer:o,_fieldInfoMap:r}=this,a=null==i?void 0:i.fieldInfos,l={...n.attributes,...t},c={global:Ne({fieldInfos:a,graphic:n,attributes:l,layer:o,fieldInfoMap:r,relatedInfos:s}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&e.fieldInfos&&(c.content[t]=Ne({fieldInfos:e.fieldInfos,graphic:n,attributes:l,layer:o,fieldInfoMap:r,relatedInfos:s}))})),c}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Ve(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:n,_sourceLayer:o}=this;n.clear();const r=Object(s.P)(o.associatedLayer)?await o.associatedLayer.load(i):o;if(!r)return;const a=t.filter((e=>e&&Be(e.fieldName)));if(!a||!a.length)return;t.forEach((e=>this._configureRelatedInfo(e,r)));const l=await _i({relatedInfos:n,layer:r},i);Object.keys(l).forEach((e=>{var t;const i=n.get(e.toString()),s=null==(t=l[e])?void 0:t.value;i&&s&&(i.layerInfo=s.data)}));const c=await function({graphic:e,relatedInfos:t,layer:i},n){const o={};return t.forEach(((t,s)=>{t.layerInfo&&(o[s]=vi(e,t,i,n))})),Object(s.E)(o)}({graphic:e,relatedInfos:n,layer:r},i);Object.keys(c).forEach((e=>{var t;!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:n}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const o=n&&n.value;t.relatedStatsFeatures=o?o.features:[]}(null==(t=c[e])?void 0:t.value,n.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,n=fi(e.fieldName);if(!n)return;const{layerId:s,fieldName:o}=n;if(!s)return;const r=i.get(s.toString())||yi(s,t);r&&(function({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const n=new v.e({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(n)}}({relatedInfo:r,fieldName:o,fieldInfo:e}),this.relatedInfos.set(s,r))}};Object(s.e)([Object(s.y)()],on.prototype,"_featureAbortController",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"_effectivePopupTemplate",null),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"_fieldInfoMap",null),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"_sourceLayer",null),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"content",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"contentViewModels",void 0),Object(s.e)([Object(s.y)({type:Boolean})],on.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"formattedAttributes",void 0),Object(s.e)([Object(s.y)({type:r.a,value:null})],on.prototype,"graphic",null),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"lastEditInfo",void 0),Object(s.e)([Object(s.y)()],on.prototype,"relatedInfos",void 0),Object(s.e)([Object(s.y)()],on.prototype,"spatialReference",null),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"title",void 0),Object(s.e)([Object(s.y)()],on.prototype,"map",null),Object(s.e)([Object(s.y)({readOnly:!0})],on.prototype,"waitingForContent",null),Object(s.e)([Object(s.y)()],on.prototype,"view",void 0),on=Object(s.e)([Object(s.i)(nn)],on);var rn=on;const an="esri-icon-loading-indicator esri-rotating",ln="esri-widget",cn="esri-feature",hn="esri-feature__size-container",dn="esri-feature__title",un="esri-feature__main-container",pn="esri-feature__content-element",bn="esri-feature__text",mn="esri-feature__last-edited-info",gn="esri-feature__loading-container",fn="esri-feature__loading-spinner",yn={title:!0,content:!0,lastEditedInfo:!0};let vn=class extends(ae(h.a)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...yn},this.map=null,this.view=null,this.viewModel=new rn}initialize(){this.own(Object(l.g)(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...yn,...e}}render(){const{waitingForContent:e}=this.viewModel;return Object(h.i)("div",{class:this.classes(cn,ln)},Object(h.i)("div",{class:hn},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return Object(h.i)("div",{key:"loading-container",class:gn},Object(h.i)("span",{class:this.classes(an,fn)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?Object(h.i)("div",{class:un},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?Object(h.i)("h4",{class:dn,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?Object(h.i)("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:Object(h.i)("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:n}=t.viewModel;return"loading"===i||n.length>0?Object(h.i)("div",{key:this._buildKey("attachments-element",e),class:this.classes(pn)},t.render()):null}renderCustom(e,t){const{creator:i}=e,n=this._contentWidgets[t];return!n||n.destroyed?null:i?Object(h.i)("div",{key:this._buildKey("custom-element",t),class:pn},n.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(h.i)("div",{key:this._buildKey("fields-element",e),class:pn},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Object(h.i)("div",{key:this._buildKey("media-element",e),class:pn},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:n,user:o}=i,r="edit"===i.type?o?t.lastEditedByUser:t.lastEdited:o?t.lastCreatedByUser:t.lastCreated,a=Object(s.W)(r,{date:n,user:o});return Object(h.i)("div",{key:"edit-info-element",class:this.classes(mn,pn)},a)}renderText(e,t){const i=e.text,n=this._contentWidgets[t];return!n||n.destroyed?null:i?Object(h.i)("div",{key:this._buildKey("text-element",t),class:this.classes(pn,bn)},n.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const e=this.get("viewModel.content"),{contentViewModels:t}=this.viewModel;if(Array.isArray(e))e.forEach(((e,i)=>{"attachments"===e.type&&(this._contentWidgets[i]=new Jt({displayType:e.displayType,viewModel:t[i]})),"fields"===e.type&&(this._contentWidgets[i]=new bi({viewModel:t[i]})),"media"===e.type&&(this._contentWidgets[i]=new Ji({viewModel:t[i]})),"text"===e.type&&(this._contentWidgets[i]=new ni({viewModel:t[i]})),"custom"===e.type&&(this._contentWidgets[i]=new ni({viewModel:t[i]}))}),this);else{const e=t[0];e&&!e.destroyed&&(this._contentWidgets[0]=new ni({viewModel:e}))}this.scheduleRender()}};Object(s.e)([Object(u.l)("viewModel.graphic")],vn.prototype,"graphic",void 0),Object(s.e)([Object(u.l)("viewModel.defaultPopupTemplateEnabled")],vn.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.e)([Object(s.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],vn.prototype,"label",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Feature/t9n/Feature")],vn.prototype,"messages",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/support/t9n/uriUtils")],vn.prototype,"messagesURIUtils",void 0),Object(s.e)([Object(u.l)("viewModel.spatialReference")],vn.prototype,"spatialReference",void 0),Object(s.e)([Object(u.l)("viewModel.title")],vn.prototype,"title",void 0),Object(s.e)([Object(s.y)()],vn.prototype,"visibleElements",void 0),Object(s.e)([Object(s.v)("visibleElements")],vn.prototype,"castVisibleElements",null),Object(s.e)([Object(u.l)("viewModel.map")],vn.prototype,"map",void 0),Object(s.e)([Object(u.l)("viewModel.view")],vn.prototype,"view",void 0),Object(s.e)([Object(s.y)({type:rn})],vn.prototype,"viewModel",void 0),vn=Object(s.e)([Object(s.i)("esri.widgets.Feature")],vn);var _n=vn;let wn=class extends s.m.EventedAccessor{constructor(e){super(e),this._anchorHandles=new s.w,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([Object(l.h)(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),Object(l.h)(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i="3d"===t.type?"camera":"viewpoint",n=Object(l.c)(t,i,(()=>this._viewpointChange()));this._anchorHandles.add(n,e),this._viewpointHandle=n,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;e&&(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,n=this.get("view.ready"),o=i&&n&&Object(s.P)(e)?t.toScreen(e):null;this._set("screenLocation",o)}};Object(s.e)([Object(s.y)()],wn.prototype,"location",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],wn.prototype,"screenLocation",void 0),Object(s.e)([Object(s.y)()],wn.prototype,"screenLocationEnabled",void 0),Object(s.e)([Object(s.y)()],wn.prototype,"view",void 0),wn=Object(s.e)([Object(s.i)("esri.widgets.support.AnchorElementViewModel")],wn);var On=wn;let jn=class extends On{constructor(e){super(e),this.visible=!1}};Object(s.e)([Object(s.y)()],jn.prototype,"visible",void 0),jn=Object(s.e)([Object(s.i)("esri.widgets.CompassViewModel")],jn);var Mn=jn;const In="esri-spinner",Cn="esri-spinner--start",xn="esri-spinner--finish";let Pn=class extends h.a{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new Mn,this.visible=!1}initialize(){this.own([Object(l.h)(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,n={[Cn]:e&&i,[xn]:!e&&i},s=this._getPositionStyles();return Object(h.i)("div",{class:this.classes(In,n),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=Object(s.X)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||Object(s.J)(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};Object(s.e)([Object(u.l)("viewModel.location")],Pn.prototype,"location",void 0),Object(s.e)([Object(u.l)("viewModel.view")],Pn.prototype,"view",void 0),Object(s.e)([Object(s.y)({type:Mn})],Pn.prototype,"viewModel",void 0),Object(s.e)([Object(u.l)("viewModel.visible")],Pn.prototype,"visible",void 0),Pn=Object(s.e)([Object(s.i)("esri.widgets.Spinner")],Pn);var Tn=Pn;function kn(e){return e&&"opacity"in e?e.opacity*kn(e.parent):1}async function En(e,t){if(!e)return;const n=kn(e.layer||e.sourceLayer);if(Object(s.P)(e.symbol)&&(!Object(s.P)(t)||!0!==t.ignoreGraphicSymbol)){const i="web-style"===e.symbol.type?await e.symbol.fetchSymbol(Object(s.P)(t)?t.abortOptions:null):e.symbol.clone();return Object(j.c)(i,null,n),i}const o=Object(s.P)(t)&&t.renderer||e.get("layer.renderer")||e.get("sourceLayer.renderer");let r=await o.getSymbolAsync(e,t);if(!r)return;if(r="web-style"===r.type?await r.fetchSymbol(Object(s.P)(t)?t.abortOptions:null):r.clone(),!("visualVariables"in o)||"visualVariables"in o&&!o.visualVariables||"visualVariables"in o&&o.visualVariables&&!o.visualVariables.length)return r;if(o.arcadeRequiredForVisualVariables&&(Object(s.J)(t)||Object(s.J)(t.arcade))){const e={...Object(s.Y)(t)};e.arcade=await Object(y.k)(),t=e}const a=await Promise.resolve().then(i.bind(null,85)),l=[],c=[],h=[],d=[];for(const e of o.visualVariables)switch(e.type){case"color":l.push(e);break;case"opacity":c.push(e);break;case"rotation":d.push(e);break;case"size":e.target||h.push(e)}const u=!!l.length&&l[l.length-1],p=u?a.getColor(u,e,t):null,b=!!c.length&&c[c.length-1];let m=b?a.getOpacity(b,e,t):null;if(null!=n&&(m=null!=m?m*n:n),Object(j.c)(r,p,m),h.length){const i=a.getAllSizes(h,e,t);await Object(j.a)(r,i)}for(const i of d)Object(j.b)(r,a.getRotationAngle(i,e,t),i.axis);return r}const An=Object(o.a)("mac")?"Meta":"Ctrl",Fn={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)Fn[e]=String.fromCharCode(e);for(let e=1;e<25;e++)Fn[111+e]=`F${e}`;for(let e=65;e<91;e++)Fn[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function Sn(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class Vn{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const e of this.keyModifiers)if(!t.has(e))return!1;return!0}}const Dn=s.n.getLogger("esri.views.input.InputHandler");class Ln{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Dn.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;"function"==typeof t?(i=t,n=[]):n=t||[];const s="string"==typeof e?new Vn(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},r=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),o(),this._manager&&this._manager.updateDependencies()}},a=new Rn(s,i,{onPause:r,onRemove:r,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),o(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[s.eventType];return l||(l=[],this._incoming[s.eventType]=l),l.push(a),o(),this._manager&&this._manager.updateDependencies(),a}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new Nn(e,{onEmit:(e,t,i,n)=>{this._manager.emit(e.eventType,t,i,n)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Dn.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class Rn{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class Nn{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class zn extends Ln{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const Bn=s.n.getLogger("esri.views.input.InputManager");let Hn=class extends s.u{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=An,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,i=Gn.INTERNAL){if(this._nameToGroup[e])return void Bn.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void Bn.error("Can't register a group of zero handlers");const n={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=n;for(let e=n.handlers.length-1;e>=0;e--){const t=n.handlers[e];this._handlers.push(t),t.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(e,i,n,s,o)=>{this._emitInputEvent(t.priorityIndex+1,e,i,n,o,s)},setPointerCapture:(e,i)=>{this._setPointerCapture(n,t,e,i)},setEventCallback:e=>{t.eventCallback=e},setUninstallCallback:e=>{t.uninstallCallback=e},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Bn.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){const e=new Set,t=new Set;this._handlersPriority=[];for(let e=this._handlers.length-1;e>=0;e--){const t=this._handlers[e];t.priorityIndex=e,this._handlersPriority.push(t)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s)for(const t of n.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of n.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)Sn(e)||t.add(e)}n.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,n=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,n)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const n=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(n(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(n(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const o=t.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new zn((e=>this._setLatestPointerType(e))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Gn.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],Gn.INTERNAL)}_setPointerCapture(e,t,i,n){const s=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),1===o.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),0===o.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,n){this._emitInputEvent(0,e,t,i,n)}_emitInputEvent(e,t,i,n,s,o){const r=void 0!==n?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==s&&s,l={event:new Un(t,i,r,o||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new M.d,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),n=t.data&&t.data.eventId;if(null==n||!this._stoppedPropagationEventIds.has(n))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=n&&this._stoppedPropagationEventIds.add(n);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null}}_pausePropagation(e){const t=new M.d;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>-1!==e.keyModifiers.indexOf(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};Object(s.e)([Object(s.y)({readOnly:!0})],Hn.prototype,"hasPendingInputs",null),Object(s.e)([Object(s.y)()],Hn.prototype,"eventSource",void 0),Object(s.e)([Object(s.y)()],Hn.prototype,"recognizers",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Hn.prototype,"latestPointerType",void 0),Hn=Object(s.e)([Object(s.i)("esri.views.input.InputManager")],Hn);class Un{constructor(e,t,i,n,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(e){this._propagationState|=2;const t=(e,t)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const Gn={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},qn="esri-icon-zoom-in-magnifying-glass",$n="esri-icon-trash",Wn="esri-icon-table",Kn=new u.e({id:"zoom-to-feature",title:"{messages.zoom}",className:qn}),Zn=new u.e({id:"remove-selected-feature",title:"{messages.remove}",className:$n}),Jn=new u.e({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:qn}),Yn=new u.e({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Wn}),Xn=s.n.getLogger("esri.widgets.Popup.PopupViewModel"),Qn=function(e){const{event:t,view:i}=e,{action:n}=t,o=i&&i.popup;if(!n)return Promise.reject(new s.s("trigger-action:missing-arguments","Event has no action"));if(!o)return Promise.reject(new s.s("trigger-action:missing-arguments","view.popup is missing"));const{disabled:r,id:a}=n;if(!a)return Promise.reject(new s.s("trigger-action:invalid-action","action.id is missing"));if(r)return Promise.reject(new s.s("trigger-action:invalid-action","Action is disabled"));if(a===Kn.id)return async function(e){const{location:t,selectedFeature:i,view:n,zoomFactor:o}=e,r=es(e);if(!r){const e=new s.s("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:r,view:n});return Xn.error(e),Promise.reject(e)}const a=n.scale/o,l=e.get("selectedFeature.geometry")||t,c=l&&"point"===l.type&&function(e,t){if("3d"!==(null==t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new s.s("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});Xn.error(t)})),t}return!0}(i,n);Kn.active=!0,Kn.disabled=!0,await e.view.goTo({target:r,scale:c?a:void 0}),Kn.active=!1,Kn.disabled=!1,e.zoomToLocation=null,c&&(e.location=l)}(o.viewModel);if(a===Jn.id)return async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new s.s("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Xn.error(e),e}if(!t.isAggregate){const e=new s.s("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Xn.error(e),e}const n=t.sourceLayer,o=await i.whenLayerView(n),r=o.createQuery();r.aggregateIds=[t.getObjectId()],Jn.active=!0,Jn.disabled=!0;const{extent:a}=await o.queryExtent(r);await i.goTo({target:a}),Jn.active=!1,Jn.disabled=!1}(o.viewModel);if(o.viewModel.browseClusterEnabled=!1,a===Yn.id&&(o.featureMenuOpen=!0,o.viewModel.browseClusterEnabled=!0),a===Zn.id){o.close();const{selectedFeature:e}=o;if(!e)return Promise.reject(new s.s(`trigger-action:${Zn.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Promise.resolve()}return Promise.resolve()};function es(e){const{selectedFeature:t,location:i,view:n}=e;return n?"3d"===n.type?t||i:e.get("selectedFeature.geometry")||i:null}const ts=s.L.ofType({key:"type",defaultKeyValue:"button",base:u.f,typeMap:{button:u.e,toggle:u.g}}),is="esri.widgets.Popup.PopupViewModel",ns=s.n.getLogger(is);let ss=class extends(Object(p.b)(On)){constructor(e){super(e),this._handles=new s.w,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.featuresPerPage=20,this.actions=new ts,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new r.a({symbol:new w.B({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((e=>e.waitingForContent))}initialize(){this._handles.add([Object(l.g)(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),Object(l.h)(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),Object(l.h)(this,"view.animation.state",(e=>this._animationStateChange(e))),Object(l.h)(this,"location",(e=>this._locationChange(e))),Object(l.h)(this,"selectedFeature",(e=>this._selectedFeatureChange(e))),Object(l.h)(this,["selectedFeatureIndex","featureCount","featuresPerPage"],(()=>this._selectedFeatureIndexChange())),Object(l.h)(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],(()=>this._setGraphicOnFeatureViewModels())),Object(l.h)(this,"featureViewModels",(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>Qn({event:e,view:this.view}))),Object(l.e)(this,"waitingForResult",(()=>this._waitingForResultChange())),Object(l.h)(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs())),Object(l.h)(this,["view.scale"],this._viewScaleChange),Object(l.e)(this,"visible",(()=>this.browseClusterEnabled=!1)),Object(l.h)(this,"browseClusterEnabled",(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new ts;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:o}=this,r=s?i.concat(t):t,a=o&&("function"==typeof o.getEffectivePopupTemplate&&o.getEffectivePopupTemplate(n)||o.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(r):r;return c&&c.filter(Boolean).forEach((t=>e.add(t))),e}get defaultActions(){var e;const t=this._get("defaultActions")||new ts;return t.removeAll(),t.addMany(null!=(e=this.selectedFeature)&&e.isAggregate?[Jn.clone(),Yn.clone()]:[Kn.clone()]),t}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&t.length;o&&i&&-1===s?this.selectedFeatureIndex=0:o&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Object(s.Z)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e);e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=es(this);if(!t){const i=new s.s("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return ns.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new s.s("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return ns.error(t),Promise.reject(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function(e){e.features=e.features.filter((e=>e.isAggregate))})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new s.s("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:i});throw Xn.error(e),e}if(!t.isAggregate){const e=new s.s("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Xn.error(e),e}const n=t.sourceLayer,o=await i.whenLayerView(n),r=o.createQuery();r.aggregateIds=[t.getObjectId()];const{extent:a}=await o.queryExtent(r);e.selectedClusterBoundaryFeature.geometry=a,i.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new s.s("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:i});throw Xn.error(e),e}if(!t.isAggregate){const e=new s.s("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Xn.error(e),e}const n=t.sourceLayer,o=await i.whenLayerView(n),r=o.createQuery();r.aggregateIds=[t.getObjectId()],Yn.active=!0,Yn.disabled=!0;const{features:a}=await o.queryFeatures(r);Yn.active=!1,Yn.disabled=!1,e.features=[t].concat(a)}(this)}_animationStateChange(e){this.zoomToLocation||(Kn.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){var e;const t=null==(e=this.view)?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var e;(null!=(e=this.selectedFeature)&&e.isAggregate||this.browseClusterEnabled)&&(this.browseClusterEnabled=!1,this.visible=!1)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:n,featureViewModels:s}=this;if(null===i)return;const o=((i-1)*n+t)%t,r=o+n;s.slice(o,r).forEach(((t,i)=>{t&&!t.graphic&&(t.graphic=e[o+i])}))}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:n}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),e.isAggregate)return;return e.symbol=await En(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature)}!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=n.center.clone()})):this.location=Object(s.Y)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,n=Promise.resolve(t),s=i.map((e=>e.promise));this.promises=[n,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(null!=e&&e.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const n=i.slice(0),s=[];t.forEach(((t,i)=>{if(!t)return;let o=null;if(n.some(((e,i)=>(e&&e.graphic===t&&(o=e,n.splice(i,1)),!!o))),o)s[i]=o;else{var r,a;const n=new rn({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(r=this.view)?void 0:r.spatialReference,graphic:t===e?t:null,map:null==(a=this.view)?void 0:a.map,view:this.view});s[i]=n}})),n.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),Gn.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=Object(s.V)(),{signal:n}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const o=this.fetchFeatures(e,{signal:n,event:t});return o.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),o}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:n}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:o}=e,r=[Promise.resolve(t),...s.map((e=>e.promise))];return n.popup.open({location:o||i,promises:r}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return Object(s.J)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:n,visible:s}=this;if(!(t&&n&&i&&s))return;let{layer:o,sourceLayer:r}=t;if(!(o&&o instanceof O.a))return;"map-notes"===(null==r?void 0:r.type)&&(o=r);const a=this._getLayerView(n,o);this._highlightPromise=a;const l=await a;if(!(l&&Object(p.a)(l)&&this._highlightPromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c="objectIdField"in o&&o.objectIdField,h=t.attributes,d=h&&c&&h[c],u=l.highlight(d||t);this._handles.add(u,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>-1===t.indexOf(e)));this.features=t.concat(i)}};Object(s.e)([Object(s.y)()],ss.prototype,"featurePage",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"featuresPerPage",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"isLoadingFeature",null),Object(s.e)([Object(s.y)({type:ts})],ss.prototype,"actions",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"active",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"allActions",null),Object(s.e)([Object(s.y)({type:Boolean})],ss.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"autoCloseEnabled",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"autoOpenEnabled",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"browseClusterEnabled",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"content",void 0),Object(s.e)([Object(s.y)({type:ts,readOnly:!0})],ss.prototype,"defaultActions",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"featureCount",null),Object(s.e)([Object(s.y)()],ss.prototype,"features",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"featureViewModels",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"highlightEnabled",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"includeDefaultActions",void 0),Object(s.e)([Object(s.y)({type:s._})],ss.prototype,"location",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"pendingPromisesCount",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"selectedClusterBoundaryFeature",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"waitingForResult",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"promiseCount",null),Object(s.e)([Object(s.y)()],ss.prototype,"promises",null),Object(s.e)([Object(s.y)({value:null,readOnly:!0})],ss.prototype,"selectedFeature",null),Object(s.e)([Object(s.y)({value:-1})],ss.prototype,"selectedFeatureIndex",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"selectedFeatureViewModel",null),Object(s.e)([Object(s.y)({readOnly:!0})],ss.prototype,"state",null),Object(s.e)([Object(s.y)()],ss.prototype,"title",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"updateLocationEnabled",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"view",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"visible",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"zoomFactor",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"zoomToLocation",void 0),Object(s.e)([Object(s.y)()],ss.prototype,"centerAtLocation",null),ss=Object(s.e)([Object(s.i)(is)],ss);var os=ss;const rs="selected-index",as="popup-spinner",ls="esri-icon-left-triangle-arrow",cs="esri-icon-right-triangle-arrow",hs="esri-icon-maximize",ds="esri-icon-dock-bottom",us="esri-icon-dock-left",ps="esri-icon-dock-right",bs="esri-icon-close",ms="esri-icon-minimize",gs="esri-icon-check-mark",fs="esri-icon-loading-indicator",ys="esri-icon-default-action",vs="esri-icon-handle-horizontal",_s="esri-rotating",ws="esri-popup",Os="esri-widget",js="esri-popup__main-container",Ms="esri-popup__loading-container",Is="esri-popup--is-collapsible",Cs="esri-popup--is-collapsed",xs="esri-popup--shadow",Ps="esri-popup--is-docked",Ts="esri-popup--is-docked-top-left",ks="esri-popup--is-docked-top-center",Es="esri-popup--is-docked-top-right",As="esri-popup--is-docked-bottom-left",Fs="esri-popup--is-docked-bottom-center",Ss="esri-popup--is-docked-bottom-right",Vs="esri-popup--aligned-top-center",Ds="esri-popup--aligned-bottom-center",Ls="esri-popup--aligned-top-left",Rs="esri-popup--aligned-bottom-left",Ns="esri-popup--aligned-top-right",zs="esri-popup--aligned-bottom-right",Bs="esri-popup--feature-menu-open",Hs="esri-popup--actions-menu-open",Us="esri-popup--feature-updated",Gs="esri-popup__header",qs="esri-popup__header-buttons",$s="esri-popup__header-container",Ws="esri-popup__header-container--button",Ks="esri-popup__header-title",Zs="esri-popup__content",Js="esri-popup__footer",Ys="esri-popup__footer--has-pagination",Xs="esri-popup__footer--has-actions",Qs="esri-popup__footer--has-actions-menu",eo="esri-popup__button",to="esri-popup__button--disabled",io="esri-popup__button--dock",no="esri-popup__icon",so="esri-popup__icon--dock-icon",oo="esri-popup__inline-actions-container",ro="esri-popup__actions-menu-button",ao="esri-popup__actions",lo="esri-popup__action",co="esri-popup__action-image",ho="esri-popup__action-text",uo="esri-popup__action-toggle",po="esri-popup__action-toggle--on",bo="esri-popup__pointer",mo="esri-popup__pointer-direction",go="esri-popup__navigation",fo="esri-popup__pagination-previous",yo="esri-popup__pagination-next",vo="esri-popup__pagination-previous-icon",_o="esri-popup__pagination-previous-icon--rtl",wo="esri-popup__pagination-next-icon",Oo="esri-popup__pagination-next-icon--rtl",jo="esri-popup__feature-menu",Mo="esri-popup__feature-menu-list",Io="esri-popup__feature-menu-item",Co="esri-popup__feature-menu-viewport",xo="esri-popup__feature-menu-header",Po="esri-popup__feature-menu-item--selected",To="esri-popup__feature-menu-button",ko="esri-popup__feature-menu-title",Eo="esri-popup__feature-menu-observer",Ao="esri-popup__feature-menu-loader",Fo={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},So="esri-popup";function Vo(e,t){return void 0===t?`${So}__${e}`:`${So}__${e}-${t}`}const Do="esri.widgets.Popup",Lo=s.n.getLogger(Do),Ro={closeButton:!0,featureNavigation:!0};let No=class extends(ae(h.a)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new s.w,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([e])=>{null!=e&&e.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback),this._displaySpinnerThrottled=re((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new os,this.visible=null,this.visibleElements={...Ro},this._addSelectedFeatureIndexHandle(),this.own([Object(l.h)(this,"viewModel.screenLocation",(()=>this._positionContainer())),Object(l.h)(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),Object(l.h)(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),Object(l.h)(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),Object(l.h)(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),Object(l.h)(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),Object(l.h)(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),Object(l.h)(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),Object(l.h)(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),Object(l.h)(this,"selectedFeatureWidget.viewModel.title",(e=>this._setTitleFromFeatureWidget(e))),Object(l.h)(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(()=>this._setContentFromFeatureWidget())),Object(l.e)(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),Object(l.d)(this,"viewModel.allActions","change",(()=>this._watchActions())),Object(l.g)(this,"viewModel.allActions",(()=>this._watchActions())),Object(l.h)(this,"viewModel.featureViewModels",(()=>this._featureMenuViewportScrollTop()))])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(e=this._handles)||e.destroy(),this._unobserveFeatureMenuObserver(),null==(t=this._featureMenuIntersectionObserver)||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,n,s;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(i=this.selectedFeatureWidget)||null==(n=i.viewModel)?void 0:n.content):null==(s=this.viewModel)?void 0:s.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Fo}set dockOptions(e){const t={...Fo},i=this.get("viewModel.view.breakpoints"),n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...t,...e},o={...t.breakpoint,...n},{breakpoint:r}=s;!0===r?s.breakpoint=o:"object"==typeof r&&(s.breakpoint={...o,...r}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}set featureNavigationEnabled(e){Object(s.$)(Lo,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements={...this.visibleElements,featureNavigation:e}}get selectedFeatureWidget(){const{_feature:e,visibleElements:t}=this,{selectedFeatureViewModel:i}=this.viewModel,n={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=n):this._feature=new _n({viewModel:i,visibleElements:n}),this._feature):null}castVisibleElements(e){return{...Ro,...e}}blur(){const{active:e}=this.viewModel;e||Lo.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Lo.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove(rs);const n=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,o={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:n};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(o.collapsed=!0),this.set(o),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,n;const{actionsMenuOpen:s,dockEnabled:o,featureMenuVisible:r,dividedActions:a,currentAlignment:l,currentDockPosition:c}=this,{active:d}=this.viewModel,{menuActions:u}=a,p=d&&u.length>1&&s,b=d&&o,m=d&&!o,g=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,f=null==(i=this.selectedFeature)||null==(n=i.layer)?void 0:n.id,y={[Vs]:"top-center"===l,[Ds]:"bottom-center"===l,[Ls]:"top-left"===l,[Rs]:"bottom-left"===l,[Ns]:"top-right"===l,[zs]:"bottom-right"===l,[Ps]:b,[xs]:m,[Ts]:"top-left"===c,[ks]:"top-center"===c,[Es]:"top-right"===c,[As]:"bottom-left"===c,[Fs]:"bottom-center"===c,[Ss]:"bottom-right"===c,[Bs]:r,[Hs]:p};return Object(h.i)("div",{class:this.classes(ws,y),role:"presentation","data-layer-title":g,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},d?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Object(h.i)("span",{"aria-hidden":"true",class:this.classes(no,fs,_s)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Object(h.i)("div",{key:Vo("loading-container"),role:"presentation",class:Ms,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Object(h.e)(),t={[cs]:e,[_o]:e,[ls]:!e,[vo]:!e};return Object(h.i)("span",{"aria-hidden":"true",class:this.classes(no,t)})}renderPreviousButton(){const{messages:e}=this;return Object(h.i)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(eo,fo),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Object(h.e)(),t={[ls]:e,[Oo]:e,[cs]:!e,[wo]:!e};return Object(h.i)("span",{"aria-hidden":"true",class:this.classes(no,t)})}renderNextButton(){const{messages:e}=this;return Object(h.i)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(eo,yo),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return Object(h.i)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(eo,To),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[ms]:e,[so]:!e,[ps]:!e&&("top-right"===t||"bottom-right"===t),[us]:!e&&("top-left"===t||"bottom-left"===t),[hs]:!e&&"top-center"===t,[ds]:!e&&"bottom-center"===t};return Object(h.i)("span",{"aria-hidden":"true",class:this.classes(i,no)})}renderDockButton(){var e,t,i;const{dockEnabled:n,messages:s}=this,o=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,r=n?s.undock:s.dock;return"xsmall"!==o&&null!=(i=this.dockOptions)&&i.buttonEnabled?Object(h.i)("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(eo,io)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,o={[Ws]:i},r=Object(h.i)("h2",{class:Ks,innerHTML:e}),a=i?Object(h.i)("button",{key:`${e}--collapsible`,id:t,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes($s,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed},r):Object(h.i)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes($s,o)},r);return e?a:null}renderCloseIcon(){return Object(h.i)("span",{"aria-hidden":"true",class:this.classes(no,bs)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?Object(h.i)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:eo,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return Object(h.i)("header",{class:Gs},this.renderTitle(),Object(h.i)("div",{class:qs},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:n}=this.viewModel;return t&&!i?Object(h.i)("article",{key:n,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Zs},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,o=i?s.close:s.open,{menuActions:r}=n;return r.length?Object(h.i)("div",{key:Vo("actions-menu-button"),class:this.classes(eo,ro),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},Object(h.i)("span",{"aria-hidden":"true",class:vs})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s,inlineActions:o}=n;return s.length&&i?Object(h.i)("ul",{id:e,role:"menu","aria-labelledby":t,key:Vo("actions"),class:ao,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(((e,t)=>this.renderAction({action:e,index:t+o.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(((e,t)=>this.renderAction({action:e,index:t,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,n=!!t.length;return i||n?Object(h.i)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:oo},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Object(h.i)("section",{key:Vo("navigation"),class:this.classes(go)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:n}=t,s=!!i.length,o=!!n.length,r={[Ys]:e,[Xs]:s,[Qs]:o};return e||s?Object(h.i)("div",{key:Vo("feature-buttons"),class:this.classes(Js,r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,n=Object(s.W)(e.selectedFeatures,{total:t.length});return Object(h.i)("section",{key:Vo("menu"),class:jo},Object(h.i)("h2",{class:xo},n),Object(h.i)("nav",{bind:this,class:Co,"data-node-ref":"_featureMenuViewportNode",afterCreate:h.j},this.renderFeatureMenu(),Object(h.i)("div",{class:Eo,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?Object(h.i)("div",{class:Ao},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:Object(h.i)("div",{key:Vo("pointer"),class:bo,role:"presentation"},Object(h.i)("div",{class:this.classes(mo,xs)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:n,contentId:s,collapsible:o,hasContent:r,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,d="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,u="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,p={[xs]:e,[Is]:o,[Cs]:a};return Object(h.i)("div",{class:this.classes(js,Os,p),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?n:"","aria-describedby":r&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?Object(h.i)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return Object(h.i)("span",{key:"text",class:ho},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),n={[fs]:e.active,[_s]:e.active,[no]:!!t,[co]:!e.active&&!!i};return t&&(n[t]=!e.active),Object(h.i)("span",{key:"icon","aria-hidden":"true",class:this.classes(no,n),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,index:i,type:n}=e,s=this._getActionTitle(t),o={[lo]:"toggle"!==t.type,[uo]:"toggle"===t.type,[po]:"toggle"===t.type&&t.value,[to]:t.disabled},r=[this.renderActionIcon(t),this.renderActionText(s)],a="menu-item"===n?Object(h.i)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(eo,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},r):Object(h.i)("div",{key:t.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(eo,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},r);return t.visible?a:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,r=e===o,a={[Po]:r},l=r?Object(h.i)("span",{key:Vo(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:gs}):null,c=Object(h.i)("span",{innerHTML:e.title||n.untitled});return Object(h.i)("li",{role:"menuitem",tabIndex:-1,key:Vo(`feature-menu-feature-${s}`),class:this.classes(a,Io),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},Object(h.i)("span",{class:ko},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?Object(h.i)("ol",{class:Mo,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:n}=this,{id:o}=e,r=null==i?void 0:i.attributes,a="zoom-to-feature"===o?Object(s.W)(e.title,{messages:t}):"remove-selected-feature"===o?Object(s.W)(e.title,{messages:n}):"zoom-to-clustered-features"===o||"browse-clustered-features"===o?Object(s.W)(e.title,{messages:t}):e.title;return a&&r?Object(s.W)(a,r):a}_getActionClass(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{className:n,image:o}=e,r=o||n?n:ys;return r&&i?Object(s.W)(r,i):r}_getActionImage(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{image:n}=e;return n&&i?Object(s.W)(n,i):n}_createFeatureUpdatedAnimation(){return Object(h.g)("enter",Us)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add(Object(l.h)(e,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),i=null===t,n=0===t;return{inlineActions:i?e.slice(0):n?new s.L:e.slice(0,t),menuActions:i?new s.L:n?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===Object(s.T)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===Object(s.T)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=Object(s.T)(e),{_featureMenuNode:i}=this,n=e.currentTarget["data-feature-index"];if(!i)return;const o=i.querySelectorAll("li"),r=o.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+r)%r].focus()):(e.stopPropagation(),o[(n-1+r)%r].focus())}_handleActionMenuItemKeyup(e){const t=Object(s.T)(e),{_actionsMenuNode:i}=this,n=e.currentTarget["data-action-index"];if(!i)return;const o=i.querySelectorAll("li"),r=o.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+r)%r].focus()):(e.stopPropagation(),o[(n-1+r)%r].focus())}_handleMainKeyup(e){const t=Object(s.T)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=Object(l.h)(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,rs)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:n,side:s,view:o}=e;if(isNaN(i)||isNaN(t)||!o||!n)return!1;const r=o.padding;return"right"===s&&n.x+i/2>o.width-r.right||"left"===s&&n.x-i/2<r.left||"top"===s&&n.y-t<r.top||"bottom"===s&&n.y+t>o.height-r.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:n,viewModel:o}=this,{screenLocation:r,view:a}=o;if(Object(s.J)(r)||!a||!i)return"top-center";if(!this._isScreenLocationWithinView(r,a))return this._get("currentAlignment")||"top-center";function l(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const c=n?window.getComputedStyle(n,null):null,h=c?l(c.getPropertyValue("max-height")):0,d=c?l(c.getPropertyValue("height")):0,{height:u,width:p}=i.getBoundingClientRect(),b=p+t,m=Math.max(u,h,d)+t,g=this._isOutsideView({popupHeight:m,popupWidth:b,screenLocation:r,side:"right",view:a}),f=this._isOutsideView({popupHeight:m,popupWidth:b,screenLocation:r,side:"left",view:a}),y=this._isOutsideView({popupHeight:m,popupWidth:b,screenLocation:r,side:"top",view:a}),v=this._isOutsideView({popupHeight:m,popupWidth:b,screenLocation:r,side:"bottom",view:a});return f?y?"bottom-right":"top-right":g?y?"bottom-left":"top-left":y?v?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Object(h.e)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,n=Object(h.e)()?"top-left":"top-right";if(!i)return n;const s=i.padding||{left:0,right:0,top:0,bottom:0},o=i.width-s.left-s.right,{breakpoints:r}=i;return r&&o<=r.xsmall?"bottom-center":n}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),n=this._calculatePositionStyle(t,i);n&&(e.style.top=n.top,e.style.left=n.left,e.style.bottom=n.bottom,e.style.right=n.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this,r=n/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return"bottom-center"===s?{top:t+o-c.top,left:e-r-c.left}:"top-left"===s?{bottom:a+o-c.bottom,right:l+o-c.right}:"bottom-left"===s?{top:t+o-c.top,right:l+o-c.right}:"top-right"===s?{bottom:a+o-c.bottom,left:e+o-c.left}:"bottom-right"===s?{top:t+o-c.top,left:e+o-c.left}:"top-center"===s?{bottom:a+o-c.bottom,left:e-r-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if(Object(s.J)(e)||!t)return;const o=this._calculateFullWidth(t),r=this._calculateAlignmentPosition(e.x,e.y,n,o);return r?{top:void 0!==r.top?`${r.top}px`:"auto",left:void 0!==r.left?`${r.left}px`:"auto",bottom:void 0!==r.bottom?`${r.bottom}px`:"auto",right:void 0!==r.right?`${r.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[n,s]=e,[o,r]=t,{width:a,height:l}=i;return n<=a&&o>a||n>a&&o<=a||s<=l&&r>l||s>l&&r<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],r=[];o[0]=e[0]-n,o[1]=e[1]-s,r[0]=t[0]-n,r[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(o,r,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const n=e.breakpoint,s=null==(t=this.viewModel)||null==(i=t.view)?void 0:i.ui;if(!s)return!1;const{width:o,height:r}=s;if(isNaN(o)||isNaN(r))return!1;const a=n.hasOwnProperty("width")&&o<=n.width,l=n.hasOwnProperty("height")&&r<=n.height;return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Object(s.W)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,as),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Tn({view:e}),e.ui.add(this._spinner,{key:as,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(t);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"actionsMenuId",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"actionsMenuButtonId",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"featureMenuId",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"titleId",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"contentId",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"hasContent",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"featureNavigationVisible",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"collapsible",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"featureMenuVisible",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"contentCollapsed",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"dividedActions",null),Object(s.e)([Object(u.l)("viewModel.actions")],No.prototype,"actions",void 0),Object(s.e)([Object(s.y)()],No.prototype,"actionsMenuOpen",null),Object(s.e)([Object(s.y)()],No.prototype,"alignment",void 0),Object(s.e)([Object(u.l)("viewModel.autoCloseEnabled")],No.prototype,"autoCloseEnabled",void 0),Object(s.e)([Object(u.l)("viewModel.autoOpenEnabled")],No.prototype,"autoOpenEnabled",void 0),Object(s.e)([Object(u.l)("viewModel.defaultPopupTemplateEnabled")],No.prototype,"defaultPopupTemplateEnabled",void 0),Object(s.e)([Object(u.l)("viewModel.content")],No.prototype,"content",void 0),Object(s.e)([Object(s.y)()],No.prototype,"collapsed",void 0),Object(s.e)([Object(s.y)()],No.prototype,"collapseEnabled",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"currentAlignment",null),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"currentDockPosition",null),Object(s.e)([Object(s.y)()],No.prototype,"dockOptions",null),Object(s.e)([Object(s.y)()],No.prototype,"dockEnabled",void 0),Object(s.e)([Object(u.l)("viewModel.featureCount")],No.prototype,"featureCount",void 0),Object(s.e)([Object(s.y)()],No.prototype,"featureMenuOpen",void 0),Object(s.e)([Object(u.l)("viewModel.features")],No.prototype,"features",void 0),Object(s.e)([Object(s.y)()],No.prototype,"featureNavigationEnabled",null),Object(s.e)([Object(u.l)("viewModel.goToOverride")],No.prototype,"goToOverride",void 0),Object(s.e)([Object(u.l)("viewModel.highlightEnabled")],No.prototype,"highlightEnabled",void 0),Object(s.e)([Object(u.l)("viewModel.location")],No.prototype,"location",void 0),Object(s.e)([Object(s.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],No.prototype,"label",void 0),Object(s.e)([Object(s.y)()],No.prototype,"maxInlineActions",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Popup/t9n/Popup")],No.prototype,"messages",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/t9n/common")],No.prototype,"messagesCommon",void 0),Object(s.e)([Object(u.l)("viewModel.promises")],No.prototype,"promises",void 0),Object(s.e)([Object(u.l)("viewModel.selectedFeature")],No.prototype,"selectedFeature",void 0),Object(s.e)([Object(u.l)("viewModel.selectedFeatureIndex")],No.prototype,"selectedFeatureIndex",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],No.prototype,"selectedFeatureWidget",null),Object(s.e)([Object(s.y)()],No.prototype,"spinnerEnabled",void 0),Object(s.e)([Object(u.l)("viewModel.title")],No.prototype,"title",void 0),Object(s.e)([Object(u.l)("viewModel.updateLocationEnabled")],No.prototype,"updateLocationEnabled",void 0),Object(s.e)([Object(u.l)("viewModel.view")],No.prototype,"view",void 0),Object(s.e)([Object(s.y)({type:os}),Object(p.d)(["triggerAction","trigger-action"])],No.prototype,"viewModel",void 0),Object(s.e)([Object(u.l)("viewModel.visible")],No.prototype,"visible",void 0),Object(s.e)([Object(s.y)()],No.prototype,"visibleElements",void 0),Object(s.e)([Object(s.v)("visibleElements")],No.prototype,"castVisibleElements",null),Object(s.e)([Object(p.c)()],No.prototype,"_close",null),Object(s.e)([Object(p.c)()],No.prototype,"_toggleDockEnabled",null),Object(s.e)([Object(p.c)()],No.prototype,"_toggleFeatureMenu",null),Object(s.e)([Object(p.c)()],No.prototype,"_toggleActionsMenu",null),Object(s.e)([Object(p.c)()],No.prototype,"_triggerAction",null),Object(s.e)([Object(p.c)()],No.prototype,"_selectFeature",null),Object(s.e)([Object(p.c)()],No.prototype,"_next",null),Object(s.e)([Object(p.c)()],No.prototype,"_previous",null),No=Object(s.e)([Object(s.i)(Do)],No);var zo=No;const Bo=[0,0];function Ho(e){e&&(Object(h.l)(e),e.parentNode&&e.parentNode.removeChild(e))}const Uo=750,Go=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:16,time:Uo},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(e=>{const t=this.surface;t&&t.setAttribute("data-cursor",e)})),this.watch("interacting",(e=>{const t=this.surface;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add(this.watch("ui",((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Ho(this.root),this._set("root",null),Object(h.k)(this.userContent,t),Ho(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",Object(h.k)(e,t),e.appendChild(t),this._set("userContent",t);const n=document.createElement("div");n.className="esri-view-root",e.insertBefore(n,e.firstChild),this._set("root",n);const o=document.createElement("div");o.className="esri-view-surface",o.setAttribute("role","application"),o.tabIndex=0,n.appendChild(o),this._set("surface",o);const r=new oe;n.appendChild(r.surface),this._set("overlay",r),r.watch("needsRender",(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Object(s.a0)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add(Object(l.g)(this,"size",(e=>{const[t,i]=e,n="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?o.classList.add(n):o.classList.remove(n)})),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new zo({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,i){const n=this.position;return e-=n[0],t-=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const n=this.position;return e+=n[0],t+=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([Object(l.g)(this,"root",(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null})),Object(l.g)(this,"popup",((t,i)=>{const n="popup";i&&e.remove(i,n),t&&(t.view=e.view,e.add(t,{key:n,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=Uo,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=Uo};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),Object(s.a0)({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const n=this._position();i.freq=n||t?16:Math.min(Uo,2*i.freq),!t&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const n=this.width,s=this.height;return t===n&&i===s?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:s,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=function(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return Bo[0]=i.left+t.pageXOffset,Bo[1]=i.top+t.pageYOffset,Bo}(e);return!(t&&i[0]===t[0]&&i[1]===t[1]||(this._set("position",[i[0],i[1]]),0))}forceDOMReadyCycle(){}};return Object(s.e)([Object(s.y)({value:null,cast:e=>Object(h.b)(e)})],t.prototype,"container",null),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"focused",null),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"height",void 0),Object(s.e)([Object(s.y)({type:zo})],t.prototype,"popup",null),Object(s.e)([Object(s.y)({type:oe})],t.prototype,"overlay",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"position",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"resizing",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"root",void 0),Object(s.e)([Object(s.y)({value:null,readOnly:!0})],t.prototype,"size",null),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"surface",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"suspended",void 0),Object(s.e)([Object(s.y)()],t.prototype,"ui",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"userContent",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"width",void 0),Object(s.e)([Object(s.y)()],t.prototype,"widthBreakpoint",void 0),t=Object(s.e)([Object(s.i)("esri.views.DOMContainer")],t),t};function qo(e){return Object(w.j)(e.x,e.y)}function $o(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return Object(w.j)(t.clientX-i.left,t.clientY-i.top)}function Wo(e,t){return t instanceof Event?$o(e,t):qo(t)}function Ko(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;case"key-down":case"key-up":case"gamepad":case"focus":case"blur":default:return!1}return!1}var Zo;let Jo=Zo=class extends s.a{constructor(...e){super(...e),this.position=new s._([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,n){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const s={position:e};return null!=t&&(s.heading=t),null!=i&&(s.tilt=i),null!=n&&(s.fov=n),s}return e}writePosition(e,t,i,n){const o=e.clone();o.x=Object(s.a2)(e.x||0),o.y=Object(s.a2)(e.y||0),o.z=e.hasZ?Object(s.a2)(e.z||0):e.z,t[i]=o.write(null,n)}readPosition(e,t){const i=new s._;return i.read(e,t),i.x=Object(s.a2)(i.x||0),i.y=Object(s.a2)(i.y||0),i.z=i.hasZ?Object(s.a2)(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}clone(){return new Zo({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})}};Object(s.e)([Object(s.y)({type:s._,json:{write:{isRequired:!0}}})],Jo.prototype,"position",void 0),Object(s.e)([Object(s.o)("position")],Jo.prototype,"writePosition",null),Object(s.e)([Object(s.a1)("position")],Jo.prototype,"readPosition",null),Object(s.e)([Object(s.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Object(s.v)((e=>C.a.normalize(Object(s.a2)(e))))],Jo.prototype,"heading",void 0),Object(s.e)([Object(s.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Object(s.v)((e=>Object(s.D)(Object(s.a2)(e),-180,180)))],Jo.prototype,"tilt",void 0),Object(s.e)([Object(s.y)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Jo.prototype,"fov",void 0),Jo=Zo=Object(s.e)([Object(s.i)("esri.Camera")],Jo);var Yo,Xo=Jo;let Qo=Yo=class extends s.a{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new Yo({rotation:this.rotation,scale:this.scale,targetGeometry:Object(s.P)(this.targetGeometry)?this.targetGeometry.clone():null,camera:Object(s.P)(this.camera)?this.camera.clone():null})}};function er(){return{enabled:!this.camera}}Object(s.e)([Object(s.y)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:er}}}}})],Qo.prototype,"rotation",void 0),Object(s.e)([Object(s.v)("rotation")],Qo.prototype,"castRotation",null),Object(s.e)([Object(s.y)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:er}}}}})],Qo.prototype,"scale",void 0),Object(s.e)([Object(s.y)({types:s.a3,json:{read:I.e,write:!0,origins:{"web-scene":{read:I.e,write:{overridePolicy:er}}}}})],Qo.prototype,"targetGeometry",void 0),Object(s.e)([Object(s.y)({type:Xo,json:{write:!0}})],Qo.prototype,"camera",void 0),Qo=Yo=Object(s.e)([Object(s.i)("esri.Viewpoint")],Qo);var tr=Qo;const ir=e=>{let t=class extends e{async fetchPopupFeatures(e,t){await this.when();const{location:i,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:r}=await this._prepareFetchPopupFeatures(e,t),a=Promise.resolve(r),l=this._queryLayerPopupFeatures({queryArea:n,layerViewsAndGraphics:o,options:t}),c=l.map((e=>e.promise));return{location:i,clientOnlyGraphics:r,allGraphicsPromise:Object(s.a4)([a,...c]).then(s.a5),promisesPerLayerView:l}}_queryLayerPopupFeatures({queryArea:e,layerViewsAndGraphics:t,options:i}){return t.map((({layerView:t,graphics:n})=>{const o={clientGraphics:n,event:Object(s.P)(i)?i.event:null,signal:Object(s.P)(i)?i.signal:null,defaultPopupTemplateEnabled:!!Object(s.P)(i)&&!!i.defaultPopupTemplateEnabled},r=t.fetchPopupFeatures(e,o);return{layerView:t,promise:r}}))}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate(Object(s.P)(t)&&t.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(e,t){const{clientGraphics:i,queryArea:n,location:s}=await this._popupHitTestGraphics(e,t),o=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:r,clientOnlyGraphics:a}=this._graphicsPerFetchPopupLayerView(i,o);return{clientOnlyGraphics:a,layerViewsAndGraphics:r,queryArea:n,location:s}}async _popupHitTestGraphics(e,t){const{results:i,mapPoint:n}=await this.popupHitTest(e),s=i.filter((e=>this._isValidPopupGraphic(e.graphic,t))),o=s.length?s[0].mapPoint:null;return{clientGraphics:s.map((e=>e.graphic)),queryArea:n,location:n||o}}_getFetchPopupLayerViews(){const e=[];return this.allLayerViews.forEach((t=>{this._isValidPopupLayerView(t)&&e.push(t)})),Object(s.P)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&e.push(this.graphicsView),e.reverse()}_isValidPopupLayerView(e){return Object(s.P)(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}_graphicsPerFetchPopupLayerView(e,t){const i=[],n=new Map,s=t.map((e=>{const t=[];return"layer"in e?n.set(e.layer,t):n.set(e.graphics,t),{layerView:e,graphics:t}}));for(const t of e){const e=n.get(t.layer)||null;e?e.push(t):i.push(t)}return{layerViewsAndGraphics:s,clientOnlyGraphics:i}}};return t=Object(s.e)([Object(s.i)("esri.views.PopupView")],t),t};let nr=class extends s.u{constructor(e){super(e),this.view=null,this.baseLayerViews=new s.L,this.referenceLayerViews=new s.L,this._loadingHandle=Object(l.g)(this,"view.map.basemap",(e=>{e&&e.load().catch((()=>{}))}))}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};function sr(e,t){for(const[i,n]of e)if(t(n,i))return!0;return!1}Object(s.e)([Object(s.y)({constructOnly:!0})],nr.prototype,"view",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],nr.prototype,"baseLayerViews",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],nr.prototype,"referenceLayerViews",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],nr.prototype,"suspended",null),Object(s.e)([Object(s.y)({type:Boolean,readOnly:!0})],nr.prototype,"updating",null),nr=Object(s.e)([Object(s.i)("esri.views.BasemapView")],nr);const or=s.n.getLogger("esri.views.LayerViewManager");class rr{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=Object(s.V)(),this._deferred=Object(s.a6)(),this._started=!1,this.done=!1,Object(s.a8)(this._controller.signal,(()=>{const t=new s.s("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{var n,o;let r,a;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)r=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new s.s("layer:view-not-supported","No layerview implementation was found");const n=await this.layerViewImporter.importLayerView(t);Object(s.h)(e),r="default"in n?new n.default({layer:t,view:i}):new n({layer:t,view:i})}const l=()=>{a=Object(s.a9)(a),r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};a=Object(s.a8)(e,l),Object(s.h)(e);try{await r.when()}catch(e){throw l(),e}if(!(null==(n=this._map)||null==(o=n.allLayers)?void 0:o.includes(t)))return l(),void this._deferred.reject(new s.s("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=r,t.emit("layerview-create",{view:i,layerView:r}),i.emit("layerview-create",{layer:t,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new s.s("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let ar=class extends d.b{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new d.c,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var e;const t=null==(e=this.view.map)?void 0:e.allLayers;if(t)for(const e of t)this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e)},this._reschedule=()=>(Object(s.J)(this._workPromise)&&(this._workPromise=Object(s.a6)()),this.handles.remove("reschedule"),this.handles.add(Object(s.a7)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var e,t,i;const n=this.view.map;if(this._map!==n&&(this.clear(),this._map=n),Object(s.J)(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const o=new a.a({root:this,rootCollectionNames:this._rootCollectionNames,getChildrenFunction:e=>e.layers});if(!o)return this._workPromise.resolve(),void(this._workPromise=null);for(const e of o)this._createLayerView(e);this._refreshCollections();for(const[e,t]of this._layerLayerViewInfoMap)o.includes(e)||(this._layerLayerViewInfoMap.delete(t.layer),t.destroy());const r=o.filter((e=>"group"===e.type)).map((e=>e.layers)),l=[null==n||null==(e=n.ground)?void 0:e.layers,null==n||null==(t=n.basemap)?void 0:t.baseLayers,null==n||null==(i=n.basemap)?void 0:i.referenceLayers,null==n?void 0:n.layers,...r].filter((e=>!!e));this.handles.add(l.map((e=>this._watchUpdatingTracking.addOnCollectionChange(e,this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([Object(l.d)(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),Object(l.g)(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return!(!Object(s.P)(this._workPromise)&&!this._watchUpdatingTracking.updating)||sr(this._layerLayerViewInfoMap,(e=>!e.done))}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new s.s("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let n=0;for(const s of e){const e=this._layerLayerViewInfoMap.get(s);if(!e||!e.layerView)continue;const o=e.layerView;o.layer=s,o.parent=i,t.getItemAt(n)!==o&&t.splice(n,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),n+=1}n<t.length&&t.splice(n,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),void this.notifyChange("updating");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new rr(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{var i,n;t&&(Object(s.B)(t)||"cancelled:layerview-create"===t.name)||or.error(`Failed to create layerview for layer title:'${null!=(i=e.title)?i:"no title"}', id:'${null!=(n=e.id)?n:"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating")}};Object(s.e)([Object(s.y)()],ar.prototype,"_workPromise",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ar.prototype,"_watchUpdatingTracking",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ar.prototype,"_layersToLayerViews",null),Object(s.e)([Object(s.y)({readOnly:!0})],ar.prototype,"_rootCollectionNames",null),Object(s.e)([Object(s.y)()],ar.prototype,"layerViewImporter",void 0),Object(s.e)([Object(s.y)()],ar.prototype,"supportsGround",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ar.prototype,"updating",null),Object(s.e)([Object(s.y)({constructOnly:!0})],ar.prototype,"view",void 0),ar=Object(s.e)([Object(s.i)("esri.views.LayerViewManager")],ar);var lr=ar;let cr=class extends s.u{constructor(e){super(e),this.factor=1.5,this.offset=Object(w.j)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};Object(s.e)([Object(s.y)({type:Number})],cr.prototype,"factor",void 0),Object(s.e)([Object(s.y)({nonNullable:!0})],cr.prototype,"offset",void 0),Object(s.e)([Object(s.y)()],cr.prototype,"position",void 0),Object(s.e)([Object(s.y)({type:Number,range:{min:0}})],cr.prototype,"size",void 0),Object(s.e)([Object(s.y)()],cr.prototype,"maskUrl",void 0),Object(s.e)([Object(s.y)()],cr.prototype,"maskEnabled",void 0),Object(s.e)([Object(s.y)()],cr.prototype,"overlayUrl",void 0),Object(s.e)([Object(s.y)()],cr.prototype,"overlayEnabled",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],cr.prototype,"version",null),Object(s.e)([Object(s.y)({type:Boolean})],cr.prototype,"visible",void 0),cr=Object(s.e)([Object(s.i)("esri.views.Magnifier")],cr);var hr=cr;const dr=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshTimestamp=null,this.refreshDebounced=Object(s.aa)((async(e,t)=>{let i;"number"==typeof e?i=e:(i=Date.now(),t=e),this._set("refreshTimestamp",i),this.doRefresh&&await this.doRefresh(t)}),2e3)}refresh(e=Date.now()){this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()}};return Object(s.e)([Object(s.y)()],t.prototype,"layer",void 0),Object(s.e)([Object(u.l)("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),t=Object(s.e)([Object(s.i)("esri.layers.mixins.RefreshableLayerView")],t),t};function ur(e){return"refresh"in e}let pr=class extends s.m.EventedAccessor{constructor(){super(...arguments),this._handles=new s.w,this._currentTick=0}initialize(){this._handles.add([this.view.allLayerViews.on("after-changes",(()=>{this.notifyChange("tickInterval"),this._handles.remove("layerViewsUpdating"),this._handles.add(this._getLayerViewHandles(),"layerViewsUpdating")})),this.watch("tickInterval",(()=>this._restartTicking())),this.watch("view.ready",(()=>this._restartTicking()))]),this._restartTicking()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}get tickInterval(){const e=this.view.allLayerViews.filter((e=>ur(e)));return this._getCommonInterval(e)}_restartTicking(){this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval((()=>{const e=Date.now();this._currentTick+=this.tickInterval,this.view.allLayerViews.forEach((t=>{if(ur(t)){const i=Math.round(6e4*t.refreshInterval),n=this._currentTick%i==0,s=e-t.refreshTimestamp<5400;i&&n&&!s&&(t.refresh(e),this.emit("refresh",{layerView:t,timestamp:e,trigger:"interval"}))}}))}),this.tickInterval))}_getLayerViewHandles(){const e=[],t=()=>this.notifyChange("tickInterval");return this.view.allLayerViews.forEach((i=>{ur(i)&&i.layer&&e.push(i.watch("refreshInterval",t),i.layer.on("refresh",(()=>{const e=Date.now();i.refresh(e),this.emit("refresh",{layerView:i,timestamp:e,trigger:"layer-refresh"})})))})),e}_getCommonInterval(e){const t=(e,i)=>isNaN(e)||isNaN(i)?0:i<=0?e:t(i,e%i);return e.toArray().reduce(((e,i)=>t(Math.round(6e4*i.refreshInterval),e)),0)}};Object(s.e)([Object(s.y)()],pr.prototype,"view",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],pr.prototype,"tickInterval",null),pr=Object(s.e)([Object(s.i)("esri.views.RefreshManager")],pr);var br=pr;const mr=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],gr={};function fr(e){return!!gr[e]}mr.forEach((e=>{gr[e]=!0}));class yr{constructor(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((({handler:e,priority:t},i)=>this.inputManager.installHandlers(i,[e],t)))}disconnect(){this.inputManager&&this.handlers.forEach(((e,t)=>this.inputManager.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(e,t,i,n){const s=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!fr(t))return!1;return!0}(s))return s.some(fr)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,r;Array.isArray(t)?r=t:(o=t,r=[]),"function"==typeof i?o=i:n=i,n=null!=n?n:Gn.DEFAULT;const a=this.createUniqueGroupName(),l=new vr(this.view,s,r,o);this.handlers.set(a,{handler:l,priority:n});for(const e of s){const t=this.handlerCounts.get(e)||0;this.handlerCounts.set(e,t+1)}return this.inputManager&&this.inputManager.installHandlers(a,[l],n),{remove:()=>this.removeHandler(a,s)}}hasHandler(e){return!!this.handlerCounts.get(e)}removeHandler(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class vr extends Ln{constructor(e,t,i,n){super(!0),this.view=e;for(const e of t)switch(e){case"click":this.registerIncoming("click",i,(e=>n(this.wrapClick(e))));break;case"double-click":this.registerIncoming("double-click",i,(e=>n(this.wrapDoubleClick(e))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(e=>n(this.wrapImmediateClick(e))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(e=>n(this.wrapImmediateDoubleClick(e))));break;case"hold":this.registerIncoming("hold",i,(e=>n(this.wrapHold(e))));break;case"drag":this.registerIncoming("drag",i,(e=>{const t=this.wrapDrag(e);t&&n(t)}));break;case"key-down":this.registerIncoming("key-down",i,(e=>n(this.wrapKeyDown(e))));break;case"key-up":this.registerIncoming("key-up",i,(e=>n(this.wrapKeyUp(e))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(e=>n(this.wrapPointer(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(e=>n(this.wrapPointer(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(e=>n(this.wrapPointer(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(e=>n(this.wrapPointerDrag(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(e=>n(this.wrapMouseWheel(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(e=>n(this.wrapPointer(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(e=>n(this.wrapPointer(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(e=>{n(this.wrapGamepad(e))}));break;case"focus":this.registerIncoming("focus",i,(e=>{n(this.wrapFocus(e))}));break;case"blur":this.registerIncoming("blur",i,(e=>{n(this.wrapBlur(e))}))}}wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:o,native:r,eventId:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"click",pointerType:t,button:i,buttons:n,x:s,y:o,native:r,timestamp:c,screenPoint:Object(w.j)(s,o),mapPoint:this.getMapPoint(s,o),eventId:a,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapDoubleClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:o,native:r,eventId:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"double-click",pointerType:t,button:i,buttons:n,x:s,y:o,native:r,timestamp:c,mapPoint:this.getMapPoint(s,o),eventId:a,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:o,native:r,eventId:a}=e.data,l=r.pointerId,{cancelable:c,timestamp:h}=e;return{type:"immediate-click",pointerId:l,pointerType:t,button:i,buttons:n,x:s,y:o,native:r,timestamp:h,mapPoint:this.getMapPoint(s,o),eventId:a,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateDoubleClick(e){const{pointerType:t,button:i,buttons:n,x:s,y:o,native:r,eventId:a}=e.data,l=r.pointerId,{cancelable:c,timestamp:h}=e;return{type:"immediate-double-click",pointerId:l,pointerType:t,button:i,buttons:n,x:s,y:o,native:r,timestamp:h,mapPoint:this.getMapPoint(s,o),eventId:a,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapHold(e){const{pointerType:t,button:i,buttons:n,x:s,y:o,native:r}=e.data,{cancelable:a,timestamp:l}=e;return{type:"hold",pointerType:t,button:i,buttons:n,x:s,y:o,native:r,timestamp:l,mapPoint:this.getMapPoint(s,o),cancelable:a,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}getMapPoint(e,t){return this.view.toMap(Object(w.j)(e,t),{exclude:[]})}wrapDrag(e){const t=e.data,{x:i,y:n}=t.center,{action:o,pointerType:r,button:a}=t;if("start"===o&&(this.latestDragStart=t),!this.latestDragStart)return;const l=t.pointer.native,c=t.buttons,{cancelable:h,timestamp:d}=e,u={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===o&&(this.latestDragStart=void 0),{type:"drag",action:o,x:i,y:n,origin:u,pointerType:r,button:a,buttons:c,radius:t.radius,angle:Object(s.ab)(t.angle),native:l,timestamp:d,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyDown(e){const{key:t,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:t,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyUp(e){const{key:t,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:t,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointer(e,t){const{x:i,y:n,button:s,buttons:o,native:r,eventId:a}=e.data,l=r.pointerId,c=r.pointerType,{cancelable:h,timestamp:d}=e;return{type:t,x:i,y:n,pointerId:l,pointerType:c,button:s,buttons:o,native:r,timestamp:d,eventId:a,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointerDrag(e){const{x:t,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:r}=e.data.startEvent,a=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,h={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:d,timestamp:u}=e;return{type:"pointer-drag",x:t,y:i,pointerId:a,pointerType:l,button:r,buttons:n,action:c,origin:h,native:s,timestamp:u,eventId:o,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapMouseWheel(e){const{cancelable:t,data:i,timestamp:n}=e,{x:s,y:o,deltaY:r,native:a}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:r,native:a,timestamp:n,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapGamepad(e){const{action:t,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:r,axes:a}=i;return{type:"gamepad",device:n,timestamp:o,action:t,buttons:r,axes:a,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}function _r(e,t){const i=e.view;i&&(t&&i.ready&&i.activeTool!==e?(i.activeTool=e,function(e){return e&&"focus"in e}(i)&&i.focus()):t||i.activeTool!==e||(i.activeTool=null))}function wr(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function Or(e){return Object(s.J)(e)?{}:"function"==typeof e?e():e}class jr{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Mr(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!Ir(e)||Cr(e))break;const n=qo(e),o=this._intersect(n,e.pointerType,t.forEachTool);if(Object(s.J)(o))break;const r=this._findToolAndManipulatorByKey(o,t.forEachTool,xr),a=Object(s.ac)(r,(e=>e.manipulator)),l=Object(s.ac)(r,(e=>e.tool));!(Object(s.P)(a)&&Object(s.P)(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,e),Object(s.P)(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:o,start:n}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(o.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",screenPoint:n}),i());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!Ir(e))break;const n=this._grabbedManipulators.get(e.pointerId),o=this._draggedManipulators.get(e.pointerId),r=Object(s.ac)(n||o,(({key:e})=>e)),a=this._findManipulatorByKey(r,t.forEachTool);if(Object(s.J)(a))break;const l=qo(e);l.x=Object(s.D)(l.x,0,t.view.width),l.y=Object(s.D)(l.y,0,t.view.height);const c=Object(s.Y)(n||o).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(a.dragging=!0,o?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:Object(s.Y)(r),start:c}));break;case"end":a.dragging=!1,o&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const n=qo(e),o=this._intersect(n,e.pointerType,t.forEachTool),r=this._findToolAndManipulatorByKey(o,t.forEachTool,xr);if(Cr(e)||t.forEachTool((e=>{if((!Object(s.P)(r)||r.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),Object(s.J)(r))break;const{manipulator:a,tool:l}=r;if(!a.interactive)break;a.selectable&&!l.selectionManagementDisabled&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:c,stopPropagation:i});break}case"click":{const n=qo(e),o=this._intersect(n,e.pointerType,t.forEachTool),r=this._findManipulatorByKey(o,t.forEachTool);if(Object(s.J)(r)||!r.interactive)break;const a=e.native.shiftKey;r.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=qo(e),o=this._intersect(n,e.pointerType,t.forEachTool),r=this._findManipulatorByKey(o,t.forEachTool);if(Object(s.J)(r)||!r.interactive)break;const a=e.native.shiftKey;r.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const n=qo(e),o=this._intersect(n,e.pointerType,t.forEachTool),r=this._findManipulatorByKey(o,t.forEachTool);if(Object(s.J)(r)||!r.interactive)break;const a=e.native.shiftKey;r.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._updateCursor(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",screenPoint:qo(i)}),this._grabbedManipulators.forEach((({key:i},n)=>{i.tool===t&&t.manipulators.findById(i.manipulatorId)===e&&this._grabbedManipulators.delete(n)}))}_handlePointerEnd(e,t){const i=Object(s.ac)(this._grabbedManipulators.get(e.pointerId),(({key:e})=>e)),n=this._findManipulatorByKey(i,t.forEachTool);if(Object(s.P)(n)&&!n.dragging){const o=Object(s.P)(t.creatingTool)&&t.creatingTool===Object(s.Y)(i).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||o||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",screenPoint:qo(e)})),this._grabbedManipulators.delete(e.pointerId)}}_cursorFromMap(e,t){let i=null;return sr(e,(({key:e})=>{const n=this._findManipulatorByKey(e,t);return!!(Object(s.P)(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(i=n.cursor,!0)})),i}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}clearPointers(e,t,i=!0,n){const o=t=>t.tool===e&&(Object(s.J)(n)||t.manipulatorId===n);this._grabbedManipulators.forEach((({key:e},i)=>{if(o(e)){this._grabbedManipulators.delete(i);const n=this._findManipulatorByKey(e,t);Object(s.P)(n)&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",screenPoint:null}))}})),this._draggedManipulators.forEach((({key:e},i)=>{if(o(e)){this._draggedManipulators.delete(i);const n=this._findManipulatorByKey(e,t);Object(s.P)(n)&&(n.dragging=!1,n.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:e},i)=>{if(o(e)){this._hoveredManipulators.delete(i);const n=this._findManipulatorByKey(e,t);Object(s.P)(n)&&(n.hovering=!1)}})),this._updateCursor(t)}_intersect(e,t,i){let n=null;return i((i=>{if(null==i.manipulators||!wr(i))return!1;const o=i.manipulators.intersect(e,t);return!Object(s.J)(o)&&(n={manipulatorId:o.id,tool:i},!0)})),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Object(w.j)(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!Mr(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(qo(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,n){const o=this._intersect(e,i,n);let r=this._findManipulatorByKey(o,n);const a=Object(s.ac)(this._hoveredManipulators.get(t),(({key:e})=>e)),l=this._findManipulatorByKey(a,n);Object(s.P)(r)&&!r.interactive&&(r=null),l!==r&&(Object(s.P)(l)&&(l.hovering=!1),Object(s.P)(r)?(r.hovering=!0,this._hoveredManipulators.set(t,{key:Object(s.Y)(o)})):this._hoveredManipulators.delete(t),this._updateCursor(n))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,xr)?xr.manipulator:null}_findToolAndManipulatorByKey(e,t,i){return Object(s.J)(e)?null:(i.tool=null,i.manipulator=null,t((t=>{if(t!==e.tool||null==t.manipulators||!wr(t))return!1;const n=t.manipulators.findById(e.manipulatorId);return!!Object(s.P)(n)&&(i.manipulator=n,i.tool=t,!0)})),i.manipulator?i:null)}}function Mr(e){return"mouse"===e}function Ir(e){return"mouse"!==e.pointerType||0===e.button}function Cr(e){return!!e.native.shiftKey}const xr={manipulator:null,tool:null},Pr=s.n.getLogger("esri.views.ToolViewManager"),Tr="manipulators",kr="tools";let Er=class extends s.u{constructor(e){super(e),this._handles=new s.w,this._creatingTool=null,this._manipulatorState=new jr,this.tools=function(){const e=new s.L;return e.on("after-add",(e=>{const t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(e=>{const t=e.item;_r(t,!1),t.destroyed||t.detach()})),e}(),this.cursor=null,this._forEachTool=e=>{if(!Object(s.P)(this._creatingTool)||!e(this._creatingTool))for(const t of this.tools.items)if(e(t))return}}initialize(){this._handles.add([this.view.on(mr,(e=>{this._handleInputEvent(e)}),Gn.TOOL),this.tools.on("before-add",(e=>{const t=e.item;null==t||this.tools.includes(t)?e.preventDefault():null==t.created||t.created||(Pr.error("tools","Tool can not be added to view before it has been created"),e.preventDefault())})),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this._forEachTool((e=>e.destroy())),this._handles.destroy(),this._handles=null}set activeTool(e){!Object(s.P)(e)||this.view.ready?(function(e,t,i){const n=e.activeTool;t!==n&&(Object(s.P)(n)&&n.deactivate&&n.deactivate(),i(t),Object(s.P)(t)&&t.activate&&t.activate())}(this,e,(t=>{this._set("activeTool",t),this._removeIncompleteTools(e),this._forEachTool((e=>{const t=Object(s.J)(this.activeTool)||e===this.activeTool;e.setEditableFlag&&e.setEditableFlag(1,t);const i=wr(e);!Object(s.J)(this.activeTool)&&i||this._manipulatorState.clearPointers(e,this._forEachTool,!i)})),this._updateCursor()})),this._creatingTool!==e&&this._rejectCreatingTool()):Pr.error("#activeTool=","cannot set active tool while view is not ready")}async createTool(e,t,i){await this.view.whenReady();const n="Tool creation was interrupted by another tool being created";if(Object(s.ad)(i))throw Object(s.ae)(n);const o=new e({...Or(t),view:this.view}),r=Object(s.a8)(i,(()=>this.activeTool=null));return this._rejectCreatingTool(n),this._creatingTool=o,o.attach(),this._refreshToolWatchers(),_r(o,!0),await o.when(),Object(s.P)(r)&&r.remove(),this._creatingTool=null,this.tools.add(o),o instanceof s.u&&null!=o.completed&&Object(l.j)(o,"completed").then((()=>{_r(o,!1)})),o}attach(){this._forEachTool((e=>e.attach())),"3d"===this.view.type?this._handles.add([this.view.state.watch("camera",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this.forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))}))],Tr):this._handles.add(this.view.watch("extent",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){this.activeTool=null,this._forEachTool((e=>{e.detach(),e.destroy()})),this.tools.removeAll(),this._handles.remove(Tr)}forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};Object(s.P)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!t&&Object(s.P)(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this._handles.remove(kr),this._forEachTool((e=>{if(e instanceof s.u){const t=Object(l.h)(e,["cursor","visible","editable"],(()=>{wr(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()}));this._handles.add(t,kr)}e.manipulators&&this._handles.add(e.manipulators.on("change",(t=>{t.removed.forEach((({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),kr)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=null;this._forEachTool((t=>null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0))),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)}_rejectCreatingTool(e){const t=this._creatingTool;Object(s.J)(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation(Object(s.ae)(e)),t.destroy(),this._creatingTool=null,this._refreshToolWatchers())}_removeIncompleteTools(e){this.tools.filter((t=>(Object(s.J)(e)||t!==e)&&null!=t.completed&&!t.completed)).forEach((e=>{this.tools.remove(e)}))}};Object(s.e)([Object(s.y)({constructOnly:!0,nonNullable:!0})],Er.prototype,"view",void 0),Object(s.e)([Object(s.y)({value:null})],Er.prototype,"activeTool",null),Object(s.e)([Object(s.y)({readOnly:!0,type:s.L})],Er.prototype,"tools",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Er.prototype,"cursor",void 0),Er=Object(s.e)([Object(s.i)("esri.views.ToolViewManager")],Er);var Ar=Er;class Fr{constructor(e,t,i){this.analysis=e,this.viewFactory=t,this.controllerFactory=i,this._promise=Object(s.a6)(),this.analysisView=null,this.analysisController=null,this._load()}destroy(){Object(s.P)(this.analysisView)&&this.analysisView.destroy(),Object(s.P)(this.analysisController)&&this.analysisController.destroy()}get promise(){return this._promise.promise}async _load(){let e=!1;Object(s.P)(this.viewFactory)?this.analysisView=await this.viewFactory(this.analysis):e=!0,Object(s.P)(this.controllerFactory)?this.analysisController=await this.controllerFactory(this.analysis):e=!0,e?this._promise.reject("no view/controller factories available for analysis"):this._promise.resolve(Object(s.Y)(this.analysisView))}}let Sr=class extends s.u{constructor(e){super(e),this._items=new Map,this.analyses=new s.L}initialize(){this.analyses.on("after-add",(e=>{const t=e.item;this._items.set(t,this._createItem(t))})),this.analyses.on("after-remove",(e=>{const t=e.item,i=this._getItem(t);Object(s.P)(i)&&(i.destroy(),this._items.delete(t))}))}async whenAnalysisView(e){return this._items.has(e)?this._items.get(e).promise:Object(s.af)(new s.s("view:no-analysisview-for-analysis","No analysis view has been found for the analysis"))}getAnalysisView(e){const t=this._items.get(e);return t?t.analysisView:null}_createItem(e){return new Fr(e,this.viewFactory,this.controllerFactory)}_getItem(e){return this._items.get(e)}};Object(s.e)([Object(s.y)({type:s.L})],Sr.prototype,"analyses",void 0),Object(s.e)([Object(s.y)()],Sr.prototype,"viewFactory",void 0),Object(s.e)([Object(s.y)()],Sr.prototype,"controllerFactory",void 0),Sr=Object(s.e)([Object(s.i)("esri.views.3d.interactive.graphics.AnalysisManager")],Sr);let Vr=class extends s.u{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":Dr.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Lr[this.deviceType]}};Object(s.e)([Object(s.y)({nonNullable:!0,readOnly:!0})],Vr.prototype,"nativeIndex",void 0),Object(s.e)([Object(s.y)({type:String,readOnly:!0})],Vr.prototype,"deviceType",null),Object(s.e)([Object(s.y)({type:Number,readOnly:!0})],Vr.prototype,"axisThreshold",null),Vr=Object(s.e)([Object(s.i)("esri.views.input.gamepad.GamepadInputDevice")],Vr);const Dr=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Lr={standard:.15,spacemouse:.025,unknown:0};var Rr=Vr;let Nr=class extends s.u{constructor(...e){super(...e),this.devices=new s.L,this.enabledFocusMode="document"}};Object(s.e)([Object(s.y)({type:s.L.ofType(Rr),readOnly:!0})],Nr.prototype,"devices",void 0),Object(s.e)([Object(s.y)({type:["document","view","none"]})],Nr.prototype,"enabledFocusMode",void 0),Nr=Object(s.e)([Object(s.i)("esri.views.input.gamepad.GamepadSettings")],Nr);var zr=Nr;let Br=class extends s.u{constructor(){super(...arguments),this.gamepad=new zr}};Object(s.e)([Object(s.y)({readOnly:!0})],Br.prototype,"gamepad",void 0),Br=Object(s.e)([Object(s.i)("esri.views.input.Input")],Br);var Hr=Br;let Ur=class extends s.u{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};Object(s.e)([Object(s.y)({type:Boolean,nonNullable:!0})],Ur.prototype,"enabled",void 0),Object(s.e)([Object(s.y)({type:Rr})],Ur.prototype,"device",void 0),Object(s.e)([Object(s.y)({type:["pan","zoom"],nonNullable:!0})],Ur.prototype,"mode",void 0),Object(s.e)([Object(s.y)({type:["forward-down","forward-up"],nonNullable:!0})],Ur.prototype,"tiltDirection",void 0),Object(s.e)([Object(s.y)({type:Number,nonNullable:!0})],Ur.prototype,"velocityFactor",void 0),Ur=Object(s.e)([Object(s.i)("esri.views.navigation.gamepad.GamepadSettings")],Ur);var Gr=Ur;let qr=class extends s.u{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Gr,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};Object(s.e)([Object(s.y)({type:Boolean})],qr.prototype,"browserTouchPanEnabled",void 0),Object(s.e)([Object(s.y)({type:Gr,nonNullable:!0})],qr.prototype,"gamepad",void 0),Object(s.e)([Object(s.y)({type:Boolean})],qr.prototype,"momentumEnabled",void 0),Object(s.e)([Object(s.y)({type:Boolean})],qr.prototype,"mouseWheelZoomEnabled",void 0),qr=Object(s.e)([Object(s.i)("esri.views.navigation.Navigation")],qr);var $r=qr;function Wr(e){const t=e.url&&Object(A.c)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&Object(s.P)(t)&&"ImageServer"===t.serverType||!Kr(e)||!e.heightModelInfo?function(e){return Zr(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Jr(e)}(e)?k.a.deriveUnitFromSR(Yr,e.spatialReference):null:e.heightModelInfo}function Kr(e){return"heightModelInfo"in e}function Zr(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"ogc-feature":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function Jr(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":case null:return!1}return!1}const Yr=new k.a({heightModel:"gravity-related-height"});var Xr;const Qr=s.n.getLogger("esri.views.support.DefaultsFromMap");let ea=Xr=class extends s.u{constructor(){super(...arguments),this._handles=new s.w,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=Xr.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",(()=>{this._running&&(this.reset(),this.start())}))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const e=this._updateLayerChange.bind(this);for(const t of this.mapCollectionPaths)this._handles.add(Object(l.d)(this.view,`map.${t}`,"change",e,e,e,!0));this._handles.add(Object(l.m)(this,"isSpatialReferenceDone",(()=>this._updateTileInfo()),!0))}_ownerNameFromCollectionName(e){const t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)}_ensureLoadedOwnersFromCollectionName(e){const t=this._ownerNameFromCollectionName(e).split(".");let i;for(let n=0;n<t.length&&(i=this.get(t.slice(0,n+1).join(".")),i);n++)if(i.load&&!i.isFulfilled())return{collectionName:e,owner:null,loading:i.load().catch((()=>{}))};return{collectionName:e,owner:i}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(e){let t=!0,i=!1;const n=e.catch((()=>{})).then((()=>{t?i=!0:n===this._waitTask&&this._update()}));return t=!1,i||(this._waitTask=n),i}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const e=this._processMapCollections((e=>this._processSpatialReferenceSource(e)));if(this._debugLog(`Search ended with status '${ia(e)}'`),0!==e){let e=null,t=this._spatialReferenceCandidates;if(!t||t.length<1?(e=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${ta(e)})`)):(this.defaultSpatialReference&&t.length>1&&t.findIndex((e=>e.equals(this.defaultSpatialReference)))>-1&&(t=[this.defaultSpatialReference]),e=t[0],this._debugLog(`Locking to ${ta(e)}`)),this._set("spatialReference",e),e)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const t=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((t=>this._findExtent(t,e))),this.logDebugInformation=t,this._projectExtentCandidate().catch((()=>{})).then((()=>this._set("isSpatialReferenceDone",!0)))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const e=this._processMapCollections((e=>this._processHeightModelInfoSource(e)),(e=>function(e){return null!=e.layers||Jr(e)||Zr(e)||Kr(e)}(e)));this._debugLog(`Search ended with status ${ia(e)}`),this._set("isHeightModelInfoSearching",0===e)}this._updateTileInfo()}}_processMapCollections(e,t){this._preloadMapCollections(t);let i=2;return this._forAllMapCollectionSources((e=>{if(2!==i)return!1;const{collectionName:t}=e;return this._debugLog(`Processing collection ${t}...`),!(e.loading&&!this._updateWhen(e.loading)&&(this._debugLog(`Collection ${e.collectionName} owner is loading -> wait`),i=0,1))}),(n=>2===i&&(null==t||t(n)?!n.load||n.isFulfilled()||this._updateWhen(n.load())?!((!n.load||n.isResolved())&&e(n)&&(i=1,1)):(this._debugLog(`Source ${n.id} is loading -> wait`),i=0,!1):(this._debugLog(`Source ${n.id} is skipped due to predicate`),!1)))),i}_preloadMapCollections(e){let t=10;const i=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((()=>!0),(n=>0!==t&&!(null!=e&&!e(n)||(n.load&&!n.isFulfilled()&&(this.logDebugInformation=i,this._debugLog(`Pre-loading source ${n.id}`),this.logDebugInformation=!1,n.load().catch((()=>{})),t--),0)))),this.logDebugInformation=i}_forAllMapCollectionSources(e,t){for(const i of this.mapCollectionPaths){const n=`map.${i}`,s=this._ensureLoadedOwnersFromCollectionName(n);if(!1===e(s))continue;const o=s.owner;if(!o||o.isRejected&&o.isRejected()){this._debugLog(`Collection ${n} owner is invalid or rejected -> skip`);continue}const r=this.view.get(n);r?this._forEachSource(r,t):this._debugLog(`Collection ${n} does not exist -> skip`)}}_forEachSource(e,t){for(const i of e.items)!1!==t(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,t)}_processSpatialReferenceSource(e){let t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=Object(s.ag)(t,this._spatialReferenceCandidates,((e,t)=>e.equals(t))),t.length>0?this._spatialReferenceCandidates=t:this._debugLog(`Layer ${e.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)}_findExtent(e,t){const i="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),n=i.find((e=>e.spatialReference.equals(t)));if(n)return this._set("extent",n),!0;if(this._getSupportedSpatialReferences(e).length>0){const t=i.map((t=>({extent:t,layer:e}))),n=this._extentCandidates||[];this._extentCandidates=n.concat(t)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const e=this.spatialReference,t=this._extentCandidates.find((t=>Object(s.ah)(t.extent.spatialReference,e)));if(t)this._set("extent",Object(s.ai)(t.extent,e));else{const t=this._extentCandidates[0];this._extentProjectController=Object(s.V)();const n=await i.e(150).then(i.bind(null,276));try{const i=await n.projectGeometry(t.extent,e,t.layer.portalItem,this._extentProjectController.signal);this._set("extent",i)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return this._debugLog(`Layer ${e.id} is ignored because it does not have any spatial references`),[];const i=t.filter((t=>this.view.isSpatialReferenceSupported(t,e,(e=>this._debugLog(e)))));return 0===i.length?this._debugLog(`Layer ${e.id} has spatial references but none of them are supported (or layer doesn't require locking)`):this._debugLog(`Layer ${e.id} has spatial references. Resulting candidate set: ${i.map(ta).join(", ")}`),i}_processHeightModelInfoSource(e){const t=Wr(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const e=this.get("view.map");if(!e)return void this._debugLog("updateTileInfo: no map");const t=e.basemap,i=e.get("layers.0");let n=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");const e=t&&t.get("baseLayers.0");if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");n="tileInfo"in e&&e.tileInfo}else{if(!i||"failed"===i.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");n="tileInfo"in i&&i.tileInfo}}else if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");n="tileInfo"in i&&i.tileInfo}n&&!n.spatialReference.equals(this.spatialReference)&&(n=null),this._debugLog(`updateTileInfo: setting ${n}`),this._set("tileInfo",n),this._set("isTileInfoDone",!0)}_debugLog(e){this.logDebugInformation&&Qr.info(e)}};function ta(e){return e?JSON.stringify(e.toJSON()):"undefined"}function ia(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}ea.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],Object(s.e)([Object(s.y)()],ea.prototype,"logDebugInformation",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"isSpatialReferenceDone",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"isTileInfoDone",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"isHeightModelInfoSearching",void 0),Object(s.e)([Object(s.y)({constructOnly:!0})],ea.prototype,"view",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"spatialReference",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"extent",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"heightModelInfo",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"vcsWkid",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"latestVcsWkid",void 0),Object(s.e)([Object(s.y)()],ea.prototype,"mapCollectionPaths",void 0),Object(s.e)([Object(s.y)()],ea.prototype,"defaultSpatialReference",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ea.prototype,"tileInfo",void 0),ea=Xr=Object(s.e)([Object(s.i)("esri.views.support.DefaultsFromMap")],ea);var na,sa=ea;const oa=s.n.getLogger("esri.views.View");let ra=na=class extends(Object(d.a)(s.m.EventedMixin(Object(s.aj)(s.u)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new a.a({root:this,rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:e=>e.layerViews}),this.animation=null,this.basemapView=null,this.defaultsFromMap=new sa({view:this}),this.fatalError=null,this.extent=null,this.graphics=new E.b,this.navigating=!1,this.layerViews=new s.L,this.magnifier=new hr,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.renderContext=null,this.input=new Hr,this.navigation=new $r,this.layerViewManager=null,this.refreshManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new yr(this),this.persistableViewModels=new s.L,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",(e=>{e?(this._currentSpatialReference=this.spatialReference,na.views.add(this)):(this._currentSpatialReference=null,na.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),this.toolViewManager.attach())}),!0))}initialize(){let e;this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,Object(l.j)(this,"ready"))))),this.basemapView=new nr({view:this}),this.layerViewManager=new lr({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.refreshManager=new br({view:this}),this.toolViewManager=new Ar({view:this}),this.analysisManager=new Sr({viewFactory:e=>this.createAnalysisView(e),controllerFactory:e=>this.createAnalysisController(e)}),this._resetInitialViewPropertiesFromContent(),Object(l.g)(this.defaultsFromMap,"isSpatialReferenceDone",(t=>{const i=!!(this.map&&this.map.allLayers.length>0);if(t&&!this.spatialReference&&i||!e){if(t&&!this.spatialReference&&i&&!e){const t=e=Object(s.X)(this.spatialReferenceWarningDelay);e.then((()=>{t===e&&oa.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((()=>{}))}}else e=null}),!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,null==e||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return oa.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!s.k.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(e){var t;e!==this._get("map")&&(null!=(t=e)&&t.destroyed&&(oa.warn("#map","The provided map is already destroyed",{map:e}),e=null),s.k.isLoadable(e)&&e.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){this._userSpatialReference=e,this._set("spatialReference",e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return Object(s.P)(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getAnalysisView(e){return this.analysisManager.getAnalysisView(e)}whenAnalysisView(e){return this.analysisManager.whenAnalysisView(e)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(e){throw new s.s("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async createAnalysisView(e){throw new s.s("createAnalysisView() not implemented")}async createAnalysisController(e){throw new s.s("createAnalysisController() not implemented")}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(e,t,i){return!0}isTileInfoRequired(){return!1}when(e,t){return this.isResolved()&&!this.ready&&oa.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(e,t)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,Object(l.a)(this,"preconditionsReady",(()=>this._readyCycleForced=!1)))}createTool(e,t,i){return this.toolViewManager.createTool(e,t,i)}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const e=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([Object(l.h)(this,"spatialReference",((t,i)=>{Object(s.ak)(t,i)||e()})),Object(l.h)(this,"initialExtentRequired",e),Object(s.a7)(e)],"defaultsFromMap")}};ra.views=new s.L,Object(s.e)([Object(u.l)("toolViewManager.activeTool")],ra.prototype,"activeTool",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"allLayerViews",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"animation",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"basemapView",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"defaultsFromMap",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"fatalError",void 0),Object(s.e)([Object(s.y)({type:s.M})],ra.prototype,"extent",void 0),Object(s.e)([Object(s.y)(Object(E.c)())],ra.prototype,"graphics",void 0),Object(s.e)([Object(s.y)({readOnly:!0,type:k.a,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],ra.prototype,"heightModelInfo",null),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"interacting",null),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"navigating",void 0),Object(s.e)([Object(s.y)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],ra.prototype,"preconditionsReady",null),Object(s.e)([Object(s.y)({type:s.L,readOnly:!0})],ra.prototype,"layerViews",void 0),Object(s.e)([Object(s.y)({type:hr})],ra.prototype,"magnifier",void 0),Object(s.e)([Object(s.y)({value:null,type:P.a})],ra.prototype,"map",null),Object(s.e)([Object(s.y)()],ra.prototype,"padding",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"ready",void 0),Object(s.e)([Object(s.y)({type:s.A})],ra.prototype,"spatialReference",null),Object(s.e)([Object(s.y)()],ra.prototype,"spatialReferenceWarningDelay",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"stationary",null),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"supportsGround",void 0),Object(s.e)([Object(s.y)({type:T.a})],ra.prototype,"timeExtent",void 0),Object(s.e)([Object(u.l)("toolViewManager.tools")],ra.prototype,"tools",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"toolViewManager",void 0),Object(s.e)([Object(u.l)("analysisManager.analyses")],ra.prototype,"analyses",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"analysisManager",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"type",void 0),Object(s.e)([Object(s.y)({type:Number})],ra.prototype,"scale",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"updating",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"initialExtentRequired",void 0),Object(s.e)([Object(s.y)({readOnly:!0,type:s.M})],ra.prototype,"initialExtent",null),Object(s.e)([Object(s.y)()],ra.prototype,"cursor",null),Object(s.e)([Object(s.y)()],ra.prototype,"renderContext",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"input",void 0),Object(s.e)([Object(s.y)({type:$r,nonNullable:!0})],ra.prototype,"navigation",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"layerViewManager",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"width",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"height",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"resizing",void 0),Object(s.e)([Object(s.y)({value:null,readOnly:!0})],ra.prototype,"size",null),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"suspended",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"viewEvents",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],ra.prototype,"persistableViewModels",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"_isValid",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"_readyCycleForced",void 0),Object(s.e)([Object(s.y)()],ra.prototype,"_currentSpatialReference",void 0),ra=na=Object(s.e)([Object(s.i)("esri.views.View")],ra);var aa=ra;let la=class extends s.al{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise(((e,t)=>this._dfd={resolve:e,reject:t})))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new s.s("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Object(s.S)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};Object(s.e)([Object(s.y)({readOnly:!0})],la.prototype,"done",null),Object(s.e)([Object(s.y)({readOnly:!0,type:String})],la.prototype,"state",void 0),Object(s.e)([Object(s.y)()],la.prototype,"target",void 0),la=Object(s.e)([Object(s.i)("esri.views.ViewAnimation")],la),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(la||(la={}));var ca=la;function ha(){return[1,0,0,1,0,0]}Object.freeze({__proto__:null,create:ha,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,i,n,s,o){return[e,t,i,n,s,o]},createView:function(e,t){return new Float64Array(e,t,6)}});const da=39.37,ua=180/Math.PI;function pa(e,t,i,n){return n&&i&&!n.equals(i)&&Object(s.ah)(n,i)&&n.isWebMercator?n.isWebMercator?function(e,t){let i=t[1];return i>89.99999?i=89.99999:i<-89.99999&&(i=-89.99999),i=Math.sin(Object(F.q)(i)),Object(V.m)(e,Object(F.q)(t[0])*s.am.radius,.5*s.am.radius*Math.log((1+i)/(1-i)))}(e,t):function(e,t,i){const n=Object(F.r)(t[0]/s.am.radius);return Object(V.m)(e,i?n:n-360*Math.floor((n+180)/360),Object(F.r)(.5*Math.PI-2*Math.atan(Math.exp(-1*t[1]/s.am.radius))))}(e,t):Object(V.d)(e,t)}function ba(e){return e.wkid?e:e.spatialReference||s.A.WGS84}function ma(e,t){return t.type?Object(V.m)(e,t.x,t.y):Object(V.d)(e,t)}function ga(e){return Object(m.b)(e)}function fa(e,t){return Math.max(e.width/t[0],e.height/t[1])*function(e){return Object(s.an)(e)?ga(e)*da*96:1}(e.spatialReference)}async function ya(e,t,i,n){let o,r;if(!e)return null;if(Array.isArray(e)&&!e.length)return null;if(s.L.isCollection(e)&&(e=e.toArray()),Array.isArray(e)&&e.length&&"object"==typeof e[0]){const o=e.every((e=>"attributes"in e)),r=e.some((e=>!e.geometry));let a=e;if(o&&r&&t&&t.allLayerViews){const i=new Map;for(const t of e){const e=t.layer,n=i.get(e)||[],s=t.attributes[e.objectIdField];null!=s&&n.push(s),i.set(e,n)}const n=[];i.forEach(((e,i)=>{const s=t.allLayerViews.find((e=>e.layer.id===i.id));if("queryFeatures"in s){const t=i.createQuery();t.objectIds=e,t.returnGeometry=!0,n.push(s.queryFeatures(t))}}));const o=await Promise.all(n),r=[];for(const e of o)if(e&&e.features&&e.features.length)for(const t of e.features)Object(s.P)(t.geometry)&&r.push(t.geometry);a=r}for(const e of a)n=await ya(e,t,i,n);return n}if(Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1])o=new s._(e);else if(e instanceof s.ao)o=e;else if("geometry"in e)if(e.geometry)o=e.geometry;else if(e.layer){const i=e.layer,n=t.allLayerViews.find((e=>e.layer.id===i.id));if("queryFeatures"in n){const t=i.createQuery();t.objectIds=[e.attributes[i.objectIdField]],t.returnGeometry=!0;const r=await n.queryFeatures(t);o=Object(s.ap)(r,"features",0,"geometry")}}if(Object(s.J)(o))return null;if(r="point"===o.type?new s.M({xmin:o.x,ymin:o.y,xmax:o.x,ymax:o.y,spatialReference:o.spatialReference}):o.extent,!r)return null;const a=Object(s.ah)(r,i);if(!r.spatialReference.equals(i)&&a)r=Object(s.ai)(r,i);else if(!a)return null;return n?n.union(r):r.clone()}async function va(e,t){if(!e||!t)return new tr({targetGeometry:new s._,scale:0,rotation:0});let i=t.spatialReference;const{constraints:n,padding:o,viewpoint:r,size:a}=t,l=[o?a[0]-o.left-o.right:a[0],o?a[1]-o.top-o.bottom:a[1]];let c=null;e instanceof tr?c=e:e.viewpoint?c=e.viewpoint:e.target&&"esri.Viewpoint"===e.target.declaredClass&&(c=e.target);let h=null;c&&c.targetGeometry?h=c.targetGeometry:e instanceof s.M?h=e:(e||e&&("center"in e||"extent"in e||"target"in e))&&(h=await ya(e.center,t,i)||await ya(e.extent,t,i)||await ya(e.target,t,i)||await ya(e,t,i)),!h&&r&&r.targetGeometry?h=r.targetGeometry:!h&&t.extent&&(h=t.extent);const d=ba(h);if(i||(i=ba(t.spatialReference||t.extent||h)),!Object(s.ah)(h,i)&&d&&!d.equals(i))return null;const u=ma(Object(S.h)(),h.center?h.center:h),p=new s._(pa(u,u,d,i),i);let b=null;b=c&&Object(s.P)(c.targetGeometry)&&"point"===c.targetGeometry.type?c.scale:e.hasOwnProperty("scale")&&e.scale?e.scale:e.hasOwnProperty("zoom")&&-1!==e.zoom&&n&&n.effectiveLODs?n.zoomToScale(e.zoom):Array.isArray(h)||"point"===h.type||"extent"===h.type&&0===h.width&&0===h.height?t.extent&&Object(s.ah)(t.extent,i)?fa(Object(s.ai)(t.extent,i),l):t.extent?fa(t.extent,l):r.scale:Object(s.ah)(h.extent,i)?fa(Object(s.ai)(h.extent,i),l):fa(h.extent,l);const m=function(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&e.layer&&e.layer.minScale&&e.layer.maxScale){const t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every((e=>"layer"in e))){let t=0,i=0;for(const n of e){const e=n.layer;e&&e.minScale&&e.maxScale&&(t=e.minScale<t?e.minScale:t,i=e.maxScale>i?e.maxScale:i)}return t&&i?{min:t,max:i}:null}}}(e);m&&(m.min&&m.min>b?b=m.min:m.max&&m.max<b&&(b=m.max));let g=0;c?g=c.rotation:e.hasOwnProperty("rotation")?g=e.rotation:r&&(g=r.rotation);let f=new tr({targetGeometry:p,scale:b,rotation:g});return n&&(f=n.fit(f),n.constrainByGeometry(f),n.rotationEnabled||(f.rotation=g)),f}function _a(e,t){const i=e.targetGeometry,n=t.targetGeometry;return i.x=n.x,i.y=n.y,i.spatialReference=n.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function wa(e,t,i){return i?Object(V.m)(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):Object(V.i)(e,t,.5)}const Oa=function(){const e=Object(S.h)();return function(t,i,n){const s=i.targetGeometry;ma(e,s);const o=.5*Ia(i);return t.xmin=e[0]-o*n[0],t.ymin=e[1]-o*n[1],t.xmax=e[0]+o*n[0],t.ymax=e[1]+o*n[1],t.spatialReference=s.spatialReference,t}}();const ja=function(){const e=Object(S.h)();return function(t,i,n){return Object(V.a)(t,function(e,t){return Object(V.i)(e,t,.5)}(t,i),wa(e,i,n))}}(),Ma=function(){const e=[1,0,0,1,0,0],t=Object(S.h)();return function(i,n,s,o){const r=Ia(n),a=Ca(n);return Object(V.m)(t,r,r),Object(D.a)(e,t),Object(D.d)(e,e,a),Object(D.i)(e,e,ja(t,s,o)),Object(D.i)(e,e,[0,o.top-o.bottom]),Object(V.m)(i,e[4],e[5])}}();function Ia(e){return e.scale*function(e){return Object(s.P)(e)&&Object(s.an)(e.spatialReference)?1/(ga(e.spatialReference)*da*96):1}(e.targetGeometry)}function Ca(e){return Object(F.q)(e.rotation)||0}const xa=function(){const e=Object(S.h)(),t=Object(S.h)(),i=Object(S.h)();return function(n,s,o,r,a,l){return Object(V.k)(e,s),Object(V.i)(t,o,.5*l),Object(V.m)(i,1/r*l,-1/r*l),Object(D.j)(n),Object(D.i)(n,n,t),a&&Object(D.d)(n,n,a),Object(D.f)(n,n,i),Object(D.i)(n,n,e),n}}(),Pa=function(){const e=Object(S.h)();return function(t,i,n,s){const o=Ia(i),r=Ca(i);return ma(e,i.targetGeometry),xa(t,e,n,o,r,s)}}(),Ta=function(){const e=Object(S.h)();return function(t,i,n,s){const o=Ia(i);return ma(e,i.targetGeometry),xa(t,e,n,o,0,s)}}();function ka(e){if(e.isWrappable){const t=Object(s.aq)(e);return t.valid[1]-t.valid[0]}return 0}const Ea=function(){const e=Object(S.h)(),t=Object(S.h)(),i=[0,0,0];return function(n,s,o){Object(V.j)(e,n,s),Object(V.g)(e,e),Object(V.j)(t,n,o),Object(V.g)(t,t),Object(V.h)(i,e,t);let r=Math.acos(Object(V.c)(e,t)/(Object(V.e)(e)*Object(V.e)(t)))*ua;return i[2]<0&&(r=-r),isNaN(r)&&(r=0),r}}(),Aa=function(){const e=Object(S.h)();return function(t,i,n,s){const o=t.targetGeometry;return _a(t,i),Ma(e,i,n,s),o.x+=e[0],o.y+=e[1],t}}(),Fa=function(){const e=Object(S.h)();return function(t,i,n){_a(t,i);const s=t.targetGeometry,o=ba(n),r=ba(s);return ma(e,n),pa(e,e,o,r),s.x=e[0],s.y=e[1],t}}(),Sa=function(){const e=Object(S.h)();return function(t,i,n,s,o){o||(o="center"),Object(V.a)(e,n,s),Object(V.i)(e,e,.5);const r=e[0],a=e[1];switch(o){case"center":Object(V.m)(e,0,0);break;case"left":Object(V.m)(e,-r,0);break;case"top":Object(V.m)(e,0,a);break;case"right":Object(V.m)(e,r,0);break;case"bottom":Object(V.m)(e,0,-a);break;case"top-left":Object(V.m)(e,-r,a);break;case"bottom-left":Object(V.m)(e,-r,-a);break;case"top-right":Object(V.m)(e,r,a);break;case"bottom-right":Object(V.m)(e,r,-a)}return Ha(t,i,e),t}}();function Va(e,t,i){return _a(e,t),e.rotation+=i,e}const Da=function(){const e=Object(S.h)();return function(t,i,n,s,o){return _a(t,i),isNaN(n)||0===n||(za(e,s,i,o),t.scale=i.scale*n,Ba(e,e,t,o),Ha(t,t,Object(V.m)(e,e[0]-s[0],s[1]-e[1]))),t}}();function La(e,t,i){return _a(e,t),e.scale=i,e}const Ra=function(){const e=Object(S.h)();return function(t,i,n,s,o,r){return _a(t,i),isNaN(n)||0===n||(za(e,o,i,r),t.scale=i.scale*n,t.rotation+=s,Ba(e,e,t,r),Ha(t,t,Object(V.m)(e,e[0]-o[0],o[1]-e[1]))),t}}(),Na=function(){const e=Object(S.h)(),t=Object(S.h)();return function(i,n,s,o,r,a,l){return ja(t,a,l),Object(V.n)(e,r,t),o?Ra(i,n,s,o,e,a):Da(i,n,s,e,a)}}(),za=function(){const e=[1,0,0,1,0,0];return function(t,i,n,s){return Object(V.b)(t,i,function(e,t,i,n){return Pa(e,t,i,n),Object(D.m)(e,e)}(e,n,s,1))}}(),Ba=function(){const e=[1,0,0,1,0,0];return function(t,i,n,s){return Object(V.b)(t,i,Pa(e,n,s,1))}}(),Ha=function(){const e=Object(S.h)(),t=[1,0,0,1,0,0];return function(i,n,s){_a(i,n);const o=Ia(n),r=i.targetGeometry;return Object(D.h)(t,Ca(n)),Object(D.f)(t,t,Object(S.k)(o,o)),Object(V.b)(e,s,t),r.x+=e[0],r.y+=e[1],i}}();class Ua{constructor(e,t,i,n){const s=e.targetGeometry,o=t.targetGeometry;n?"string"==typeof n&&(n=Object(L.b)(n)||L.c.ease):n=L.c.ease,this.easing=n,this.duration=i,this.sCenterX=s.x,this.sCenterY=s.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=t.scale,this.tRotation=t.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(e,t){const i=this.easing(t);let n,s,o,r;t>=1?(n=this.tCenterX,s=this.tCenterY,o=this.tRotation,r=this.tScale):(n=this.sCenterX+i*this.dCenterX,s=this.sCenterY+i*this.dCenterY,o=this.sRotation+i*this.dRotation,r=this.sScale+i*this.dScale),e.targetGeometry.x=n,e.targetGeometry.y=s,e.scale=r,e.rotation=o}}let Ga=class extends s.u{constructor(e){super(e),this.duration=200,this.transition=null,this.easing=L.c.ease,this.view=null,this.viewpoint=null,this.viewpoint=new tr({targetGeometry:new s._,scale:0,rotation:0}),this._updateTask=Object(s.a0)({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask.remove(),this._updateTask=null}animate(e,t,i){this.stop();_a(this.viewpoint,t),this.transition=new Ua(this.viewpoint,e.target,i&&i.duration||this.duration,i&&i.easing||this.easing);const n=()=>{this.animation===e&&this._updateTask&&("finished"===e.state&&(this.transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;const i=new ca({target:e.clone()}),n=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){const t=this.animation;if(t&&t.state!==ca.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{const e=(performance.now()-this._startTime)/this.transition.duration,t=e>=1;this.transition.applyRatio(this.viewpoint,e),t&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};Object(s.e)([Object(s.y)()],Ga.prototype,"animation",void 0),Object(s.e)([Object(s.y)()],Ga.prototype,"duration",void 0),Object(s.e)([Object(s.y)()],Ga.prototype,"transition",void 0),Object(s.e)([Object(s.y)()],Ga.prototype,"easing",void 0),Object(s.e)([Object(s.y)()],Ga.prototype,"view",void 0),Object(s.e)([Object(s.y)()],Ga.prototype,"viewpoint",void 0),Ga=Object(s.e)([Object(s.i)("esri.views.2d.AnimationManager")],Ga);var qa=Ga;class $a{constructor(e){this.view=e,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.updateEnabled=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions},this.update=()=>{if(this._updateRequested=!1,!this.updateEnabled)return;const{basemapView:e,graphicsView:t,labelManager:i,layerViews:n,state:{id:o}}=this.view;e.baseLayerViews.forEach(this._updateLayerView,this),n.forEach(this._updateLayerView,this),e.referenceLayerViews.forEach(this._updateLayerView,this),Object(s.P)(i)&&(i.lastUpdateId!==o&&(i.viewChange(),i.lastUpdateId=o),i.updateRequested&&i.processUpdate(this._updateParameters)),Object(s.P)(t)&&(t.lastUpdateId!==o&&(t.viewChange(),t.lastUpdateId=o),t.updateRequested&&t.processUpdate(this._updateParameters)),this.animationInProgress||this._updateRequested||this._frameTaskHandle.pause()}}destroy(){this.stop()}start(){this.stationary=this.view.stationary,this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions},this._stationaryHandle=this.view.watch("stationary",(e=>{this.stationary=e,this.requestFrame()})),this._frameTaskHandle=Object(s.a0)(this)}stop(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){const t=this.view.state,i=e.lastUpdateId;null!=i&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),i!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}}function Wa(){return Promise.all([Promise.all([i.e(0),i.e(19)]).then(i.bind(null,173)),Promise.all([i.e(2),i.e(3),i.e(4),i.e(11),i.e(12)]).then(i.bind(null,174))])}const Ka=()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(85)]).then(i.bind(null,277)))),Za=()=>Wa().then((()=>Promise.all([i.e(3),i.e(0)]).then(i.bind(null,224)))),Ja={"base-dynamic":()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(29)]).then(i.bind(null,278)))),"base-tile":Ka,"bing-maps":Ka,csv:Za,"geo-rss":()=>Wa().then((()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(47)]).then(i.bind(null,279)))),feature:Za,geojson:Za,graphics:()=>Wa().then((()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(48)]).then(i.bind(null,280)))),group:()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(49)]).then(i.bind(null,281)))),imagery:()=>Wa().then((()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(54)]).then(i.bind(null,282)))),"imagery-tile":()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(15)]).then(i.bind(null,175)))),kml:()=>Wa().then((()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(58)]).then(i.bind(null,283)))),"map-image":()=>Wa().then((()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(60)]).then(i.bind(null,284)))),"map-notes":()=>Wa().then((()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(62)]).then(i.bind(null,285)))),"ogc-feature":()=>Wa().then((()=>Promise.all([i.e(3),i.e(0),i.e(64)]).then(i.bind(null,286)))),"open-street-map":Ka,route:()=>Wa().then((()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(75)]).then(i.bind(null,287)))),stream:()=>Wa().then((()=>Promise.all([i.e(3),i.e(0),i.e(81)]).then(i.bind(null,288)))),tile:Ka,"vector-tile":()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(89)]).then(i.bind(null,289)))),wcs:()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(15)]).then(i.bind(null,175)))),"web-tile":Ka,wms:()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(91)]).then(i.bind(null,290)))),wmts:()=>Wa().then((()=>Promise.all([i.e(2),i.e(0),i.e(93)]).then(i.bind(null,291)))),"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,scene:null,unknown:null,unsupported:null};const Ya=e=>Object(s.P)(Ja[e.type]),Xa=e=>{const t=Ja[e.type];if(!Object(s.P)(t))throw function(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new s.s(`${i}:view-not-supported`,`${t} is not supported in 2D`)}(e);return t(e)};var Qa;const el=s.n.getLogger("esri.views.MapView");let tl=Qa=class extends s.u{constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){return this.geometry&&this.spatialReference?this.spatialReference.equals(this.geometry.spatialReference)?this.geometry:Object(s.ah)(this.geometry,this.spatialReference)?Object(s.ai)(this.geometry,this.spatialReference):Object(R.e)()?Object(R.b)(this.geometry,this.spatialReference):(el.error("#constraints.geometry","unsupported coordinate system. The source geometry cannot be projected to the view's coordinate system. The projection engine cannot be loaded.",{geometry:this.geometry}),null):null}constrain(e,t){if(!this.normalizedGeometry)return e;const i=e.targetGeometry;if("extent"===this.normalizedGeometry.type?Object(s.as)(this.normalizedGeometry,i):Object(s.at)(this.normalizedGeometry,i))return e;const{coordinate:n}=function(e,t){const{spatialReference:i}=t,n=[t.x,t.y];let o=Number.POSITIVE_INFINITY,r=0,a=0;const l=[0,0],c="extent"===e.type?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:e.rings;for(const e of c)for(let t=0;t<e.length-1;t++){Object(s.ar)(l,n,e,t);const i=Object(V.f)(n,l);i<o&&(o=i,r=l[0],a=l[1])}return{coordinate:new s._({x:r,y:a,spatialReference:i}),distance:o}}(this.normalizedGeometry,i);return n?(e.targetGeometry=n,e):e}clone(){var e,t;return new Qa({geometry:null==(e=this.geometry)?void 0:e.clone(),spatialReference:null==(t=this.spatialReference)?void 0:t.clone()})}};var il;Object(s.e)([Object(s.y)({constructOnly:!0})],tl.prototype,"geometry",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],tl.prototype,"normalizedGeometry",null),Object(s.e)([Object(s.y)({constructOnly:!0})],tl.prototype,"spatialReference",void 0),tl=Qa=Object(s.e)([Object(s.i)("esri.views.2d.constraints.GeometryConstraint")],tl);let nl=il=class extends s.u{constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t?(this.rotationEnabled||(e.rotation=t.rotation),e):e}clone(){return new il({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};Object(s.e)([Object(s.y)()],nl.prototype,"enabled",void 0),Object(s.e)([Object(s.y)()],nl.prototype,"rotationEnabled",void 0),nl=il=Object(s.e)([Object(s.i)("esri.views.2d.constraints.RotationConstraint")],nl);var sl,ol=nl;let rl=sl=class extends s.u{constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:n,minZoom:s,maxZoom:o}=this,r=-1,a=-1,l=!1,c=!1;if(0!==i&&0!==n&&i<n&&([i,n]=[n,i]),!t||!t.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",n);t=t.map((e=>e.clone())),t.sort(((e,t)=>t.scale-e.scale)),t.forEach(((e,t)=>e.level=t));for(const s of t)!l&&i>0&&i>=s.scale&&(r=s.level,l=!0),!c&&n>0&&n>=s.scale&&(a=e?e.level:-1,c=!0),e=s;-1===s&&(s=0===i?0:r),-1===o&&(o=0===n?t.length-1:a),s=Math.max(s,0),s=Math.min(s,t.length-1),o=Math.max(o,0),o=Math.min(o,t.length-1),s>o&&([s,o]=[o,s]),i=t[s].scale,n=t[o].scale,t.splice(0,s),t.splice(o-s+1,t.length),t.forEach(((e,t)=>{this._lodByScale[e.scale]=e,this._scales[t]=e.scale})),this._set("effectiveLODs",t),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",o),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",n)}constrain(e,t){if(t&&e.scale===t.scale)return e;const i=this.effectiveMinScale,n=this.effectiveMaxScale,s=e.targetGeometry,o=t&&t.targetGeometry,r=0!==n&&e.scale<n,a=0!==i&&e.scale>i;if(r||a){const r=a?i:n;if(o){const i=(r-t.scale)/(e.scale-t.scale);s.x=o.x+(s.x-o.x)*i,s.y=o.y+(s.y-o.y)*i}e.scale=r}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);const t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);const t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];const i=Math.round(e-.5),n=Math.round(e);return t[n]+(n-e)*(t[i]-t[n])}scaleToZoom(e){if(!this.effectiveLODs)return-1;const t=this._scales;let i,n;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let s=0;s<t.length-1;s++){if(i=t[s],n=t[s+1],n===e)return s+this.effectiveMinZoom+1;if(i>e&&n<e)return s+this.effectiveMinZoom+1-(e-n)/(i-n)}}snapToClosestScale(e){if(!this.effectiveLODs)return e;const t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new sl({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce(((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t),this._scales[0])),this._lodByScale[e].scale}};Object(s.e)([Object(s.y)({readOnly:!0})],rl.prototype,"effectiveLODs",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],rl.prototype,"effectiveMinZoom",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],rl.prototype,"effectiveMaxZoom",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],rl.prototype,"effectiveMinScale",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],rl.prototype,"effectiveMaxScale",void 0),Object(s.e)([Object(s.y)({type:[x.a]})],rl.prototype,"lods",void 0),Object(s.e)([Object(s.y)()],rl.prototype,"minZoom",void 0),Object(s.e)([Object(s.y)()],rl.prototype,"maxZoom",void 0),Object(s.e)([Object(s.y)()],rl.prototype,"minScale",void 0),Object(s.e)([Object(s.y)()],rl.prototype,"maxScale",void 0),Object(s.e)([Object(s.y)()],rl.prototype,"snapToZoom",void 0),rl=sl=Object(s.e)([Object(s.i)("esri.views.2d.constraints.ZoomConstraint")],rl);var al=rl;const ll={base:null,key:"type",typeMap:{extent:s.M,polygon:s.au}};let cl=class extends s.m.EventedAccessor{constructor(){super(...arguments),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}initialize(){this.watch(["_zoom","_rotation"],this.emit.bind(this,"update"),!0)}destroy(){this.view=null,this._set("_zoom",null),this._set("_rotation",null)}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get _defaultLODs(){const e=this.get("view.defaultsFromMap.tileInfo"),t=this.get("view.spatialReference");return e&&t&&e.spatialReference.equals(t)?e.lods:null}get _geometry(){return new tl({geometry:this.geometry,spatialReference:this.view.spatialReference})}get _rotation(){return new ol({rotationEnabled:this.rotationEnabled})}get _zoom(){return new al({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})}canZoomInTo(e){const t=this.effectiveMaxScale;return 0===t||e>=t}canZoomOutTo(e){const t=this.effectiveMinScale;return 0===t||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),e}constrainByGeometry(e){return this._geometry.constrain(e)}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};Object(s.e)([Object(s.y)({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],cl.prototype,"effectiveLODs",void 0),Object(s.e)([Object(s.y)({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],cl.prototype,"effectiveMinScale",void 0),Object(s.e)([Object(s.y)({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],cl.prototype,"effectiveMaxScale",void 0),Object(s.e)([Object(s.y)({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],cl.prototype,"effectiveMinZoom",void 0),Object(s.e)([Object(s.y)({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],cl.prototype,"effectiveMaxZoom",void 0),Object(s.e)([Object(s.y)({types:ll,value:null})],cl.prototype,"geometry",null),Object(s.e)([Object(s.y)({type:[x.a]})],cl.prototype,"lods",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"minScale",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"maxScale",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"minZoom",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"maxZoom",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"rotationEnabled",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"snapToZoom",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"view",void 0),Object(s.e)([Object(s.y)()],cl.prototype,"_defaultLODs",null),Object(s.e)([Object(s.y)({type:tl})],cl.prototype,"_geometry",null),Object(s.e)([Object(s.y)({type:ol})],cl.prototype,"_rotation",null),Object(s.e)([Object(s.y)({readOnly:!0,type:al})],cl.prototype,"_zoom",null),cl=Object(s.e)([Object(s.i)("esri.views.2d.MapViewConstraints")],cl);var hl,dl=cl;function ul(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function pl(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function bl(e){return function(e){return e instanceof Float32Array&&e.length>=2}(e)||function(e){return Array.isArray(e)&&e.length>=2}(e)}Object.freeze({__proto__:null,create:ul,clone:pl,fromValues:function(e,t,i,n,s,o,r,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=n,c[4]=s,c[5]=o,c[6]=r,c[7]=a,c[8]=l,c},createView:function(e,t){return new Float32Array(e,t,9)}});const ml=[0,0];let gl=hl=class extends s.a{constructor(...e){super(...e),this._viewpoint2D={center:Object(S.h)(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new s.M,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=ul(),this.displayViewMat3=ul(),this.viewMat3=ul(),this.viewMat2d=Object(D.b)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=_a(i,e.viewpoint),this._set("size",Object(V.d)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new hl({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return bl(t)?Object(V.b)(e,t,this.inverseTransform):(ml[0]=t,ml[1]=i,Object(V.b)(e,ml,this.inverseTransform))}toScreen(e,t,i){return bl(t)?Object(V.b)(e,t,this.transform):(ml[0]=t,ml[1]=i,Object(V.b)(e,ml,this.transform))}toScreenNoRotation(e,t,i){return bl(t)?Object(V.b)(e,t,this.transformNoRotation):(ml[0]=t,ml[1]=i,Object(V.b)(e,ml,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size");return xa(e,i,s,t,0,n),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:n}=this._viewpoint2D,o=this._get("pixelRatio")||1,r=this._get("size"),a=new tr({targetGeometry:new s._(e[0],e[1],t),scale:i,rotation:n});if(this._set("viewpoint",a),!r||!t||!i)return;this.resolution=Ia(a),this.rotation=n,this.scale=i,this.spatialReference=t,Object(V.d)(this.center,e);const l=0!==r[0]?2/r[0]:0,c=0!==r[1]?-2/r[1]:0;Object(S.j)(this.displayMat3,l,0,0,0,c,0,-1,1,1);const h=Object(S.i)(this.viewMat3),d=Object(D.n)(r[0]/2,r[1]/2),u=Object(D.n)(-r[0]/2,-r[1]/2),p=Object(F.q)(n);Object(S.a)(h,h,d),Object(S.e)(h,h,p),Object(S.a)(h,h,u),Object(S.f)(this.displayViewMat3,this.displayMat3,h);const b=Object(D.j)(this.viewMat2d);return Object(D.i)(b,b,d),Object(D.d)(b,b,p),Object(D.i)(b,b,u),Oa(this.extent,a,r),Pa(this.transform,a,r,o),Object(D.m)(this.inverseTransform,this.transform),Ta(this.transformNoRotation,a,r,o),this.worldScreenWidth=function(e,t){return Math.round(ka(e)/t)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};Object(s.e)([Object(s.y)({readOnly:!0})],gl.prototype,"id",void 0),Object(s.e)([Object(s.y)({value:1,json:{write:!0}})],gl.prototype,"pixelRatio",null),Object(s.e)([Object(s.y)({json:{write:!0}})],gl.prototype,"size",null),Object(s.e)([Object(s.y)({type:tr,json:{write:!0}})],gl.prototype,"viewpoint",null),gl=hl=Object(s.e)([Object(s.i)("esri.views.2d.ViewState")],gl);var fl=gl;let yl=class extends s.u{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}};Object(s.e)([Object(s.y)()],yl.prototype,"left",void 0),Object(s.e)([Object(s.y)()],yl.prototype,"top",void 0),Object(s.e)([Object(s.y)()],yl.prototype,"right",void 0),Object(s.e)([Object(s.y)()],yl.prototype,"bottom",void 0),yl=Object(s.e)([Object(s.i)("esri.views.2d.PaddedViewState.Padding")],yl);let vl=class extends fl{constructor(...e){super(...e),this.paddedViewState=new fl,this._updateContent=(()=>{const e=Object(S.h)();return()=>{const t=this._get("size"),i=this._get("padding");if(!t||!i)return;const n=this.paddedViewState;Object(V.m)(e,i.left+i.right,i.top+i.bottom),Object(V.j)(e,t,e),Object(V.d)(n.size,e);const s=n.viewpoint;s&&(this.viewpoint=s)}})(),this.watch(["size","padding"],this._updateContent,!0),this.padding=new yl,this.size=[0,0]}set padding(e){this._set("padding",e||new yl)}set viewpoint(e){if(e){const t=e.clone();this.paddedViewState.viewpoint=e,Aa(t,e,this._get("size"),this._get("padding"));const i=this._viewpoint2D,n=t.targetGeometry;i.center[0]=n.x,i.center[1]=n.y,i.rotation=t.rotation,i.scale=t.scale,i.spatialReference=n.spatialReference,this._update()}}};Object(s.e)([Object(s.y)()],vl.prototype,"paddedViewState",void 0),Object(s.e)([Object(s.y)({type:yl})],vl.prototype,"padding",null),Object(s.e)([Object(s.y)()],vl.prototype,"viewpoint",null),vl=Object(s.e)([Object(s.i)("esri.views.2d.PaddedViewState")],vl);var _l=vl;class wl{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),(e=>-1!==e.indexOf("Brush"))(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}}const Ol=s.n.getLogger("esri.views.MapView");let jl=class extends(ir(aa)){constructor(e){super(e),this._stationaryTimer=null,this.frameTask=new $a(this),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.initialExtent=null,this.labelManager=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.resizeAlign="center",this.supportsGround=!1,this.timeline=new wl,this.type="2d",this.constraints=new dl,this.padding={top:0,right:0,bottom:0,left:0};const t=this.handles,i=()=>this.notifyChange("updating");t.add([this.watch("viewpoint",(()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(160)}),!0),this.on("resize",(e=>this._resizeHandler(e))),this.watch("animationManager.animation",(e=>{this.animation=e})),this.allLayerViews.on("change",(()=>{i(),t.remove("map-view-base-layerViewsUpdating"),t.add(this.allLayerViews.map((e=>e.watch("updating",i))),"map-view-base-layerViewsUpdating")}))],"map-view-base")}destroy(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)}set animation(e){const t=this._get("animation");if(e===t)return;if(t&&t.stop(),!e||e.isFulfilled())return void this._set("animation",null);this._set("animation",e),this.frameTask.animationInProgress=!0;const i=()=>{e===this._get("animation")&&(this._set("animation",null),this.frameTask.requestFrame()),this.frameTask.animationInProgress=!1};e.when(i,i)}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:t}=this.state.paddedViewState;return new s._({x:e[0],y:e[1],spatialReference:t})}set center(e){if(null==e)return;if(!this._normalizeInput(e))return void Ol.error("#center",`incompatible spatialReference ${JSON.stringify(e.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");const t=this.viewpoint;Fa(t,t,e),this.viewpoint=t}set constraints(e){const t=this._get("constraints");t&&(this.handles.remove("map-view-base-constraints"),t.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add(e.on("update",(()=>{this.ready&&this.state&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint))})),"map-view-base-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(e){if(null==e)return;const t=this._normalizeInput(e);if(!t)return void Ol.error("#center",`incompatible spatialReference ${JSON.stringify(e.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!t.width||!t.height)return void Ol.error("#extent","invalid extent size");if(!this.ready)return this._set("extent",t),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");const i=this.viewpoint;(function(e,t,i,n,s){Fa(e,t,i.center),e.scale=fa(i,n),s&&s.constraints&&s.constraints.constrain(e)})(i,i,t,this.size,{constraints:this.constraints}),this.viewpoint=i}get initialExtentRequired(){const{extent:e,center:t,scale:i,viewpoint:n,zoom:s}=this;return!(this.get("map.initialViewProperties.viewpoint")||e||t&&(0!==i||-1!==s)||n)}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const t=this.viewpoint;(function(e,t,i){_a(e,t),e.rotation=i})(t,t,e),this.viewpoint=t}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",-1);const t=this._get("extent");return t&&(this._set("extent",null),this._set("center",t.center)),void this.notifyChange("initialExtentRequired")}const t=this.viewpoint;La(t,t,e),this.viewpoint=t}get stationary(){return!(this.animation||this.navigating||this._get("resizing")||this._stationaryTimer)}get updating(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||!0===this.get("graphicsView.updating")||this.allLayerViews.some((e=>!e.destroyed&&!("layerViews"in e)&&!0===e.updating)))}get viewpoint(){if(!this.ready)return this._get("viewpoint");const e=this.state.paddedViewState;return e&&e.viewpoint.clone()}set viewpoint(e){if(null==e)return;const t=this._normalizeInput(e);if(!t)return void(!e.scale||isNaN(e.scale)?Ol.error("#viewpoint",`invalid scale value of ${e.scale}`):Object(s.J)(e.targetGeometry)?Ol.error("#viewpoint","geometry not defined"):Ol.error("#viewpoint",`incompatible spatialReference ${JSON.stringify(e.targetGeometry.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`));if(!this.ready)return this._set("viewpoint",t),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");const i=new tr({targetGeometry:new s._,scale:0,rotation:0});_a(i,t),this.constraints.constrain(i,this.state.paddedViewState.viewpoint),this.state.viewpoint=i,this.frameTask.requestFrame(),this._set("viewpoint",i)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(e){if(null==e)return;if(!this.ready){this.notifyChange("initialExtentRequired"),this._set("zoom",e),this._set("scale",0);const t=this._get("extent");t&&(this._set("extent",null),this._set("center",t.center))}if(!this.constraints.effectiveLODs)return;const t=this.viewpoint;La(t,t,this.constraints.zoomToScale(e)),this.viewpoint=t,this._set("zoom",this.constraints.scaleToZoom(this.scale))}goTo(e,t){if(e)return this.animation&&(this.animation=null),this._createAnimation(),Object(l.l)(this,"ready",t&&t.signal).then((()=>{const i={animate:!0,...t},n=function(e,t){return va(e,t)}(e,this);return this.animation.update(n),this._gotoTask={},i.animate?this._gotoAnimated(n,i):this._gotoImmediate(n,i)}));Ol.error("#goTo()","target cannot be null or undefined")}hitTest(e){return Promise.reject("Should be implemented by subclasses")}popupHitTest(e){return this.hitTest(e).then((t=>({...t,mapPoint:this.toMap(e)})))}toMap(e){if(!this.ready)return null;const[t,i]=this.state.toMap([0,0],[e.x,e.y]),n=this.spatialReference;return new s._({x:t,y:i,spatialReference:n})}isTileInfoRequired(){return!0}toScreen(e){if(!this.ready)return null;const t=this._normalizeInput(e),i=[t.x,t.y];return this.state.toScreen(i,i),Object(w.j)(i[0],i[1])}pixelSizeAt(){return this.ready?this.state.resolution:(Ol.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}getDefaultSpatialReference(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||null}isSpatialReferenceSupported(e,t){return!(!t&&!this._get("ready"))||null!==this._getDefaultViewpoint()}importLayerView(e){return Xa(e)}hasLayerViewModule(e){return Ya(e)}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new ca),this.animation}_cancellableGoTo(e,t,i){const n=()=>e===this._gotoTask,s=i.then((()=>{n()&&(this.animation=null)})).catch((e=>{throw n()&&(this.animation=null,t.done||(t.stop(),this.frameTask.animationInProgress=!1)),e})),o=new Promise((e=>e(s)));return t.when().catch((()=>{n()&&o.cancel&&o.cancel()})),o}_gotoImmediate(e,t){const i=this._gotoTask,n=this.animation,o=e.then((e=>{if(Object(s.h)(t),i!==this._gotoTask)throw new s.s("view:goto-interrupted","Goto was interrupted");this.viewpoint=n.target=e,n.finish()}));return this._cancellableGoTo(i,n,o)}_gotoAnimated(e,t){const i=this._gotoTask,n=this.animation,o=e.then((e=>{if(Object(s.h)(t),i!==this._gotoTask)throw new s.s("view:goto-interrupted","Goto was interrupted");return n.update(e),this.animationManager.animate(n,this.viewpoint,t),n.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(i,n,o)}_resizeHandler(e){const t=this.state;if(!t)return;let i=this.state.paddedViewState.viewpoint;const n=this.state.paddedViewState.size.concat();t.size=[e.width,e.height],Sa(i,i,n,this.state.paddedViewState.size,this.resizeAlign),i=this.constraints.constrain(i,null),this.state.viewpoint=i}_startup(){const e=this._getDefaultViewpoint();this.constraints.view=this,this.constraints.fit(e),this._set("animationManager",new qa({view:this})),this._set("state",new _l({padding:this._get("padding"),size:this.size,viewpoint:e})),this._set("featuresTilingScheme",new M.b(x.b.create({spatialReference:this.spatialReference,size:512}))),this._set("ready",!0),this.frameTask&&this.frameTask.start()}_teardown(){this.frameTask&&this.frameTask.stop(),this._set("ready",!1),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);const{center:[e,t],spatialReference:i,rotation:n,scale:o}=this.state.paddedViewState,r=new s._({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",r),this._set("zoom",-1),this._set("rotation",n),this._set("scale",o),this._set("spatialReference",i),this.constraints.view=null,this.animationManager.destroy(),this._set("animationManager",null),this._set("state",null),this.animation=null}_flipStationary(e){return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((()=>{this._stationaryTimer=null;const e=performance.now()-this._lastStationaryEventTimestamp;e<160&&(this._stationaryTimer=this._flipStationary(e))}),e)),this._stationaryTimer}_normalizeInput(e,t=this.spatialReference){const i=e&&e.targetGeometry||e;return t?i?t.equals(i.spatialReference)?e:Object(s.ah)(i,t)?function(e){return e&&"esri.Viewpoint"===e.declaredClass}(e)?(e.targetGeometry=Object(s.ai)(i,t),e):Object(s.ai)(i,t):null:null:e}_getDefaultViewpoint(){const e=this.constraints,t={zoom:this._get("zoom"),scale:this._get("scale"),center:this._normalizeInput(this._get("center")),extent:this._normalizeInput(this._get("extent")),rotation:this._get("rotation"),viewpoint:this._normalizeInput(this._get("viewpoint")),spatialReference:this._userSpatialReference};e.effectiveLODs?-1!==t.zoom&&(t.scale=e.zoomToScale(t.zoom)):t.zoom=-1;let i=null,n=null,o=0;const r=t.viewpoint&&t.viewpoint.rotation,a=t.viewpoint&&t.viewpoint.targetGeometry;Object(s.P)(a)&&("extent"===a.type?i=a:"point"===a.type&&(n=a,o=t.viewpoint.scale));const l=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent")),c=this._normalizeInput(this.initialExtent),h=t.extent||i||l||c,d=t.center||n||h&&h.center,u=this.get("map.initialViewProperties.viewpoint.scale"),p=t.scale||o||u||h&&fa(h,this.size),b=this.get("map.initialViewProperties.viewpoint.rotation"),m=t.rotation||r||b||0;return d&&p?new tr({targetGeometry:d,scale:p,rotation:m}):null}};Object(s.e)([Object(s.y)()],jl.prototype,"_stationaryTimer",void 0),Object(s.e)([Object(s.y)()],jl.prototype,"animation",null),Object(s.e)([Object(s.y)({readOnly:!0})],jl.prototype,"animationManager",void 0),Object(s.e)([Object(s.y)({value:null,type:s._,dependsOn:["state.id","ready"]})],jl.prototype,"center",null),Object(s.e)([Object(s.y)({type:dl})],jl.prototype,"constraints",null),Object(s.e)([Object(s.y)({value:null,type:s.M,dependsOn:["state.id","ready"]})],jl.prototype,"extent",null),Object(s.e)([Object(s.y)({readOnly:!0})],jl.prototype,"featuresTilingScheme",void 0),Object(s.e)([Object(s.y)()],jl.prototype,"fullOpacity",void 0),Object(s.e)([Object(s.y)()],jl.prototype,"graphicsView",void 0),Object(s.e)([Object(s.y)({type:s.M})],jl.prototype,"initialExtent",void 0),Object(s.e)([Object(s.y)({dependsOn:["map.initialViewProperties?.viewpoint"]})],jl.prototype,"initialExtentRequired",null),Object(s.e)([Object(s.y)()],jl.prototype,"labelManager",void 0),Object(s.e)([Object(s.y)({value:{top:0,right:0,bottom:0,left:0},cast:e=>({top:0,right:0,bottom:0,left:0,...e})})],jl.prototype,"padding",null),Object(s.e)([Object(s.y)({type:Object})],jl.prototype,"renderingOptions",void 0),Object(s.e)([Object(s.y)()],jl.prototype,"resizeAlign",void 0),Object(s.e)([Object(s.y)({readOnly:!0,dependsOn:["state.id"]})],jl.prototype,"resolution",null),Object(s.e)([Object(s.y)({value:0,type:Number,dependsOn:["state.id","ready"]})],jl.prototype,"rotation",null),Object(s.e)([Object(s.y)({value:0,type:Number,dependsOn:["state.id","ready"]})],jl.prototype,"scale",null),Object(s.e)([Object(s.y)({type:s.A,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],jl.prototype,"spatialReference",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],jl.prototype,"state",void 0),Object(s.e)([Object(s.y)({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],jl.prototype,"stationary",null),Object(s.e)([Object(s.y)({readOnly:!0})],jl.prototype,"supportsGround",void 0),Object(s.e)([Object(s.y)({type:wl,readOnly:!0})],jl.prototype,"timeline",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],jl.prototype,"type",void 0),Object(s.e)([Object(s.y)({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],jl.prototype,"updating",null),Object(s.e)([Object(s.y)({value:null,type:tr,dependsOn:["state.id","ready"]})],jl.prototype,"viewpoint",null),Object(s.e)([Object(s.y)({value:-1,dependsOn:["state.id"]})],jl.prototype,"zoom",null),jl=Object(s.e)([Object(s.i)("esri.views.MapViewBase")],jl);var Ml=jl;function Il(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}class Cl extends Ln{constructor(e,t){super(!0),this.view=e,this.registerIncoming("double-click",t,(e=>this._handleDoubleClick(e,t)))}_handleDoubleClick(e,t){Il(e.data,"primary")&&(e.stopPropagation(),t?this.view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this.view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}}class xl extends Ln{constructor(e,t,i){super(!0),this.view=e,this.pointerType=t,this.registerIncoming("double-tap-drag",i,(e=>this._handleDoubleTapDrag(e)))}_handleDoubleTapDrag(e){const{data:t}=e,{pointerType:i}=t;if(i!==this.pointerType)return;e.stopPropagation();const{action:n,delta:s}=t,{view:o}=this,{mapViewNavigation:r}=o;switch(n){case"begin":{const{scale:e}=o;this._startScale=e,this._currentScale=e,this._previousDelta=s,r.begin();break}case"update":{if(this._previousDelta.y===s.y)return;this._previousDelta=s;const e=1.015**s.y,t=this._startScale*e,i=t/this._currentScale;r.setViewpointImmediate(i),this._currentScale=t;break}case"end":{const{constraints:e}=o,{effectiveLODs:t,snapToZoom:i}=e;if(!i||!t)return void r.end();const n=e.snapScale(this._currentScale),a=(s.y>0?Math.max(n,e.snapToPreviousScale(this._startScale)):Math.min(n,e.snapToNextScale(this._startScale)))/this._currentScale;r.zoom(a);break}}}}class Pl{constructor(e){this.callbacks=e,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(e){const t=e.data,i=t.pointers.size;switch(t.action){case"start":this.currentCount=i,this.emitStart(e);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(e);break;case"update":this.emitUpdate(e);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(e);break;case"end":this.emitEnd(e),this.currentCount=0}this.previousEvent=e}emitStart(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)}emitUpdate(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)}emitEnd(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null}}class Tl extends Ln{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t,this.registerIncoming("drag",i,(e=>this._handleDrag(e))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const n=this.view.mapViewNavigation;this.dragEventSeparator=new Pl({start:(e,t)=>{n.pan.begin(this.view,t.data),t.stopPropagation()},update:(e,t)=>{n.pan.update(this.view,t.data),t.stopPropagation()},end:(e,t)=>{n.pan.end(this.view,t.data),t.stopPropagation()},condition:(e,t)=>1===e&&Il(t.data,this.pointerAction)})}_handleDrag(e){const t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}class kl extends Ln{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t;const n=this.view.mapViewNavigation;this.dragEventSeparator=new Pl({start:(e,t)=>{n.rotate.begin(this.view,t.data),t.stopPropagation()},update:(e,t)=>{n.rotate.update(this.view,t.data),t.stopPropagation()},end:(e,t)=>{n.rotate.end(),t.stopPropagation()},condition:(e,t)=>1===e&&Il(t.data,this.pointerAction)}),this.registerIncoming("drag",i,(e=>this.dragEventSeparator.handle(e)))}}function El(e){let t=e*e;return e<0&&(t*=-1),t}class Al extends Ln{constructor(e){super(!0),this.view=e,this.frameTask=null,this.watchHandles=new s.w,this.currentDevice=null,this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.handle=this.registerIncoming("gamepad",(e=>this.handleEvent(e))),this.handle.pause()}onInstall(e){super.onInstall(e),this.watchHandles.add([Object(l.g)(this.view.navigation.gamepad,"enabled",(e=>{e?(this.handle.resume(),this.frameTask||(this.frameTask=Object(s.a0)({update:e=>this.frameUpdate(e.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null))}))])}onUninstall(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),super.onUninstall()}handleEvent(e){const t=this.view.navigation.gamepad.device;t&&e.data.device!==t||this.currentDevice&&this.currentDevice!==e.data.device||("end"===e.data.action?(this.currentDevice=null,function(e){e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0}(this.transformation)):(this.currentDevice=e.data.device,function(e,t,i){const n=i,s=e.state,o=e.device,r="forward-down"===t.tiltDirection?1:-1;"standard"===o.deviceType?(n.translation[0]=El(s.axes[0]),n.translation[1]=El(s.axes[1]),n.translation[2]=El(s.buttons[7])-El(s.buttons[6]),n.heading=El(s.axes[2]),n.tilt=El(s.axes[3])):"spacemouse"===o.deviceType&&(n.translation[0]=1.2*El(s.axes[0]),n.translation[1]=1.2*El(s.axes[1]),n.translation[2]=2*-El(s.axes[2]),n.heading=1.2*El(s.axes[5]),n.tilt=1.2*El(s.axes[3])),n.tilt*=r,Object(F.j)(n.translation,n.translation,1)}(e.data,this.view.navigation.gamepad,this.transformation)))}frameUpdate(e){const t=this.transformation;if(function(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}(t))return;const i=this.view.viewpoint.clone(),n=this.view.navigation.gamepad.velocityFactor,s=Sl*n*e;Ha(i,i,[t.translation[0]*s,-t.translation[1]*s]);const o=1+t.translation[2]*Vl*e,r=this.view.constraints.rotationEnabled?-t.heading*Fl*e:0,a=this.view.size,l=[a[0]/2,a[1]];Ra(i,i,o,r,l,a);const c=this.view.constraints.constrain(i,this.view.viewpoint);this.view.viewpoint=c}}const Fl=.06,Sl=.7,Vl=6e-4;class Dl extends Ln{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._pressed=!1,this._keyMap={[t.left]:"left",[t.right]:"right",[t.up]:"up",[t.down]:"down"},this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",i,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",i,(()=>this._handleBlur()))}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,t){const i=this._keyMap[e.data.key];if(this._pressed=null!=i,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),i){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}class Ll extends Ln{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._pressed=!1,this._keyToDirection={[t.clockwiseOption1]:"clockwise",[t.clockwiseOption2]:"clockwise",[t.counterClockwiseOption1]:"counterClockwise",[t.counterClockwiseOption2]:"counterClockwise",[t.resetOption1]:"reset",[t.resetOption2]:"reset"},this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",i,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",i,(()=>this._handleBlur()))}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,t){const i=e.modifiers;if(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)return;const n=this._keyToDirection[e.data.key];if(this._pressed=null!=n,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}class Rl extends Ln{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._keysToZoomAction={},this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),t.zoomIn.forEach((e=>this._keysToZoomAction[e]=0)),t.zoomOut.forEach((e=>this._keysToZoomAction[e]=1))}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const t=e.modifiers;if(t.size>0&&!t.has("Shift"))return;const{key:i}=e.data;if(!(i in this._keysToZoomAction))return;const n=this._keysToZoomAction[i],{mapViewNavigation:s}=this.view;let o=null;switch(n){case 0:o=s.zoomIn();break;case 1:o=s.zoomOut();break;default:return}s.begin(),o.then((()=>s.end())),e.stopPropagation()}}class Nl extends Ln{constructor(e,t){super(!0),this.view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",t,(e=>this._handleMouseWheel(e)))}_handleMouseWheel(e){if(!this.view.navigation.mouseWheelZoomEnabled)return;if(e.preventDefault(),e.stopPropagation(),!this._canZoom)return;const t=this.view.mapViewNavigation,{x:i,y:n,deltaY:s}=e.data,o=1/.6**(1/60*s),r=t.zoom(o,[i,n]);r&&(this._canZoom=!1,r.catch((()=>{})).then((()=>{this._canZoom=!0,t.end()})))}}class zl extends Ln{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",(e=>this._handleDrag(e))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const t=this.view.mapViewNavigation;this.dragEventSeparator=new Pl({start:(e,i)=>{t.pinch.begin(this.view,i.data),i.stopPropagation()},update:(e,i)=>{t.pinch.update(this.view,i.data),i.stopPropagation()},end:(e,i)=>{t.pinch.end(this.view),i.stopPropagation()},condition:e=>e>=2})}_handleDrag(e){this.dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}function Bl(e){const t=e.native;return t?{buttons:t.buttons.map((e=>e.pressed?e.value?e.value:1:0)),axes:t.axes.map((t=>function(e,t){const i=Math.abs(e);return i<t?0:Object(s.av)(e)*(i-t)/(1-t)}(t,e.axisThreshold)))}:{buttons:[],axes:[]}}class Hl{constructor(e,t){this.element=e,this.input=t,this._hasEventListeners=!1,this.onConnectGamepad=e=>{this.connectGamepad(e.gamepad)},this.onDisconnectGamepad=e=>{const t=e.gamepad,i=t.index,n=this.inputDevices[i];n&&(this.emitGamepadEvent(t,Bl(n),!1),this.inputDevices.splice(i,1),this.latestUpdate.splice(i,1),this.input.gamepad.devices.remove(n),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this.callback=e}connectGamepad(e){const t=new Rr(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this.startPolling():this.stopPolling()}startPolling(){null==this.frameTask&&(this.frameTask=Object(s.a0)({update:()=>this.readGamepadState()}))}stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}readGamepadState(){const e=document.hasFocus(),t=this.element.contains(document.activeElement),i="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!t;this.forEachGamepad((e=>{const t=this.inputDevices[e.index];if(!t)return;const n=this.latestUpdate[e.index],s=Bl(t),o=i||function(e){for(let t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(let t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}(s);if(n){if(n.timestamp===e.timestamp)return;if(!n.active&&o)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}(n.state,s))return}this.emitGamepadEvent(e,s,!o)}))}forEachGamepad(e){const t=window.navigator.getGamepads();for(let i=0;i<t.length;i++){const n=t[i];this.validate(n)&&e(n)}}emitGamepadEvent(e,t,i){const n=this.latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:i},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:o})}validate(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}const Ul=Object(o.a)("trident"),Gl=Object(o.a)("edge"),ql=Object(o.a)("chrome"),$l=Object(o.a)("ff"),Wl=Object(o.a)("safari"),Kl="esri-view-surface--touch-none",Zl="esri-view-surface--touch-pan";class Jl{constructor(e,t){this.input=t,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Hl(e,this.input),this._gamepadSource.onEvent=e=>this._callback("gamepad",e)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((e=>{this._releasePointerCaptureSafe(e)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(Yl[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&Yl[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(Yl[e],t),this._active[e]=t}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}setPointerCapture(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Kl:Zl),this._element.classList.add(this._browserTouchPanningEnabled?Zl:Kl)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Kl),this._element.classList.remove(Zl),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(e){}}_updateNormalizedPointerLikeEvent(e,t){const i=$o(this._element,e);return Jl.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),t.x=i.x,t.y=i.y,t}_handleKey(e,t){const i=function(e){if(void 0!==e.key)return Object(s.T)(e);const t=Fn[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}(t);i&&"key-up"===e&&this._keyDownState.delete(i);const n={native:t,key:i,repeat:i&&this._keyDownState.has(i)};i&&"key-down"===e&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,t){let i=t.deltaY;switch(t.deltaMode){case 0:(Ul||Gl)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Ul||Gl?i*=.7:ql||Wl?i*=.6:$l&&(i*=1.375);const n=Math.abs(i);if(n>100){const e=.02;i=i/n*200/(1+Math.exp(-e*(n-100)))}const s=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:i});this._callback(e,s)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const i={native:t};t.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){"Alt"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}Jl.test={disableSubpixelCoordinates:!1};const Yl={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Xl extends Ln{constructor(){super(!0),this.registerIncoming("context-menu",(e=>{e.data.native.preventDefault()}))}}function Ql(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}const ec=250,tc=10,ic=350,nc=35;class sc extends Ln{constructor(e=ec,t=tc,i=ic,n=nc,o=s.aw){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=n,this._clock=o,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach((e=>{null!=e.doubleClickTimeout&&(e.doubleClickTimeout.remove(),e.doubleClickTimeout=null)}))}get hasPendingInputs(){return sr(this._pointerState,(e=>null!=e.doubleClickTimeout))}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_handleImmediateClick(e){const t=e.data,i=this._pointerId(t),n=this._pointerState.get(i);if(n){const s="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Ql(n.event.data,t)>s?(this._clearDoubleClickTimeout(i,!0),this._startClick(e)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(n.event.data,void 0,n.event.modifiers))}else this._startClick(e)}_startClick(e){const t=this._pointerId(e.data),i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(t,{event:e,doubleClickTimeout:this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(t)),i)}),this.refreshHasPendingInputs()}_handlePointerDrag(e){const t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)}_handleDrag(e){const t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)}_clearDoubleClickTimeout(e,t){const i=this._pointerState.get(e);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}}class oc extends Ln{constructor(e=ec,t=tc,i=ic,n=nc,o=s.aw){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=n,this._clock=o,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=Object(w.j)(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new Pl({start:(e,t)=>this._dragStart(e,t),update:(e,t)=>this._dragUpdate(t),end:(e,t)=>this._dragEnd(t)}),this.registerIncoming("drag",(e=>this._dragEventSeparator.handle(e))),this.registerIncoming("pointer-down",(e=>this._handlePointerDown(e))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()))}onUninstall(){this._pointerState.forEach((e=>{null!=e.doubleTapTimeout&&(e.doubleTapTimeout.remove(),e.doubleTapTimeout=null)}))}get hasPendingInputs(){return sr(this._pointerState,(e=>null!=e.doubleTapTimeout))}_clearPointerDown(e){const t=this._pointerState.get(e);t&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs())}_createDoubleTapDragData(e,t,i){const{button:n,buttons:s,pointer:o,pointers:r,pointerType:a,timestamp:l}=i;return{action:e,delta:t,button:n,buttons:s,pointer:o,pointers:r,pointerType:a,timestamp:l}}_dragStart(e,t){if(!this._doubleTapDragReady||1!==e)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:i,modifiers:n}=t,{center:s}=i;this._dragStartCenter=s;const o=this._createDoubleTapDragData("begin",Object(w.j)(0,0),i);this._doubleTapDrag.emit(o,void 0,n),t.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:n}=t,s=Object(w.j)(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("update",s,t);this._doubleTapDrag.emit(o,void 0,i),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:n}=t,s=Object(w.j)(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("end",s,t);this._doubleTapDrag.emit(o,void 0,i),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:t}=e,i=this._pointerId(t),n=this._pointerState.get(i),{pointerType:s}=t.native;if(n){const o="touch"===s?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(i),Ql(n.event.data,t)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_pointerId(e){const{native:t}=e,{pointerId:i,button:n,pointerType:s}=t;return"mouse"===s?`${i}:${n}`:`${s}`}_storePointerDown(e){const{data:t}=e,{pointerType:i}=t.native,n=this._pointerId(t),s="touch"===i?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay,o=this._clock.setTimeout((()=>this._clearPointerDown(n)),s);this._pointerState.set(n,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}}class rc extends Ln{constructor(e){super(!1),this.navigationTouch=e,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this.handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this.handlePointerUpAndPointerLost.bind(this))}createPayload(e,t,i,n){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:n,pointers:cc(this.activePointerMap),pointer:t,angle:i.angle,radius:i.radius,center:i.center}}addPointer(e){const t=e.native.pointerId,i=lc(this.activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,n);const s=hc(n,ac(this.activePointerMap));n.initialAngle=s,n.lastAngle=s,this.updatePointerAngles(i)}updatePointer(e){if(e&&null==e.x&&null==e.y)return;const t=e.native.pointerId,i=this.activePointerMap.get(t);i?i.event=e:this.addPointer(e)}removePointer(e){const t=lc(this.activePointerMap).angle;this.activePointerMap.delete(e),this.updatePointerAngles(t)}updatePointerAngles(e){const t=lc(this.activePointerMap);this.activePointerMap.forEach((i=>{i.initialAngle=hc(i,t)-e,i.lastAngle=hc(i,t)-e}))}emitEvent(e,t,i){const n=lc(this.activePointerMap);this.drag.emit(this.createPayload(e,t,n,i),void 0,this.startStateModifiers)}handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,i=Object(T.d)(e.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(e.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",e.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",e.data,Object(T.d)(e.timestamp))))}handlePointerDrag(e){const t=e.data,i=t.currentEvent,n=Object(T.d)(e.timestamp);switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this.updatePointer(i),!this.isCurrentDragSuppressed&&this.emitEvent("update",i,n)):(this.addPointer(i),this.emitEvent("added",i,n),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(i),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",i,n))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function ac(e){const t=[];return e.forEach((e=>{t.push(Object(w.j)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Object(w.j)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[i,n]=e,[s,o]=[n.x-i.x,n.y-i.y];return t.radius=Math.sqrt(s*s+o*o)/2,t.center.x=(i.x+n.x)/2,t.center.y=(i.y+n.y)/2,t}let i=0,n=0;for(let t=0;t<e.length;t++)i+=e[t].x,n+=e[t].y;i/=e.length,n/=e.length;const s=e.map((e=>e.x-i)),o=e.map((e=>e.y-n));let r=0,a=0,l=0,c=0,h=0,d=0,u=0;for(let e=0;e<s.length;e++){const t=s[e],i=o[e],n=t*t,p=i*i;r+=n,a+=p,l+=t*i,c+=n*t,h+=p*i,d+=t*p,u+=i*n}const p=.5*(c+d),b=.5*(h+u),m=r*a-l*l,g=(p*a-b*l)/m,f=(r*b-l*p)/m,y=Object(w.j)(g+i,f+n);return{radius:Math.sqrt(g*g+f*f+(r+a)/e.length),center:y}}(t)}function lc(e){const t=ac(e);let i=0;return e.forEach((e=>{let n=hc(e,t),s=n-e.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=e.lastAngle+s,e.lastAngle=n;const o=n-e.initialAngle;i+=o})),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function cc(e){const t=new Map;return e.forEach(((e,i)=>t.set(i,e.event))),t}function hc(e,t){const i=e.event,n=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,n)}var dc;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(dc||(dc={}));class uc extends Ln{constructor(e=ec,t=tc,i=ic,n=nc,o=s.aw){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=n,this._clock=o,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")}))}onUninstall(){this._pointerState.forEach((e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=this._pointerId(t);if(!this._pointerState.has(i)){const e={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(i,e),this.startCapturingPointer(t.native)}}_handlePointerLoss(e,t){const i=e.data,n=this._pointerId(i),s=this._pointerState.get(n);if(s&&"pointer-up"===t&&s.downButton===i.native.button){const t=s.immediateDoubleClick;if(t){t.timeoutHandle.remove();const n="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Ql(t,e.data)>n?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,t.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,t){const i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(e.data)),i)}}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_removeState(e){const t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}const pc=300,bc=1.5,mc=6,gc=6,fc=500;class yc extends Ln{constructor(e=pc,t=bc,i=mc,n=gc,o=fc,r=s.aw){super(!1),this.maximumClickDelay=e,this.movementUntilMouseDrag=t,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=n,this.holdDelay=o,this._clock=r,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=t.native.pointerId;let n=null;0===this._pointerState.size&&(n=this._clock.setTimeout((()=>{const t=this._pointerState.get(i);if(t){if(!t.isDragging){const i=t.previousEvent;this._pointerHold.emit(i,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this.holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(e)}_createPointerDragData(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}_handlePointerMove(e){const t=e.data,i=t.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,t),void 0,n.modifiers):function(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}(t,n.startEvent)>this._getDragThreshold(t.native.pointerType)&&this.startDragging(e),n.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;case"mouse":default:return this.movementUntilMouseDrag}}startDragging(e){const t=e.data,i=t.native.pointerId;this._pointerState.forEach((n=>{null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,t)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(null!=s.holdTimeout&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,"pointer-up"===t?i:s.previousEvent),void 0,s.modifiers):"pointer-up"===t&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this.maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}const vc="Ctrl",_c={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},wc={zoomIn:["=","+"],zoomOut:["-","_"]},Oc={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};let jc=class extends s.u{constructor(){super(...arguments),this._handles=new s.w}initialize(){this._handles.add([Object(l.f)(this.view,"ready",(()=>this._disconnect())),Object(l.m)(this.view,"ready",(()=>this._connect()))])}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect()}_disconnect(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)}_connect(){const e=this.view.surface,t=new Jl(e,this.view.input),i=[new uc,new yc,new sc,new rc(this.view.navigation),new oc],n=new Hn({eventSource:t,recognizers:i});n.installHandlers("prevent-context-menu",[new Xl],Gn.INTERNAL),n.installHandlers("navigation",[new zl(this.view),new Al(this.view),new Nl(this.view),new Cl(this.view),new Cl(this.view,[vc]),new Tl(this.view,"primary"),new Dl(this.view,_c),new Rl(this.view,wc),new Ll(this.view,Oc),new kl(this.view,"secondary"),new xl(this.view,"touch")],Gn.INTERNAL),this.view.viewEvents.connect(n),this._source=t,this._inputManager=n,Object(l.g)(this.view.navigation,"browserTouchPanEnabled",(e=>{this._source.browserTouchPanningEnabled=!e}))}get test(){return{inputManager:this._inputManager}}};Object(s.e)([Object(s.y)()],jc.prototype,"view",void 0),jc=Object(s.e)([Object(s.i)("esri.views.2d.input.MapViewInputManager")],jc);var Mc=jc;let Ic=0,Cc=class extends s.u{constructor(){super(...arguments),this.color=new s.j([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}get version(){return Ic++}};Object(s.e)([Object(s.y)({readOnly:!0})],Cc.prototype,"version",null),Object(s.e)([Object(s.y)({type:s.j})],Cc.prototype,"color",void 0),Object(s.e)([Object(s.y)({type:s.j})],Cc.prototype,"haloColor",void 0),Object(s.e)([Object(s.y)()],Cc.prototype,"haloOpacity",void 0),Object(s.e)([Object(s.y)()],Cc.prototype,"fillOpacity",void 0),Cc=Object(s.e)([Object(s.i)("esri.views.2d.support.HighlightOptions")],Cc);var xc=Cc;const Pc={checkMajorWebPerformanceCaveat:!0};const Tc="esri-component";let kc=class extends s.u{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Tc),t&&t.classList.remove(Tc),this._set("node",e))}castNode(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),Object(h.b)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};Object(s.e)([Object(s.y)({dependsOn:[]})],kc.prototype,"id",null),Object(s.e)([Object(s.y)()],kc.prototype,"node",null),Object(s.e)([Object(s.v)("node")],kc.prototype,"castNode",null),Object(s.e)([Object(s.y)({readOnly:!0})],kc.prototype,"widget",void 0),kc=Object(s.e)([Object(s.i)("esri.views.ui.Component")],kc);var Ec=kc;const Ac={left:0,top:0,bottom:0,right:0},Fc={bottom:30,top:15,right:15,left:15},Sc="manual",Vc="esri-ui",Dc="esri-ui-corner",Lc="esri-ui-inner-container",Rc="esri-ui-manual-container",Nc="esri-ui-corner-container",zc="esri-ui-top-left",Bc="esri-ui-top-right",Hc="esri-ui-bottom-left",Uc="esri-ui-bottom-right";function Gc(e){return"object"!=typeof e||e instanceof Ec||"declaredClass"in e||!("component"in e||"index"in e||"position"in e)?null:e}function qc(e,{top:t,bottom:i,left:n,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=n,e.style.right=s}let $c=class extends s.m.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new s.w,this.view=null,this._initContainers()}initialize(){this._handles.add([Object(l.g)(this,"view.padding, container",this._applyViewPadding.bind(this)),Object(l.g)(this,"padding",this._applyUIPadding.bind(this))])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Vc),this._attachContainers(e)),t&&(t.classList.remove(Vc),qc(t,{top:"",bottom:"",left:"",right:""}),Object(h.l)(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:{...Fc,...e}}get width(){const e=this.get("view.width")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,n;if(Array.isArray(e))return void e.forEach((e=>this.add(e,t)));const s=Gc(e);s&&({index:i,position:t,component:e,key:n}=s),t&&"object"==typeof t&&({index:i,key:n,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,n)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map((e=>this.remove(e,t)));const i=this._find(e);if(i){const n=this._componentToKey;if(n.has(e)&&n.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map((e=>this.empty(e))).reduce(((e,t)=>e.concat(t))):(e=e||Sc)===Sc?Array.prototype.slice.call(this._manualContainer.children).filter((e=>!e.classList.contains(Dc))).map((e=>this.remove(e))):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach((e=>this.move(e,t))),!e)return;let i;const n=Gc(e)||Gc(t);if(n&&(i=n.index,t=n.position,e=n.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,n){e instanceof Ec||(e=new Ec({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),n&&this._componentToKey.set(e,n)}_find(e){return e?e instanceof Ec?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||Ac}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Lc),e.classList.add(Nc);const t=document.createElement("div");t.classList.add(Lc),t.classList.add(Rc);const i=document.createElement("div");i.classList.add(zc),i.classList.add(Dc),e.appendChild(i);const n=document.createElement("div");n.classList.add(Bc),n.classList.add(Dc),e.appendChild(n);const s=document.createElement("div");s.classList.add(Hc),s.classList.add(Dc),e.appendChild(s);const o=document.createElement("div");o.classList.add(Uc),o.classList.add(Dc),e.appendChild(o),this._innerContainer=e,this._manualContainer=t;const r=Object(h.e)();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":r?n:i,"top-trailing":r?i:n,"bottom-leading":r?o:s,"bottom-trailing":r?s:o},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||Sc,n=e.index,s=this._positionNameToContainerLookup[i],o=n>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),!o)return void s.appendChild(t.node);const r=Array.prototype.slice.call(s.children);0!==n?n>=r.length?s.appendChild(t.node):Object(h.c)(t.node,r[n]):s.firstChild?Object(h.c)(t.node,s.firstChild):s.appendChild(t.node)}_applyViewPadding(){const e=this.container;e&&qc(e,this._toPxPosition(this._getViewPadding()))}_applyUIPadding(){const e=this._innerContainer;e&&qc(e,this._toPxPosition(this.padding))}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return 0===e?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some((n=>(t=n===e,t&&(i=n),t))),i}_findById(e){let t,i=null;return this._components.some((n=>(t=n.id===e,t&&(i=n),t))),i}_findByNode(e){let t,i=null;return this._components.some((n=>(t=n.node===e,t&&(i=n),t))),i}};Object(s.e)([Object(s.y)()],$c.prototype,"container",null),Object(s.e)([Object(s.y)()],$c.prototype,"height",null),Object(s.e)([Object(s.y)({value:Fc})],$c.prototype,"padding",null),Object(s.e)([Object(s.v)("padding")],$c.prototype,"castPadding",null),Object(s.e)([Object(s.y)()],$c.prototype,"view",void 0),Object(s.e)([Object(s.y)()],$c.prototype,"width",null),$c=Object(s.e)([Object(s.i)("esri.views.ui.UI")],$c);var Wc=$c;function Kc(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function Zc(e,t,i){i&&t&&(e.find((e=>e.layerView===t&&e.text===i))||e.push({text:i,layerView:t}))}const Jc=[];let Yc=class extends d.b{constructor(e){super(e),this.clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new s.L,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const t=this.get("view.allLayerViews");t&&this.handles.add(t.map((e=>e.watch(["suspended","attributionVisible"],this._updateAttributionItems))),"suspension"),e&&e.removed&&e.removed.forEach((e=>{this._pendingAttributions.delete(e),this._fetchedAttributionData.delete(e)})),this._updateAttributionItems()},this._updateAttributionItems=()=>{const e=this.get("view.allLayerViews");Jc.length=0,e?(e.forEach((e=>{if(e.suspended||!e.get("layer.attributionVisible"))return;const t=e.layer;if(Kc(t,"user"))return void Zc(Jc,e,t.copyright);if(t.hasAttributionData){if(this._fetchedAttributionData.has(e)){const i=this._fetchedAttributionData.get(e);return void(i?Zc(Jc,e,this._getDynamicAttribution(i,this.view,t)):Kc(t)&&Zc(Jc,e,t.copyright))}return void this._fetchAttributionData(e)}const i=t.get("portalItem.accessInformation");Zc(Jc,e,i||t.copyright)})),function(e,t){return e.length!==t.length||e.some(((e,i)=>e.text!==t[i].text))}(this.items,Jc)&&(this.items.removeAll(),this.items.addMany(Jc)),Jc.length=0,this.notifyChange("state")):this.clear()},this.handles.add([Object(l.d)(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this.clear),Object(l.k)(this,"view.stationary",(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Object(s.ax)(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,function(e){return"bing-maps"===e.type}(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,n={};if(!i)return n;for(let e=0;e<i.length;e++){const o=i[e],r=o.coverageAreas;if(!r)return;for(const i of r){const r=i.bbox,a=i.zoomMin-(t&&i.zoomMin?1:0),l=i.zoomMax-(t&&i.zoomMax?1:0),c={xmin:r[1],ymin:r[0],xmax:r[3],ymax:r[2],spatialReference:s.A.WGS84},h={extent:Object(s.Z)(c),attribution:o.attribution||"",score:null!=i.score?i.score:100,id:e};for(let e=a;e<=l;e++)n[e]=n[e]||[],n[e].push(h)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,t,i){const{extent:n,scale:o}=t;let r=i.tileInfo.scaleToZoom(o);if(r=Math.min(e.maxKey,Math.round(r)),!n||null==r||r<=-1)return"";const a=e[r],l=Object(s.ai)(n.center.clone().normalize(),t.spatialReference),c={};return a?a.filter((e=>{const t=!c[e.id]&&l&&Object(s.as)(e.extent,l);return t&&(c[e.id]=!0),t})).sort(((e,t)=>t.score-e.score||e.objectId-t.objectId)).map((e=>e.attribution)).join(", "):""}};Object(s.e)([Object(s.y)({readOnly:!0,type:s.L})],Yc.prototype,"items",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Yc.prototype,"state",null),Object(s.e)([Object(s.y)()],Yc.prototype,"view",void 0),Yc=Object(s.e)([Object(s.i)("esri.widgets.Attribution.AttributionViewModel")],Yc);var Xc=Yc;const Qc="esri-attribution esri-widget",eh="esri-widget__anchor",th="esri-attribution__powered-by",ih="esri-attribution__sources",nh="esri-attribution--open",sh="esri-attribution__sources--open",oh="esri-attribution__link",rh="esri-icon-description",ah="esri-interactive";let lh=class extends h.a{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this.iconClass=rh,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Xc}initialize(){this.own(Object(l.d)(this,"viewModel.items","change",(()=>this.scheduleRender())))}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(-1===e.indexOf(t.text)&&e.push(t.text),e)),[]).join(this.itemDelimiter)}render(){const e={[nh]:this._isOpen};return Object(h.i)("div",{bind:this,class:this.classes(Qc,e),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Object(h.i)("div",{class:th},"Powered by"," ",Object(h.i)("a",{class:this.classes(oh,eh),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive(),i=t?0:-1,{attributionText:n}=this,s=t?"button":void 0,o={[sh]:e,[ah]:t};return Object(h.i)("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes(ih,o),innerHTML:n,role:s,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth}_afterSourcesNodeUpdate(e){let t=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>=n,r=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,r&&(t=!0),this._isOpen){const e=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive()&&(this._isOpen=!this._isOpen)}_isInteractive(){return this._isOpen||this._attributionTextOverflowed}};Object(s.e)([Object(s.y)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],lh.prototype,"attributionText",null),Object(s.e)([Object(s.y)()],lh.prototype,"iconClass",void 0),Object(s.e)([Object(s.y)()],lh.prototype,"itemDelimiter",void 0),Object(s.e)([Object(s.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],lh.prototype,"label",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Attribution/t9n/Attribution")],lh.prototype,"messages",void 0),Object(s.e)([Object(u.l)("viewModel.view")],lh.prototype,"view",void 0),Object(s.e)([Object(s.y)({type:Xc})],lh.prototype,"viewModel",void 0),Object(s.e)([Object(p.c)()],lh.prototype,"_toggleState",null),lh=Object(s.e)([Object(s.i)("esri.widgets.Attribution")],lh);var ch=lh;let hh=class extends(Object(p.b)(s.u)){constructor(e){super(e),this._handles=new s.w,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(Object(l.g)(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){null!=e&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&("2d"===e.type?this._handles.add(Object(l.g)(this,"view.rotation",this._updateForRotation)):this._handles.add(Object(l.g)(this,"view.camera",this._updateForCamera)))}};Object(s.e)([Object(s.y)({readOnly:!0})],hh.prototype,"canShowNorth",null),Object(s.e)([Object(s.y)()],hh.prototype,"orientation",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],hh.prototype,"state",null),Object(s.e)([Object(s.y)()],hh.prototype,"view",void 0),hh=Object(s.e)([Object(s.i)("esri.widgets.CompassViewModel")],hh);var dh=hh;const uh="esri-compass esri-widget--button esri-widget",ph="esri-icon-font-fallback-text",bh="esri-compass__icon",mh="esri-icon-dial",gh="esri-icon-compass",fh="esri-icon-locate-circled",yh="esri-interactive",vh="esri-disabled";let _h=class extends h.a{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=fh,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new dh}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i="disabled"===t,n="compass"==("rotation"===t?"rotation":"compass"),s=i?-1:0,o={[vh]:i,[yh]:!i},r={[gh]:n,[mh]:!n},{messages:a}=this;return Object(h.i)("div",{bind:this,class:this.classes(uh,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},Object(h.i)("span",{"aria-hidden":"true",class:this.classes(bh,r),styles:this._toRotationTransform(e)}),Object(h.i)("span",{class:ph},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};Object(s.e)([Object(u.l)("viewModel.goToOverride")],_h.prototype,"goToOverride",void 0),Object(s.e)([Object(s.y)()],_h.prototype,"iconClass",void 0),Object(s.e)([Object(s.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_h.prototype,"label",void 0),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Compass/t9n/Compass")],_h.prototype,"messages",void 0),Object(s.e)([Object(u.l)("viewModel.view")],_h.prototype,"view",void 0),Object(s.e)([Object(s.y)({type:dh})],_h.prototype,"viewModel",void 0),Object(s.e)([Object(p.c)()],_h.prototype,"_reset",null),_h=Object(s.e)([Object(s.i)("esri.widgets.Compass")],_h);var wh=_h;let Oh=class extends s.u{constructor(e){super(e),this._handles=new s.w,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Object(l.m)(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};Object(s.e)([Object(s.y)({readOnly:!0})],Oh.prototype,"state",null),Object(s.e)([Object(s.y)()],Oh.prototype,"navigationMode",void 0),Object(s.e)([Object(s.y)()],Oh.prototype,"view",void 0),Oh=Object(s.e)([Object(s.i)("esri.widgets.NavigationToggleViewModel")],Oh);var jh=Oh;const Mh="esri-navigation-toggle esri-widget",Ih="esri-navigation-toggle__button esri-widget--button",Ch="esri-navigation-toggle__button--active",xh="esri-navigation-toggle__button--pan",Ph="esri-navigation-toggle__button--rotate",Th="esri-navigation-toggle--horizontal",kh="esri-icon-rotate",Eh="esri-icon-pan",Ah="esri-icon-pan2",Fh="esri-disabled";let Sh=class extends h.a{constructor(e,t){super(e,t),this.iconClass=Ah,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new jh}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e="disabled"===this.get("viewModel.state"),t="pan"===this.get("viewModel.navigationMode"),i={[Fh]:e,[Th]:"horizontal"===this.layout},n={[Ch]:t},s={[Ch]:!t},o=e?-1:0,r=this.messages.toggle;return Object(h.i)("div",{bind:this,class:this.classes(Mh,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":r,title:r},Object(h.i)("div",{class:this.classes(Ih,xh,n)},Object(h.i)("span",{class:Eh})),Object(h.i)("div",{class:this.classes(Ih,Ph,s)},Object(h.i)("span",{class:kh})))}_toggle(){this.toggle()}};Object(s.e)([Object(s.y)()],Sh.prototype,"iconClass",void 0),Object(s.e)([Object(s.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Sh.prototype,"label",void 0),Object(s.e)([Object(s.y)({value:"vertical"})],Sh.prototype,"layout",null),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Sh.prototype,"messages",void 0),Object(s.e)([Object(u.l)("viewModel.view")],Sh.prototype,"view",void 0),Object(s.e)([Object(s.y)({type:jh})],Sh.prototype,"viewModel",void 0),Object(s.e)([Object(p.c)()],Sh.prototype,"_toggle",null),Sh=Object(s.e)([Object(s.i)("esri.widgets.NavigationToggle")],Sh);var Vh=Sh;const Dh="esri-widget--button esri-widget",Lh="esri-disabled",Rh="esri-interactive",Nh="esri-icon-font-fallback-text",zh="esri-icon";let Bh=class extends h.a{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[Lh]:!this.enabled,[Rh]:this.enabled},i={[this.iconClass]:!!this.iconClass};return Object(h.i)("div",{bind:this,class:this.classes(Dh,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Object(h.i)("span",{"aria-hidden":"true",role:"presentation",class:this.classes(zh,i)}),Object(h.i)("span",{class:Nh},this.title))}_triggerAction(){this.action.call(this)}};Object(s.e)([Object(s.y)()],Bh.prototype,"action",void 0),Object(s.e)([Object(s.y)()],Bh.prototype,"enabled",void 0),Object(s.e)([Object(s.y)()],Bh.prototype,"iconClass",void 0),Object(s.e)([Object(s.y)()],Bh.prototype,"title",void 0),Object(s.e)([Object(p.c)()],Bh.prototype,"_triggerAction",null),Bh=Object(s.e)([Object(s.i)("esri.widgets.IconButton")],Bh);var Hh=Bh;let Uh=class extends s.u{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}};Object(s.e)([Object(s.y)({readOnly:!0})],Uh.prototype,"canZoomIn",null),Object(s.e)([Object(s.y)({readOnly:!0})],Uh.prototype,"canZoomOut",null),Object(s.e)([Object(s.y)()],Uh.prototype,"view",void 0),Uh=Object(s.e)([Object(s.i)("esri.widgets.Zoom.ZoomConditions2D")],Uh);var Gh=Uh;let qh=class extends s.u{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};Object(s.e)([Object(s.y)({readOnly:!0})],qh.prototype,"canZoomIn",null),Object(s.e)([Object(s.y)({readOnly:!0})],qh.prototype,"canZoomOut",null),Object(s.e)([Object(s.y)()],qh.prototype,"view",void 0),qh=Object(s.e)([Object(s.i)("esri.widgets.Zoom.ZoomConditions3D")],qh);var $h=qh;let Wh=class extends s.u{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?"2d"===e.type?this._zoomConditions=new Gh({view:e}):"3d"===e.type&&(this._zoomConditions=new $h({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():Object(s.ay)(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():Object(s.ay)(e.goTo({zoomFactor:.5}))}};Object(s.e)([Object(s.y)()],Wh.prototype,"_zoomConditions",void 0),Object(s.e)([Object(s.y)({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],Wh.prototype,"canZoomIn",void 0),Object(s.e)([Object(s.y)({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],Wh.prototype,"canZoomOut",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],Wh.prototype,"state",null),Object(s.e)([Object(s.y)()],Wh.prototype,"view",null),Wh=Object(s.e)([Object(s.i)("esri.widgets.Zoom.ZoomViewModel")],Wh);var Kh=Wh;const Zh="esri-zoom esri-widget",Jh="esri-zoom--horizontal",Yh="esri-icon-plus",Xh="esri-icon-minus",Qh="esri-icon-zoom-in-magnifying-glass";let ed=class extends h.a{constructor(e,t){super(e,t),this.iconClass=Qh,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Kh}initialize(){this._zoomInButton=new Hh({action:this.zoomIn.bind(this),iconClass:Yh}),this._zoomOutButton=new Hh({action:this.zoomOut.bind(this),iconClass:Xh})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[Jh]:"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===e.state&&e.canZoomIn,this._zoomOutButton.enabled="ready"===e.state&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,Object(h.i)("div",{class:this.classes(Zh,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};Object(s.e)([Object(s.y)()],ed.prototype,"iconClass",void 0),Object(s.e)([Object(s.y)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ed.prototype,"label",void 0),Object(s.e)([Object(s.y)({value:"vertical"})],ed.prototype,"layout",null),Object(s.e)([Object(s.y)(),Object(h.f)("esri/widgets/Zoom/t9n/Zoom")],ed.prototype,"messages",void 0),Object(s.e)([Object(u.l)("viewModel.view")],ed.prototype,"view",void 0),Object(s.e)([Object(s.y)({type:Kh})],ed.prototype,"viewModel",void 0),ed=Object(s.e)([Object(s.i)("esri.widgets.Zoom")],ed);var td=ed;const id="esri.views.ui.DefaultUI";s.n.getLogger(id);let nd=class extends Wc{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([Object(l.g)(this,"components",this._componentsWatcher.bind(this)),Object(l.g)(this,"view",this._updateViewAwareWidgets.bind(this))])}_add(e,t,i,n){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,n)}_removeComponents(e){e.forEach((e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())}))}_updateViewAwareWidgets(e){this.components.forEach((t=>{const i=this._find(t),n=i&&i.widget;(function(e){return e&&void 0!==e.view})(n)&&(n.view=e)}))}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(-1===e.indexOf("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(e){this.initialized&&e.forEach((e=>this.add(this._createComponent(e),this._defaultPositionLookup[e])))}_createComponent(e){const t=this._createWidget(e);if(t)return new Ec({id:e,node:t})}_createWidget(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}_createAttribution(){return new ch({view:this.view})}_createCompass(){return new wh({view:this.view})}_createNavigationToggle(){return new Vh({view:this.view})}_createZoom(){return new td({view:this.view})}};Object(s.e)([Object(s.y)()],nd.prototype,"components",void 0),nd=Object(s.e)([Object(s.i)(id)],nd);var sd=nd;let od=class extends sd{constructor(e){super(e),this.components=["attribution","zoom"]}};Object(s.e)([Object(s.y)()],od.prototype,"components",void 0),od=Object(s.e)([Object(s.i)("esri.views.ui.2d.DefaultUI2D")],od);var rd=od;const ad=s.n.getLogger("esri.views.MapView");let ld,cd,hd,dd,ud,pd;function bd(e,t,i){if(e)if(Array.isArray(e)||s.L.isCollection(e)){if(0===e.length)return;e.forEach((e=>bd(e,t,i)))}else!function(e){return e instanceof r.a}(e)?i.add(e):t.add(e)}let md=class extends(ne(Go(Ml))){constructor(e){super(e),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new a.a({root:this,rootCollectionNames:["basemapView.baseLayerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:e=>null}),this.floors=new s.L,this.graphicsView=null,this.highlightOptions=new xc,this.inputManager=new Mc({view:this}),this.mapViewNavigation=null,this.supersampleScreenhotsEnabled=!0,this.ui=new rd,this.rendering=!1,Object(c.c)()}destroy(){this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get background(){return this.get("map.initialViewProperties.background")||null}set background(e){void 0===e?this._clearOverride("background"):this._override("background",e)}get textureManager(){return this._stage.painter.textureManager}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}toMap(e){if(Ko(e)){const t=Wo(this,e);return super.toMap(t)}return super.toMap(e)}hitTest(e,t){const i=Ko(e)?Wo(this,e):e;if(!this.ready||isNaN(i.x)||isNaN(i.y))return Promise.resolve({screenPoint:i,results:[]});const n=this.toMap(i),s=[this.graphicsView];s.push.apply(s,this.allLayerViews.toArray().reverse());const o=new Set,r=new Set,a=new Set,l=new Set;return t&&(bd(t&&t.include,o,a),bd(t&&t.exclude,r,l)),Promise.all(s.map((e=>!e||!e.hitTest||a.size>0&&!e.layer||a.size>0&&e.layer&&!a.has(e.layer)||l.size>0&&e.layer&&l.has(e.layer)?null:e.hitTest(i.x,i.y)))).then((e=>({screenPoint:i,results:e.filter((e=>null!=e&&(!(o.size>0)||o.has(e))&&(!(r.size>0)||!r.has(e)))).map((e=>({mapPoint:n,graphic:e})))})))}takeScreenshot(e){return this.ready?this._stage.takeScreenshot(function(e,t){const i=H(e,t),n=i.area,s=i.width/n.width,o=Z(i,t.padding),r=o.left+o.right,a=o.top+o.bottom,l=t.width-r,c=t.height-a,h=Math.floor(l*s+r),d=Math.floor(c*s+a),u=e&&e.layers?e.layers:[],p=i.ignoreBackground,b=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(n.x*s)+o.left,y:Math.floor(n.y*s)+o.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:u,disableDecorations:i.disableDecorations,ignoreBackground:p,ignorePadding:b}}(e,this),this.allLayerViews):Promise.reject("Map view cannot be used before it is ready")}on(e,t,i,n){return this.inputManager&&this.viewEvents.on(e,t,i,n)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e)}))}forceDOMReadyCycle(){this.forceReadyCycle()}validate(){let e=function(e){e={...Pc,...e};const t=Object(N.b)();return t.available?e.checkMajorWebPerformanceCaveat&&t.majorPerformanceCaveat?new s.s("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?t.supportsElementIndexUint?t.supportsStandardDerivatives?t.supportsInstancedArrays?null:new s.s("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new s.s("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new s.s("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new s.s("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new s.s("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new s.s("webgl:required","WebGL is required but not supported.")}({checkMajorWebPerformanceCaveat:!1});return Object(o.a)("safari")&&Object(o.a)("safari")<9&&(e=new s.s("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Object(o.a)("safari")})),Object(s.P)(e)?(ad.warn("#validate()",e.message),Promise.reject(e)):async function(){const[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:n,MapViewNavigation:s,MagnifierView2D:o,Stage:r}]=await Promise.all([Promise.all([i.e(0),i.e(19)]).then(i.bind(null,173)),Promise.all([i.e(2),i.e(3),i.e(4),i.e(11),i.e(12)]).then(i.bind(null,174))]);cd=e,hd=t,dd=n,ud=s,pd=o,ld=r}()}_startup(){this.timeline.begin("MapView Startup"),super._startup(),this.graphics.owner=this;const e={disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},t=new ld(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenhotsEnabled,contextOptions:e,renderingOptions:this.renderingOptions,timeline:this.timeline}),i=new cd({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new hd(this.featuresTilingScheme)}),n=new ud({view:this,animationManager:this.animationManager}),s=new dd({view:this});this._magnifierView=new pd,this._magnifierView.magnifier=this.magnifier,this._stage=t,this.frameTask.graphicsView=i,this._set("graphicsView",i),this._set("mapViewNavigation",n),this._set("labelManager",s),this.handles.add([this.rootLayerViews.on("change",(()=>this._updateStageChildren())),t.on("post-render",(()=>this._set("rendering",t.renderRequested))),t.on("will-render",(()=>this._set("rendering",t.renderRequested))),t.on("webgl-error",(e=>this.fatalError=e.error)),Object(l.g)(this,"stationary",(e=>t.stationary=e),!0),Object(l.g)(this,"state.id",(()=>t.state=this.state),!0),Object(l.g)(this,"background",(e=>{t.background=e,this._magnifierView.background=e}),!0),Object(l.g)(this,"magnifier",(e=>this._magnifierView.magnifier=e),!0),Object(l.g)(this,"renderingOptions",(e=>t.renderingOptions=e),!0),Object(l.g)(this,"highlightOptions",(()=>t.highlightOptions=this.highlightOptions),!0)],"map-view"),t.state=this.state,this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach((e=>e(this))),this.timeline.end("MapView Startup")}_teardown(){this.handles.remove("map-view"),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this.graphicsView.destroy(),this.mapViewNavigation.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,super._teardown()}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach((e=>{this._stage.addChild(e.container)}));const e=this.graphicsView;this._stage.addChild(e.container),this._stage.addChild(this._magnifierView)}};Object(s.e)([Object(s.y)({type:B})],md.prototype,"background",null),Object(s.e)([Object(s.y)()],md.prototype,"floors",void 0),Object(s.e)([Object(s.y)()],md.prototype,"graphicsView",void 0),Object(s.e)([Object(s.y)({type:xc})],md.prototype,"highlightOptions",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],md.prototype,"inputManager",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],md.prototype,"textureManager",null),Object(s.e)([Object(s.y)({readOnly:!0})],md.prototype,"mapViewNavigation",void 0),Object(s.e)([Object(s.y)({type:Boolean})],md.prototype,"navigating",null),Object(s.e)([Object(s.y)({type:Boolean,constructOnly:!0})],md.prototype,"supersampleScreenhotsEnabled",void 0),Object(s.e)([Object(s.y)({type:rd})],md.prototype,"ui",void 0),Object(s.e)([Object(s.y)({readOnly:!0})],md.prototype,"rendering",void 0),Object(s.e)([Object(s.y)({constructOnly:!0})],md.prototype,"renderCanvas",void 0),Object(s.e)([Object(s.y)({constructOnly:!0})],md.prototype,"deactivatedWebGLExtensions",void 0),Object(s.e)([Object(s.y)({constructOnly:!0})],md.prototype,"debugWebGLExtensions",void 0),md=Object(s.e)([Object(s.i)("esri.views.MapView")],md);var gd=md}}]);