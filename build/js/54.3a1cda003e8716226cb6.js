(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{282:function(e,t,i){"use strict";i.r(t);i(18);var s=i(0),a=(i(1),i(5)),r=i(138),n=i(335),h=i(23),o=i(14),l=i(357),c=i(4),p=i(20),d=i(374),u=i(90),y=i(375),b=i(317),w=i(342),g=i(346),m=i(349),v=i(345),x=i(365),j=i(373);i(43),i(72),i(2),i(40),i(3),i(6),i(15),i(75),i(10),i(27),i(89),i(53),i(9),i(51),i(82),i(13),i(52),i(12),i(44),i(106),i(63),i(55),i(119),i(17),i(120),i(48),i(83),i(115),i(47),i(103),i(32),i(57),i(21),i(62),i(26),i(24),i(85),i(70),i(109),i(49),i(111),i(71),i(104),i(112),i(108),i(58),i(105),i(110),i(107),i(56),i(16),i(116),i(36),i(64),i(42),i(113),i(41),i(121),i(117),i(114),i(66),i(31),i(118),i(35),i(54),i(123),i(8),i(73),i(84),i(65),i(74),i(11),i(7),i(19),i(67),i(86),i(137),i(122),i(318),i(310),i(314),i(337),i(333),i(313),i(312),i(320),i(330),i(334),i(338),i(344),i(339),i(329),i(322),i(324),i(331),i(340),i(341),i(321),i(327),i(328),i(316),i(343),i(332),i(325),i(323),i(319),i(326);const O=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)throw new s.s("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:a}=i,r=Object(l.a)(i,t);if(!a||!Object(s.P)(r))throw new s.s("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:r});const n=await r.getRequiredFields(),h=new o.b;h.geometry=e,h.outFields=n,h.outSpatialReference=e.spatialReference;const c=this.view.resolution,p="2d"===this.view.type?new s._(c,c,this.view.spatialReference):new s._(.5*c,.5*c,this.view.spatialReference),{returnTopmostRaster:d,showNoDataRecords:u}=r.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},y={returnDomainValues:!0,returnTopmostRaster:d,pixelSize:p,showNoDataRecords:u};return i.queryVisibleRasters(h,y).then((e=>e))}canResume(){var e;return!(!super.canResume()||null!=(e=this.timeExtent)&&e.isEmpty)}};return Object(s.e)([Object(s.y)()],t.prototype,"layer",void 0),Object(s.e)([Object(s.y)()],t.prototype,"suspended",void 0),Object(s.e)([Object(s.y)(h.n)],t.prototype,"timeExtent",void 0),Object(s.e)([Object(s.y)()],t.prototype,"view",void 0),t=Object(s.e)([Object(s.i)("esri.views.layers.ImageryLayerView")],t),t},f=s.n.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");let _=class extends s.u{constructor(){super(...arguments),this.attached=!1,this.container=new b.b,this.updateRequested=!1,this._graphicsView=null,this._projectFullExtentPromise=null,this.type="Graphics",this._graphics=new u.b,this._updateGraphics=Object(s.aa)((async(e,t)=>{if(!e.stationary)return;const i=e.state,a=new s.M({xmin:i.extent.xmin,ymin:i.extent.ymin,xmax:i.extent.xmax,ymax:i.extent.ymax,spatialReference:i.spatialReference}),r=e.state.size[0],n=e.state.size[1],h={};h.timeExtent=this.timeExtent,h.requestAsImageElement=!1,h.signal=t,null==this._projectFullExtentPromise&&(this._projectFullExtentPromise=this._getProjectedFullExtent(a.spatialReference));const o="vector-field"===this.layer.renderer.type?this.layer.renderer.symbolTileSize:50,l=await this._projectFullExtentPromise,c=Object(d.d)(a,r,n,o,l),p=await this.layer.fetchImage(c.extent,c.width,c.height,h),u=this.layer.renderer;if("vector-field"===u.type){this._pixelData={extent:c.extent,pixelBlock:p.pixelData.pixelBlock};const t=await u.getGraphicsFromPixelData(p.pixelData,"vector-uv"===this.layer.rasterInfo.dataType);this._graphicsView.update(e),await Object(s.X)(0).then((()=>{this._graphics.set("items",t)}))}}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this._updateGraphics(e).catch((e=>{Object(s.B)(e)||f.error(e)}))}hitTest(e,t){const i=this.view.toMap(Object(c.j)(e,t));return Promise.resolve(new p.a({attributes:{},geometry:i,layer:this.layer}))}attach(){this._graphicsView=new w.a({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g.a(this.view.featuresTilingScheme)}),this.attached=!0}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}async _getProjectedFullExtent(e){try{return await Object(y.e)(this.layer.fullExtent,e)}catch(t){try{const t=(await Object(s.C)(this.layer.url,{query:{option:"footprints",outSR:e.wkid||JSON.stringify(e.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return t?s.M.fromJSON(t):null}catch{return null}}}};Object(s.e)([Object(s.y)()],_.prototype,"attached",void 0),Object(s.e)([Object(s.y)()],_.prototype,"container",void 0),Object(s.e)([Object(s.y)()],_.prototype,"layer",void 0),Object(s.e)([Object(s.y)()],_.prototype,"timeExtent",void 0),Object(s.e)([Object(s.y)()],_.prototype,"view",void 0),Object(s.e)([Object(s.y)()],_.prototype,"updateRequested",void 0),Object(s.e)([Object(s.y)()],_.prototype,"updating",null),Object(s.e)([Object(s.r)({graphics:"Graphics"})],_.prototype,"type",void 0),_=Object(s.e)([Object(s.i)("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],_);var R=_;const E=s.n.getLogger("esri.views.2d.layers.imagery.ImageryView2D");let q=class extends s.u{constructor(){super(...arguments),this.attached=!1,this.container=new b.b,this.updateRequested=!1,this.type="Imagery",this._bitmapView=null}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{Object(s.B)(e)||E.error(e)}))}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e,t){const i=this.view.toMap(Object(c.j)(e,t));return Promise.resolve(new p.a({attributes:{},geometry:i,layer:this.layer}))}attach(){const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new x.a,this.strategy=new j.a({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()}),this.attached=!0}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports((e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then((t=>{const i=e.source;i.pixelBlock=t.pixelBlock,i.filter=e=>this.layer.applyFilter(e),this.container.requestRender()}))}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.container.children;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,i=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),s=Object(m.j)(i,t);return s?{extent:s.extent,pixelBlock:s.pixelBlock}:null}return null}_fetchImage(e,t,i,s){return(s=s||{}).timeExtent=this.timeExtent,s.requestAsImageElement=!0,this.layer.fetchImage(e,t,i,s).then((e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:s.signal}).then((t=>{const i=new v.b(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return i.filter=e=>this.layer.applyFilter(e),i}))))}};Object(s.e)([Object(s.y)()],q.prototype,"attached",void 0),Object(s.e)([Object(s.y)()],q.prototype,"container",void 0),Object(s.e)([Object(s.y)()],q.prototype,"layer",void 0),Object(s.e)([Object(s.y)()],q.prototype,"strategy",void 0),Object(s.e)([Object(s.y)()],q.prototype,"timeExtent",void 0),Object(s.e)([Object(s.y)()],q.prototype,"view",void 0),Object(s.e)([Object(s.y)()],q.prototype,"updateRequested",void 0),Object(s.e)([Object(s.y)()],q.prototype,"updating",null),Object(s.e)([Object(s.r)({imagery:"Imagery"})],q.prototype,"type",void 0),q=Object(s.e)([Object(s.i)("esri.views.2d.layers.imagery.ImageryView2D")],q);var V=q;let I=class extends(O(Object(r.m)(Object(n.b)(n.a)))){constructor(){super(...arguments),this._exportImageVersion=-1}initialize(){this.handles.add(Object(a.g)(this,["layer.blendMode"],(e=>{this.subview&&(this.subview.container.blendMode=e)}),!0))}get pixelData(){return this.updating?null:this.subview.getPixelData()}get updating(){return!(this.subview&&!this.subview.updating)}hitTest(e,t){return this.suspended||!this.subview?Promise.resolve(null):this.subview.hitTest(e,t)}update(e){var t;null==(t=this.subview)||t.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([Object(a.g)(this,"layer.exportImageServiceParameters.version",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch("timeExtent",(()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()})),this.layer.on("redraw",(()=>this.subview.redraw())),Object(a.h)(this.layer,"renderer",(()=>this._setSubView()))],"imagerylayerview-update")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||!this.suspended&&this.subview.isUpdating()}_setSubView(){var e;let t="Imagery";var i,s;"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(t="Graphics"),this.subview&&this.subview.type===t||(null==(i=this.subview)||i.uninstall(this.container),null==(s=this.subview)||s.destroy(),this.subview="Imagery"===t?new V({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new R({layer:this.layer,view:this.view,timeExtent:this.timeExtent}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode),this.requestUpdate()}};Object(s.e)([Object(s.y)()],I.prototype,"pixelData",null),Object(s.e)([Object(s.y)({readOnly:!0})],I.prototype,"updating",null),Object(s.e)([Object(s.y)()],I.prototype,"subview",void 0),I=Object(s.e)([Object(s.i)("esri.views.2d.layers.ImageryLayerView2D")],I);var D=I;t.default=D}}]);